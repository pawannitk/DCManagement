{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _pick from \"lodash/pick\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport { QueryState, styled, t, tn, useTheme, usePrevious, css, getNumberFormatter, getExtensionsRegistry } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport { addQueryEditor, clearQueryResults, CtasEnum, fetchQueryResults, reFetchQueryResults, reRunQuery } from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport Icons from 'src/components/Icons';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nvar LimitingFactor;\n(function (LimitingFactor) {\n  LimitingFactor[\"Query\"] = \"QUERY\";\n  LimitingFactor[\"QueryAndDropdown\"] = \"QUERY_AND_DROPDOWN\";\n  LimitingFactor[\"Dropdown\"] = \"DROPDOWN\";\n  LimitingFactor[\"NotLimited\"] = \"NOT_LIMITED\";\n})(LimitingFactor || (LimitingFactor = {}));\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\nconst extensionsRegistry = getExtensionsRegistry();\nconst ResultSet = ({ cache = false, csv = true, database = {}, displayLimit, height, queryId, search = true, showSql = false, showSqlInline = false, visualize = true, defaultQueryLimit }) => {var _extensionsRegistry$g, _query$results2, _query$extra$progress, _query$extra2;\n  const user = useSelector(({ user }) => user, shallowEqual);\n  const query = useSelector(({ sqlLab: { queries } }) => _pick(queries[queryId], [\n  'id',\n  'errorMessage',\n  'cached',\n  'results',\n  'resultsKey',\n  'dbId',\n  'tab',\n  'sql',\n  'templateParams',\n  'schema',\n  'rows',\n  'queryLimit',\n  'limitingFactor',\n  'trackingUrl',\n  'state',\n  'errors',\n  'link',\n  'ctas',\n  'ctas_method',\n  'tempSchema',\n  'tempTable',\n  'isDataPreview',\n  'progress',\n  'extra']\n  ), shallowEqual);\n  const ResultTable = (_extensionsRegistry$g = extensionsRegistry.get('sqleditor.extension.resultTable')) != null ? _extensionsRegistry$g :\n  FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (query.errorMessage &&\n    query.errorMessage.indexOf('session timed out') > 0) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n  const fetchResults = (q) => {\n    dispatch(fetchQueryResults(q, displayLimit));\n  };\n  const prevQuery = usePrevious(query);\n  useEffect(() => {var _query$results, _query$results$data;\n    if (cache && query.cached && (query == null ? void 0 : (_query$results = query.results) == null ? void 0 : (_query$results$data = _query$results.data) == null ? void 0 : _query$results$data.length) > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== (prevQuery == null ? void 0 : prevQuery.resultsKey)) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n  const calculateAlertRefHeight = (alertElement) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else\n    {\n      setAlertIsOpen(false);\n    }\n  };\n  const popSelectStar = (tempSchema, tempTable) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`\n    };\n    dispatch(addQueryEditor(qe));\n  };\n  const changeSearch = (event) => {\n    setSearchText(event.target.value);\n  };\n  const createExploreResultsOnClick = async (clickEvent) => {\n    const { results } = query;\n    const openInNewWindow = clickEvent.metaKey;\n    if (results != null && results.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map((column) => column.column_name)\n        }\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else\n      {\n        history.push(url);\n      }\n    } else\n    {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n  const getExportCsvUrl = (clientId) => `/api/v1/sqllab/export/${clientId}/`;\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n      const datasource = {\n        columns: query.results.columns,\n        name: (query == null ? void 0 : query.tab) || 'Untitled',\n        dbId: query == null ? void 0 : query.dbId,\n        sql: query == null ? void 0 : query.sql,\n        templateParams: query == null ? void 0 : query.templateParams,\n        schema: query == null ? void 0 : query.schema\n      };\n      return ___EmotionJSX(ResultSetControls, null,\n      ___EmotionJSX(SaveDatasetModal, { visible: showSaveDatasetModal, onHide: () => setShowSaveDatasetModal(false), buttonTextOnSave: t('Save & Explore'), buttonTextOnOverwrite: t('Overwrite & Explore'), modalDescription: t('Save this query as a virtual dataset to continue exploring'), datasource: datasource }),\n      ___EmotionJSX(ResultSetButtons, null,\n      visualize && (database == null ? void 0 : database.allows_virtual_table_explore) && ___EmotionJSX(ExploreResultsButton, { database: database, onClick: createExploreResultsOnClick }),\n      csv && ___EmotionJSX(Button, { buttonSize: \"small\", href: getExportCsvUrl(query.id) },\n      ___EmotionJSX(\"i\", { className: \"fa fa-file-text-o\" }), \" \", t('Download to CSV')\n      ),\n\n      ___EmotionJSX(CopyToClipboard, { text: prepareCopyToClipboardTabularData(data, columns), wrapped: false, copyNode: ___EmotionJSX(Button, { buttonSize: \"small\" },\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\" }), \" \", t('Copy to Clipboard')\n        ), hideTooltip: true })\n      ),\n      search && ___EmotionJSX(\"input\", { type: \"text\", onChange: changeSearch, value: searchText, className: \"form-control input-sm\", placeholder: t('Filter results') })\n      );\n    }\n    return ___EmotionJSX(\"div\", null);\n  };\n  const renderRowsReturned = (alertMessage) => {var _user$roles, _results$data;\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results == null ? void 0 : results.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!(user != null && (_user$roles = user.roles) != null && _user$roles.Admin);\n    const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data = results.data) == null ? void 0 : _results$data.length) || 0);\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t('The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n      'Please add additional limits/filters or download to csv to see more rows up to ' +\n      'the %(limit)d limit.', { rows: rowsCount, limit }),\n      withoutAdmin: t('The number of results displayed is limited to %(rows)d. ' +\n      'Please add additional limits/filters, download to csv, or contact an admin ' +\n      'to see more rows up to the %(limit)d limit.', { rows: rowsCount, limit })\n    };\n    const shouldUseDefaultDropdownAlert = limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.Dropdown &&\n    !shouldUseDefaultDropdownAlert) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the limit dropdown.', { rows });\n    } else\n    if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query and limit dropdown.', { rows });\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows\n    });\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n    if (alertMessage) {\n      return ___EmotionJSX(React.Fragment, null,\n      !limitReached && shouldUseDefaultDropdownAlert && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n      ___EmotionJSX(Alert, { type: \"warning\", message: t('%(rows)d rows returned', { rows }), onClose: () => setAlertIsOpen(false), description: t('The number of rows displayed is limited to %(rows)d by the dropdown.', { rows }) })\n      ),\n      limitReached && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n      ___EmotionJSX(Alert, { type: \"warning\", onClose: () => setAlertIsOpen(false), message: t('%(rows)d rows returned', { rows: rowsCount }), description: isAdmin ?\n        displayMaxRowsReachedMessage.withAdmin :\n        displayMaxRowsReachedMessage.withoutAdmin })\n      )\n      );\n    }\n    const showRowsReturned = showSqlInline || !limitReached && !shouldUseDefaultDropdownAlert;\n    return ___EmotionJSX(React.Fragment, null,\n    showRowsReturned && ___EmotionJSX(ReturnedRows, null,\n    ___EmotionJSX(Tooltip, { id: \"sqllab-rowcount-tooltip\", title: tooltipText, placement: \"left\" },\n    ___EmotionJSX(Label, { css: css`\n                  line-height: ${theme.typography.sizes.l}px;\n                ` },\n    limitMessage && ___EmotionJSX(Icons.ExclamationCircleOutlined, { css: css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    ` }),\n    tn('%s row', '%s rows', rows, formattedRowCount)\n    )\n    )\n    )\n    );\n  };\n  const limitReached = query == null ? void 0 : (_query$results2 = query.results) == null ? void 0 : _query$results2.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database != null && database.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n  let trackingUrl;\n  if (query.trackingUrl &&\n  query.state !== QueryState.Success &&\n  query.state !== QueryState.Fetching) {\n    trackingUrl = ___EmotionJSX(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", href: query.trackingUrl, target: \"_blank\" },\n    query.state === QueryState.Running ?\n    t('Track job') :\n    t('See query details')\n    );\n  }\n  if (showSql) {\n    sql = ___EmotionJSX(HighlightedSql, _extends({ sql: query.sql }, showSqlInline && { maxLines: 1, maxWidth: 60 }));\n  }\n  if (query.state === QueryState.Stopped) {\n    return ___EmotionJSX(Alert, { type: \"warning\", message: t('Query was stopped') });\n  }\n  if (query.state === QueryState.Failed) {var _query$extra, _query$extra$errors, _query$errors;\n    return ___EmotionJSX(ResultlessStyles, null,\n    ___EmotionJSX(ErrorMessageWithStackTrace, { title: t('Database error'), error: (query == null ? void 0 : (_query$extra = query.extra) == null ? void 0 : (_query$extra$errors = _query$extra.errors) == null ? void 0 : _query$extra$errors[0]) || (query == null ? void 0 : (_query$errors = query.errors) == null ? void 0 : _query$errors[0]), subtitle: ___EmotionJSX(MonospaceDiv, null, query.errorMessage), copyText: query.errorMessage || undefined, link: query.link, source: \"sqllab\" }),\n    trackingUrl\n    );\n  }\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return ___EmotionJSX(\"div\", null,\n    ___EmotionJSX(Alert, { type: \"info\", message: ___EmotionJSX(React.Fragment, null,\n      t(object), \" [\",\n      ___EmotionJSX(\"strong\", null,\n      tempSchema ? `${tempSchema}.` : '',\n      tempTable\n      ), \"] \",\n      t('was created'), \" \\xA0\",\n      ___EmotionJSX(ButtonGroup, null,\n      ___EmotionJSX(Button, { buttonSize: \"small\", css: /*#__PURE__*/_css({ marginRight: theme.gridUnit }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3Bhd2Fuay9Eb2N1bWVudHMvZGNpbS9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtVjJDIiwiZmlsZSI6Ii9ob21lL3Bhd2Fuay9Eb2N1bWVudHMvZGNpbS9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHNoYWxsb3dFcXVhbCwgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgdXNlSGlzdG9yeSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHsgcGljayB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0IHsgUXVlcnlTdGF0ZSwgc3R5bGVkLCB0LCB0biwgdXNlVGhlbWUsIHVzZVByZXZpb3VzLCBjc3MsIGdldE51bWJlckZvcm1hdHRlciwgZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5LCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCBFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSBmcm9tICdzcmMvY29tcG9uZW50cy9FcnJvck1lc3NhZ2UvRXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UnO1xuaW1wb3J0IHsgU2F2ZURhdGFzZXRNb2RhbCwgfSBmcm9tICdzcmMvU3FsTGFiL2NvbXBvbmVudHMvU2F2ZURhdGFzZXRNb2RhbCc7XG5pbXBvcnQgeyBFWFBMT1JFX0NIQVJUX0RFRkFVTFQgfSBmcm9tICdzcmMvU3FsTGFiL3R5cGVzJztcbmltcG9ydCB7IG1vdW50RXhwbG9yZVVybCB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscyc7XG5pbXBvcnQgeyBwb3N0Rm9ybURhdGEgfSBmcm9tICdzcmMvZXhwbG9yZS9leHBsb3JlVXRpbHMvZm9ybURhdGEnO1xuaW1wb3J0IFByb2dyZXNzQmFyIGZyb20gJ3NyYy9jb21wb25lbnRzL1Byb2dyZXNzQmFyJztcbmltcG9ydCBMb2FkaW5nIGZyb20gJ3NyYy9jb21wb25lbnRzL0xvYWRpbmcnO1xuaW1wb3J0IENhcmQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQ2FyZCc7XG5pbXBvcnQgTGFiZWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTGFiZWwnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL1Rvb2x0aXAnO1xuaW1wb3J0IEZpbHRlcmFibGVUYWJsZSBmcm9tICdzcmMvY29tcG9uZW50cy9GaWx0ZXJhYmxlVGFibGUnO1xuaW1wb3J0IENvcHlUb0NsaXBib2FyZCBmcm9tICdzcmMvY29tcG9uZW50cy9Db3B5VG9DbGlwYm9hcmQnO1xuaW1wb3J0IHsgYWRkRGFuZ2VyVG9hc3QgfSBmcm9tICdzcmMvY29tcG9uZW50cy9NZXNzYWdlVG9hc3RzL2FjdGlvbnMnO1xuaW1wb3J0IHsgcHJlcGFyZUNvcHlUb0NsaXBib2FyZFRhYnVsYXJEYXRhIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzIH0gZnJvbSAnc3JjL3V0aWxzL2xvY2FsU3RvcmFnZUhlbHBlcnMnO1xuaW1wb3J0IHsgYWRkUXVlcnlFZGl0b3IsIGNsZWFyUXVlcnlSZXN1bHRzLCBDdGFzRW51bSwgZmV0Y2hRdWVyeVJlc3VsdHMsIHJlRmV0Y2hRdWVyeVJlc3VsdHMsIHJlUnVuUXVlcnksIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBVUkxfUEFSQU1TIH0gZnJvbSAnc3JjL2NvbnN0YW50cyc7XG5pbXBvcnQgSWNvbnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvSWNvbnMnO1xuaW1wb3J0IEV4cGxvcmVDdGFzUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24nO1xuaW1wb3J0IEV4cGxvcmVSZXN1bHRzQnV0dG9uIGZyb20gJy4uL0V4cGxvcmVSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBIaWdobGlnaHRlZFNxbCBmcm9tICcuLi9IaWdobGlnaHRlZFNxbCc7XG5pbXBvcnQgUXVlcnlTdGF0ZUxhYmVsIGZyb20gJy4uL1F1ZXJ5U3RhdGVMYWJlbCc7XG52YXIgTGltaXRpbmdGYWN0b3I7XG4oZnVuY3Rpb24gKExpbWl0aW5nRmFjdG9yKSB7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeVwiXSA9IFwiUVVFUllcIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIlF1ZXJ5QW5kRHJvcGRvd25cIl0gPSBcIlFVRVJZX0FORF9EUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiRHJvcGRvd25cIl0gPSBcIkRST1BET1dOXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJOb3RMaW1pdGVkXCJdID0gXCJOT1RfTElNSVRFRFwiO1xufSkoTGltaXRpbmdGYWN0b3IgfHwgKExpbWl0aW5nRmFjdG9yID0ge30pKTtcbmNvbnN0IFJlc3VsdENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICByb3ctZ2FwOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbmA7XG5jb25zdCBSZXN1bHRsZXNzU3R5bGVzID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgbWluLWhlaWdodDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDI1fXB4O1xuICBbcm9sZT0nYWxlcnQnXSB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbiAgLnNxbC1yZXN1bHQtdHJhY2stam9iIHtcbiAgICBtYXJnaW4tdG9wOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgfVxuYDtcbi8vIE1ha2luZyB0ZXh0IHJlbmRlciBsaW5lIGJyZWFrcy90YWJzIGFzIGlzIGFzIG1vbm9zcGFjZSxcbi8vIGJ1dCB3cmFwcGluZyB0ZXh0IHRvbyBzbyB0ZXh0IGRvZXNuJ3Qgb3ZlcmZsb3dcbmNvbnN0IE1vbm9zcGFjZURpdiA9IHN0eWxlZC5kaXYgYFxuICBmb250LWZhbWlseTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LmZhbWlsaWVzLm1vbm9zcGFjZX07XG4gIHdoaXRlLXNwYWNlOiBwcmU7XG4gIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7XG4gIG92ZXJmbG93LXg6IGF1dG87XG4gIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDtcbmA7XG5jb25zdCBSZXR1cm5lZFJvd3MgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1zaXplOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc31weDtcbiAgbGluZS1oZWlnaHQ6IDE7XG5gO1xuY29uc3QgUmVzdWx0U2V0Q29udHJvbHMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuYDtcbmNvbnN0IFJlc3VsdFNldEJ1dHRvbnMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZ3JpZDtcbiAgZ3JpZC1hdXRvLWZsb3c6IGNvbHVtbjtcbiAgcGFkZGluZy1yaWdodDogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG5gO1xuY29uc3QgUk9XU19DSElQX1dJRFRIID0gMTAwO1xuY29uc3QgR0FQID0gODtcbmNvbnN0IGV4dGVuc2lvbnNSZWdpc3RyeSA9IGdldEV4dGVuc2lvbnNSZWdpc3RyeSgpO1xuY29uc3QgUmVzdWx0U2V0ID0gKHsgY2FjaGUgPSBmYWxzZSwgY3N2ID0gdHJ1ZSwgZGF0YWJhc2UgPSB7fSwgZGlzcGxheUxpbWl0LCBoZWlnaHQsIHF1ZXJ5SWQsIHNlYXJjaCA9IHRydWUsIHNob3dTcWwgPSBmYWxzZSwgc2hvd1NxbElubGluZSA9IGZhbHNlLCB2aXN1YWxpemUgPSB0cnVlLCBkZWZhdWx0UXVlcnlMaW1pdCwgfSkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VTZWxlY3RvcigoeyB1c2VyIH0pID0+IHVzZXIsIHNoYWxsb3dFcXVhbCk7XG4gICAgY29uc3QgcXVlcnkgPSB1c2VTZWxlY3RvcigoeyBzcWxMYWI6IHsgcXVlcmllcyB9IH0pID0+IHBpY2socXVlcmllc1txdWVyeUlkXSwgW1xuICAgICAgICAnaWQnLFxuICAgICAgICAnZXJyb3JNZXNzYWdlJyxcbiAgICAgICAgJ2NhY2hlZCcsXG4gICAgICAgICdyZXN1bHRzJyxcbiAgICAgICAgJ3Jlc3VsdHNLZXknLFxuICAgICAgICAnZGJJZCcsXG4gICAgICAgICd0YWInLFxuICAgICAgICAnc3FsJyxcbiAgICAgICAgJ3RlbXBsYXRlUGFyYW1zJyxcbiAgICAgICAgJ3NjaGVtYScsXG4gICAgICAgICdyb3dzJyxcbiAgICAgICAgJ3F1ZXJ5TGltaXQnLFxuICAgICAgICAnbGltaXRpbmdGYWN0b3InLFxuICAgICAgICAndHJhY2tpbmdVcmwnLFxuICAgICAgICAnc3RhdGUnLFxuICAgICAgICAnZXJyb3JzJyxcbiAgICAgICAgJ2xpbmsnLFxuICAgICAgICAnY3RhcycsXG4gICAgICAgICdjdGFzX21ldGhvZCcsXG4gICAgICAgICd0ZW1wU2NoZW1hJyxcbiAgICAgICAgJ3RlbXBUYWJsZScsXG4gICAgICAgICdpc0RhdGFQcmV2aWV3JyxcbiAgICAgICAgJ3Byb2dyZXNzJyxcbiAgICAgICAgJ2V4dHJhJyxcbiAgICBdKSwgc2hhbGxvd0VxdWFsKTtcbiAgICBjb25zdCBSZXN1bHRUYWJsZSA9IGV4dGVuc2lvbnNSZWdpc3RyeS5nZXQoJ3NxbGVkaXRvci5leHRlbnNpb24ucmVzdWx0VGFibGUnKSA/P1xuICAgICAgICBGaWx0ZXJhYmxlVGFibGU7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IFtzZWFyY2hUZXh0LCBzZXRTZWFyY2hUZXh0XSA9IHVzZVN0YXRlKCcnKTtcbiAgICBjb25zdCBbY2FjaGVkRGF0YSwgc2V0Q2FjaGVkRGF0YV0gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgW3Nob3dTYXZlRGF0YXNldE1vZGFsLCBzZXRTaG93U2F2ZURhdGFzZXRNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2FsZXJ0SXNPcGVuLCBzZXRBbGVydElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG4gICAgY29uc3QgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGlmIChxdWVyeS5lcnJvck1lc3NhZ2UgJiZcbiAgICAgICAgICAgIHF1ZXJ5LmVycm9yTWVzc2FnZS5pbmRleE9mKCdzZXNzaW9uIHRpbWVkIG91dCcpID4gMCkge1xuICAgICAgICAgICAgZGlzcGF0Y2gocmVSdW5RdWVyeShxdWVyeSkpO1xuICAgICAgICB9XG4gICAgfSwgW10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG9ubHkgZG8gdGhpcyB0aGUgZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IGlzIHJlbmRlcmVkL21vdW50ZWRcbiAgICAgICAgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQoKTtcbiAgICB9LCBbcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnRdKTtcbiAgICBjb25zdCBmZXRjaFJlc3VsdHMgPSAocSkgPT4ge1xuICAgICAgICBkaXNwYXRjaChmZXRjaFF1ZXJ5UmVzdWx0cyhxLCBkaXNwbGF5TGltaXQpKTtcbiAgICB9O1xuICAgIGNvbnN0IHByZXZRdWVyeSA9IHVzZVByZXZpb3VzKHF1ZXJ5KTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkICYmIHF1ZXJ5Py5yZXN1bHRzPy5kYXRhPy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXRDYWNoZWREYXRhKHF1ZXJ5LnJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICBkaXNwYXRjaChjbGVhclF1ZXJ5UmVzdWx0cyhxdWVyeSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5ICYmIHF1ZXJ5LnJlc3VsdHNLZXkgIT09IHByZXZRdWVyeT8ucmVzdWx0c0tleSkge1xuICAgICAgICAgICAgZmV0Y2hSZXN1bHRzKHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sIFtxdWVyeSwgY2FjaGVdKTtcbiAgICBjb25zdCBjYWxjdWxhdGVBbGVydFJlZkhlaWdodCA9IChhbGVydEVsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKGFsZXJ0RWxlbWVudCkge1xuICAgICAgICAgICAgc2V0QWxlcnRJc09wZW4odHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3BlbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHBvcFNlbGVjdFN0YXIgPSAodGVtcFNjaGVtYSwgdGVtcFRhYmxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHFlID0ge1xuICAgICAgICAgICAgaWQ6IHNob3J0aWQuZ2VuZXJhdGUoKSxcbiAgICAgICAgICAgIG5hbWU6IHRlbXBUYWJsZSxcbiAgICAgICAgICAgIGF1dG9ydW46IGZhbHNlLFxuICAgICAgICAgICAgZGJJZDogcXVlcnkuZGJJZCxcbiAgICAgICAgICAgIHNxbDogYFNFTEVDVCAqIEZST00gJHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfSR7dGVtcFRhYmxlfWAsXG4gICAgICAgIH07XG4gICAgICAgIGRpc3BhdGNoKGFkZFF1ZXJ5RWRpdG9yKHFlKSk7XG4gICAgfTtcbiAgICBjb25zdCBjaGFuZ2VTZWFyY2ggPSAoZXZlbnQpID0+IHtcbiAgICAgICAgc2V0U2VhcmNoVGV4dChldmVudC50YXJnZXQudmFsdWUpO1xuICAgIH07XG4gICAgY29uc3QgY3JlYXRlRXhwbG9yZVJlc3VsdHNPbkNsaWNrID0gYXN5bmMgKGNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzIH0gPSBxdWVyeTtcbiAgICAgICAgY29uc3Qgb3BlbkluTmV3V2luZG93ID0gY2xpY2tFdmVudC5tZXRhS2V5O1xuICAgICAgICBpZiAocmVzdWx0cz8ucXVlcnlfaWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IHBvc3RGb3JtRGF0YShyZXN1bHRzLnF1ZXJ5X2lkLCAncXVlcnknLCB7XG4gICAgICAgICAgICAgICAgLi4uRVhQTE9SRV9DSEFSVF9ERUZBVUxULFxuICAgICAgICAgICAgICAgIGRhdGFzb3VyY2U6IGAke3Jlc3VsdHMucXVlcnlfaWR9X19xdWVyeWAsXG4gICAgICAgICAgICAgICAgLi4ue1xuICAgICAgICAgICAgICAgICAgICBhbGxfY29sdW1uczogcmVzdWx0cy5jb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLmNvbHVtbl9uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtb3VudEV4cGxvcmVVcmwobnVsbCwge1xuICAgICAgICAgICAgICAgIFtVUkxfUEFSQU1TLmZvcm1EYXRhS2V5Lm5hbWVdOiBrZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcGVuSW5OZXdXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnLCAnbm9yZWZlcnJlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdVbmFibGUgdG8gY3JlYXRlIGNoYXJ0IHdpdGhvdXQgYSBxdWVyeSBpZC4nKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdldEV4cG9ydENzdlVybCA9IChjbGllbnRJZCkgPT4gYC9hcGkvdjEvc3FsbGFiL2V4cG9ydC8ke2NsaWVudElkfS9gO1xuICAgIGNvbnN0IHJlbmRlckNvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgICBpZiAoc2VhcmNoIHx8IHZpc3VhbGl6ZSB8fCBjc3YpIHtcbiAgICAgICAgICAgIGxldCB7IGRhdGEgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICAvLyBBZGRlZCBjb21wdXRlIGxvZ2ljIHRvIHN0b3AgdXNlciBmcm9tIGJlaW5nIGFibGUgdG8gU2F2ZSAmIEV4cGxvcmVcbiAgICAgICAgICAgIGNvbnN0IGRhdGFzb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgY29sdW1uczogcXVlcnkucmVzdWx0cy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIG5hbWU6IHF1ZXJ5Py50YWIgfHwgJ1VudGl0bGVkJyxcbiAgICAgICAgICAgICAgICBkYklkOiBxdWVyeT8uZGJJZCxcbiAgICAgICAgICAgICAgICBzcWw6IHF1ZXJ5Py5zcWwsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXJhbXM6IHF1ZXJ5Py50ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHF1ZXJ5Py5zY2hlbWEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0U2V0Q29udHJvbHM+XG4gICAgICAgICAgPFNhdmVEYXRhc2V0TW9kYWwgdmlzaWJsZT17c2hvd1NhdmVEYXRhc2V0TW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWwoZmFsc2UpfSBidXR0b25UZXh0T25TYXZlPXt0KCdTYXZlICYgRXhwbG9yZScpfSBidXR0b25UZXh0T25PdmVyd3JpdGU9e3QoJ092ZXJ3cml0ZSAmIEV4cGxvcmUnKX0gbW9kYWxEZXNjcmlwdGlvbj17dCgnU2F2ZSB0aGlzIHF1ZXJ5IGFzIGEgdmlydHVhbCBkYXRhc2V0IHRvIGNvbnRpbnVlIGV4cGxvcmluZycpfSBkYXRhc291cmNlPXtkYXRhc291cmNlfS8+XG4gICAgICAgICAgPFJlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAgICB7dmlzdWFsaXplICYmIGRhdGFiYXNlPy5hbGxvd3NfdmlydHVhbF90YWJsZV9leHBsb3JlICYmICg8RXhwbG9yZVJlc3VsdHNCdXR0b24gZGF0YWJhc2U9e2RhdGFiYXNlfSBvbkNsaWNrPXtjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2t9Lz4pfVxuICAgICAgICAgICAge2NzdiAmJiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBocmVmPXtnZXRFeHBvcnRDc3ZVcmwocXVlcnkuaWQpfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1maWxlLXRleHQtb1wiLz4ge3QoJ0Rvd25sb2FkIHRvIENTVicpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuXG4gICAgICAgICAgICA8Q29weVRvQ2xpcGJvYXJkIHRleHQ9e3ByZXBhcmVDb3B5VG9DbGlwYm9hcmRUYWJ1bGFyRGF0YShkYXRhLCBjb2x1bW5zKX0gd3JhcHBlZD17ZmFsc2V9IGNvcHlOb2RlPXs8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiPlxuICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmEgZmEtY2xpcGJvYXJkXCIvPiB7dCgnQ29weSB0byBDbGlwYm9hcmQnKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj59IGhpZGVUb29sdGlwLz5cbiAgICAgICAgICA8L1Jlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAge3NlYXJjaCAmJiAoPGlucHV0IHR5cGU9XCJ0ZXh0XCIgb25DaGFuZ2U9e2NoYW5nZVNlYXJjaH0gdmFsdWU9e3NlYXJjaFRleHR9IGNsYXNzTmFtZT1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIHBsYWNlaG9sZGVyPXt0KCdGaWx0ZXIgcmVzdWx0cycpfS8+KX1cbiAgICAgICAgPC9SZXN1bHRTZXRDb250cm9scz4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyUm93c1JldHVybmVkID0gKGFsZXJ0TWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHJvd3MsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IGxpbWl0TWVzc2FnZSA9ICcnO1xuICAgICAgICBjb25zdCBsaW1pdFJlYWNoZWQgPSByZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5TGltaXQgfHwgcmVzdWx0cy5xdWVyeS5saW1pdDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9ICEhdXNlcj8ucm9sZXM/LkFkbWluO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLm1pbihyb3dzIHx8IDAsIHJlc3VsdHM/LmRhdGE/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgY29uc3QgZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHdpdGhBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBjb25maWd1cmF0aW9uIERJU1BMQVlfTUFYX1JPVy4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycyBvciBkb3dubG9hZCB0byBjc3YgdG8gc2VlIG1vcmUgcm93cyB1cCB0byAnICtcbiAgICAgICAgICAgICAgICAndGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgICAgICB3aXRob3V0QWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZC4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycywgZG93bmxvYWQgdG8gY3N2LCBvciBjb250YWN0IGFuIGFkbWluICcgK1xuICAgICAgICAgICAgICAgICd0byBzZWUgbW9yZSByb3dzIHVwIHRvIHRoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCA9IGxpbWl0ID09PSBkZWZhdWx0UXVlcnlMaW1pdCAmJiBsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd247XG4gICAgICAgIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnkgJiYgY3N2KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIHF1ZXJ5JywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnlBbmREcm9wZG93bikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeSBhbmQgbGltaXQgZHJvcGRvd24uJywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFJvd0NvdW50ID0gZ2V0TnVtYmVyRm9ybWF0dGVyKCkocm93cyk7XG4gICAgICAgIGNvbnN0IHJvd3NSZXR1cm5lZE1lc3NhZ2UgPSB0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywge1xuICAgICAgICAgICAgcm93cyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gYCR7cm93c1JldHVybmVkTWVzc2FnZX0uICR7bGltaXRNZXNzYWdlfWA7XG4gICAgICAgIGlmIChhbGVydE1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgICB7IWxpbWl0UmVhY2hlZCAmJiBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93cyB9KX0gb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBkZXNjcmlwdGlvbj17dCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBkcm9wZG93bi4nLCB7IHJvd3MgfSl9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgICAge2xpbWl0UmVhY2hlZCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBtZXNzYWdlPXt0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywgeyByb3dzOiByb3dzQ291bnQgfSl9IGRlc2NyaXB0aW9uPXtpc0FkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aEFkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aG91dEFkbWlufS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNob3dSb3dzUmV0dXJuZWQgPSBzaG93U3FsSW5saW5lIHx8ICghbGltaXRSZWFjaGVkICYmICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCk7XG4gICAgICAgIHJldHVybiAoPD5cbiAgICAgICAge3Nob3dSb3dzUmV0dXJuZWQgJiYgKDxSZXR1cm5lZFJvd3M+XG4gICAgICAgICAgICA8VG9vbHRpcCBpZD1cInNxbGxhYi1yb3djb3VudC10b29sdGlwXCIgdGl0bGU9e3Rvb2x0aXBUZXh0fSBwbGFjZW1lbnQ9XCJsZWZ0XCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLmx9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAge2xpbWl0TWVzc2FnZSAmJiAoPEljb25zLkV4Y2xhbWF0aW9uQ2lyY2xlT3V0bGluZWQgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLm19cHg7XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgICBgfS8+KX1cbiAgICAgICAgICAgICAgICB7dG4oJyVzIHJvdycsICclcyByb3dzJywgcm93cywgZm9ybWF0dGVkUm93Q291bnQpfVxuICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvUmV0dXJuZWRSb3dzPil9XG4gICAgICA8Lz4pO1xuICAgIH07XG4gICAgY29uc3QgbGltaXRSZWFjaGVkID0gcXVlcnk/LnJlc3VsdHM/LmRpc3BsYXlMaW1pdFJlYWNoZWQ7XG4gICAgbGV0IHNxbDtcbiAgICBsZXQgZXhwbG9yZURCSWQgPSBxdWVyeS5kYklkO1xuICAgIGlmIChkYXRhYmFzZT8uZXhwbG9yZV9kYXRhYmFzZV9pZCkge1xuICAgICAgICBleHBsb3JlREJJZCA9IGRhdGFiYXNlLmV4cGxvcmVfZGF0YWJhc2VfaWQ7XG4gICAgfVxuICAgIGxldCB0cmFja2luZ1VybDtcbiAgICBpZiAocXVlcnkudHJhY2tpbmdVcmwgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJlxuICAgICAgICBxdWVyeS5zdGF0ZSAhPT0gUXVlcnlTdGF0ZS5GZXRjaGluZykge1xuICAgICAgICB0cmFja2luZ1VybCA9ICg8QnV0dG9uIGNsYXNzTmFtZT1cInNxbC1yZXN1bHQtdHJhY2stam9iXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17cXVlcnkudHJhY2tpbmdVcmx9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICB7cXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuUnVubmluZ1xuICAgICAgICAgICAgICAgID8gdCgnVHJhY2sgam9iJylcbiAgICAgICAgICAgICAgICA6IHQoJ1NlZSBxdWVyeSBkZXRhaWxzJyl9XG4gICAgICA8L0J1dHRvbj4pO1xuICAgIH1cbiAgICBpZiAoc2hvd1NxbCkge1xuICAgICAgICBzcWwgPSAoPEhpZ2hsaWdodGVkU3FsIHNxbD17cXVlcnkuc3FsfSB7Li4uKHNob3dTcWxJbmxpbmUgJiYgeyBtYXhMaW5lczogMSwgbWF4V2lkdGg6IDYwIH0pfS8+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN0b3BwZWQpIHtcbiAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1F1ZXJ5IHdhcyBzdG9wcGVkJyl9Lz47XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAgPEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIHRpdGxlPXt0KCdEYXRhYmFzZSBlcnJvcicpfSBlcnJvcj17cXVlcnk/LmV4dHJhPy5lcnJvcnM/LlswXSB8fCBxdWVyeT8uZXJyb3JzPy5bMF19IHN1YnRpdGxlPXs8TW9ub3NwYWNlRGl2PntxdWVyeS5lcnJvck1lc3NhZ2V9PC9Nb25vc3BhY2VEaXY+fSBjb3B5VGV4dD17cXVlcnkuZXJyb3JNZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPlxuICAgICAgICB7dHJhY2tpbmdVcmx9XG4gICAgICA8L1Jlc3VsdGxlc3NTdHlsZXM+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkuY3Rhcykge1xuICAgICAgICBjb25zdCB7IHRlbXBTY2hlbWEsIHRlbXBUYWJsZSB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBvYmplY3QgPSAnVGFibGUnO1xuICAgICAgICBpZiAocXVlcnkuY3Rhc19tZXRob2QgPT09IEN0YXNFbnVtLlZpZXcpIHtcbiAgICAgICAgICAgIG9iamVjdCA9ICdWaWV3JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9ezw+XG4gICAgICAgICAgICAgIHt0KG9iamVjdCl9IFtcbiAgICAgICAgICAgICAgPHN0cm9uZz5cbiAgICAgICAgICAgICAgICB7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ31cbiAgICAgICAgICAgICAgICB7dGVtcFRhYmxlfVxuICAgICAgICAgICAgICA8L3N0cm9uZz5cbiAgICAgICAgICAgICAgXSB7dCgnd2FzIGNyZWF0ZWQnKX0gJm5ic3A7XG4gICAgICAgICAgICAgIDxCdXR0b25Hcm91cD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGNzcz17eyBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgfX0gb25DbGljaz17KCkgPT4gcG9wU2VsZWN0U3Rhcih0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpfT5cbiAgICAgICAgICAgICAgICAgIHt0KCdRdWVyeSBpbiBhIG5ldyB0YWInKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8RXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uIHRhYmxlPXt0ZW1wVGFibGV9IHNjaGVtYT17dGVtcFNjaGVtYX0gZGJJZD17ZXhwbG9yZURCSWR9Lz5cbiAgICAgICAgICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICAgICAgICAgIDwvPn0vPlxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkucmVzdWx0cykge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMgfSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIFJlc3VsdFNldFJvd3NSZXR1cm5lZCBjb21wb25lbnQgaWYgIWxpbWl0UmVhY2hlZFxuICAgICAgICBjb25zdCByb3dNZXNzYWdlSGVpZ2h0ID0gIWxpbWl0UmVhY2hlZCA/IDMyIDogMDtcbiAgICAgICAgLy8gQWNjb3VudHMgZm9yIG9mZnNldCBuZWVkZWQgZm9yIGhlaWdodCBvZiBBbGVydCBpZiB0aGlzLnN0YXRlLmFsZXJ0SXNPcGVuXG4gICAgICAgIGNvbnN0IGFsZXJ0Q29udGFpbmVySGVpZ2h0ID0gNzA7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhpcy5yZW5kZXJSb3dzUmV0dXJuZWQoKVxuICAgICAgICAvLyBpZiB3ZSB3YW50IHJlc3VsdHMgcGFuZWwgdG8gYmUgcHJvcGVyIGhlaWdodCBiZWNhdXNlIHRoZVxuICAgICAgICAvLyBGaWx0ZXJUYWJsZSBjb21wb25lbnQgbmVlZHMgYW4gZXhwbGljaXQgaGVpZ2h0IHRvIHJlbmRlclxuICAgICAgICAvLyB0aGUgVGFibGUgY29tcG9uZW50XG4gICAgICAgIGNvbnN0IHJvd3NIZWlnaHQgPSBhbGVydElzT3BlblxuICAgICAgICAgICAgPyBoZWlnaHQgLSBhbGVydENvbnRhaW5lckhlaWdodFxuICAgICAgICAgICAgOiBoZWlnaHQgLSByb3dNZXNzYWdlSGVpZ2h0O1xuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0cz8uZGF0YSkge1xuICAgICAgICAgICAgKHsgZGF0YSB9ID0gcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSByZXN1bHRzLmV4cGFuZGVkX2NvbHVtbnNcbiAgICAgICAgICAgICAgICA/IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSlcbiAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgY29uc3QgYWxsb3dIVE1MID0gZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiAoPFJlc3VsdENvbnRhaW5lcj5cbiAgICAgICAgICB7cmVuZGVyQ29udHJvbHMoKX1cbiAgICAgICAgICB7c2hvd1NxbCAmJiBzaG93U3FsSW5saW5lID8gKDw+XG4gICAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgICAgICAgICAgIGdhcDogJHtHQVB9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAgPENhcmQgY3NzPXtbXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjhweDtcbiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY2FsYygxMDAlIC0gJHtST1dTX0NISVBfV0lEVEggKyBHQVB9cHgpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGAsXG4gICAgICAgICAgICAgICAgICAgIF19PlxuICAgICAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKHRydWUpfVxuICAgICAgICAgICAgPC8+KSA6ICg8PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKGZhbHNlKX1cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgPFJlc3VsdFRhYmxlIGRhdGE9e2RhdGF9IHF1ZXJ5SWQ9e3F1ZXJ5LmlkfSBvcmRlcmVkQ29sdW1uS2V5cz17cmVzdWx0cy5jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKX0gaGVpZ2h0PXtyb3dzSGVpZ2h0fSBmaWx0ZXJUZXh0PXtzZWFyY2hUZXh0fSBleHBhbmRlZENvbHVtbnM9e2V4cGFuZGVkQ29sdW1uc30gYWxsb3dIVE1MPXthbGxvd0hUTUx9Lz5cbiAgICAgICAgPC9SZXN1bHRDb250YWluZXI+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgUmVhY3QubWVtbyhSZXN1bHRTZXQpO1xuIl19 */\"), onClick: () => popSelectStar(tempSchema, tempTable) },\n      t('Query in a new tab')\n      ),\n      ___EmotionJSX(ExploreCtasResultsButton, { table: tempTable, schema: tempSchema, dbId: exploreDBId })\n      )\n      ) })\n    );\n  }\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen ?\n    height - alertContainerHeight :\n    height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else\n    if (results != null && results.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns ?\n      results.expanded_columns.map((col) => col.column_name) :\n      [];\n      const allowHTML = getItem(LocalStorageKeys.SqllabIsRenderHtmlEnabled, false);\n      return ___EmotionJSX(ResultContainer, null,\n      renderControls(),\n      showSql && showSqlInline ? ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", { css: css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                ` },\n      ___EmotionJSX(Card, { css: [\n        css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3Bhd2Fuay9Eb2N1bWVudHMvZGNpbS9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0WHNCIiwiZmlsZSI6Ii9ob21lL3Bhd2Fuay9Eb2N1bWVudHMvZGNpbS9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvUmVzdWx0U2V0L2luZGV4LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHNoYWxsb3dFcXVhbCwgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgdXNlSGlzdG9yeSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHsgcGljayB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0IHsgUXVlcnlTdGF0ZSwgc3R5bGVkLCB0LCB0biwgdXNlVGhlbWUsIHVzZVByZXZpb3VzLCBjc3MsIGdldE51bWJlckZvcm1hdHRlciwgZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5LCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCBFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSBmcm9tICdzcmMvY29tcG9uZW50cy9FcnJvck1lc3NhZ2UvRXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UnO1xuaW1wb3J0IHsgU2F2ZURhdGFzZXRNb2RhbCwgfSBmcm9tICdzcmMvU3FsTGFiL2NvbXBvbmVudHMvU2F2ZURhdGFzZXRNb2RhbCc7XG5pbXBvcnQgeyBFWFBMT1JFX0NIQVJUX0RFRkFVTFQgfSBmcm9tICdzcmMvU3FsTGFiL3R5cGVzJztcbmltcG9ydCB7IG1vdW50RXhwbG9yZVVybCB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscyc7XG5pbXBvcnQgeyBwb3N0Rm9ybURhdGEgfSBmcm9tICdzcmMvZXhwbG9yZS9leHBsb3JlVXRpbHMvZm9ybURhdGEnO1xuaW1wb3J0IFByb2dyZXNzQmFyIGZyb20gJ3NyYy9jb21wb25lbnRzL1Byb2dyZXNzQmFyJztcbmltcG9ydCBMb2FkaW5nIGZyb20gJ3NyYy9jb21wb25lbnRzL0xvYWRpbmcnO1xuaW1wb3J0IENhcmQgZnJvbSAnc3JjL2NvbXBvbmVudHMvQ2FyZCc7XG5pbXBvcnQgTGFiZWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTGFiZWwnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL1Rvb2x0aXAnO1xuaW1wb3J0IEZpbHRlcmFibGVUYWJsZSBmcm9tICdzcmMvY29tcG9uZW50cy9GaWx0ZXJhYmxlVGFibGUnO1xuaW1wb3J0IENvcHlUb0NsaXBib2FyZCBmcm9tICdzcmMvY29tcG9uZW50cy9Db3B5VG9DbGlwYm9hcmQnO1xuaW1wb3J0IHsgYWRkRGFuZ2VyVG9hc3QgfSBmcm9tICdzcmMvY29tcG9uZW50cy9NZXNzYWdlVG9hc3RzL2FjdGlvbnMnO1xuaW1wb3J0IHsgcHJlcGFyZUNvcHlUb0NsaXBib2FyZFRhYnVsYXJEYXRhIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzIH0gZnJvbSAnc3JjL3V0aWxzL2xvY2FsU3RvcmFnZUhlbHBlcnMnO1xuaW1wb3J0IHsgYWRkUXVlcnlFZGl0b3IsIGNsZWFyUXVlcnlSZXN1bHRzLCBDdGFzRW51bSwgZmV0Y2hRdWVyeVJlc3VsdHMsIHJlRmV0Y2hRdWVyeVJlc3VsdHMsIHJlUnVuUXVlcnksIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBVUkxfUEFSQU1TIH0gZnJvbSAnc3JjL2NvbnN0YW50cyc7XG5pbXBvcnQgSWNvbnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvSWNvbnMnO1xuaW1wb3J0IEV4cGxvcmVDdGFzUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24nO1xuaW1wb3J0IEV4cGxvcmVSZXN1bHRzQnV0dG9uIGZyb20gJy4uL0V4cGxvcmVSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBIaWdobGlnaHRlZFNxbCBmcm9tICcuLi9IaWdobGlnaHRlZFNxbCc7XG5pbXBvcnQgUXVlcnlTdGF0ZUxhYmVsIGZyb20gJy4uL1F1ZXJ5U3RhdGVMYWJlbCc7XG52YXIgTGltaXRpbmdGYWN0b3I7XG4oZnVuY3Rpb24gKExpbWl0aW5nRmFjdG9yKSB7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJRdWVyeVwiXSA9IFwiUVVFUllcIjtcbiAgICBMaW1pdGluZ0ZhY3RvcltcIlF1ZXJ5QW5kRHJvcGRvd25cIl0gPSBcIlFVRVJZX0FORF9EUk9QRE9XTlwiO1xuICAgIExpbWl0aW5nRmFjdG9yW1wiRHJvcGRvd25cIl0gPSBcIkRST1BET1dOXCI7XG4gICAgTGltaXRpbmdGYWN0b3JbXCJOb3RMaW1pdGVkXCJdID0gXCJOT1RfTElNSVRFRFwiO1xufSkoTGltaXRpbmdGYWN0b3IgfHwgKExpbWl0aW5nRmFjdG9yID0ge30pKTtcbmNvbnN0IFJlc3VsdENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICByb3ctZ2FwOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbmA7XG5jb25zdCBSZXN1bHRsZXNzU3R5bGVzID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgbWluLWhlaWdodDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDI1fXB4O1xuICBbcm9sZT0nYWxlcnQnXSB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbiAgLnNxbC1yZXN1bHQtdHJhY2stam9iIHtcbiAgICBtYXJnaW4tdG9wOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgfVxuYDtcbi8vIE1ha2luZyB0ZXh0IHJlbmRlciBsaW5lIGJyZWFrcy90YWJzIGFzIGlzIGFzIG1vbm9zcGFjZSxcbi8vIGJ1dCB3cmFwcGluZyB0ZXh0IHRvbyBzbyB0ZXh0IGRvZXNuJ3Qgb3ZlcmZsb3dcbmNvbnN0IE1vbm9zcGFjZURpdiA9IHN0eWxlZC5kaXYgYFxuICBmb250LWZhbWlseTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LmZhbWlsaWVzLm1vbm9zcGFjZX07XG4gIHdoaXRlLXNwYWNlOiBwcmU7XG4gIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7XG4gIG92ZXJmbG93LXg6IGF1dG87XG4gIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDtcbmA7XG5jb25zdCBSZXR1cm5lZFJvd3MgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1zaXplOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc31weDtcbiAgbGluZS1oZWlnaHQ6IDE7XG5gO1xuY29uc3QgUmVzdWx0U2V0Q29udHJvbHMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuYDtcbmNvbnN0IFJlc3VsdFNldEJ1dHRvbnMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZ3JpZDtcbiAgZ3JpZC1hdXRvLWZsb3c6IGNvbHVtbjtcbiAgcGFkZGluZy1yaWdodDogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG5gO1xuY29uc3QgUk9XU19DSElQX1dJRFRIID0gMTAwO1xuY29uc3QgR0FQID0gODtcbmNvbnN0IGV4dGVuc2lvbnNSZWdpc3RyeSA9IGdldEV4dGVuc2lvbnNSZWdpc3RyeSgpO1xuY29uc3QgUmVzdWx0U2V0ID0gKHsgY2FjaGUgPSBmYWxzZSwgY3N2ID0gdHJ1ZSwgZGF0YWJhc2UgPSB7fSwgZGlzcGxheUxpbWl0LCBoZWlnaHQsIHF1ZXJ5SWQsIHNlYXJjaCA9IHRydWUsIHNob3dTcWwgPSBmYWxzZSwgc2hvd1NxbElubGluZSA9IGZhbHNlLCB2aXN1YWxpemUgPSB0cnVlLCBkZWZhdWx0UXVlcnlMaW1pdCwgfSkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VTZWxlY3RvcigoeyB1c2VyIH0pID0+IHVzZXIsIHNoYWxsb3dFcXVhbCk7XG4gICAgY29uc3QgcXVlcnkgPSB1c2VTZWxlY3RvcigoeyBzcWxMYWI6IHsgcXVlcmllcyB9IH0pID0+IHBpY2socXVlcmllc1txdWVyeUlkXSwgW1xuICAgICAgICAnaWQnLFxuICAgICAgICAnZXJyb3JNZXNzYWdlJyxcbiAgICAgICAgJ2NhY2hlZCcsXG4gICAgICAgICdyZXN1bHRzJyxcbiAgICAgICAgJ3Jlc3VsdHNLZXknLFxuICAgICAgICAnZGJJZCcsXG4gICAgICAgICd0YWInLFxuICAgICAgICAnc3FsJyxcbiAgICAgICAgJ3RlbXBsYXRlUGFyYW1zJyxcbiAgICAgICAgJ3NjaGVtYScsXG4gICAgICAgICdyb3dzJyxcbiAgICAgICAgJ3F1ZXJ5TGltaXQnLFxuICAgICAgICAnbGltaXRpbmdGYWN0b3InLFxuICAgICAgICAndHJhY2tpbmdVcmwnLFxuICAgICAgICAnc3RhdGUnLFxuICAgICAgICAnZXJyb3JzJyxcbiAgICAgICAgJ2xpbmsnLFxuICAgICAgICAnY3RhcycsXG4gICAgICAgICdjdGFzX21ldGhvZCcsXG4gICAgICAgICd0ZW1wU2NoZW1hJyxcbiAgICAgICAgJ3RlbXBUYWJsZScsXG4gICAgICAgICdpc0RhdGFQcmV2aWV3JyxcbiAgICAgICAgJ3Byb2dyZXNzJyxcbiAgICAgICAgJ2V4dHJhJyxcbiAgICBdKSwgc2hhbGxvd0VxdWFsKTtcbiAgICBjb25zdCBSZXN1bHRUYWJsZSA9IGV4dGVuc2lvbnNSZWdpc3RyeS5nZXQoJ3NxbGVkaXRvci5leHRlbnNpb24ucmVzdWx0VGFibGUnKSA/P1xuICAgICAgICBGaWx0ZXJhYmxlVGFibGU7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IFtzZWFyY2hUZXh0LCBzZXRTZWFyY2hUZXh0XSA9IHVzZVN0YXRlKCcnKTtcbiAgICBjb25zdCBbY2FjaGVkRGF0YSwgc2V0Q2FjaGVkRGF0YV0gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgW3Nob3dTYXZlRGF0YXNldE1vZGFsLCBzZXRTaG93U2F2ZURhdGFzZXRNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2FsZXJ0SXNPcGVuLCBzZXRBbGVydElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG4gICAgY29uc3QgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGlmIChxdWVyeS5lcnJvck1lc3NhZ2UgJiZcbiAgICAgICAgICAgIHF1ZXJ5LmVycm9yTWVzc2FnZS5pbmRleE9mKCdzZXNzaW9uIHRpbWVkIG91dCcpID4gMCkge1xuICAgICAgICAgICAgZGlzcGF0Y2gocmVSdW5RdWVyeShxdWVyeSkpO1xuICAgICAgICB9XG4gICAgfSwgW10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG9ubHkgZG8gdGhpcyB0aGUgZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IGlzIHJlbmRlcmVkL21vdW50ZWRcbiAgICAgICAgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQoKTtcbiAgICB9LCBbcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnRdKTtcbiAgICBjb25zdCBmZXRjaFJlc3VsdHMgPSAocSkgPT4ge1xuICAgICAgICBkaXNwYXRjaChmZXRjaFF1ZXJ5UmVzdWx0cyhxLCBkaXNwbGF5TGltaXQpKTtcbiAgICB9O1xuICAgIGNvbnN0IHByZXZRdWVyeSA9IHVzZVByZXZpb3VzKHF1ZXJ5KTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkICYmIHF1ZXJ5Py5yZXN1bHRzPy5kYXRhPy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXRDYWNoZWREYXRhKHF1ZXJ5LnJlc3VsdHMuZGF0YSk7XG4gICAgICAgICAgICBkaXNwYXRjaChjbGVhclF1ZXJ5UmVzdWx0cyhxdWVyeSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5yZXN1bHRzS2V5ICYmIHF1ZXJ5LnJlc3VsdHNLZXkgIT09IHByZXZRdWVyeT8ucmVzdWx0c0tleSkge1xuICAgICAgICAgICAgZmV0Y2hSZXN1bHRzKHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sIFtxdWVyeSwgY2FjaGVdKTtcbiAgICBjb25zdCBjYWxjdWxhdGVBbGVydFJlZkhlaWdodCA9IChhbGVydEVsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKGFsZXJ0RWxlbWVudCkge1xuICAgICAgICAgICAgc2V0QWxlcnRJc09wZW4odHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3BlbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHBvcFNlbGVjdFN0YXIgPSAodGVtcFNjaGVtYSwgdGVtcFRhYmxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHFlID0ge1xuICAgICAgICAgICAgaWQ6IHNob3J0aWQuZ2VuZXJhdGUoKSxcbiAgICAgICAgICAgIG5hbWU6IHRlbXBUYWJsZSxcbiAgICAgICAgICAgIGF1dG9ydW46IGZhbHNlLFxuICAgICAgICAgICAgZGJJZDogcXVlcnkuZGJJZCxcbiAgICAgICAgICAgIHNxbDogYFNFTEVDVCAqIEZST00gJHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfSR7dGVtcFRhYmxlfWAsXG4gICAgICAgIH07XG4gICAgICAgIGRpc3BhdGNoKGFkZFF1ZXJ5RWRpdG9yKHFlKSk7XG4gICAgfTtcbiAgICBjb25zdCBjaGFuZ2VTZWFyY2ggPSAoZXZlbnQpID0+IHtcbiAgICAgICAgc2V0U2VhcmNoVGV4dChldmVudC50YXJnZXQudmFsdWUpO1xuICAgIH07XG4gICAgY29uc3QgY3JlYXRlRXhwbG9yZVJlc3VsdHNPbkNsaWNrID0gYXN5bmMgKGNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzIH0gPSBxdWVyeTtcbiAgICAgICAgY29uc3Qgb3BlbkluTmV3V2luZG93ID0gY2xpY2tFdmVudC5tZXRhS2V5O1xuICAgICAgICBpZiAocmVzdWx0cz8ucXVlcnlfaWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IHBvc3RGb3JtRGF0YShyZXN1bHRzLnF1ZXJ5X2lkLCAncXVlcnknLCB7XG4gICAgICAgICAgICAgICAgLi4uRVhQTE9SRV9DSEFSVF9ERUZBVUxULFxuICAgICAgICAgICAgICAgIGRhdGFzb3VyY2U6IGAke3Jlc3VsdHMucXVlcnlfaWR9X19xdWVyeWAsXG4gICAgICAgICAgICAgICAgLi4ue1xuICAgICAgICAgICAgICAgICAgICBhbGxfY29sdW1uczogcmVzdWx0cy5jb2x1bW5zLm1hcChjb2x1bW4gPT4gY29sdW1uLmNvbHVtbl9uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtb3VudEV4cGxvcmVVcmwobnVsbCwge1xuICAgICAgICAgICAgICAgIFtVUkxfUEFSQU1TLmZvcm1EYXRhS2V5Lm5hbWVdOiBrZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcGVuSW5OZXdXaW5kb3cpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnLCAnbm9yZWZlcnJlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdVbmFibGUgdG8gY3JlYXRlIGNoYXJ0IHdpdGhvdXQgYSBxdWVyeSBpZC4nKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdldEV4cG9ydENzdlVybCA9IChjbGllbnRJZCkgPT4gYC9hcGkvdjEvc3FsbGFiL2V4cG9ydC8ke2NsaWVudElkfS9gO1xuICAgIGNvbnN0IHJlbmRlckNvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgICBpZiAoc2VhcmNoIHx8IHZpc3VhbGl6ZSB8fCBjc3YpIHtcbiAgICAgICAgICAgIGxldCB7IGRhdGEgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICAvLyBBZGRlZCBjb21wdXRlIGxvZ2ljIHRvIHN0b3AgdXNlciBmcm9tIGJlaW5nIGFibGUgdG8gU2F2ZSAmIEV4cGxvcmVcbiAgICAgICAgICAgIGNvbnN0IGRhdGFzb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgY29sdW1uczogcXVlcnkucmVzdWx0cy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIG5hbWU6IHF1ZXJ5Py50YWIgfHwgJ1VudGl0bGVkJyxcbiAgICAgICAgICAgICAgICBkYklkOiBxdWVyeT8uZGJJZCxcbiAgICAgICAgICAgICAgICBzcWw6IHF1ZXJ5Py5zcWwsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXJhbXM6IHF1ZXJ5Py50ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHF1ZXJ5Py5zY2hlbWEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0U2V0Q29udHJvbHM+XG4gICAgICAgICAgPFNhdmVEYXRhc2V0TW9kYWwgdmlzaWJsZT17c2hvd1NhdmVEYXRhc2V0TW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWwoZmFsc2UpfSBidXR0b25UZXh0T25TYXZlPXt0KCdTYXZlICYgRXhwbG9yZScpfSBidXR0b25UZXh0T25PdmVyd3JpdGU9e3QoJ092ZXJ3cml0ZSAmIEV4cGxvcmUnKX0gbW9kYWxEZXNjcmlwdGlvbj17dCgnU2F2ZSB0aGlzIHF1ZXJ5IGFzIGEgdmlydHVhbCBkYXRhc2V0IHRvIGNvbnRpbnVlIGV4cGxvcmluZycpfSBkYXRhc291cmNlPXtkYXRhc291cmNlfS8+XG4gICAgICAgICAgPFJlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAgICB7dmlzdWFsaXplICYmIGRhdGFiYXNlPy5hbGxvd3NfdmlydHVhbF90YWJsZV9leHBsb3JlICYmICg8RXhwbG9yZVJlc3VsdHNCdXR0b24gZGF0YWJhc2U9e2RhdGFiYXNlfSBvbkNsaWNrPXtjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2t9Lz4pfVxuICAgICAgICAgICAge2NzdiAmJiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBocmVmPXtnZXRFeHBvcnRDc3ZVcmwocXVlcnkuaWQpfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1maWxlLXRleHQtb1wiLz4ge3QoJ0Rvd25sb2FkIHRvIENTVicpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuXG4gICAgICAgICAgICA8Q29weVRvQ2xpcGJvYXJkIHRleHQ9e3ByZXBhcmVDb3B5VG9DbGlwYm9hcmRUYWJ1bGFyRGF0YShkYXRhLCBjb2x1bW5zKX0gd3JhcHBlZD17ZmFsc2V9IGNvcHlOb2RlPXs8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiPlxuICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmEgZmEtY2xpcGJvYXJkXCIvPiB7dCgnQ29weSB0byBDbGlwYm9hcmQnKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj59IGhpZGVUb29sdGlwLz5cbiAgICAgICAgICA8L1Jlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAge3NlYXJjaCAmJiAoPGlucHV0IHR5cGU9XCJ0ZXh0XCIgb25DaGFuZ2U9e2NoYW5nZVNlYXJjaH0gdmFsdWU9e3NlYXJjaFRleHR9IGNsYXNzTmFtZT1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIHBsYWNlaG9sZGVyPXt0KCdGaWx0ZXIgcmVzdWx0cycpfS8+KX1cbiAgICAgICAgPC9SZXN1bHRTZXRDb250cm9scz4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyUm93c1JldHVybmVkID0gKGFsZXJ0TWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHJvd3MsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IGxpbWl0TWVzc2FnZSA9ICcnO1xuICAgICAgICBjb25zdCBsaW1pdFJlYWNoZWQgPSByZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5TGltaXQgfHwgcmVzdWx0cy5xdWVyeS5saW1pdDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9ICEhdXNlcj8ucm9sZXM/LkFkbWluO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLm1pbihyb3dzIHx8IDAsIHJlc3VsdHM/LmRhdGE/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgY29uc3QgZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHdpdGhBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBjb25maWd1cmF0aW9uIERJU1BMQVlfTUFYX1JPVy4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycyBvciBkb3dubG9hZCB0byBjc3YgdG8gc2VlIG1vcmUgcm93cyB1cCB0byAnICtcbiAgICAgICAgICAgICAgICAndGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgICAgICB3aXRob3V0QWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZC4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycywgZG93bmxvYWQgdG8gY3N2LCBvciBjb250YWN0IGFuIGFkbWluICcgK1xuICAgICAgICAgICAgICAgICd0byBzZWUgbW9yZSByb3dzIHVwIHRvIHRoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCA9IGxpbWl0ID09PSBkZWZhdWx0UXVlcnlMaW1pdCAmJiBsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuRHJvcGRvd247XG4gICAgICAgIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnkgJiYgY3N2KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIHF1ZXJ5JywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMaW1pdGluZ0ZhY3Rvci5Ecm9wZG93biAmJlxuICAgICAgICAgICAgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTGltaXRpbmdGYWN0b3IuUXVlcnlBbmREcm9wZG93bikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeSBhbmQgbGltaXQgZHJvcGRvd24uJywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFJvd0NvdW50ID0gZ2V0TnVtYmVyRm9ybWF0dGVyKCkocm93cyk7XG4gICAgICAgIGNvbnN0IHJvd3NSZXR1cm5lZE1lc3NhZ2UgPSB0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywge1xuICAgICAgICAgICAgcm93cyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gYCR7cm93c1JldHVybmVkTWVzc2FnZX0uICR7bGltaXRNZXNzYWdlfWA7XG4gICAgICAgIGlmIChhbGVydE1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgICB7IWxpbWl0UmVhY2hlZCAmJiBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93cyB9KX0gb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBkZXNjcmlwdGlvbj17dCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBkcm9wZG93bi4nLCB7IHJvd3MgfSl9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgICAge2xpbWl0UmVhY2hlZCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBtZXNzYWdlPXt0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywgeyByb3dzOiByb3dzQ291bnQgfSl9IGRlc2NyaXB0aW9uPXtpc0FkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aEFkbWluXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aG91dEFkbWlufS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNob3dSb3dzUmV0dXJuZWQgPSBzaG93U3FsSW5saW5lIHx8ICghbGltaXRSZWFjaGVkICYmICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCk7XG4gICAgICAgIHJldHVybiAoPD5cbiAgICAgICAge3Nob3dSb3dzUmV0dXJuZWQgJiYgKDxSZXR1cm5lZFJvd3M+XG4gICAgICAgICAgICA8VG9vbHRpcCBpZD1cInNxbGxhYi1yb3djb3VudC10b29sdGlwXCIgdGl0bGU9e3Rvb2x0aXBUZXh0fSBwbGFjZW1lbnQ9XCJsZWZ0XCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBjc3M9e2NzcyBgXG4gICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLmx9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAge2xpbWl0TWVzc2FnZSAmJiAoPEljb25zLkV4Y2xhbWF0aW9uQ2lyY2xlT3V0bGluZWQgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS50eXBvZ3JhcGh5LnNpemVzLm19cHg7XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgICBgfS8+KX1cbiAgICAgICAgICAgICAgICB7dG4oJyVzIHJvdycsICclcyByb3dzJywgcm93cywgZm9ybWF0dGVkUm93Q291bnQpfVxuICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvUmV0dXJuZWRSb3dzPil9XG4gICAgICA8Lz4pO1xuICAgIH07XG4gICAgY29uc3QgbGltaXRSZWFjaGVkID0gcXVlcnk/LnJlc3VsdHM/LmRpc3BsYXlMaW1pdFJlYWNoZWQ7XG4gICAgbGV0IHNxbDtcbiAgICBsZXQgZXhwbG9yZURCSWQgPSBxdWVyeS5kYklkO1xuICAgIGlmIChkYXRhYmFzZT8uZXhwbG9yZV9kYXRhYmFzZV9pZCkge1xuICAgICAgICBleHBsb3JlREJJZCA9IGRhdGFiYXNlLmV4cGxvcmVfZGF0YWJhc2VfaWQ7XG4gICAgfVxuICAgIGxldCB0cmFja2luZ1VybDtcbiAgICBpZiAocXVlcnkudHJhY2tpbmdVcmwgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJlxuICAgICAgICBxdWVyeS5zdGF0ZSAhPT0gUXVlcnlTdGF0ZS5GZXRjaGluZykge1xuICAgICAgICB0cmFja2luZ1VybCA9ICg8QnV0dG9uIGNsYXNzTmFtZT1cInNxbC1yZXN1bHQtdHJhY2stam9iXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17cXVlcnkudHJhY2tpbmdVcmx9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICB7cXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuUnVubmluZ1xuICAgICAgICAgICAgICAgID8gdCgnVHJhY2sgam9iJylcbiAgICAgICAgICAgICAgICA6IHQoJ1NlZSBxdWVyeSBkZXRhaWxzJyl9XG4gICAgICA8L0J1dHRvbj4pO1xuICAgIH1cbiAgICBpZiAoc2hvd1NxbCkge1xuICAgICAgICBzcWwgPSAoPEhpZ2hsaWdodGVkU3FsIHNxbD17cXVlcnkuc3FsfSB7Li4uKHNob3dTcWxJbmxpbmUgJiYgeyBtYXhMaW5lczogMSwgbWF4V2lkdGg6IDYwIH0pfS8+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN0b3BwZWQpIHtcbiAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1F1ZXJ5IHdhcyBzdG9wcGVkJyl9Lz47XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgICAgPEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIHRpdGxlPXt0KCdEYXRhYmFzZSBlcnJvcicpfSBlcnJvcj17cXVlcnk/LmV4dHJhPy5lcnJvcnM/LlswXSB8fCBxdWVyeT8uZXJyb3JzPy5bMF19IHN1YnRpdGxlPXs8TW9ub3NwYWNlRGl2PntxdWVyeS5lcnJvck1lc3NhZ2V9PC9Nb25vc3BhY2VEaXY+fSBjb3B5VGV4dD17cXVlcnkuZXJyb3JNZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPlxuICAgICAgICB7dHJhY2tpbmdVcmx9XG4gICAgICA8L1Jlc3VsdGxlc3NTdHlsZXM+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkuY3Rhcykge1xuICAgICAgICBjb25zdCB7IHRlbXBTY2hlbWEsIHRlbXBUYWJsZSB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBvYmplY3QgPSAnVGFibGUnO1xuICAgICAgICBpZiAocXVlcnkuY3Rhc19tZXRob2QgPT09IEN0YXNFbnVtLlZpZXcpIHtcbiAgICAgICAgICAgIG9iamVjdCA9ICdWaWV3JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9ezw+XG4gICAgICAgICAgICAgIHt0KG9iamVjdCl9IFtcbiAgICAgICAgICAgICAgPHN0cm9uZz5cbiAgICAgICAgICAgICAgICB7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ31cbiAgICAgICAgICAgICAgICB7dGVtcFRhYmxlfVxuICAgICAgICAgICAgICA8L3N0cm9uZz5cbiAgICAgICAgICAgICAgXSB7dCgnd2FzIGNyZWF0ZWQnKX0gJm5ic3A7XG4gICAgICAgICAgICAgIDxCdXR0b25Hcm91cD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGNzcz17eyBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgfX0gb25DbGljaz17KCkgPT4gcG9wU2VsZWN0U3Rhcih0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpfT5cbiAgICAgICAgICAgICAgICAgIHt0KCdRdWVyeSBpbiBhIG5ldyB0YWInKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8RXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uIHRhYmxlPXt0ZW1wVGFibGV9IHNjaGVtYT17dGVtcFNjaGVtYX0gZGJJZD17ZXhwbG9yZURCSWR9Lz5cbiAgICAgICAgICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICAgICAgICAgIDwvPn0vPlxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlN1Y2Nlc3MgJiYgcXVlcnkucmVzdWx0cykge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMgfSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIFJlc3VsdFNldFJvd3NSZXR1cm5lZCBjb21wb25lbnQgaWYgIWxpbWl0UmVhY2hlZFxuICAgICAgICBjb25zdCByb3dNZXNzYWdlSGVpZ2h0ID0gIWxpbWl0UmVhY2hlZCA/IDMyIDogMDtcbiAgICAgICAgLy8gQWNjb3VudHMgZm9yIG9mZnNldCBuZWVkZWQgZm9yIGhlaWdodCBvZiBBbGVydCBpZiB0aGlzLnN0YXRlLmFsZXJ0SXNPcGVuXG4gICAgICAgIGNvbnN0IGFsZXJ0Q29udGFpbmVySGVpZ2h0ID0gNzA7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhpcy5yZW5kZXJSb3dzUmV0dXJuZWQoKVxuICAgICAgICAvLyBpZiB3ZSB3YW50IHJlc3VsdHMgcGFuZWwgdG8gYmUgcHJvcGVyIGhlaWdodCBiZWNhdXNlIHRoZVxuICAgICAgICAvLyBGaWx0ZXJUYWJsZSBjb21wb25lbnQgbmVlZHMgYW4gZXhwbGljaXQgaGVpZ2h0IHRvIHJlbmRlclxuICAgICAgICAvLyB0aGUgVGFibGUgY29tcG9uZW50XG4gICAgICAgIGNvbnN0IHJvd3NIZWlnaHQgPSBhbGVydElzT3BlblxuICAgICAgICAgICAgPyBoZWlnaHQgLSBhbGVydENvbnRhaW5lckhlaWdodFxuICAgICAgICAgICAgOiBoZWlnaHQgLSByb3dNZXNzYWdlSGVpZ2h0O1xuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0cz8uZGF0YSkge1xuICAgICAgICAgICAgKHsgZGF0YSB9ID0gcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSByZXN1bHRzLmV4cGFuZGVkX2NvbHVtbnNcbiAgICAgICAgICAgICAgICA/IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSlcbiAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgY29uc3QgYWxsb3dIVE1MID0gZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiAoPFJlc3VsdENvbnRhaW5lcj5cbiAgICAgICAgICB7cmVuZGVyQ29udHJvbHMoKX1cbiAgICAgICAgICB7c2hvd1NxbCAmJiBzaG93U3FsSW5saW5lID8gKDw+XG4gICAgICAgICAgICAgIDxkaXYgY3NzPXtjc3MgYFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgICAgICAgICAgIGdhcDogJHtHQVB9cHg7XG4gICAgICAgICAgICAgICAgYH0+XG4gICAgICAgICAgICAgICAgPENhcmQgY3NzPXtbXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MgYFxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjhweDtcbiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogY2FsYygxMDAlIC0gJHtST1dTX0NISVBfV0lEVEggKyBHQVB9cHgpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGAsXG4gICAgICAgICAgICAgICAgICAgIF19PlxuICAgICAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZChmYWxzZSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKHRydWUpfVxuICAgICAgICAgICAgPC8+KSA6ICg8PlxuICAgICAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKGZhbHNlKX1cbiAgICAgICAgICAgICAge3JlbmRlclJvd3NSZXR1cm5lZCh0cnVlKX1cbiAgICAgICAgICAgICAge3NxbH1cbiAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgPFJlc3VsdFRhYmxlIGRhdGE9e2RhdGF9IHF1ZXJ5SWQ9e3F1ZXJ5LmlkfSBvcmRlcmVkQ29sdW1uS2V5cz17cmVzdWx0cy5jb2x1bW5zLm1hcChjb2wgPT4gY29sLmNvbHVtbl9uYW1lKX0gaGVpZ2h0PXtyb3dzSGVpZ2h0fSBmaWx0ZXJUZXh0PXtzZWFyY2hUZXh0fSBleHBhbmRlZENvbHVtbnM9e2V4cGFuZGVkQ29sdW1uc30gYWxsb3dIVE1MPXthbGxvd0hUTUx9Lz5cbiAgICAgICAgPC9SZXN1bHRDb250YWluZXI+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU3VjY2VzcyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgUmVhY3QubWVtbyhSZXN1bHRTZXQpO1xuIl19 */\"] },\n\n      sql\n      ),\n      renderRowsReturned(false)\n      ),\n      renderRowsReturned(true)\n      ) : ___EmotionJSX(React.Fragment, null,\n      renderRowsReturned(false),\n      renderRowsReturned(true),\n      sql\n      ),\n      ___EmotionJSX(ResultTable, { data: data, queryId: query.id, orderedColumnKeys: results.columns.map((col) => col.column_name), height: rowsHeight, filterText: searchText, expandedColumns: expandedColumns, allowHTML: allowHTML })\n      );\n    }\n    if (data && data.length === 0) {\n      return ___EmotionJSX(Alert, { type: \"warning\", message: t('The query returned no data') });\n    }\n  }\n  if (query.cached || query.state === QueryState.Success && !query.results) {\n    if (query.isDataPreview) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => dispatch(reFetchQueryResults({\n          ...query,\n          isDataPreview: true\n        })) },\n      t('Fetch data preview')\n      );\n    }\n    if (query.resultsKey) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => fetchResults(query) },\n      t('Refetch results')\n      );\n    }\n  }\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = ___EmotionJSX(ProgressBar, { percent: parseInt(query.progress.toFixed(0), 10), striped: true });\n  }\n  const progressMsg = (_query$extra$progress = query == null ? void 0 : (_query$extra2 = query.extra) == null ? void 0 : _query$extra2.progress) != null ? _query$extra$progress : null;\n  return ___EmotionJSX(ResultlessStyles, null,\n  ___EmotionJSX(\"div\", null, !progressBar && ___EmotionJSX(Loading, { position: \"normal\" })),\n\n  ___EmotionJSX(\"div\", null, query.progress === 100 && ___EmotionJSX(Loading, { position: \"normal\" })),\n  ___EmotionJSX(QueryStateLabel, { query: query }),\n  ___EmotionJSX(\"div\", null, progressMsg && ___EmotionJSX(Alert, { type: \"success\", message: progressMsg })),\n  ___EmotionJSX(\"div\", null, query.progress !== 100 && progressBar),\n  trackingUrl && ___EmotionJSX(\"div\", null, trackingUrl)\n  );\n};__signature__(ResultSet, \"useSelector{user}\\nuseSelector{query}\\nuseTheme{theme}\\nuseState{[searchText, setSearchText]('')}\\nuseState{[cachedData, setCachedData]([])}\\nuseState{[showSaveDatasetModal, setShowSaveDatasetModal](false)}\\nuseState{[alertIsOpen, setAlertIsOpen](false)}\\nuseHistory{history}\\nuseDispatch{dispatch}\\nuseCallback{reRunQueryIfSessionTimeoutErrorOnMount}\\nuseEffect{}\\nusePrevious{prevQuery}\\nuseEffect{}\", () => [useSelector, useSelector, useTheme, useHistory, useDispatch, usePrevious]);const _default = /*#__PURE__*/\nReact.memo(ResultSet);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(LimitingFactor, \"LimitingFactor\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultContainer, \"ResultContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultlessStyles, \"ResultlessStyles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(MonospaceDiv, \"MonospaceDiv\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ReturnedRows, \"ReturnedRows\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetControls, \"ResultSetControls\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetButtons, \"ResultSetButtons\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ROWS_CHIP_WIDTH, \"ROWS_CHIP_WIDTH\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(GAP, \"GAP\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(extensionsRegistry, \"extensionsRegistry\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSet, \"ResultSet\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useCallback","useEffect","useState","shallowEqual","useDispatch","useSelector","useHistory","ButtonGroup","Alert","Button","shortid","QueryState","styled","t","tn","useTheme","usePrevious","css","getNumberFormatter","getExtensionsRegistry","ErrorMessageWithStackTrace","SaveDatasetModal","EXPLORE_CHART_DEFAULT","mountExploreUrl","postFormData","ProgressBar","Loading","Card","Label","Tooltip","FilterableTable","CopyToClipboard","addDangerToast","prepareCopyToClipboardTabularData","getItem","LocalStorageKeys","addQueryEditor","clearQueryResults","CtasEnum","fetchQueryResults","reFetchQueryResults","reRunQuery","URL_PARAMS","Icons","ExploreCtasResultsButton","ExploreResultsButton","HighlightedSql","QueryStateLabel","jsx","___EmotionJSX","LimitingFactor","ResultContainer","div","theme","gridUnit","ResultlessStyles","MonospaceDiv","typography","families","monospace","ReturnedRows","sizes","s","ResultSetControls","ResultSetButtons","ROWS_CHIP_WIDTH","GAP","extensionsRegistry","ResultSet","cache","csv","database","displayLimit","height","queryId","search","showSql","showSqlInline","visualize","defaultQueryLimit","_extensionsRegistry$g","_query$results2","_query$extra$progress","_query$extra2","user","query","sqlLab","queries","_pick","ResultTable","get","searchText","setSearchText","cachedData","setCachedData","showSaveDatasetModal","setShowSaveDatasetModal","alertIsOpen","setAlertIsOpen","history","dispatch","reRunQueryIfSessionTimeoutErrorOnMount","errorMessage","indexOf","fetchResults","q","prevQuery","_query$results","_query$results$data","cached","results","data","length","resultsKey","calculateAlertRefHeight","alertElement","popSelectStar","tempSchema","tempTable","qe","id","generate","name","autorun","dbId","sql","changeSearch","event","target","value","createExploreResultsOnClick","clickEvent","openInNewWindow","metaKey","query_id","key","datasource","all_columns","columns","map","column","column_name","url","formDataKey","window","open","push","getExportCsvUrl","clientId","renderControls","tab","templateParams","schema","visible","onHide","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","allows_virtual_table_explore","onClick","buttonSize","href","className","text","wrapped","copyNode","hideTooltip","type","onChange","placeholder","renderRowsReturned","alertMessage","_user$roles","_results$data","rows","queryLimit","limitingFactor","limitMessage","limitReached","displayLimitReached","limit","isAdmin","roles","Admin","rowsCount","Math","min","displayMaxRowsReachedMessage","withAdmin","withoutAdmin","shouldUseDefaultDropdownAlert","Dropdown","Query","QueryAndDropdown","formattedRowCount","rowsReturnedMessage","tooltipText","Fragment","ref","message","onClose","description","showRowsReturned","title","placement","l","ExclamationCircleOutlined","m","exploreDBId","explore_database_id","trackingUrl","state","Success","Fetching","Running","_extends","maxLines","maxWidth","Stopped","Failed","_query$extra","_query$extra$errors","_query$errors","error","extra","errors","subtitle","copyText","undefined","link","source","ctas","object","ctas_method","View","_css","marginRight","process","env","NODE_ENV","table","rowMessageHeight","alertContainerHeight","rowsHeight","expandedColumns","expanded_columns","col","allowHTML","SqllabIsRenderHtmlEnabled","orderedColumnKeys","filterText","isDataPreview","buttonStyle","progressBar","progress","percent","parseInt","toFixed","striped","progressMsg","position","__signature__","_default","memo","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { pick } from 'lodash';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport {\n  QueryState,\n  styled,\n  t,\n  tn,\n  useTheme,\n  usePrevious,\n  css,\n  getNumberFormatter,\n  getExtensionsRegistry,\n} from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport {\n  ISaveableDatasource,\n  ISimpleColumn,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT, SqlLabRootState } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport Card from 'src/components/Card';\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { getItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport {\n  addQueryEditor,\n  clearQueryResults,\n  CtasEnum,\n  fetchQueryResults,\n  reFetchQueryResults,\n  reRunQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport Icons from 'src/components/Icons';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';\n\nenum LimitingFactor {\n  Query = 'QUERY',\n  QueryAndDropdown = 'QUERY_AND_DROPDOWN',\n  Dropdown = 'DROPDOWN',\n  NotLimited = 'NOT_LIMITED',\n}\n\nexport interface ResultSetProps {\n  cache?: boolean;\n  csv?: boolean;\n  database?: Record<string, any>;\n  displayLimit: number;\n  height: number;\n  queryId: string;\n  search?: boolean;\n  showSql?: boolean;\n  showSqlInline?: boolean;\n  visualize?: boolean;\n  defaultQueryLimit: number;\n}\n\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: 1;\n`;\n\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\n\nconst ROWS_CHIP_WIDTH = 100;\nconst GAP = 8;\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst ResultSet = ({\n  cache = false,\n  csv = true,\n  database = {},\n  displayLimit,\n  height,\n  queryId,\n  search = true,\n  showSql = false,\n  showSqlInline = false,\n  visualize = true,\n  defaultQueryLimit,\n}: ResultSetProps) => {\n  const user = useSelector(({ user }: SqlLabRootState) => user, shallowEqual);\n  const query = useSelector(\n    ({ sqlLab: { queries } }: SqlLabRootState) =>\n      pick(queries[queryId], [\n        'id',\n        'errorMessage',\n        'cached',\n        'results',\n        'resultsKey',\n        'dbId',\n        'tab',\n        'sql',\n        'templateParams',\n        'schema',\n        'rows',\n        'queryLimit',\n        'limitingFactor',\n        'trackingUrl',\n        'state',\n        'errors',\n        'link',\n        'ctas',\n        'ctas_method',\n        'tempSchema',\n        'tempTable',\n        'isDataPreview',\n        'progress',\n        'extra',\n      ]),\n    shallowEqual,\n  );\n  const ResultTable =\n    extensionsRegistry.get('sqleditor.extension.resultTable') ??\n    FilterableTable;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState<Record<string, unknown>[]>([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n\n  const history = useHistory();\n  const dispatch = useDispatch();\n\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (\n      query.errorMessage &&\n      query.errorMessage.indexOf('session timed out') > 0\n    ) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n\n  const fetchResults = (q: typeof query) => {\n    dispatch(fetchQueryResults(q, displayLimit));\n  };\n\n  const prevQuery = usePrevious(query);\n  useEffect(() => {\n    if (cache && query.cached && query?.results?.data?.length > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== prevQuery?.resultsKey) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n\n  const calculateAlertRefHeight = (alertElement: HTMLElement | null) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else {\n      setAlertIsOpen(false);\n    }\n  };\n\n  const popSelectStar = (tempSchema: string | null, tempTable: string) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`,\n    };\n    dispatch(addQueryEditor(qe));\n  };\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchText(event.target.value);\n  };\n\n  const createExploreResultsOnClick = async (clickEvent: React.MouseEvent) => {\n    const { results } = query;\n\n    const openInNewWindow = clickEvent.metaKey;\n\n    if (results?.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map(column => column.column_name),\n        },\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key,\n      });\n      if (openInNewWindow) {\n        window.open(url, '_blank', 'noreferrer');\n      } else {\n        history.push(url);\n      }\n    } else {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n\n  const getExportCsvUrl = (clientId: string) =>\n    `/api/v1/sqllab/export/${clientId}/`;\n\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n\n      const datasource: ISaveableDatasource = {\n        columns: query.results.columns as ISimpleColumn[],\n        name: query?.tab || 'Untitled',\n        dbId: query?.dbId,\n        sql: query?.sql,\n        templateParams: query?.templateParams,\n        schema: query?.schema,\n      };\n\n      return (\n        <ResultSetControls>\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={() => setShowSaveDatasetModal(false)}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n          <ResultSetButtons>\n            {visualize && database?.allows_virtual_table_explore && (\n              <ExploreResultsButton\n                database={database}\n                onClick={createExploreResultsOnClick}\n              />\n            )}\n            {csv && (\n              <Button buttonSize=\"small\" href={getExportCsvUrl(query.id)}>\n                <i className=\"fa fa-file-text-o\" /> {t('Download to CSV')}\n              </Button>\n            )}\n\n            <CopyToClipboard\n              text={prepareCopyToClipboardTabularData(data, columns)}\n              wrapped={false}\n              copyNode={\n                <Button buttonSize=\"small\">\n                  <i className=\"fa fa-clipboard\" /> {t('Copy to Clipboard')}\n                </Button>\n              }\n              hideTooltip\n            />\n          </ResultSetButtons>\n          {search && (\n            <input\n              type=\"text\"\n              onChange={changeSearch}\n              value={searchText}\n              className=\"form-control input-sm\"\n              placeholder={t('Filter results')}\n            />\n          )}\n        </ResultSetControls>\n      );\n    }\n    return <div />;\n  };\n\n  const renderRowsReturned = (alertMessage: boolean) => {\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage = '';\n    const limitReached = results?.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!user?.roles?.Admin;\n    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t(\n        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n          'Please add additional limits/filters or download to csv to see more rows up to ' +\n          'the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n      withoutAdmin: t(\n        'The number of results displayed is limited to %(rows)d. ' +\n          'Please add additional limits/filters, download to csv, or contact an admin ' +\n          'to see more rows up to the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n    };\n    const shouldUseDefaultDropdownAlert =\n      limit === defaultQueryLimit && limitingFactor === LimitingFactor.Dropdown;\n\n    if (limitingFactor === LimitingFactor.Query && csv) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query',\n        { rows },\n      );\n    } else if (\n      limitingFactor === LimitingFactor.Dropdown &&\n      !shouldUseDefaultDropdownAlert\n    ) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the limit dropdown.',\n        { rows },\n      );\n    } else if (limitingFactor === LimitingFactor.QueryAndDropdown) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n        { rows },\n      );\n    }\n    const formattedRowCount = getNumberFormatter()(rows);\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows,\n    });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n\n    if (alertMessage) {\n      return (\n        <>\n          {!limitReached && shouldUseDefaultDropdownAlert && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                message={t('%(rows)d rows returned', { rows })}\n                onClose={() => setAlertIsOpen(false)}\n                description={t(\n                  'The number of rows displayed is limited to %(rows)d by the dropdown.',\n                  { rows },\n                )}\n              />\n            </div>\n          )}\n          {limitReached && (\n            <div ref={calculateAlertRefHeight}>\n              <Alert\n                type=\"warning\"\n                onClose={() => setAlertIsOpen(false)}\n                message={t('%(rows)d rows returned', { rows: rowsCount })}\n                description={\n                  isAdmin\n                    ? displayMaxRowsReachedMessage.withAdmin\n                    : displayMaxRowsReachedMessage.withoutAdmin\n                }\n              />\n            </div>\n          )}\n        </>\n      );\n    }\n    const showRowsReturned =\n      showSqlInline || (!limitReached && !shouldUseDefaultDropdownAlert);\n\n    return (\n      <>\n        {showRowsReturned && (\n          <ReturnedRows>\n            <Tooltip\n              id=\"sqllab-rowcount-tooltip\"\n              title={tooltipText}\n              placement=\"left\"\n            >\n              <Label\n                css={css`\n                  line-height: ${theme.typography.sizes.l}px;\n                `}\n              >\n                {limitMessage && (\n                  <Icons.ExclamationCircleOutlined\n                    css={css`\n                      font-size: ${theme.typography.sizes.m}px;\n                      margin-right: ${theme.gridUnit}px;\n                    `}\n                  />\n                )}\n                {tn('%s row', '%s rows', rows, formattedRowCount)}\n              </Label>\n            </Tooltip>\n          </ReturnedRows>\n        )}\n      </>\n    );\n  };\n\n  const limitReached = query?.results?.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database?.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n\n  let trackingUrl;\n  if (\n    query.trackingUrl &&\n    query.state !== QueryState.Success &&\n    query.state !== QueryState.Fetching\n  ) {\n    trackingUrl = (\n      <Button\n        className=\"sql-result-track-job\"\n        buttonSize=\"small\"\n        href={query.trackingUrl}\n        target=\"_blank\"\n      >\n        {query.state === QueryState.Running\n          ? t('Track job')\n          : t('See query details')}\n      </Button>\n    );\n  }\n\n  if (showSql) {\n    sql = (\n      <HighlightedSql\n        sql={query.sql}\n        {...(showSqlInline && { maxLines: 1, maxWidth: 60 })}\n      />\n    );\n  }\n\n  if (query.state === QueryState.Stopped) {\n    return <Alert type=\"warning\" message={t('Query was stopped')} />;\n  }\n\n  if (query.state === QueryState.Failed) {\n    return (\n      <ResultlessStyles>\n        <ErrorMessageWithStackTrace\n          title={t('Database error')}\n          error={query?.extra?.errors?.[0] || query?.errors?.[0]}\n          subtitle={<MonospaceDiv>{query.errorMessage}</MonospaceDiv>}\n          copyText={query.errorMessage || undefined}\n          link={query.link}\n          source=\"sqllab\"\n        />\n        {trackingUrl}\n      </ResultlessStyles>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.View) {\n      object = 'View';\n    }\n    return (\n      <div>\n        <Alert\n          type=\"info\"\n          message={\n            <>\n              {t(object)} [\n              <strong>\n                {tempSchema ? `${tempSchema}.` : ''}\n                {tempTable}\n              </strong>\n              ] {t('was created')} &nbsp;\n              <ButtonGroup>\n                <Button\n                  buttonSize=\"small\"\n                  css={{ marginRight: theme.gridUnit }}\n                  onClick={() => popSelectStar(tempSchema, tempTable)}\n                >\n                  {t('Query in a new tab')}\n                </Button>\n                <ExploreCtasResultsButton\n                  table={tempTable}\n                  schema={tempSchema}\n                  dbId={exploreDBId}\n                />\n              </ButtonGroup>\n            </>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (query.state === QueryState.Success && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen\n      ? height - alertContainerHeight\n      : height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else if (results?.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns\n        ? results.expanded_columns.map(col => col.column_name)\n        : [];\n      const allowHTML = getItem(\n        LocalStorageKeys.SqllabIsRenderHtmlEnabled,\n        false,\n      );\n      return (\n        <ResultContainer>\n          {renderControls()}\n          {showSql && showSqlInline ? (\n            <>\n              <div\n                css={css`\n                  display: flex;\n                  justify-content: space-between;\n                  gap: ${GAP}px;\n                `}\n              >\n                <Card\n                  css={[\n                    css`\n                      height: 28px;\n                      width: calc(100% - ${ROWS_CHIP_WIDTH + GAP}px);\n                      code {\n                        width: 100%;\n                        overflow: hidden;\n                        white-space: nowrap !important;\n                        text-overflow: ellipsis;\n                        display: block;\n                      }\n                    `,\n                  ]}\n                >\n                  {sql}\n                </Card>\n                {renderRowsReturned(false)}\n              </div>\n              {renderRowsReturned(true)}\n            </>\n          ) : (\n            <>\n              {renderRowsReturned(false)}\n              {renderRowsReturned(true)}\n              {sql}\n            </>\n          )}\n          <ResultTable\n            data={data}\n            queryId={query.id}\n            orderedColumnKeys={results.columns.map(col => col.column_name)}\n            height={rowsHeight}\n            filterText={searchText}\n            expandedColumns={expandedColumns}\n            allowHTML={allowHTML}\n          />\n        </ResultContainer>\n      );\n    }\n    if (data && data.length === 0) {\n      return <Alert type=\"warning\" message={t('The query returned no data')} />;\n    }\n  }\n\n  if (query.cached || (query.state === QueryState.Success && !query.results)) {\n    if (query.isDataPreview) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() =>\n            dispatch(\n              reFetchQueryResults({\n                ...query,\n                isDataPreview: true,\n              }),\n            )\n          }\n        >\n          {t('Fetch data preview')}\n        </Button>\n      );\n    }\n    if (query.resultsKey) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() => fetchResults(query)}\n        >\n          {t('Refetch results')}\n        </Button>\n      );\n    }\n  }\n\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = (\n      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n    );\n  }\n\n  const progressMsg = query?.extra?.progress ?? null;\n\n  return (\n    <ResultlessStyles>\n      <div>{!progressBar && <Loading position=\"normal\" />}</div>\n      {/* show loading bar whenever progress bar is completed but needs time to render */}\n      <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n      <QueryStateLabel query={query} />\n      <div>{progressMsg && <Alert type=\"success\" message={progressMsg} />}</div>\n      <div>{query.progress !== 100 && progressBar}</div>\n      {trackingUrl && <div>{trackingUrl}</div>}\n    </ResultlessStyles>\n  );\n};\n\nexport default React.memo(ResultSet);\n"],"mappings":"mbAAA;;;;;;;;;;;;;;;;;;AAkBA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC/D,SAASC,YAAY,EAAEC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACpE,SAASC,UAAU,QAAQ,kBAAkB;;AAE7C,OAAOC,WAAW,MAAM,4BAA4B;AACpD,OAAOC,KAAK,MAAM,sBAAsB;AACxC,OAAOC,MAAM,MAAM,uBAAuB;AAC1C,OAAOC,OAAO,MAAM,SAAS;AAC7B,SACEC,UAAU,EACVC,MAAM,EACNC,CAAC,EACDC,EAAE,EACFC,QAAQ,EACRC,WAAW,EACXC,GAAG,EACHC,kBAAkB,EAClBC,qBAAqB,QAChB,mBAAmB;AAC1B,OAAOC,0BAA0B,MAAM,wDAAwD;AAC/F,SAGEC,gBAAgB,QACX,wCAAwC;AAC/C,SAASC,qBAAqB,QAAyB,kBAAkB;AACzE,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,SAASC,YAAY,QAAQ,mCAAmC;AAChE,OAAOC,WAAW,MAAM,4BAA4B;AACpD,OAAOC,OAAO,MAAM,wBAAwB;AAC5C,OAAOC,IAAI,MAAM,qBAAqB;AACtC,OAAOC,KAAK,MAAM,sBAAsB;AACxC,SAASC,OAAO,QAAQ,wBAAwB;AAChD,OAAOC,eAAe,MAAM,gCAAgC;AAC5D,OAAOC,eAAe,MAAM,gCAAgC;AAC5D,SAASC,cAAc,QAAQ,sCAAsC;AACrE,SAASC,iCAAiC,QAAQ,kBAAkB;AACpE,SAASC,OAAO,EAAEC,gBAAgB,QAAQ,+BAA+B;AACzE,SACEC,cAAc,EACdC,iBAAiB,EACjBC,QAAQ,EACRC,iBAAiB,EACjBC,mBAAmB,EACnBC,UAAU,QACL,2BAA2B;AAClC,SAASC,UAAU,QAAQ,eAAe;AAC1C,OAAOC,KAAK,MAAM,sBAAsB;AACxC,OAAOC,wBAAwB,MAAM,6BAA6B;AAClE,OAAOC,oBAAoB,MAAM,yBAAyB;AAC1D,OAAOC,cAAc,MAAM,mBAAmB;AAC9C,OAAOC,eAAe,MAAM,oBAAoB,CAAC,SAAAC,GAAA,IAAAC,aAAA;AAEjD,IAAKC,cAKJ;AALD,WAAKA,cAAc;EACjBA,cAAA,mBAAe;EACfA,cAAA,2CAAuC;EACvCA,cAAA,yBAAqB;EACrBA,cAAA,8BAA0B;AAC5B,CAAC,EALIA,cAAc,KAAdA,cAAc;AAqBnB,MAAMC,eAAe,GAAGvC,MAAM,CAACwC,GAAG;;;aAGrB,CAAC,EAAEC,KAAK,EAAE,KAAKA,KAAK,CAACC,QAAQ,GAAG,CAAC;CAC7C;AAED,MAAMC,gBAAgB,GAAG3C,MAAM,CAACwC,GAAG;;gBAEnB,CAAC,EAAEC,KAAK,EAAE,KAAKA,KAAK,CAACC,QAAQ,GAAG,EAAE;;kBAEhC,CAAC,EAAED,KAAK,EAAE,KAAKA,KAAK,CAACC,QAAQ,GAAG,CAAC;;;kBAGjC,CAAC,EAAED,KAAK,EAAE,KAAKA,KAAK,CAACC,QAAQ,GAAG,CAAC;;CAElD;AAED;AACA;AACA,MAAME,YAAY,GAAG5C,MAAM,CAACwC,GAAG;iBACd,CAAC,EAAEC,KAAK,EAAE,KAAKA,KAAK,CAACI,UAAU,CAACC,QAAQ,CAACC,SAAS;;;;;CAKlE;AAED,MAAMC,YAAY,GAAGhD,MAAM,CAACwC,GAAG;eAChB,CAAC,EAAEC,KAAK,EAAE,KAAKA,KAAK,CAACI,UAAU,CAACI,KAAK,CAACC,CAAC;;CAErD;AAED,MAAMC,iBAAiB,GAAGnD,MAAM,CAACwC,GAAG;;;CAGnC;AAED,MAAMY,gBAAgB,GAAGpD,MAAM,CAACwC,GAAG;;;mBAGhB,CAAC,EAAEC,KAAK,EAAE,KAAK,CAAC,GAAGA,KAAK,CAACC,QAAQ;CACnD;AAED,MAAMW,eAAe,GAAG,GAAG;AAC3B,MAAMC,GAAG,GAAG,CAAC;AAEb,MAAMC,kBAAkB,GAAGhD,qBAAqB,EAAE;AAElD,MAAMiD,SAAS,GAAGA,CAAC,EACjBC,KAAK,GAAG,KAAK,EACbC,GAAG,GAAG,IAAI,EACVC,QAAQ,GAAG,EAAE,EACbC,YAAY,EACZC,MAAM,EACNC,OAAO,EACPC,MAAM,GAAG,IAAI,EACbC,OAAO,GAAG,KAAK,EACfC,aAAa,GAAG,KAAK,EACrBC,SAAS,GAAG,IAAI,EAChBC,iBAAiB,EACF,KAAI,KAAAC,qBAAA,EAAAC,eAAA,EAAAC,qBAAA,EAAAC,aAAA;EACnB,MAAMC,IAAI,GAAG/E,WAAW,CAAC,CAAC,EAAE+E,IAAI,EAAmB,KAAKA,IAAI,EAAEjF,YAAY,CAAC;EAC3E,MAAMkF,KAAK,GAAGhF,WAAW,CACvB,CAAC,EAAEiF,MAAM,EAAE,EAAEC,OAAO,EAAE,EAAmB,KACvCC,KAAA,CAAKD,OAAO,CAACb,OAAO,CAAC,EAAE;EACrB,IAAI;EACJ,cAAc;EACd,QAAQ;EACR,SAAS;EACT,YAAY;EACZ,MAAM;EACN,KAAK;EACL,KAAK;EACL,gBAAgB;EAChB,QAAQ;EACR,MAAM;EACN,YAAY;EACZ,gBAAgB;EAChB,aAAa;EACb,OAAO;EACP,QAAQ;EACR,MAAM;EACN,MAAM;EACN,aAAa;EACb,YAAY;EACZ,WAAW;EACX,eAAe;EACf,UAAU;EACV,OAAO;EACR,CAAC,EACJvE,YAAY,CACb;EACD,MAAMsF,WAAW,IAAAT,qBAAA,GACfb,kBAAkB,CAACuB,GAAG,CAAC,iCAAiC,CAAC,YAAAV,qBAAA;EACzDlD,eAAe;EACjB,MAAMuB,KAAK,GAAGtC,QAAQ,EAAE;EACxB,MAAM,CAAC4E,UAAU,EAAEC,aAAa,CAAC,GAAG1F,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAAC2F,UAAU,EAAEC,aAAa,CAAC,GAAG5F,QAAQ,CAA4B,EAAE,CAAC;EAC3E,MAAM,CAAC6F,oBAAoB,EAAEC,uBAAuB,CAAC,GAAG9F,QAAQ,CAAC,KAAK,CAAC;EACvE,MAAM,CAAC+F,WAAW,EAAEC,cAAc,CAAC,GAAGhG,QAAQ,CAAC,KAAK,CAAC;EAErD,MAAMiG,OAAO,GAAG7F,UAAU,EAAE;EAC5B,MAAM8F,QAAQ,GAAGhG,WAAW,EAAE;EAE9B,MAAMiG,sCAAsC,GAAGrG,WAAW,CAAC,MAAK;IAC9D,IACEqF,KAAK,CAACiB,YAAY;IAClBjB,KAAK,CAACiB,YAAY,CAACC,OAAO,CAAC,mBAAmB,CAAC,GAAG,CAAC,EACnD;MACAH,QAAQ,CAAC3D,UAAU,CAAC4C,KAAK,CAAC,CAAC;;EAE/B,CAAC,EAAE,EAAE,CAAC;EAENpF,SAAS,CAAC,MAAK;IACb;IACAoG,sCAAsC,EAAE;EAC1C,CAAC,EAAE,CAACA,sCAAsC,CAAC,CAAC;EAE5C,MAAMG,YAAY,GAAGA,CAACC,CAAe,KAAI;IACvCL,QAAQ,CAAC7D,iBAAiB,CAACkE,CAAC,EAAEjC,YAAY,CAAC,CAAC;EAC9C,CAAC;EAED,MAAMkC,SAAS,GAAG1F,WAAW,CAACqE,KAAK,CAAC;EACpCpF,SAAS,CAAC,MAAK,KAAA0G,cAAA,EAAAC,mBAAA;IACb,IAAIvC,KAAK,IAAIgB,KAAK,CAACwB,MAAM,IAAI,CAAAxB,KAAK,qBAAAsB,cAAA,GAALtB,KAAK,CAAEyB,OAAO,sBAAAF,mBAAA,GAAdD,cAAA,CAAgBI,IAAI,qBAApBH,mBAAA,CAAsBI,MAAM,IAAG,CAAC,EAAE;MAC7DlB,aAAa,CAACT,KAAK,CAACyB,OAAO,CAACC,IAAI,CAAC;MACjCX,QAAQ,CAAC/D,iBAAiB,CAACgD,KAAK,CAAC,CAAC;;IAEpC,IAAIA,KAAK,CAAC4B,UAAU,IAAI5B,KAAK,CAAC4B,UAAU,MAAKP,SAAS,oBAATA,SAAS,CAAEO,UAAU,GAAE;MAClET,YAAY,CAACnB,KAAK,CAAC;;EAEvB,CAAC,EAAE,CAACA,KAAK,EAAEhB,KAAK,CAAC,CAAC;EAElB,MAAM6C,uBAAuB,GAAGA,CAACC,YAAgC,KAAI;IACnE,IAAIA,YAAY,EAAE;MAChBjB,cAAc,CAAC,IAAI,CAAC;KACrB;IAAM;MACLA,cAAc,CAAC,KAAK,CAAC;;EAEzB,CAAC;EAED,MAAMkB,aAAa,GAAGA,CAACC,UAAyB,EAAEC,SAAiB,KAAI;IACrE,MAAMC,EAAE,GAAG;MACTC,EAAE,EAAE9G,OAAO,CAAC+G,QAAQ,EAAE;MACtBC,IAAI,EAAEJ,SAAS;MACfK,OAAO,EAAE,KAAK;MACdC,IAAI,EAAEvC,KAAK,CAACuC,IAAI;MAChBC,GAAG,EAAE,iBAAiBR,UAAU,GAAG,GAAGA,UAAU,GAAG,GAAG,EAAE,GAAGC,SAAS;KACrE;IACDlB,QAAQ,CAAChE,cAAc,CAACmF,EAAE,CAAC,CAAC;EAC9B,CAAC;EAED,MAAMO,YAAY,GAAGA,CAACC,KAA0C,KAAI;IAClEnC,aAAa,CAACmC,KAAK,CAACC,MAAM,CAACC,KAAK,CAAC;EACnC,CAAC;EAED,MAAMC,2BAA2B,GAAG,MAAAA,CAAOC,UAA4B,KAAI;IACzE,MAAM,EAAErB,OAAO,EAAE,GAAGzB,KAAK;IAEzB,MAAM+C,eAAe,GAAGD,UAAU,CAACE,OAAO;IAE1C,IAAIvB,OAAO,YAAPA,OAAO,CAAEwB,QAAQ,EAAE;MACrB,MAAMC,GAAG,GAAG,MAAM/G,YAAY,CAACsF,OAAO,CAACwB,QAAQ,EAAE,OAAO,EAAE;QACxD,GAAGhH,qBAAqB;QACxBkH,UAAU,EAAE,GAAG1B,OAAO,CAACwB,QAAQ,SAAS;QACxC,GAAG;UACDG,WAAW,EAAE3B,OAAO,CAAC4B,OAAO,CAACC,GAAG,CAAC,CAAAC,MAAM,KAAIA,MAAM,CAACC,WAAW;;OAEhE,CAAC;MACF,MAAMC,GAAG,GAAGvH,eAAe,CAAC,IAAI,EAAE;QAChC,CAACmB,UAAU,CAACqG,WAAW,CAACrB,IAAI,GAAGa;OAChC,CAAC;MACF,IAAIH,eAAe,EAAE;QACnBY,MAAM,CAACC,IAAI,CAACH,GAAG,EAAE,QAAQ,EAAE,YAAY,CAAC;OACzC;MAAM;QACL3C,OAAO,CAAC+C,IAAI,CAACJ,GAAG,CAAC;;KAEpB;IAAM;MACL9G,cAAc,CAACnB,CAAC,CAAC,4CAA4C,CAAC,CAAC;;EAEnE,CAAC;EAED,MAAMsI,eAAe,GAAGA,CAACC,QAAgB,KACvC,yBAAyBA,QAAQ,GAAG;EAEtC,MAAMC,cAAc,GAAGA,CAAA,KAAK;IAC1B,IAAI1E,MAAM,IAAIG,SAAS,IAAIR,GAAG,EAAE;MAC9B,IAAI,EAAEyC,IAAI,EAAE,GAAG1B,KAAK,CAACyB,OAAO;MAC5B,IAAIzC,KAAK,IAAIgB,KAAK,CAACwB,MAAM,EAAE;QACzBE,IAAI,GAAGlB,UAAU;;MAEnB,MAAM,EAAE6C,OAAO,EAAE,GAAGrD,KAAK,CAACyB,OAAO;MACjC;MAEA,MAAM0B,UAAU,GAAwB;QACtCE,OAAO,EAAErD,KAAK,CAACyB,OAAO,CAAC4B,OAA0B;QACjDhB,IAAI,EAAE,CAAArC,KAAK,oBAALA,KAAK,CAAEiE,GAAG,KAAI,UAAU;QAC9B1B,IAAI,EAAEvC,KAAK,oBAALA,KAAK,CAAEuC,IAAI;QACjBC,GAAG,EAAExC,KAAK,oBAALA,KAAK,CAAEwC,GAAG;QACf0B,cAAc,EAAElE,KAAK,oBAALA,KAAK,CAAEkE,cAAc;QACrCC,MAAM,EAAEnE,KAAK,oBAALA,KAAK,CAAEmE;OAChB;MAED,OACEvG,aAAA,CAACc,iBAAiB;MAChBd,aAAA,CAAC5B,gBAAgB,IACfoI,OAAO,EAAE1D,oBAAqB,EAC9B2D,MAAM,EAAEA,CAAA,KAAM1D,uBAAuB,CAAC,KAAK,CAAE,EAC7C2D,gBAAgB,EAAE9I,CAAC,CAAC,gBAAgB,CAAE,EACtC+I,qBAAqB,EAAE/I,CAAC,CAAC,qBAAqB,CAAE,EAChDgJ,gBAAgB,EAAEhJ,CAAC,CACjB,4DAA4D,CAC5D,EACF2H,UAAU,EAAEA,UAAW,GAEzB;MAAAvF,aAAA,CAACe,gBAAgB;MACdc,SAAS,KAAIP,QAAQ,oBAARA,QAAQ,CAAEuF,4BAA4B,KAClD7G,aAAA,CAACJ,oBAAoB,IACnB0B,QAAQ,EAAEA,QAAS,EACnBwF,OAAO,EAAE7B,2BAA4B,GAExC;MACA5D,GAAG,IACFrB,aAAA,CAACxC,MAAM,IAACuJ,UAAU,EAAC,OAAO,EAACC,IAAI,EAAEd,eAAe,CAAC9D,KAAK,CAACmC,EAAE,CAAE;MACzDvE,aAAA,QAAGiH,SAAS,EAAC,mBAAmB,GAAI,OAACrJ,CAAC,CAAC,iBAAiB;MAClD,CACT;;MAEDoC,aAAA,CAAClB,eAAe,IACdoI,IAAI,EAAElI,iCAAiC,CAAC8E,IAAI,EAAE2B,OAAO,CAAE,EACvD0B,OAAO,EAAE,KAAM,EACfC,QAAQ,EACNpH,aAAA,CAACxC,MAAM,IAACuJ,UAAU,EAAC,OAAO;QACxB/G,aAAA,QAAGiH,SAAS,EAAC,iBAAiB,GAAI,OAACrJ,CAAC,CAAC,mBAAmB;QAClD,CACT,EACDyJ,WAAW;MAEG,CAClB;MAAC3F,MAAM,IACL1B,aAAA,YACEsH,IAAI,EAAC,MAAM,EACXC,QAAQ,EAAE1C,YAAa,EACvBG,KAAK,EAAEtC,UAAW,EAClBuE,SAAS,EAAC,uBAAuB,EACjCO,WAAW,EAAE5J,CAAC,CAAC,gBAAgB,CAAE;MAGpB,CAAC;;IAGxB,OAAOoC,aAAA,YAAI,CAAG;EAChB,CAAC;EAED,MAAMyH,kBAAkB,GAAGA,CAACC,YAAqB,KAAI,KAAAC,WAAA,EAAAC,aAAA;IACnD,MAAM,EAAE/D,OAAO,EAAEgE,IAAI,EAAEC,UAAU,EAAEC,cAAc,EAAE,GAAG3F,KAAK;IAC3D,IAAI4F,YAAY,GAAG,EAAE;IACrB,MAAMC,YAAY,GAAGpE,OAAO,oBAAPA,OAAO,CAAEqE,mBAAmB;IACjD,MAAMC,KAAK,GAAGL,UAAU,IAAIjE,OAAO,CAACzB,KAAK,CAAC+F,KAAK;IAC/C,MAAMC,OAAO,GAAG,CAAC,EAACjG,IAAI,aAAAwF,WAAA,GAAJxF,IAAI,CAAEkG,KAAK,aAAXV,WAAA,CAAaW,KAAK;IACpC,MAAMC,SAAS,GAAGC,IAAI,CAACC,GAAG,CAACZ,IAAI,IAAI,CAAC,EAAE,CAAAhE,OAAO,qBAAA+D,aAAA,GAAP/D,OAAO,CAAEC,IAAI,qBAAb8D,aAAA,CAAe7D,MAAM,KAAI,CAAC,CAAC;IAEjE,MAAM2E,4BAA4B,GAAG;MACnCC,SAAS,EAAE/K,CAAC,CACV,+FAA+F;MAC7F,iFAAiF;MACjF,sBAAsB,EACxB,EAAEiK,IAAI,EAAEU,SAAS,EAAEJ,KAAK,EAAE,CAC3B;MACDS,YAAY,EAAEhL,CAAC,CACb,0DAA0D;MACxD,6EAA6E;MAC7E,6CAA6C,EAC/C,EAAEiK,IAAI,EAAEU,SAAS,EAAEJ,KAAK,EAAE;KAE7B;IACD,MAAMU,6BAA6B,GACjCV,KAAK,KAAKrG,iBAAiB,IAAIiG,cAAc,KAAK9H,cAAc,CAAC6I,QAAQ;IAE3E,IAAIf,cAAc,KAAK9H,cAAc,CAAC8I,KAAK,IAAI1H,GAAG,EAAE;MAClD2G,YAAY,GAAGpK,CAAC,CACd,kEAAkE,EAClE,EAAEiK,IAAI,EAAE,CACT;KACF;IAAM,IACLE,cAAc,KAAK9H,cAAc,CAAC6I,QAAQ;IAC1C,CAACD,6BAA6B,EAC9B;MACAb,YAAY,GAAGpK,CAAC,CACd,4EAA4E,EAC5E,EAAEiK,IAAI,EAAE,CACT;KACF;IAAM,IAAIE,cAAc,KAAK9H,cAAc,CAAC+I,gBAAgB,EAAE;MAC7DhB,YAAY,GAAGpK,CAAC,CACd,sFAAsF,EACtF,EAAEiK,IAAI,EAAE,CACT;;IAEH,MAAMoB,iBAAiB,GAAGhL,kBAAkB,EAAE,CAAC4J,IAAI,CAAC;IACpD,MAAMqB,mBAAmB,GAAGtL,CAAC,CAAC,wBAAwB,EAAE;MACtDiK;KACD,CAAC;IAEF,MAAMsB,WAAW,GAAG,GAAGD,mBAAmB,KAAKlB,YAAY,EAAE;IAE7D,IAAIN,YAAY,EAAE;MAChB,OACE1H,aAAA,CAAAlD,KAAA,CAAAsM,QAAA;MACG,CAACnB,YAAY,IAAIY,6BAA6B,IAC7C7I,aAAA,UAAKqJ,GAAG,EAAEpF,uBAAwB;MAChCjE,aAAA,CAACzC,KAAK,IACJ+J,IAAI,EAAC,SAAS,EACdgC,OAAO,EAAE1L,CAAC,CAAC,wBAAwB,EAAE,EAAEiK,IAAI,EAAE,CAAE,EAC/C0B,OAAO,EAAEA,CAAA,KAAMtG,cAAc,CAAC,KAAK,CAAE,EACrCuG,WAAW,EAAE5L,CAAC,CACZ,sEAAsE,EACtE,EAAEiK,IAAI,EAAE,CACR;MAED,CACN;MACAI,YAAY,IACXjI,aAAA,UAAKqJ,GAAG,EAAEpF,uBAAwB;MAChCjE,aAAA,CAACzC,KAAK,IACJ+J,IAAI,EAAC,SAAS,EACdiC,OAAO,EAAEA,CAAA,KAAMtG,cAAc,CAAC,KAAK,CAAE,EACrCqG,OAAO,EAAE1L,CAAC,CAAC,wBAAwB,EAAE,EAAEiK,IAAI,EAAEU,SAAS,EAAE,CAAE,EAC1DiB,WAAW,EACTpB,OAAO;QACHM,4BAA4B,CAACC,SAAS;QACtCD,4BAA4B,CAACE,YAClC;MAEA;MAET,CAAG;;IAGP,MAAMa,gBAAgB,GACpB7H,aAAa,IAAK,CAACqG,YAAY,IAAI,CAACY,6BAA8B;IAEpE,OACE7I,aAAA,CAAAlD,KAAA,CAAAsM,QAAA;IACGK,gBAAgB,IACfzJ,aAAA,CAACW,YAAY;IACXX,aAAA,CAACpB,OAAO,IACN2F,EAAE,EAAC,yBAAyB,EAC5BmF,KAAK,EAAEP,WAAY,EACnBQ,SAAS,EAAC,MAAM;IAEhB3J,aAAA,CAACrB,KAAK,IACJX,GAAG,EAAEA,GAAG;iCACSoC,KAAK,CAACI,UAAU,CAACI,KAAK,CAACgJ,CAAC;iBACvC;IAED5B,YAAY,IACXhI,aAAA,CAACN,KAAK,CAACmK,yBAAyB,IAC9B7L,GAAG,EAAEA,GAAG;mCACOoC,KAAK,CAACI,UAAU,CAACI,KAAK,CAACkJ,CAAC;sCACrB1J,KAAK,CAACC,QAAQ;qBAC9B,GAEL;IACAxC,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAEgK,IAAI,EAAEoB,iBAAiB;IAC3C;IACA;IACG;IAElB,CAAG;EAEP,CAAC;EAED,MAAMhB,YAAY,GAAG7F,KAAK,qBAAAJ,eAAA,GAALI,KAAK,CAAEyB,OAAO,qBAAd7B,eAAA,CAAgBkG,mBAAmB;EACxD,IAAItD,GAAG;EACP,IAAImF,WAAW,GAAG3H,KAAK,CAACuC,IAAI;EAC5B,IAAIrD,QAAQ,YAARA,QAAQ,CAAE0I,mBAAmB,EAAE;IACjCD,WAAW,GAAGzI,QAAQ,CAAC0I,mBAAmB;;EAG5C,IAAIC,WAAW;EACf,IACE7H,KAAK,CAAC6H,WAAW;EACjB7H,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAACyM,OAAO;EAClC/H,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAAC0M,QAAQ,EACnC;IACAH,WAAW,GACTjK,aAAA,CAACxC,MAAM,IACLyJ,SAAS,EAAC,sBAAsB,EAChCF,UAAU,EAAC,OAAO,EAClBC,IAAI,EAAE5E,KAAK,CAAC6H,WAAY,EACxBlF,MAAM,EAAC,QAAQ;IAEd3C,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAAC2M,OAAO;IAC/BzM,CAAC,CAAC,WAAW,CAAC;IACdA,CAAC,CAAC,mBAAmB;IACnB,CACT;;EAGH,IAAI+D,OAAO,EAAE;IACXiD,GAAG,GACD5E,aAAA,CAACH,cAAc,EAAAyK,QAAA,GACb1F,GAAG,EAAExC,KAAK,CAACwC,GAAI,IACVhD,aAAa,IAAI,EAAE2I,QAAQ,EAAE,CAAC,EAAEC,QAAQ,EAAE,EAAE,EAAE,CAAE,CAExD;;EAGH,IAAIpI,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAAC+M,OAAO,EAAE;IACtC,OAAOzK,aAAA,CAACzC,KAAK,IAAC+J,IAAI,EAAC,SAAS,EAACgC,OAAO,EAAE1L,CAAC,CAAC,mBAAmB,CAAE,GAAG;;EAGlE,IAAIwE,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAACgN,MAAM,EAAE,KAAAC,YAAA,EAAAC,mBAAA,EAAAC,aAAA;IACrC,OACE7K,aAAA,CAACM,gBAAgB;IACfN,aAAA,CAAC7B,0BAA0B,IACzBuL,KAAK,EAAE9L,CAAC,CAAC,gBAAgB,CAAE,EAC3BkN,KAAK,EAAE,CAAA1I,KAAK,qBAAAuI,YAAA,GAALvI,KAAK,CAAE2I,KAAK,sBAAAH,mBAAA,GAAZD,YAAA,CAAcK,MAAM,qBAApBJ,mBAAA,CAAuB,CAAC,CAAC,MAAIxI,KAAK,qBAAAyI,aAAA,GAALzI,KAAK,CAAE4I,MAAM,qBAAbH,aAAA,CAAgB,CAAC,CAAC,CAAC,EACvDI,QAAQ,EAAEjL,aAAA,CAACO,YAAY,QAAE6B,KAAK,CAACiB,YAA2B,CAAE,EAC5D6H,QAAQ,EAAE9I,KAAK,CAACiB,YAAY,IAAI8H,SAAU,EAC1CC,IAAI,EAAEhJ,KAAK,CAACgJ,IAAK,EACjBC,MAAM,EAAC,QAAQ,GAEjB;IAACpB;IACe,CAAC;;EAIvB,IAAI7H,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAACyM,OAAO,IAAI/H,KAAK,CAACkJ,IAAI,EAAE;IACpD,MAAM,EAAElH,UAAU,EAAEC,SAAS,EAAE,GAAGjC,KAAK;IACvC,IAAImJ,MAAM,GAAG,OAAO;IACpB,IAAInJ,KAAK,CAACoJ,WAAW,KAAKnM,QAAQ,CAACoM,IAAI,EAAE;MACvCF,MAAM,GAAG,MAAM;;IAEjB,OACEvL,aAAA;IACEA,aAAA,CAACzC,KAAK,IACJ+J,IAAI,EAAC,MAAM,EACXgC,OAAO,EACLtJ,aAAA,CAAAlD,KAAA,CAAAsM,QAAA;MACGxL,CAAC,CAAC2N,MAAM,CAAC,EAAE,IACZ;MAAAvL,aAAA;MACGoE,UAAU,GAAG,GAAGA,UAAU,GAAG,GAAG,EAAE;MAClCC;MACK,CACR,MAAE;MAACzG,CAAC,CAAC,aAAa,CAAC,EAAE,OACrB;MAAAoC,aAAA,CAAC1C,WAAW;MACV0C,aAAA,CAACxC,MAAM,IACLuJ,UAAU,EAAC,OAAO,EAClB/I,GAAG,eAAA0N,IAAA,CAAE,EAAEC,WAAW,EAAEvL,KAAK,CAACC,QAAQ,EAAE,EAAAuL,OAAA,CAAAC,GAAA,CAAAC,QAAA,8CAAAF,OAAA,CAAAC,GAAA,CAAAC,QAAA,um1BAAC,EACrChF,OAAO,EAAEA,CAAA,KAAM3C,aAAa,CAACC,UAAU,EAAEC,SAAS,CAAE;MAEnDzG,CAAC,CAAC,oBAAoB;MACjB,CACR;MAAAoC,aAAA,CAACL,wBAAwB,IACvBoM,KAAK,EAAE1H,SAAU,EACjBkC,MAAM,EAAEnC,UAAW,EACnBO,IAAI,EAAEoF,WAAY;MAET;MACf,CACD;IAEA,CAAC;;EAIV,IAAI3H,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAACyM,OAAO,IAAI/H,KAAK,CAACyB,OAAO,EAAE;IACvD,MAAM,EAAEA,OAAO,EAAE,GAAGzB,KAAK;IACzB;IACA,MAAM4J,gBAAgB,GAAG,CAAC/D,YAAY,GAAG,EAAE,GAAG,CAAC;IAC/C;IACA,MAAMgE,oBAAoB,GAAG,EAAE;IAC/B;IACA;IACA;IACA;IACA,MAAMC,UAAU,GAAGlJ,WAAW;IAC1BxB,MAAM,GAAGyK,oBAAoB;IAC7BzK,MAAM,GAAGwK,gBAAgB;IAC7B,IAAIlI,IAAI;IACR,IAAI1C,KAAK,IAAIgB,KAAK,CAACwB,MAAM,EAAE;MACzBE,IAAI,GAAGlB,UAAU;KAClB;IAAM,IAAIiB,OAAO,YAAPA,OAAO,CAAEC,IAAI,EAAE;MACxB,CAAC,EAAEA,IAAI,EAAE,GAAGD,OAAO;;IAErB,IAAIC,IAAI,IAAIA,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE;MAC3B,MAAMoI,eAAe,GAAGtI,OAAO,CAACuI,gBAAgB;MAC5CvI,OAAO,CAACuI,gBAAgB,CAAC1G,GAAG,CAAC,CAAA2G,GAAG,KAAIA,GAAG,CAACzG,WAAW,CAAC;MACpD,EAAE;MACN,MAAM0G,SAAS,GAAGrN,OAAO,CACvBC,gBAAgB,CAACqN,yBAAyB,EAC1C,KAAK,CACN;MACD,OACEvM,aAAA,CAACE,eAAe;MACbkG,cAAc,EAAE;MAChBzE,OAAO,IAAIC,aAAa,GACvB5B,aAAA,CAAAlD,KAAA,CAAAsM,QAAA;MACEpJ,aAAA,UACEhC,GAAG,EAAEA,GAAG;;;yBAGCiD,GAAG;iBACV;MAEFjB,aAAA,CAACtB,IAAI,IACHV,GAAG;QACDA,GAAG;;2CAEoBgD,eAAe,GAAGC,GAAG;;;;;;;;qBAQ3C,EAAA2K,OAAA,CAAAC,GAAA,CAAAC,QAAA,8CAAAF,OAAA,CAAAC,GAAA,CAAAC,QAAA,um1BACD;;MAEDlH;MACG,CACN;MAAC6C,kBAAkB,CAAC,KAAK;MACtB,CACL;MAACA,kBAAkB,CAAC,IAAI;MAC1B,CAAG,GAEHzH,aAAA,CAAAlD,KAAA,CAAAsM,QAAA;MACG3B,kBAAkB,CAAC,KAAK,CAAC;MACzBA,kBAAkB,CAAC,IAAI,CAAC;MACxB7C;MACH,CACD;MACD5E,aAAA,CAACwC,WAAW,IACVsB,IAAI,EAAEA,IAAK,EACXrC,OAAO,EAAEW,KAAK,CAACmC,EAAG,EAClBiI,iBAAiB,EAAE3I,OAAO,CAAC4B,OAAO,CAACC,GAAG,CAAC,CAAA2G,GAAG,KAAIA,GAAG,CAACzG,WAAW,CAAE,EAC/DpE,MAAM,EAAE0K,UAAW,EACnBO,UAAU,EAAE/J,UAAW,EACvByJ,eAAe,EAAEA,eAAgB,EACjCG,SAAS,EAAEA,SAAU;MAER,CAAC;;IAGtB,IAAIxI,IAAI,IAAIA,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;MAC7B,OAAO/D,aAAA,CAACzC,KAAK,IAAC+J,IAAI,EAAC,SAAS,EAACgC,OAAO,EAAE1L,CAAC,CAAC,4BAA4B,CAAE,GAAG;;;EAI7E,IAAIwE,KAAK,CAACwB,MAAM,IAAKxB,KAAK,CAAC8H,KAAK,KAAKxM,UAAU,CAACyM,OAAO,IAAI,CAAC/H,KAAK,CAACyB,OAAQ,EAAE;IAC1E,IAAIzB,KAAK,CAACsK,aAAa,EAAE;MACvB,OACE1M,aAAA,CAACxC,MAAM,IACLuJ,UAAU,EAAC,OAAO,EAClB4F,WAAW,EAAC,SAAS,EACrB7F,OAAO,EAAEA,CAAA,KACP3D,QAAQ,CACN5D,mBAAmB,CAAC;UAClB,GAAG6C,KAAK;UACRsK,aAAa,EAAE;SAChB,CAAC,CAEL;MAEA9O,CAAC,CAAC,oBAAoB;MACjB,CAAC;;IAGb,IAAIwE,KAAK,CAAC4B,UAAU,EAAE;MACpB,OACEhE,aAAA,CAACxC,MAAM,IACLuJ,UAAU,EAAC,OAAO,EAClB4F,WAAW,EAAC,SAAS,EACrB7F,OAAO,EAAEA,CAAA,KAAMvD,YAAY,CAACnB,KAAK,CAAE;MAElCxE,CAAC,CAAC,iBAAiB;MACd,CAAC;;;EAKf,IAAIgP,WAAW;EACf,IAAIxK,KAAK,CAACyK,QAAQ,GAAG,CAAC,EAAE;IACtBD,WAAW,GACT5M,aAAA,CAACxB,WAAW,IAACsO,OAAO,EAAEC,QAAQ,CAAC3K,KAAK,CAACyK,QAAQ,CAACG,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAE,EAACC,OAAO,SACvE;;EAGH,MAAMC,WAAW,IAAAjL,qBAAA,GAAGG,KAAK,qBAAAF,aAAA,GAALE,KAAK,CAAE2I,KAAK,qBAAZ7I,aAAA,CAAc2K,QAAQ,YAAA5K,qBAAA,GAAI,IAAI;EAElD,OACEjC,aAAA,CAACM,gBAAgB;EACfN,aAAA,cAAM,CAAC4M,WAAW,IAAI5M,aAAA,CAACvB,OAAO,IAAC0O,QAAQ,EAAC,QAAQ,GAAS,CACzD;;EACAnN,aAAA,cAAMoC,KAAK,CAACyK,QAAQ,KAAK,GAAG,IAAI7M,aAAA,CAACvB,OAAO,IAAC0O,QAAQ,EAAC,QAAQ,GAAS,CACnE;EAAAnN,aAAA,CAACF,eAAe,IAACsC,KAAK,EAAEA,KAAM,GAC9B;EAAApC,aAAA,cAAMkN,WAAW,IAAIlN,aAAA,CAACzC,KAAK,IAAC+J,IAAI,EAAC,SAAS,EAACgC,OAAO,EAAE4D,WAAY,GAAS,CACzE;EAAAlN,aAAA,cAAMoC,KAAK,CAACyK,QAAQ,KAAK,GAAG,IAAID,WAAiB,CACjD;EAAC3C,WAAW,IAAIjK,aAAA,cAAMiK,WAAiB;EACvB,CAAC;AAEvB,CAAC,CAACmD,aAAA,CA3iBIjM,SAAS,8ZAaA/D,WAAW,EACVA,WAAW,EAiCXU,QAAQ,EAMNT,UAAU,EACTF,WAAW,EAoBVY,WAAW,SAAAsP,QAAA;AAmehBvQ,KAAK,CAACwQ,IAAI,CAACnM,SAAS,CAAC,CAApC,eAAAkM,QAAA,CAAqC,mBAAAE,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAtC,SAAA,MAAAoC,cAAA,WAAAA,cAAA,CAAAG,QAAA,CAlnBhCzN,cAKJ,wHAAAsN,cAAA,CAAAG,QAAA,CAgBKxN,eAAe,yHAAAqN,cAAA,CAAAG,QAAA,CAMfpN,gBAAgB,0HAAAiN,cAAA,CAAAG,QAAA,CAahBnN,YAAY,sHAAAgN,cAAA,CAAAG,QAAA,CAQZ/M,YAAY,sHAAA4M,cAAA,CAAAG,QAAA,CAKZ5M,iBAAiB,2HAAAyM,cAAA,CAAAG,QAAA,CAKjB3M,gBAAgB,0HAAAwM,cAAA,CAAAG,QAAA,CAMhB1M,eAAe,yHAAAuM,cAAA,CAAAG,QAAA,CACfzM,GAAG,6GAAAsM,cAAA,CAAAG,QAAA,CAEHxM,kBAAkB,4HAAAqM,cAAA,CAAAG,QAAA,CAElBvM,SAAS,mHAAAoM,cAAA,CAAAG,QAAA,CAAAL,QAAA,yIAAAM,WAAA,UAAAH,oBAAA,mBAAAA,oBAAA,CAAAG,WAAA,GAAAxC,SAAA,CAAAwC,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}