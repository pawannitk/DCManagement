{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useRef, useEffect, useState } from 'react';\nimport Popover from 'src/components/Popover';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst sectionContainerId = 'controlSections';\nexport const getSectionContainerElement = () => {var _document$getElementB;return (_document$getElementB = document.getElementById(sectionContainerId)) == null ? void 0 : _document$getElementB.lastElementChild;};\nconst getElementYVisibilityRatioOnContainer = (node) => {var _window, _node$getBoundingClie;\n  const containerHeight = (_window = window) == null ? void 0 : _window.innerHeight;\n  const nodePositionInViewport = node == null ? void 0 : (_node$getBoundingClie = node.getBoundingClientRect()) == null ? void 0 : _node$getBoundingClie.top;\n  if (!containerHeight || !nodePositionInViewport) {\n    return 0;\n  }\n  return nodePositionInViewport / containerHeight;\n};\nconst ControlPopover = ({ getPopupContainer, getVisibilityRatio = getElementYVisibilityRatioOnContainer, visible: visibleProp, destroyTooltipOnHide = false, ...props }) => {\n  const triggerElementRef = useRef();\n  const [visible, setVisible] = useState(visibleProp === undefined ? props.defaultVisible : visibleProp);\n  const [placement, setPlacement] = React.useState('right');\n  const calculatePlacement = useCallback(() => {\n    const visibilityRatio = getVisibilityRatio(triggerElementRef.current);\n    if (visibilityRatio < 0.35 && placement !== 'rightTop') {\n      setPlacement('rightTop');\n    } else\n    if (visibilityRatio > 0.65 && placement !== 'rightBottom') {\n      setPlacement('rightBottom');\n    } else\n    {\n      setPlacement('right');\n    }\n  }, [getVisibilityRatio]);\n  const changeContainerScrollStatus = useCallback((visible) => {\n    const element = getSectionContainerElement();\n    if (element) {\n      element.style.setProperty('overflow-y', visible ? 'hidden' : 'auto', 'important');\n    }\n  }, [calculatePlacement]);\n  const handleGetPopupContainer = useCallback((triggerNode) => {\n    triggerElementRef.current = triggerNode;\n    return (getPopupContainer == null ? void 0 : getPopupContainer(triggerNode)) || document.body;\n  }, [calculatePlacement, getPopupContainer]);\n  const handleOnVisibleChange = useCallback((visible) => {\n    if (visible === undefined) {\n      changeContainerScrollStatus(visible);\n    }\n    setVisible(!!visible);\n    props.onVisibleChange == null ? void 0 : props.onVisibleChange(!!visible);\n  }, [props, changeContainerScrollStatus]);\n  const handleDocumentKeyDownListener = useCallback((event) => {\n    if (event.key === 'Escape') {\n      setVisible(false);\n      props.onVisibleChange == null ? void 0 : props.onVisibleChange(false);\n    }\n  }, [props]);\n  useEffect(() => {\n    if (visibleProp !== undefined) {\n      setVisible(!!visibleProp);\n    }\n  }, [visibleProp]);\n  useEffect(() => {\n    if (visible !== undefined) {\n      changeContainerScrollStatus(visible);\n    }\n  }, [visible, changeContainerScrollStatus]);\n  useEffect(() => {\n    if (visible) {\n      document.addEventListener('keydown', handleDocumentKeyDownListener);\n    }\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDownListener);\n    };\n  }, [handleDocumentKeyDownListener, visible]);\n  useEffect(() => {\n    if (visible) {\n      calculatePlacement();\n    }\n  }, [visible, calculatePlacement]);\n  return ___EmotionJSX(Popover, _extends({}, props, { visible: visible, arrowPointAtCenter: true, placement: placement, onVisibleChange: handleOnVisibleChange, getPopupContainer: handleGetPopupContainer, destroyTooltipOnHide: destroyTooltipOnHide }));\n};__signature__(ControlPopover, \"useRef{triggerElementRef}\\nuseState{[visible, setVisible](visibleProp === undefined ? props.defaultVisible : visibleProp)}\\nuseState{[placement, setPlacement]('right')}\\nuseCallback{calculatePlacement}\\nuseCallback{changeContainerScrollStatus}\\nuseCallback{handleGetPopupContainer}\\nuseCallback{handleOnVisibleChange}\\nuseCallback{handleDocumentKeyDownListener}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\");const _default =\nControlPopover;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(sectionContainerId, \"sectionContainerId\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx\");reactHotLoader.register(getSectionContainerElement, \"getSectionContainerElement\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx\");reactHotLoader.register(getElementYVisibilityRatioOnContainer, \"getElementYVisibilityRatioOnContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx\");reactHotLoader.register(ControlPopover, \"ControlPopover\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useCallback","useRef","useEffect","useState","Popover","jsx","___EmotionJSX","sectionContainerId","getSectionContainerElement","_document$getElementB","document","getElementById","lastElementChild","getElementYVisibilityRatioOnContainer","node","_window","_node$getBoundingClie","containerHeight","window","innerHeight","nodePositionInViewport","getBoundingClientRect","top","ControlPopover","getPopupContainer","getVisibilityRatio","visible","visibleProp","destroyTooltipOnHide","props","triggerElementRef","setVisible","undefined","defaultVisible","placement","setPlacement","calculatePlacement","visibilityRatio","current","changeContainerScrollStatus","element","style","setProperty","handleGetPopupContainer","triggerNode","body","handleOnVisibleChange","onVisibleChange","handleDocumentKeyDownListener","event","key","addEventListener","removeEventListener","_extends","arrowPointAtCenter","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/ControlPopover/ControlPopover.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport Popover, {\n  PopoverProps as BasePopoverProps,\n  TooltipPlacement,\n} from 'src/components/Popover';\n\nconst sectionContainerId = 'controlSections';\nexport const getSectionContainerElement = () =>\n  document.getElementById(sectionContainerId)?.lastElementChild as HTMLElement;\n\nconst getElementYVisibilityRatioOnContainer = (node: HTMLElement) => {\n  const containerHeight = window?.innerHeight;\n  const nodePositionInViewport = node?.getBoundingClientRect()?.top;\n  if (!containerHeight || !nodePositionInViewport) {\n    return 0;\n  }\n\n  return nodePositionInViewport / containerHeight;\n};\n\nexport type PopoverProps = BasePopoverProps & {\n  getVisibilityRatio?: typeof getElementYVisibilityRatioOnContainer;\n};\n\nconst ControlPopover: React.FC<PopoverProps> = ({\n  getPopupContainer,\n  getVisibilityRatio = getElementYVisibilityRatioOnContainer,\n  visible: visibleProp,\n  destroyTooltipOnHide = false,\n  ...props\n}) => {\n  const triggerElementRef = useRef<HTMLElement>();\n\n  const [visible, setVisible] = useState(\n    visibleProp === undefined ? props.defaultVisible : visibleProp,\n  );\n  const [placement, setPlacement] = React.useState<TooltipPlacement>('right');\n\n  const calculatePlacement = useCallback(() => {\n    const visibilityRatio = getVisibilityRatio(triggerElementRef.current!);\n    if (visibilityRatio < 0.35 && placement !== 'rightTop') {\n      setPlacement('rightTop');\n    } else if (visibilityRatio > 0.65 && placement !== 'rightBottom') {\n      setPlacement('rightBottom');\n    } else {\n      setPlacement('right');\n    }\n  }, [getVisibilityRatio]);\n\n  const changeContainerScrollStatus = useCallback(\n    visible => {\n      const element = getSectionContainerElement();\n      if (element) {\n        element.style.setProperty(\n          'overflow-y',\n          visible ? 'hidden' : 'auto',\n          'important',\n        );\n      }\n    },\n    [calculatePlacement],\n  );\n\n  const handleGetPopupContainer = useCallback(\n    (triggerNode: HTMLElement) => {\n      triggerElementRef.current = triggerNode;\n\n      return getPopupContainer?.(triggerNode) || document.body;\n    },\n    [calculatePlacement, getPopupContainer],\n  );\n\n  const handleOnVisibleChange = useCallback(\n    (visible: boolean | undefined) => {\n      if (visible === undefined) {\n        changeContainerScrollStatus(visible);\n      }\n\n      setVisible(!!visible);\n      props.onVisibleChange?.(!!visible);\n    },\n    [props, changeContainerScrollStatus],\n  );\n\n  const handleDocumentKeyDownListener = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setVisible(false);\n        props.onVisibleChange?.(false);\n      }\n    },\n    [props],\n  );\n\n  useEffect(() => {\n    if (visibleProp !== undefined) {\n      setVisible(!!visibleProp);\n    }\n  }, [visibleProp]);\n\n  useEffect(() => {\n    if (visible !== undefined) {\n      changeContainerScrollStatus(visible);\n    }\n  }, [visible, changeContainerScrollStatus]);\n\n  useEffect(() => {\n    if (visible) {\n      document.addEventListener('keydown', handleDocumentKeyDownListener);\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDownListener);\n    };\n  }, [handleDocumentKeyDownListener, visible]);\n\n  useEffect(() => {\n    if (visible) {\n      calculatePlacement();\n    }\n  }, [visible, calculatePlacement]);\n\n  return (\n    <Popover\n      {...props}\n      visible={visible}\n      arrowPointAtCenter\n      placement={placement}\n      onVisibleChange={handleOnVisibleChange}\n      getPopupContainer={handleGetPopupContainer}\n      destroyTooltipOnHide={destroyTooltipOnHide}\n    />\n  );\n};\n\nexport default ControlPopover;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}