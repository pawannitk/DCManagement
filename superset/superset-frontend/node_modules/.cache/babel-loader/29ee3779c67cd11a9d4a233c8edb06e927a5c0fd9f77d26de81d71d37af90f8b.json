{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useRef } from 'react';\nimport useEffectEvent from 'src/hooks/useEffectEvent';\nimport { api } from './queryApi';\nconst catalogApi = api.injectEndpoints({\n  endpoints: (builder) => ({\n    catalogs: builder.query({\n      providesTags: [{ type: 'Catalogs', id: 'LIST' }],\n      query: ({ dbId, forceRefresh }) => ({\n        endpoint: `/api/v1/database/${dbId}/catalogs/`,\n        urlParams: {\n          force: forceRefresh\n        },\n        transformResponse: ({ json }) => json.result.sort().map((value) => ({\n          value,\n          label: value,\n          title: value\n        }))\n      }),\n      serializeQueryArgs: ({ queryArgs: { dbId } }) => ({\n        dbId\n      })\n    })\n  })\n});\nexport const { useLazyCatalogsQuery, useCatalogsQuery, endpoints: catalogEndpoints, util: catalogApiUtil } = catalogApi;\nexport const EMPTY_CATALOGS = [];\nexport function useCatalogs(options) {\n  const isMountedRef = useRef(false);\n  const { dbId, onSuccess, onError } = options || {};\n  const [trigger] = useLazyCatalogsQuery();\n  const result = useCatalogsQuery({ dbId, forceRefresh: false }, {\n    skip: !dbId\n  });\n  const handleOnSuccess = useEffectEvent((data, isRefetched) => {\n    onSuccess == null ? void 0 : onSuccess(data, isRefetched);\n  });\n  const handleOnError = useEffectEvent(() => {\n    onError == null ? void 0 : onError();\n  });\n  const refetch = useCallback(() => {\n    if (dbId) {\n      trigger({ dbId, forceRefresh: true }).then(({ isSuccess, isError, data }) => {\n        if (isSuccess) {\n          handleOnSuccess(data || EMPTY_CATALOGS, true);\n        }\n        if (isError) {\n          handleOnError();\n        }\n      });\n    }\n  }, [dbId, handleOnError, handleOnSuccess, trigger]);\n  useEffect(() => {\n    if (isMountedRef.current) {\n      const { requestId, isSuccess, isError, isFetching, data, originalArgs } = result;\n      if (!(originalArgs != null && originalArgs.forceRefresh) && requestId && !isFetching) {\n        if (isSuccess) {\n          handleOnSuccess(data || EMPTY_CATALOGS, false);\n        }\n        if (isError) {\n          handleOnError();\n        }\n      }\n    } else\n    {\n      isMountedRef.current = true;\n    }\n  }, [result, handleOnSuccess, handleOnError]);\n  return {\n    ...result,\n    refetch\n  };\n}__signature__(useCatalogs, \"useRef{isMountedRef}\\nuseLazyCatalogsQuery{[trigger]}\\nuseCatalogsQuery{result}\\nuseEffectEvent{handleOnSuccess}\\nuseEffectEvent{handleOnError}\\nuseCallback{refetch}\\nuseEffect{}\", () => [useLazyCatalogsQuery, useCatalogsQuery, useEffectEvent, useEffectEvent]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(catalogApi, \"catalogApi\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(useLazyCatalogsQuery, \"useLazyCatalogsQuery\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(useCatalogsQuery, \"useCatalogsQuery\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(catalogEndpoints, \"catalogEndpoints\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(catalogApiUtil, \"catalogApiUtil\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(EMPTY_CATALOGS, \"EMPTY_CATALOGS\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");reactHotLoader.register(useCatalogs, \"useCatalogs\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useCallback","useEffect","useRef","useEffectEvent","api","catalogApi","injectEndpoints","endpoints","builder","catalogs","query","providesTags","type","id","dbId","forceRefresh","endpoint","urlParams","force","transformResponse","json","result","sort","map","value","label","title","serializeQueryArgs","queryArgs","useLazyCatalogsQuery","useCatalogsQuery","catalogEndpoints","util","catalogApiUtil","EMPTY_CATALOGS","useCatalogs","options","isMountedRef","onSuccess","onError","trigger","skip","handleOnSuccess","data","isRefetched","handleOnError","refetch","then","isSuccess","isError","current","requestId","isFetching","originalArgs","__signature__","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/hooks/apiResources/catalogs.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useRef } from 'react';\nimport useEffectEvent from 'src/hooks/useEffectEvent';\nimport { api, JsonResponse } from './queryApi';\n\nexport type CatalogOption = {\n  value: string;\n  label: string;\n  title: string;\n};\n\nexport type FetchCatalogsQueryParams = {\n  dbId?: string | number;\n  forceRefresh: boolean;\n  onSuccess?: (data: CatalogOption[], isRefetched: boolean) => void;\n  onError?: () => void;\n};\n\ntype Params = Omit<FetchCatalogsQueryParams, 'forceRefresh'>;\n\nconst catalogApi = api.injectEndpoints({\n  endpoints: builder => ({\n    catalogs: builder.query<CatalogOption[], FetchCatalogsQueryParams>({\n      providesTags: [{ type: 'Catalogs', id: 'LIST' }],\n      query: ({ dbId, forceRefresh }) => ({\n        endpoint: `/api/v1/database/${dbId}/catalogs/`,\n        urlParams: {\n          force: forceRefresh,\n        },\n        transformResponse: ({ json }: JsonResponse) =>\n          json.result.sort().map((value: string) => ({\n            value,\n            label: value,\n            title: value,\n          })),\n      }),\n      serializeQueryArgs: ({ queryArgs: { dbId } }) => ({\n        dbId,\n      }),\n    }),\n  }),\n});\n\nexport const {\n  useLazyCatalogsQuery,\n  useCatalogsQuery,\n  endpoints: catalogEndpoints,\n  util: catalogApiUtil,\n} = catalogApi;\n\nexport const EMPTY_CATALOGS = [] as CatalogOption[];\n\nexport function useCatalogs(options: Params) {\n  const isMountedRef = useRef(false);\n  const { dbId, onSuccess, onError } = options || {};\n  const [trigger] = useLazyCatalogsQuery();\n  const result = useCatalogsQuery(\n    { dbId, forceRefresh: false },\n    {\n      skip: !dbId,\n    },\n  );\n\n  const handleOnSuccess = useEffectEvent(\n    (data: CatalogOption[], isRefetched: boolean) => {\n      onSuccess?.(data, isRefetched);\n    },\n  );\n\n  const handleOnError = useEffectEvent(() => {\n    onError?.();\n  });\n\n  const refetch = useCallback(() => {\n    if (dbId) {\n      trigger({ dbId, forceRefresh: true }).then(\n        ({ isSuccess, isError, data }) => {\n          if (isSuccess) {\n            handleOnSuccess(data || EMPTY_CATALOGS, true);\n          }\n          if (isError) {\n            handleOnError();\n          }\n        },\n      );\n    }\n  }, [dbId, handleOnError, handleOnSuccess, trigger]);\n\n  useEffect(() => {\n    if (isMountedRef.current) {\n      const { requestId, isSuccess, isError, isFetching, data, originalArgs } =\n        result;\n      if (!originalArgs?.forceRefresh && requestId && !isFetching) {\n        if (isSuccess) {\n          handleOnSuccess(data || EMPTY_CATALOGS, false);\n        }\n        if (isError) {\n          handleOnError();\n        }\n      }\n    } else {\n      isMountedRef.current = true;\n    }\n  }, [result, handleOnSuccess, handleOnError]);\n\n  return {\n    ...result,\n    refetch,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}