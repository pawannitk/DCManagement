{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\n  getColumnLabel,\n  getMetricLabel,\n  getNumberFormatter,\n  NumberFormats,\n  getSequentialSchemeRegistry } from\n'@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n      PropTypes.shape({\n        x: PropTypes.string,\n        y: PropTypes.string,\n        v: PropTypes.number,\n        perc: PropTypes.number,\n        rank: PropTypes.number\n      })\n    ),\n    extents: PropTypes.arrayOf(PropTypes.number)\n  }),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  valueFormatter: PropTypes.object,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number)\n};\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10\n};\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    valueFormatter,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds,\n    xAxisFormatter,\n    yAxisFormatter\n  } = props;\n\n  const { extents } = data;\n  const records = data.records.map((record) => ({\n    ...record,\n    x: xAxisFormatter(record.x),\n    y: yAxisFormatter(record.y)\n  }));\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35\n  };\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach((datum) => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n        longestX,\n        datum.x && datum.x.toString().length || 1\n      );\n      longestY = Math.max(\n        longestY,\n        datum.y && datum.y.toString().length || 1\n      );\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n    bottomMargin === 'auto' ?\n    Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX)) :\n    bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n    xAxisNode.getBoundingClientRect().x + 4 <\n    container.node().getBoundingClientRect().x)\n    {\n      container.\n      selectAll('.x.axis').\n      selectAll('text').\n      attr('transform', 'rotate(-90)').\n      attr('x', -6).\n      attr('y', 0).\n      attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod, formatter) {\n    let domain = {};\n    records.forEach((d) => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n    });\n    const keys = Object.keys(domain).map((k) => formatter(k));\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[a] > domain[b] ? -1 : 1\n      );\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[b] > domain[a] ? -1 : 1\n      );\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n    leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n    bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n  hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n  hmWidth < DEFAULT_PROPERTIES.minChartWidth)\n  {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT_2_POINT);\n\n  const xScale = ordScale('x', null, sortXAxis, xAxisFormatter);\n  const yScale = ordScale('y', null, sortYAxis, yAxisFormatter);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis, xAxisFormatter);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis, yAxisFormatter);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry().\n  get(colorScheme).\n  createLinearScale([minBound, maxBound]);\n\n  const scale = [\n  d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n  d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight])];\n\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container.\n  append('canvas').\n  attr('width', heatmapDim[X]).\n  attr('height', heatmapDim[Y]).\n  style('width', `${hmWidth}px`).\n  style('height', `${hmHeight}px`).\n  style('image-rendering', canvasImageRendering).\n  style('left', `${margin.left}px`).\n  style('top', `${margin.top}px`).\n  style('position', 'absolute');\n\n  const svg = container.\n  append('svg').\n  attr('width', width).\n  attr('height', height).\n  attr('class', 'heatmap-container').\n  style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg.\n    selectAll('rect').\n    data(records).\n    enter().\n    append('g').\n    attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells.\n    append('text').\n    attr('transform', (d) => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`).\n    attr('y', yRbScale.rangeBand() / 2).\n    attr('x', xRbScale.rangeBand() / 2).\n    attr('text-anchor', 'middle').\n    attr('dy', '.35em').\n    text((d) => valueFormatter(d.v)).\n    attr(\n      'font-size',\n      `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`\n    ).\n    attr('fill', (d) => d.v >= extents[1] / 2 ? 'white' : 'black');\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend.\n    color().\n    labelFormat(valueFormatter).\n    scale(colorScale).\n    shapePadding(0).\n    cells(10).\n    shapeWidth(10).\n    shapeHeight(10).\n    labelOffset(3);\n\n    svg.\n    append('g').\n    attr('transform', `translate(${width - 40}, ${margin.top})`).\n    call(colorLegend);\n  }\n\n  const tip = d3tip().\n  attr('class', 'd3-tip').\n  offset(function () {\n    const k = d3.mouse(this);\n    const x = k[0] - hmWidth / 2;\n\n    return [k[1] - 20, x];\n  }).\n  html(function () {\n    let s = '';\n    const k = d3.mouse(this);\n    const m = Math.floor(scale[0].invert(k[0]));\n    const n = Math.floor(scale[1].invert(k[1]));\n    if (m in matrix && n in matrix[m]) {\n      const obj = matrix[m][n];\n      s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n      s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n      s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n        obj.v\n      )}<div>`;\n      if (showPercentage) {\n        s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n      }\n      tip.style('display', null);\n    } else {\n      // this is a hack to hide the tooltip because we have map it to a single <rect>\n      // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n      tip.style('display', 'none');\n    }\n\n    return s;\n  });\n\n  const rect = svg.\n  append('g').\n  attr('transform', `translate(${margin.left}, ${margin.top})`).\n  append('rect').\n  classed('background-rect', true).\n  on('mousemove', tip.show).\n  on('mouseout', tip.hide).\n  attr('width', hmWidth).\n  attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg.\n    axis().\n    scale(xRbScale).\n    outerTickSize(0).\n    tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval))).\n    orient('bottom');\n\n    svg.\n    append('g').\n    attr('class', 'x axis').\n    attr('transform', `translate(${margin.left},${margin.top + hmHeight})`).\n    call(xAxis).\n    selectAll('text').\n    attr('x', -4).\n    attr('y', 10).\n    attr('dy', '0.3em').\n    style('text-anchor', 'end').\n    attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg.\n    axis().\n    scale(yRbScale).\n    outerTickSize(0).\n    tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval))).\n    orient('left');\n\n    svg.\n    append('g').\n    attr('class', 'y axis').\n    attr('transform', `translate(${margin.left},${margin.top})`).\n    call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach((d) => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;const _default =\n\nHeatmap;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(cmp, \"cmp\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(DEFAULT_PROPERTIES, \"DEFAULT_PROPERTIES\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(Heatmap, \"Heatmap\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["d3","PropTypes","d3tip","getColumnLabel","getMetricLabel","getNumberFormatter","NumberFormats","getSequentialSchemeRegistry","propTypes","data","shape","records","arrayOf","x","string","y","v","number","perc","rank","extents","width","height","bottomMargin","oneOfType","colorScheme","columnX","object","columnY","leftMargin","metric","normalized","bool","valueFormatter","showLegend","showPercentage","showValues","sortXAxis","sortYAxis","xScaleInterval","yScaleInterval","yAxisBounds","cmp","a","b","DEFAULT_PROPERTIES","minChartWidth","minChartHeight","marginLeft","marginBottom","marginTop","marginRight","Heatmap","element","props","canvasImageRendering","xAxisFormatter","yAxisFormatter","map","record","margin","top","right","bottom","left","showY","showX","pixelsPerCharX","pixelsPerCharY","adjustMargins","longestX","longestY","forEach","datum","Math","max","toString","length","ceil","checkLabelPosition","container","xAxisNode","select","node","getBoundingClientRect","selectAll","attr","ordScale","k","rangeBands","sortMethod","formatter","domain","d","keys","Object","sort","reverse","scale","ordinal","range","innerHTML","matrix","hmWidth","hmHeight","hideYLabel","hideXLabel","fp","PERCENT_2_POINT","xScale","yScale","xRbScale","yRbScale","X","Y","heatmapDim","minBound","maxBound","colorScale","get","createLinearScale","linear","classed","canvas","append","style","svg","cells","enter","rangeBand","text","min","colorLegend","legend","color","labelFormat","shapePadding","shapeWidth","shapeHeight","labelOffset","call","tip","offset","mouse","html","s","m","floor","invert","n","obj","rect","on","show","hide","xAxis","axis","outerTickSize","tickValues","filter","i","orient","yAxis","context","getContext","imageSmoothingEnabled","createImageObj","imageObj","Image","image","createImageData","pixs","c","rgb","undefined","p","alpha","r","g","putImageData","src","toDataURL","displayName","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\n  getColumnLabel,\n  getMetricLabel,\n  getNumberFormatter,\n  NumberFormats,\n  getSequentialSchemeRegistry,\n} from '@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n      PropTypes.shape({\n        x: PropTypes.string,\n        y: PropTypes.string,\n        v: PropTypes.number,\n        perc: PropTypes.number,\n        rank: PropTypes.number,\n      }),\n    ),\n    extents: PropTypes.arrayOf(PropTypes.number),\n  }),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  valueFormatter: PropTypes.object,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number),\n};\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10,\n};\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    valueFormatter,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds,\n    xAxisFormatter,\n    yAxisFormatter,\n  } = props;\n\n  const { extents } = data;\n  const records = data.records.map(record => ({\n    ...record,\n    x: xAxisFormatter(record.x),\n    y: yAxisFormatter(record.y),\n  }));\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35,\n  };\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach(datum => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n        longestX,\n        (datum.x && datum.x.toString().length) || 1,\n      );\n      longestY = Math.max(\n        longestY,\n        (datum.y && datum.y.toString().length) || 1,\n      );\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n      bottomMargin === 'auto'\n        ? Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX))\n        : bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n      xAxisNode.getBoundingClientRect().x + 4 <\n      container.node().getBoundingClientRect().x\n    ) {\n      container\n        .selectAll('.x.axis')\n        .selectAll('text')\n        .attr('transform', 'rotate(-90)')\n        .attr('x', -6)\n        .attr('y', 0)\n        .attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod, formatter) {\n    let domain = {};\n    records.forEach(d => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n    });\n    const keys = Object.keys(domain).map(k => formatter(k));\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[a] > domain[b] ? -1 : 1,\n      );\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[b] > domain[a] ? -1 : 1,\n      );\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n      leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n      bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n    hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n    hmWidth < DEFAULT_PROPERTIES.minChartWidth\n  ) {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT_2_POINT);\n\n  const xScale = ordScale('x', null, sortXAxis, xAxisFormatter);\n  const yScale = ordScale('y', null, sortYAxis, yAxisFormatter);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis, xAxisFormatter);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis, yAxisFormatter);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry()\n    .get(colorScheme)\n    .createLinearScale([minBound, maxBound]);\n\n  const scale = [\n    d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n    d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight]),\n  ];\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container\n    .append('canvas')\n    .attr('width', heatmapDim[X])\n    .attr('height', heatmapDim[Y])\n    .style('width', `${hmWidth}px`)\n    .style('height', `${hmHeight}px`)\n    .style('image-rendering', canvasImageRendering)\n    .style('left', `${margin.left}px`)\n    .style('top', `${margin.top}px`)\n    .style('position', 'absolute');\n\n  const svg = container\n    .append('svg')\n    .attr('width', width)\n    .attr('height', height)\n    .attr('class', 'heatmap-container')\n    .style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg\n      .selectAll('rect')\n      .data(records)\n      .enter()\n      .append('g')\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells\n      .append('text')\n      .attr('transform', d => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`)\n      .attr('y', yRbScale.rangeBand() / 2)\n      .attr('x', xRbScale.rangeBand() / 2)\n      .attr('text-anchor', 'middle')\n      .attr('dy', '.35em')\n      .text(d => valueFormatter(d.v))\n      .attr(\n        'font-size',\n        `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`,\n      )\n      .attr('fill', d => (d.v >= extents[1] / 2 ? 'white' : 'black'));\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend\n      .color()\n      .labelFormat(valueFormatter)\n      .scale(colorScale)\n      .shapePadding(0)\n      .cells(10)\n      .shapeWidth(10)\n      .shapeHeight(10)\n      .labelOffset(3);\n\n    svg\n      .append('g')\n      .attr('transform', `translate(${width - 40}, ${margin.top})`)\n      .call(colorLegend);\n  }\n\n  const tip = d3tip()\n    .attr('class', 'd3-tip')\n    .offset(function () {\n      const k = d3.mouse(this);\n      const x = k[0] - hmWidth / 2;\n\n      return [k[1] - 20, x];\n    })\n    .html(function () {\n      let s = '';\n      const k = d3.mouse(this);\n      const m = Math.floor(scale[0].invert(k[0]));\n      const n = Math.floor(scale[1].invert(k[1]));\n      if (m in matrix && n in matrix[m]) {\n        const obj = matrix[m][n];\n        s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n        s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n        s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n          obj.v,\n        )}<div>`;\n        if (showPercentage) {\n          s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n        }\n        tip.style('display', null);\n      } else {\n        // this is a hack to hide the tooltip because we have map it to a single <rect>\n        // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n        tip.style('display', 'none');\n      }\n\n      return s;\n    });\n\n  const rect = svg\n    .append('g')\n    .attr('transform', `translate(${margin.left}, ${margin.top})`)\n    .append('rect')\n    .classed('background-rect', true)\n    .on('mousemove', tip.show)\n    .on('mouseout', tip.hide)\n    .attr('width', hmWidth)\n    .attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg\n      .axis()\n      .scale(xRbScale)\n      .outerTickSize(0)\n      .tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval)))\n      .orient('bottom');\n\n    svg\n      .append('g')\n      .attr('class', 'x axis')\n      .attr('transform', `translate(${margin.left},${margin.top + hmHeight})`)\n      .call(xAxis)\n      .selectAll('text')\n      .attr('x', -4)\n      .attr('y', 10)\n      .attr('dy', '0.3em')\n      .style('text-anchor', 'end')\n      .attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg\n      .axis()\n      .scale(yRbScale)\n      .outerTickSize(0)\n      .tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval)))\n      .orient('left');\n\n    svg\n      .append('g')\n      .attr('class', 'y axis')\n      .attr('transform', `translate(${margin.left},${margin.top})`)\n      .call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach(d => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;\n\nexport default Heatmap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}