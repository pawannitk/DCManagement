{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport supercluster from 'supercluster';\nimport { DEFAULT_POINT_RADIUS, DEFAULT_MAX_ZOOM } from './MapBox';\n\nconst NOOP = () => {};\n\nexport default function transformProps(chartProps) {\n  const { width, height, formData, hooks, queriesData } = chartProps;\n  const { onError = NOOP, setControlValue = NOOP } = hooks;\n  const { bounds, geoJSON, hasCustomMetric, mapboxApiKey } =\n  queriesData[0].data;\n  const {\n    clusteringRadius,\n    globalOpacity,\n    mapboxColor,\n    mapboxStyle,\n    pandasAggfunc,\n    pointRadius,\n    pointRadiusUnit,\n    renderWhileDragging\n  } = formData;\n\n  // Validate mapbox color\n  const rgb = /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/.exec(mapboxColor);\n  if (rgb === null) {\n    onError(\"Color field must be of form 'rgb(%d, %d, %d)'\");\n\n    return {};\n  }\n\n  const opts = {\n    maxZoom: DEFAULT_MAX_ZOOM,\n    radius: clusteringRadius\n  };\n  if (hasCustomMetric) {\n    opts.initial = () => ({\n      sum: 0,\n      squaredSum: 0,\n      min: Infinity,\n      max: -Infinity\n    });\n    opts.map = (prop) => ({\n      sum: prop.metric,\n      squaredSum: prop.metric ** 2,\n      min: prop.metric,\n      max: prop.metric\n    });\n    opts.reduce = (accu, prop) => {\n      // Temporarily disable param-reassignment linting to work with supercluster's api\n      /* eslint-disable no-param-reassign */\n      accu.sum += prop.sum;\n      accu.squaredSum += prop.squaredSum;\n      accu.min = Math.min(accu.min, prop.min);\n      accu.max = Math.max(accu.max, prop.max);\n      /* eslint-enable no-param-reassign */\n    };\n  }\n  const clusterer = supercluster(opts);\n  clusterer.load(geoJSON.features);\n\n  return {\n    width,\n    height,\n    aggregatorName: pandasAggfunc,\n    bounds,\n    clusterer,\n    globalOpacity,\n    hasCustomMetric,\n    mapboxApiKey,\n    mapStyle: mapboxStyle,\n    onViewportChange({ latitude, longitude, zoom }) {\n      setControlValue('viewport_longitude', longitude);\n      setControlValue('viewport_latitude', latitude);\n      setControlValue('viewport_zoom', zoom);\n    },\n    pointRadius: pointRadius === 'Auto' ? DEFAULT_POINT_RADIUS : pointRadius,\n    pointRadiusUnit,\n    renderWhileDragging,\n    rgb\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(NOOP, \"NOOP\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/transformProps.js\");reactHotLoader.register(transformProps, \"transformProps\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/transformProps.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["supercluster","DEFAULT_POINT_RADIUS","DEFAULT_MAX_ZOOM","NOOP","transformProps","chartProps","width","height","formData","hooks","queriesData","onError","setControlValue","bounds","geoJSON","hasCustomMetric","mapboxApiKey","data","clusteringRadius","globalOpacity","mapboxColor","mapboxStyle","pandasAggfunc","pointRadius","pointRadiusUnit","renderWhileDragging","rgb","exec","opts","maxZoom","radius","initial","sum","squaredSum","min","Infinity","max","map","prop","metric","reduce","accu","Math","clusterer","load","features","aggregatorName","mapStyle","onViewportChange","latitude","longitude","zoom","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/transformProps.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport supercluster from 'supercluster';\nimport { DEFAULT_POINT_RADIUS, DEFAULT_MAX_ZOOM } from './MapBox';\n\nconst NOOP = () => {};\n\nexport default function transformProps(chartProps) {\n  const { width, height, formData, hooks, queriesData } = chartProps;\n  const { onError = NOOP, setControlValue = NOOP } = hooks;\n  const { bounds, geoJSON, hasCustomMetric, mapboxApiKey } =\n    queriesData[0].data;\n  const {\n    clusteringRadius,\n    globalOpacity,\n    mapboxColor,\n    mapboxStyle,\n    pandasAggfunc,\n    pointRadius,\n    pointRadiusUnit,\n    renderWhileDragging,\n  } = formData;\n\n  // Validate mapbox color\n  const rgb = /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/.exec(mapboxColor);\n  if (rgb === null) {\n    onError(\"Color field must be of form 'rgb(%d, %d, %d)'\");\n\n    return {};\n  }\n\n  const opts = {\n    maxZoom: DEFAULT_MAX_ZOOM,\n    radius: clusteringRadius,\n  };\n  if (hasCustomMetric) {\n    opts.initial = () => ({\n      sum: 0,\n      squaredSum: 0,\n      min: Infinity,\n      max: -Infinity,\n    });\n    opts.map = prop => ({\n      sum: prop.metric,\n      squaredSum: prop.metric ** 2,\n      min: prop.metric,\n      max: prop.metric,\n    });\n    opts.reduce = (accu, prop) => {\n      // Temporarily disable param-reassignment linting to work with supercluster's api\n      /* eslint-disable no-param-reassign */\n      accu.sum += prop.sum;\n      accu.squaredSum += prop.squaredSum;\n      accu.min = Math.min(accu.min, prop.min);\n      accu.max = Math.max(accu.max, prop.max);\n      /* eslint-enable no-param-reassign */\n    };\n  }\n  const clusterer = supercluster(opts);\n  clusterer.load(geoJSON.features);\n\n  return {\n    width,\n    height,\n    aggregatorName: pandasAggfunc,\n    bounds,\n    clusterer,\n    globalOpacity,\n    hasCustomMetric,\n    mapboxApiKey,\n    mapStyle: mapboxStyle,\n    onViewportChange({ latitude, longitude, zoom }) {\n      setControlValue('viewport_longitude', longitude);\n      setControlValue('viewport_latitude', latitude);\n      setControlValue('viewport_zoom', zoom);\n    },\n    pointRadius: pointRadius === 'Auto' ? DEFAULT_POINT_RADIUS : pointRadius,\n    pointRadiusUnit,\n    renderWhileDragging,\n    rgb,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}