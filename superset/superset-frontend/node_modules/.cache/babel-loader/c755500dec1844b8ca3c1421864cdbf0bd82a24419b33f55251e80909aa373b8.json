{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { FeatureFlag, styled, t, useTheme, isFeatureEnabled, getClientErrorObject } from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\nconst ShareSqlLabQuery = ({ queryEditorId, addDangerToast }) => {\n  const theme = useTheme();\n  const { dbId, name, schema, autorun, sql, remoteId, templateParams } = useQueryEditor(queryEditorId, [\n  'dbId',\n  'name',\n  'schema',\n  'autorun',\n  'sql',\n  'remoteId',\n  'templateParams']\n  );\n  const getCopyUrlForKvStore = (callback) => {\n    const sharedQuery = { dbId, name, schema, autorun, sql, templateParams };\n    return storeQuery(sharedQuery).\n    then((shortUrl) => {\n      callback(shortUrl);\n    }).\n    catch((response) => {\n      getClientErrorObject(response).then(() => {\n        addDangerToast(t('There was an error with your request'));\n      });\n    });\n  };\n  const getCopyUrlForSavedQuery = (callback) => {\n    let savedQueryToastContent;\n    if (remoteId) {\n      savedQueryToastContent = `${window.location.origin + window.location.pathname}?savedQueryId=${remoteId}`;\n      callback(savedQueryToastContent);\n    } else\n    {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback) => {\n    if (isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n  const buildButton = (canShare) => {\n    const tooltip = canShare ?\n    t('Copy query link to your clipboard') :\n    t('Save the query to enable this feature');\n    return ___EmotionJSX(Button, { buttonSize: \"small\", tooltip: tooltip, disabled: !canShare },\n    ___EmotionJSX(StyledIcon, { iconColor: canShare ? theme.colors.primary.base : theme.colors.grayscale.base, iconSize: \"xl\" }),\n    t('Copy link')\n    );\n  };\n  const canShare = !!remoteId || isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore);\n  return ___EmotionJSX(React.Fragment, null,\n  canShare ? ___EmotionJSX(CopyToClipboard, { getText: getCopyUrl, wrapped: false, copyNode: buildButton(canShare) }) : buildButton(canShare)\n  );\n};__signature__(ShareSqlLabQuery, \"useTheme{theme}\\nuseQueryEditor{{ dbId, name, schema, autorun, sql, remoteId, templateParams }}\", () => [useTheme, useQueryEditor]);const _default =\nwithToasts(ShareSqlLabQuery);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledIcon, \"StyledIcon\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");reactHotLoader.register(ShareSqlLabQuery, \"ShareSqlLabQuery\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","FeatureFlag","styled","t","useTheme","isFeatureEnabled","getClientErrorObject","Button","Icons","withToasts","CopyToClipboard","storeQuery","useQueryEditor","jsx","___EmotionJSX","StyledIcon","Link","ShareSqlLabQuery","queryEditorId","addDangerToast","theme","dbId","name","schema","autorun","sql","remoteId","templateParams","getCopyUrlForKvStore","callback","sharedQuery","then","shortUrl","catch","response","getCopyUrlForSavedQuery","savedQueryToastContent","window","location","origin","pathname","getCopyUrl","ShareQueriesViaKvStore","buildButton","canShare","tooltip","buttonSize","disabled","iconColor","colors","primary","base","grayscale","iconSize","Fragment","getText","wrapped","copyNode","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport {\n  FeatureFlag,\n  styled,\n  t,\n  useTheme,\n  isFeatureEnabled,\n  getClientErrorObject,\n} from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport useQueryEditor from 'src/SqlLab/hooks/useQueryEditor';\n\ninterface ShareSqlLabQueryProps {\n  queryEditorId: string;\n  addDangerToast: (msg: string) => void;\n}\n\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\n\nconst ShareSqlLabQuery = ({\n  queryEditorId,\n  addDangerToast,\n}: ShareSqlLabQueryProps) => {\n  const theme = useTheme();\n\n  const { dbId, name, schema, autorun, sql, remoteId, templateParams } =\n    useQueryEditor(queryEditorId, [\n      'dbId',\n      'name',\n      'schema',\n      'autorun',\n      'sql',\n      'remoteId',\n      'templateParams',\n    ]);\n\n  const getCopyUrlForKvStore = (callback: Function) => {\n    const sharedQuery = { dbId, name, schema, autorun, sql, templateParams };\n\n    return storeQuery(sharedQuery)\n      .then(shortUrl => {\n        callback(shortUrl);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(() => {\n          addDangerToast(t('There was an error with your request'));\n        });\n      });\n  };\n\n  const getCopyUrlForSavedQuery = (callback: Function) => {\n    let savedQueryToastContent;\n\n    if (remoteId) {\n      savedQueryToastContent = `${\n        window.location.origin + window.location.pathname\n      }?savedQueryId=${remoteId}`;\n      callback(savedQueryToastContent);\n    } else {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback: Function) => {\n    if (isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n\n  const buildButton = (canShare: boolean) => {\n    const tooltip = canShare\n      ? t('Copy query link to your clipboard')\n      : t('Save the query to enable this feature');\n    return (\n      <Button buttonSize=\"small\" tooltip={tooltip} disabled={!canShare}>\n        <StyledIcon\n          iconColor={\n            canShare ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n          iconSize=\"xl\"\n        />\n        {t('Copy link')}\n      </Button>\n    );\n  };\n\n  const canShare =\n    !!remoteId || isFeatureEnabled(FeatureFlag.ShareQueriesViaKvStore);\n\n  return (\n    <>\n      {canShare ? (\n        <CopyToClipboard\n          getText={getCopyUrl}\n          wrapped={false}\n          copyNode={buildButton(canShare)}\n        />\n      ) : (\n        buildButton(canShare)\n      )}\n    </>\n  );\n};\n\nexport default withToasts(ShareSqlLabQuery);\n"],"mappings":"wSAAA;;;;;;;;;;;;;;;;;;AAkBA,OAAOA,KAAK,MAAM,OAAO;AACzB,SACEC,WAAW,EACXC,MAAM,EACNC,CAAC,EACDC,QAAQ,EACRC,gBAAgB,EAChBC,oBAAoB,QACf,mBAAmB;AAC1B,OAAOC,MAAM,MAAM,uBAAuB;AAC1C,OAAOC,KAAK,MAAM,sBAAsB;AACxC,OAAOC,UAAU,MAAM,yCAAyC;AAChE,OAAOC,eAAe,MAAM,gCAAgC;AAC5D,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,OAAOC,cAAc,MAAM,iCAAiC,CAAC,SAAAC,GAAA,IAAAC,aAAA;AAO7D,MAAMC,UAAU,GAAGb,MAAM,CAACM,KAAK,CAACQ,IAAI,CAAC;;;;;;;;CAQpC;AAED,MAAMC,gBAAgB,GAAGA,CAAC,EACxBC,aAAa,EACbC,cAAc,EACQ,KAAI;EAC1B,MAAMC,KAAK,GAAGhB,QAAQ,EAAE;EAExB,MAAM,EAAEiB,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,cAAc,EAAE,GAClEf,cAAc,CAACM,aAAa,EAAE;EAC5B,MAAM;EACN,MAAM;EACN,QAAQ;EACR,SAAS;EACT,KAAK;EACL,UAAU;EACV,gBAAgB;EACjB,CAAC;EAEJ,MAAMU,oBAAoB,GAAGA,CAACC,QAAkB,KAAI;IAClD,MAAMC,WAAW,GAAG,EAAET,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEE,cAAc,EAAE;IAExE,OAAOhB,UAAU,CAACmB,WAAW,CAAC;IAC3BC,IAAI,CAAC,CAAAC,QAAQ,KAAG;MACfH,QAAQ,CAACG,QAAQ,CAAC;IACpB,CAAC,CAAC;IACDC,KAAK,CAAC,CAAAC,QAAQ,KAAG;MAChB5B,oBAAoB,CAAC4B,QAAQ,CAAC,CAACH,IAAI,CAAC,MAAK;QACvCZ,cAAc,CAAChB,CAAC,CAAC,sCAAsC,CAAC,CAAC;MAC3D,CAAC,CAAC;IACJ,CAAC,CAAC;EACN,CAAC;EAED,MAAMgC,uBAAuB,GAAGA,CAACN,QAAkB,KAAI;IACrD,IAAIO,sBAAsB;IAE1B,IAAIV,QAAQ,EAAE;MACZU,sBAAsB,GAAG,GACvBC,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAGF,MAAM,CAACC,QAAQ,CAACE,QAC3C,iBAAiBd,QAAQ,EAAE;MAC3BG,QAAQ,CAACO,sBAAsB,CAAC;KACjC;IAAM;MACLA,sBAAsB,GAAGjC,CAAC,CAAC,yCAAyC,CAAC;MACrE0B,QAAQ,CAACO,sBAAsB,CAAC;;EAEpC,CAAC;EACD,MAAMK,UAAU,GAAGA,CAACZ,QAAkB,KAAI;IACxC,IAAIxB,gBAAgB,CAACJ,WAAW,CAACyC,sBAAsB,CAAC,EAAE;MACxD,OAAOd,oBAAoB,CAACC,QAAQ,CAAC;;IAEvC,OAAOM,uBAAuB,CAACN,QAAQ,CAAC;EAC1C,CAAC;EAED,MAAMc,WAAW,GAAGA,CAACC,QAAiB,KAAI;IACxC,MAAMC,OAAO,GAAGD,QAAQ;IACpBzC,CAAC,CAAC,mCAAmC,CAAC;IACtCA,CAAC,CAAC,uCAAuC,CAAC;IAC9C,OACEW,aAAA,CAACP,MAAM,IAACuC,UAAU,EAAC,OAAO,EAACD,OAAO,EAAEA,OAAQ,EAACE,QAAQ,EAAE,CAACH,QAAS;IAC/D9B,aAAA,CAACC,UAAU,IACTiC,SAAS,EACPJ,QAAQ,GAAGxB,KAAK,CAAC6B,MAAM,CAACC,OAAO,CAACC,IAAI,GAAG/B,KAAK,CAAC6B,MAAM,CAACG,SAAS,CAACD,IAC/D,EACDE,QAAQ,EAAC,IAAI,GAEf;IAAClD,CAAC,CAAC,WAAW;IACR,CAAC;EAEb,CAAC;EAED,MAAMyC,QAAQ,GACZ,CAAC,CAAClB,QAAQ,IAAIrB,gBAAgB,CAACJ,WAAW,CAACyC,sBAAsB,CAAC;EAEpE,OACE5B,aAAA,CAAAd,KAAA,CAAAsD,QAAA;EACGV,QAAQ,GACP9B,aAAA,CAACJ,eAAe,IACd6C,OAAO,EAAEd,UAAW,EACpBe,OAAO,EAAE,KAAM,EACfC,QAAQ,EAAEd,WAAW,CAACC,QAAQ,CAAE,GAChC,GAEFD,WAAW,CAACC,QAAQ;EAExB,CAAG;AAEP,CAAC,CAACc,aAAA,CApFIzC,gBAAgB,4GAINb,QAAQ,EAGpBQ,cAAc,SAAA+C,QAAA;AA+EHlD,UAAU,CAACQ,gBAAgB,CAAC,CAA3C,eAAA0C,QAAA,CAA4C,mBAAAC,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAC,SAAA,MAAAH,cAAA,WAAAA,cAAA,CAAAI,QAAA,CAhGtCjD,UAAU,2HAAA6C,cAAA,CAAAI,QAAA,CAUV/C,gBAAgB,iIAAA2C,cAAA,CAAAI,QAAA,CAAAL,QAAA,gJAAAM,WAAA,UAAAJ,oBAAA,mBAAAA,oBAAA,CAAAI,WAAA,GAAAF,SAAA,CAAAE,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}