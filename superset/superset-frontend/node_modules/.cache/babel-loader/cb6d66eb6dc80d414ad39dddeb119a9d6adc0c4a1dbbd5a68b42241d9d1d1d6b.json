{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _pick from \"lodash/pick\";import _omit from \"lodash/omit\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n  styled,\n  t,\n  css,\n  useTheme,\n  logging,\n  useChangeEffect,\n  useComponentDidMount,\n  usePrevious } from\n'@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys } from\n'src/utils/localStorageHelpers';\nimport { RESERVED_CHART_URL_PARAMS, URL_PARAMS } from 'src/constants';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport * as logActions from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'src/logger/LogUtils';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport cx from 'classnames';\nimport * as chartActions from 'src/components/Chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { postFormData, putFormData } from 'src/explore/exploreUtils/formData';\nimport { datasourcesActions } from 'src/explore/actions/datasourcesActions';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport * as exploreActions from 'src/explore/actions/exploreActions';\nimport * as saveModalActions from 'src/explore/actions/saveModalActions';\nimport { useTabId } from 'src/hooks/useTabId';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ExploreChartPanel from '../ExploreChartPanel';\nimport ConnectedControlPanelsContainer from '../ControlPanelsContainer';\nimport SaveModal from '../SaveModal';\nimport DataSourcePanel from '../DatasourcePanel';\nimport ConnectedExploreChartHeader from '../ExploreChartHeader';\nimport ExploreContainer from '../ExploreContainer';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  force: PropTypes.bool,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n  saveAction: PropTypes.string,\n  isSaveModalVisible: PropTypes.bool\n};\n\nconst ExplorePanelContainer = styled.div`\n  ${({ theme }) => css`\n    background: ${theme.colors.grayscale.light5};\n    text-align: left;\n    position: relative;\n    width: 100%;\n    max-height: 100%;\n    min-height: 0;\n    display: flex;\n    flex: 1;\n    flex-wrap: nowrap;\n    border-top: 1px solid ${theme.colors.grayscale.light2};\n    .explore-column {\n      display: flex;\n      flex-direction: column;\n      padding: ${theme.gridUnit * 2}px 0;\n      max-height: 100%;\n    }\n    .data-source-selection {\n      background-color: ${theme.colors.grayscale.light5};\n      padding: ${theme.gridUnit * 2}px 0;\n      border-right: 1px solid ${theme.colors.grayscale.light2};\n    }\n    .main-explore-content {\n      flex: 1;\n      min-width: ${theme.gridUnit * 128}px;\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      padding: 0 ${theme.gridUnit * 4}px;\n      .panel {\n        margin-bottom: 0;\n      }\n    }\n    .controls-column {\n      align-self: flex-start;\n      padding: 0;\n    }\n    .title-container {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      padding: 0 ${theme.gridUnit * 2}px 0 ${theme.gridUnit * 4}px;\n      justify-content: space-between;\n      .horizontal-text {\n        font-size: ${theme.typography.sizes.m}px;\n      }\n    }\n    .no-show {\n      display: none;\n    }\n    .vertical-text {\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n    }\n    .sidebar {\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light4};\n      padding: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 8}px;\n    }\n    .collapse-icon > svg {\n      color: ${theme.colors.primary.base};\n    }\n  `};\n`;\n\nconst updateHistory = _debounce(\n  async (\n  formData,\n  datasourceId,\n  datasourceType,\n  isReplace,\n  standalone,\n  force,\n  title,\n  tabId) =>\n  {\n    const payload = { ...formData };\n    const chartId = formData.slice_id;\n    const params = new URLSearchParams(window.location.search);\n    const additionalParam = Object.fromEntries(params);\n\n    if (chartId) {\n      additionalParam[URL_PARAMS.sliceId.name] = chartId;\n    } else {\n      additionalParam[URL_PARAMS.datasourceId.name] = datasourceId;\n      additionalParam[URL_PARAMS.datasourceType.name] = datasourceType;\n    }\n\n    const urlParams = (payload == null ? void 0 : payload.url_params) || {};\n    Object.entries(urlParams).forEach(([key, value]) => {\n      if (!RESERVED_CHART_URL_PARAMS.includes(key)) {\n        additionalParam[key] = value;\n      }\n    });\n\n    try {\n      let key;\n      let stateModifier;\n      if (isReplace) {\n        key = await postFormData(\n          datasourceId,\n          datasourceType,\n          formData,\n          chartId,\n          tabId\n        );\n        stateModifier = 'replaceState';\n      } else {\n        key = getUrlParam(URL_PARAMS.formDataKey);\n        await putFormData(\n          datasourceId,\n          datasourceType,\n          key,\n          formData,\n          chartId,\n          tabId\n        );\n        stateModifier = 'pushState';\n      }\n      // avoid race condition in case user changes route before explore updates the url\n      if (window.location.pathname.startsWith('/explore')) {\n        const url = mountExploreUrl(\n          standalone ? URL_PARAMS.standalone.name : null,\n          {\n            [URL_PARAMS.formDataKey.name]: key,\n            ...additionalParam\n          },\n          force\n        );\n        window.history[stateModifier](payload, title, url);\n      }\n    } catch (e) {\n      logging.warn('Failed at altering browser history', e);\n    }\n  },\n  1000\n);\n\nconst defaultSidebarsWidth = {\n  controls_width: 320,\n  datasource_width: 300\n};\n\nfunction getSidebarWidths(key) {\n  return getItem(key, defaultSidebarsWidth[key]);\n}\n\nfunction setSidebarWidths(key, dimension) {\n  const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n  setItem(key, newDimension);\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n    props.controls\n  );\n\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [width, setWidth] = useState(\n    getSidebarWidths(LocalStorageKeys.DatasourceWidth)\n  );\n  const tabId = useTabId();\n\n  const theme = useTheme();\n\n  const addHistory = useCallback(\n    async ({ isReplace = false, title } = {}) => {\n      const formData = props.dashboardId ?\n      {\n        ...props.form_data,\n        dashboardId: props.dashboardId\n      } :\n      props.form_data;\n      const { id: datasourceId, type: datasourceType } = props.datasource;\n\n      updateHistory(\n        formData,\n        datasourceId,\n        datasourceType,\n        isReplace,\n        props.standalone,\n        props.force,\n        title,\n        tabId\n      );\n    },\n    [\n    props.dashboardId,\n    props.form_data,\n    props.datasource.id,\n    props.datasource.type,\n    props.standalone,\n    props.force,\n    tabId]\n\n  );\n\n  const handlePopstate = useCallback(() => {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        props.force,\n        props.timeout,\n        props.chart.id\n      );\n    }\n  }, [props.actions, props.chart.id, props.timeout]);\n\n  const onQuery = useCallback(() => {\n    props.actions.setForceQuery(false);\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  const handleKeydown = useCallback(\n    (event) => {\n      const controlOrCommand = event.ctrlKey || event.metaKey;\n      if (controlOrCommand) {\n        const isEnter = event.key === 'Enter' || event.keyCode === 13;\n        const isS = event.key === 's' || event.keyCode === 83;\n        if (isEnter) {\n          onQuery();\n        } else if (isS) {\n          if (props.slice) {\n            props.actions.\n            saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false\n            }).\n            then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n          }\n        }\n      }\n    },\n    [onQuery, props.actions, props.form_data, props.slice]\n  );\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  useComponentDidMount(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n  });\n\n  useChangeEffect(tabId, (previous, current) => {\n    if (current) {\n      addHistory({ isReplace: true });\n    }\n  });\n\n  const previousHandlePopstate = usePrevious(handlePopstate);\n  useEffect(() => {\n    if (previousHandlePopstate) {\n      window.removeEventListener('popstate', previousHandlePopstate);\n    }\n    window.addEventListener('popstate', handlePopstate);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n    };\n  }, [handlePopstate, previousHandlePopstate]);\n\n  const previousHandleKeyDown = usePrevious(handleKeydown);\n  useEffect(() => {\n    if (previousHandleKeyDown) {\n      window.removeEventListener('keydown', previousHandleKeyDown);\n    }\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, [handleKeydown, previousHandleKeyDown]);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      (control) =>\n      control.validationErrors && control.validationErrors.length > 0\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = useCallback(\n    (controlsChanged) => {\n      const newQueryFormData = controlsChanged ?\n      {\n        ...props.chart.latestQueryFormData,\n        ...getFormDataFromControls(_pick(props.controls, controlsChanged))\n      } :\n      getFormDataFromControls(props.controls);\n      props.actions.updateQueryFormData(newQueryFormData, props.chart.id);\n      props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n      addHistory();\n    },\n    [\n    addHistory,\n    props.actions,\n    props.chart.id,\n    props.chart.latestQueryFormData,\n    props.controls]\n\n  );\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (\n    previousControls &&\n    props.chart.latestQueryFormData.viz_type === props.controls.viz_type.value)\n    {\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        (key) =>\n        typeof previousControls[key] !== 'undefined' &&\n        !areObjectsEqual(\n          props.controls[key].value,\n          previousControls[key].value\n        )\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const displayControlsChanged = changedControlKeys.filter(\n        (key) => props.controls[key].renderTrigger\n      );\n      if (displayControlsChanged.length > 0) {\n        reRenderChart(displayControlsChanged);\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        (key) =>\n        typeof lastQueriedControls[key] !== 'undefined' &&\n        !areObjectsEqual(\n          props.controls[key].value,\n          lastQueriedControls[key].value,\n          { ignoreFields: ['datasourceWarning'] }\n        )\n      );\n\n      return changedControlKeys.some(\n        (key) =>\n        !props.controls[key].renderTrigger &&\n        !props.controls[key].dontRefreshOnChange\n      );\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useChangeEffect(props.saveAction, () => {\n    if (['saveas', 'overwrite'].includes(props.saveAction)) {\n      onQuery();\n      addHistory({ isReplace: true });\n      props.actions.setSaveAction(null);\n    }\n  });\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  const errorMessage = useMemo(() => {\n    const controlsWithErrors = Object.values(props.controls).filter(\n      (control) =>\n      control.validationErrors && control.validationErrors.length > 0\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      (control) => control.validationErrors\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages.\n    map((message) => {\n      const matchingLabels = controlsWithErrors.\n      filter((control) => {var _control$validationEr;return (_control$validationEr = control.validationErrors) == null ? void 0 : _control$validationEr.includes(message);}).\n      map((control) => control.label);\n      return [matchingLabels, message];\n    }).\n    map(([labels, message]) =>\n    ___EmotionJSX(\"div\", { key: message },\n    labels.length > 1 ? t('Controls labeled ') : t('Control labeled '),\n    ___EmotionJSX(\"strong\", null, ` ${labels.join(', ')}`),\n    ___EmotionJSX(\"span\", null, \": \", message)\n    )\n    );\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' } }, errors);\n    }\n    return errorMessage;\n  }, [props.controls]);\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({},\n      props, {\n        errorMessage: errorMessage,\n        chartIsStale: chartIsStale,\n        onQuery: onQuery })\n      ));\n\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(ExploreContainer, null,\n    ___EmotionJSX(ConnectedExploreChartHeader, {\n      actions: props.actions,\n      canOverwrite: props.can_overwrite,\n      canDownload: props.can_download,\n      dashboardId: props.dashboardId,\n      isStarred: props.isStarred,\n      slice: props.slice,\n      sliceName: props.sliceName,\n      table_name: props.table_name,\n      formData: props.form_data,\n      chart: props.chart,\n      ownState: props.ownState,\n      user: props.user,\n      reports: props.reports,\n      saveDisabled: errorMessage || props.chart.chartStatus === 'loading',\n      metadata: props.metadata }\n    ),\n    ___EmotionJSX(ExplorePanelContainer, { id: \"explore-container\" },\n    ___EmotionJSX(Global, {\n      styles: css`\n            .navbar {\n              margin-bottom: 0;\n            }\n            body {\n              height: 100vh;\n              max-height: 100vh;\n              overflow: hidden;\n            }\n            #app-menu,\n            #app {\n              flex: 1 1 auto;\n            }\n            #app {\n              flex-basis: 100%;\n              overflow: hidden;\n              height: 100%;\n            }\n            #app-menu {\n              flex-shrink: 0;\n            }\n          ` }\n    ),\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) => {\n        setWidth(ref.getBoundingClientRect().width);\n        setSidebarWidths(LocalStorageKeys.DatasourceWidth, d);\n      },\n      defaultSize: {\n        width: getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n        height: '100%'\n      },\n      minWidth: defaultSidebarsWidth[LocalStorageKeys.DatasourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection' },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\" },\n    ___EmotionJSX(\"span\", { className: \"horizontal-text\" }, t('Chart Source')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse },\n\n    ___EmotionJSX(Icons.Expand, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\" }\n    )\n    )\n    ),\n    ___EmotionJSX(DataSourcePanel, {\n      formData: props.form_data,\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions,\n      width: width,\n      user: props.user }\n    )\n    ),\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0 },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\" },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab') },\n    ___EmotionJSX(Icons.Collapse, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\" }\n    )\n    )\n    )\n    ) :\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(LocalStorageKeys.ControlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(LocalStorageKeys.ControlsWidth),\n        height: '100%'\n      },\n      minWidth: defaultSidebarsWidth[LocalStorageKeys.ControlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\" },\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      exploreState: props.exploreState,\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      chart: props.chart,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading,\n      onQuery: onQuery,\n      onStop: onStop,\n      canStopQuery: props.can_add || props.can_overwrite,\n      errorMessage: errorMessage,\n      chartIsStale: chartIsStale }\n    )\n    ),\n    ___EmotionJSX(\"div\", {\n      className: cx(\n        'main-explore-content',\n        isCollapsed ? 'col-sm-9' : 'col-sm-7'\n      ) },\n\n    renderChartContainer()\n    )\n    ),\n    props.isSaveModalVisible &&\n    ___EmotionJSX(SaveModal, {\n      addDangerToast: props.addDangerToast,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId }\n    )\n\n    ));\n\n}__signature__(ExploreViewContainer, \"usePluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseState{[lastQueriedControls, setLastQueriedControls](props.controls)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseState{[width, setWidth](getSidebarWidths(LocalStorageKeys.DatasourceWidth))}\\nuseTabId{tabId}\\nuseTheme{theme}\\nuseCallback{addHistory}\\nuseCallback{handlePopstate}\\nuseCallback{onQuery}\\nuseCallback{handleKeydown}\\nuseComponentDidMount{}\\nuseChangeEffect{}\\nusePrevious{previousHandlePopstate}\\nuseEffect{}\\nusePrevious{previousHandleKeyDown}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{reRenderChart}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseChangeEffect{}\\nuseEffect{}\\nuseMemo{errorMessage}\", () => [usePluginContext, usePrevious, usePrevious, useTabId, useTheme, useComponentDidMount, useChangeEffect, usePrevious, usePrevious, useChangeEffect]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {var _ref, _form_data$slice_id, _dataMask$slice_id, _explore$form_data, _datasource$column_fo, _ref2, _explore$sliceName, _dataMask$slice_id2;\n  const {\n    explore,\n    charts,\n    common,\n    impressionId,\n    dataMask,\n    reports,\n    user,\n    saveModal\n  } = state;\n  const { controls, slice, datasource, metadata, hiddenFormData } = explore;\n  const form_data = _omit(\n    getFormDataFromControls(controls),\n    Object.keys(hiddenFormData != null ? hiddenFormData : {})\n  );\n  const slice_id = (_ref = (_form_data$slice_id = form_data.slice_id) != null ? _form_data$slice_id : slice == null ? void 0 : slice.slice_id) != null ? _ref : 0; // 0 - unsaved chart\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...((_dataMask$slice_id = dataMask[slice_id]) == null ? void 0 : _dataMask$slice_id.ownState)\n    }\n  );\n  const chart = charts[slice_id];\n\n  let dashboardId = Number((_explore$form_data = explore.form_data) == null ? void 0 : _explore$form_data.dashboardId);\n  if (Number.isNaN(dashboardId)) {\n    dashboardId = undefined;\n  }\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource,\n    datasource_type: datasource.type,\n    datasourceId: datasource.datasource_id,\n    dashboardId,\n    controls: explore.controls,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    can_overwrite: !!explore.can_overwrite,\n    column_formats: (_datasource$column_fo = datasource == null ? void 0 : datasource.column_formats) != null ? _datasource$column_fo : null,\n    containerId: slice ?\n    `slice-container-${slice.slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice,\n    sliceName: (_ref2 = (_explore$sliceName = explore.sliceName) != null ? _explore$sliceName : slice == null ? void 0 : slice.slice_name) != null ? _ref2 : null,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: datasource.table_name,\n    vizType: form_data.viz_type,\n    standalone: !!explore.standalone,\n    force: !!explore.force,\n    chart,\n    timeout: common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: (_dataMask$slice_id2 = dataMask[slice_id]) == null ? void 0 : _dataMask$slice_id2.ownState,\n    impressionId,\n    user,\n    exploreState: explore,\n    reports,\n    metadata,\n    saveAction: explore.saveAction,\n    isSaveModalVisible: saveModal.isVisible\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...datasourcesActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch)\n  };\n}const _default =\n\nconnect(\n  mapStateToProps,\n  mapDispatchToProps\n)(withToasts( /*#__PURE__*/React.memo(ExploreViewContainer)));export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(ExplorePanelContainer, \"ExplorePanelContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(updateHistory, \"updateHistory\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(defaultSidebarsWidth, \"defaultSidebarsWidth\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(getSidebarWidths, \"getSidebarWidths\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(setSidebarWidths, \"setSidebarWidths\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","css","useTheme","logging","useChangeEffect","useComponentDidMount","usePrevious","Resizable","usePluginContext","Global","Tooltip","Icons","getItem","setItem","LocalStorageKeys","RESERVED_CHART_URL_PARAMS","URL_PARAMS","areObjectsEqual","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","getUrlParam","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","postFormData","putFormData","datasourcesActions","mountExploreUrl","getFormDataFromControls","exploreActions","saveModalActions","useTabId","withToasts","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","DataSourcePanel","ConnectedExploreChartHeader","ExploreContainer","jsx","___EmotionJSX","propTypes","actions","object","isRequired","datasource_type","string","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","force","timeout","impressionId","vizType","saveAction","isSaveModalVisible","ExplorePanelContainer","div","theme","colors","grayscale","light5","light2","gridUnit","typography","sizes","m","light4","primary","base","updateHistory","_debounce","formData","datasourceId","datasourceType","isReplace","title","tabId","payload","chartId","slice_id","params","URLSearchParams","window","location","search","additionalParam","Object","fromEntries","sliceId","name","urlParams","url_params","entries","forEach","key","value","includes","stateModifier","formDataKey","pathname","startsWith","url","history","e","warn","defaultSidebarsWidth","controls_width","datasource_width","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","width","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","dynamicPlugins","isDynamicPluginLoading","mounting","wasDynamicPluginLoading","previousControls","lastQueriedControls","setLastQueriedControls","isCollapsed","setIsCollapsed","setWidth","DatasourceWidth","addHistory","id","type","datasource","handlePopstate","state","keys","length","setExploreControls","postChartFormData","onQuery","setForceQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","keyCode","isS","saveSlice","action","slice_name","add_to_dash","goto_dash","then","data","slice_url","onStop","queryController","abort","toggleCollapse","logEvent","previous","current","previousHandlePopstate","removeEventListener","addEventListener","previousHandleKeyDown","document","dynamicPluginControlsReady","hasError","values","some","control","validationErrors","reRenderChart","controlsChanged","newQueryFormData","latestQueryFormData","_pick","updateQueryFormData","renderTriggered","Date","getTime","viz_type","changedControlKeys","filter","displayControlsChanged","renderTrigger","ownState","chartIsStale","ignoreFields","dontRefreshOnChange","setSaveAction","undefined","errorMessage","controlsWithErrors","errorMessages","map","uniqueErrorMessages","Set","flat","errors","message","matchingLabels","_control$validationEr","label","labels","join","style","textAlign","renderChartContainer","_extends","canOverwrite","can_overwrite","canDownload","can_download","isStarred","table_name","user","reports","saveDisabled","chartStatus","metadata","styles","onResizeStop","evt","direction","ref","d","getBoundingClientRect","defaultSize","height","minWidth","maxWidth","enable","right","className","role","tabIndex","onClick","Expand","iconColor","iconSize","Collapse","ControlsWidth","exploreState","canStopQuery","can_add","addDangerToast","__signature__","mapStateToProps","_ref","_form_data$slice_id","_dataMask$slice_id","_explore$form_data","_datasource$column_fo","_ref2","_explore$sliceName","_dataMask$slice_id2","explore","charts","common","dataMask","saveModal","hiddenFormData","_omit","extra_form_data","isNaN","datasource_id","column_formats","containerId","triggerRender","conf","SUPERSET_WEBSERVER_TIMEOUT","isVisible","mapDispatchToProps","dispatch","_default","memo","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ExploreViewContainer/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n  styled,\n  t,\n  css,\n  useTheme,\n  logging,\n  useChangeEffect,\n  useComponentDidMount,\n  usePrevious,\n} from '@superset-ui/core';\nimport { debounce, omit, pick } from 'lodash';\nimport { Resizable } from 're-resizable';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys,\n} from 'src/utils/localStorageHelpers';\nimport { RESERVED_CHART_URL_PARAMS, URL_PARAMS } from 'src/constants';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport * as logActions from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from 'src/logger/LogUtils';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport cx from 'classnames';\nimport * as chartActions from 'src/components/Chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { postFormData, putFormData } from 'src/explore/exploreUtils/formData';\nimport { datasourcesActions } from 'src/explore/actions/datasourcesActions';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport * as exploreActions from 'src/explore/actions/exploreActions';\nimport * as saveModalActions from 'src/explore/actions/saveModalActions';\nimport { useTabId } from 'src/hooks/useTabId';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ExploreChartPanel from '../ExploreChartPanel';\nimport ConnectedControlPanelsContainer from '../ControlPanelsContainer';\nimport SaveModal from '../SaveModal';\nimport DataSourcePanel from '../DatasourcePanel';\nimport ConnectedExploreChartHeader from '../ExploreChartHeader';\nimport ExploreContainer from '../ExploreContainer';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  force: PropTypes.bool,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n  saveAction: PropTypes.string,\n  isSaveModalVisible: PropTypes.bool,\n};\n\nconst ExplorePanelContainer = styled.div`\n  ${({ theme }) => css`\n    background: ${theme.colors.grayscale.light5};\n    text-align: left;\n    position: relative;\n    width: 100%;\n    max-height: 100%;\n    min-height: 0;\n    display: flex;\n    flex: 1;\n    flex-wrap: nowrap;\n    border-top: 1px solid ${theme.colors.grayscale.light2};\n    .explore-column {\n      display: flex;\n      flex-direction: column;\n      padding: ${theme.gridUnit * 2}px 0;\n      max-height: 100%;\n    }\n    .data-source-selection {\n      background-color: ${theme.colors.grayscale.light5};\n      padding: ${theme.gridUnit * 2}px 0;\n      border-right: 1px solid ${theme.colors.grayscale.light2};\n    }\n    .main-explore-content {\n      flex: 1;\n      min-width: ${theme.gridUnit * 128}px;\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      padding: 0 ${theme.gridUnit * 4}px;\n      .panel {\n        margin-bottom: 0;\n      }\n    }\n    .controls-column {\n      align-self: flex-start;\n      padding: 0;\n    }\n    .title-container {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      padding: 0 ${theme.gridUnit * 2}px 0 ${theme.gridUnit * 4}px;\n      justify-content: space-between;\n      .horizontal-text {\n        font-size: ${theme.typography.sizes.m}px;\n      }\n    }\n    .no-show {\n      display: none;\n    }\n    .vertical-text {\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n    }\n    .sidebar {\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light4};\n      padding: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 8}px;\n    }\n    .collapse-icon > svg {\n      color: ${theme.colors.primary.base};\n    }\n  `};\n`;\n\nconst updateHistory = debounce(\n  async (\n    formData,\n    datasourceId,\n    datasourceType,\n    isReplace,\n    standalone,\n    force,\n    title,\n    tabId,\n  ) => {\n    const payload = { ...formData };\n    const chartId = formData.slice_id;\n    const params = new URLSearchParams(window.location.search);\n    const additionalParam = Object.fromEntries(params);\n\n    if (chartId) {\n      additionalParam[URL_PARAMS.sliceId.name] = chartId;\n    } else {\n      additionalParam[URL_PARAMS.datasourceId.name] = datasourceId;\n      additionalParam[URL_PARAMS.datasourceType.name] = datasourceType;\n    }\n\n    const urlParams = payload?.url_params || {};\n    Object.entries(urlParams).forEach(([key, value]) => {\n      if (!RESERVED_CHART_URL_PARAMS.includes(key)) {\n        additionalParam[key] = value;\n      }\n    });\n\n    try {\n      let key;\n      let stateModifier;\n      if (isReplace) {\n        key = await postFormData(\n          datasourceId,\n          datasourceType,\n          formData,\n          chartId,\n          tabId,\n        );\n        stateModifier = 'replaceState';\n      } else {\n        key = getUrlParam(URL_PARAMS.formDataKey);\n        await putFormData(\n          datasourceId,\n          datasourceType,\n          key,\n          formData,\n          chartId,\n          tabId,\n        );\n        stateModifier = 'pushState';\n      }\n      // avoid race condition in case user changes route before explore updates the url\n      if (window.location.pathname.startsWith('/explore')) {\n        const url = mountExploreUrl(\n          standalone ? URL_PARAMS.standalone.name : null,\n          {\n            [URL_PARAMS.formDataKey.name]: key,\n            ...additionalParam,\n          },\n          force,\n        );\n        window.history[stateModifier](payload, title, url);\n      }\n    } catch (e) {\n      logging.warn('Failed at altering browser history', e);\n    }\n  },\n  1000,\n);\n\nconst defaultSidebarsWidth = {\n  controls_width: 320,\n  datasource_width: 300,\n};\n\nfunction getSidebarWidths(key) {\n  return getItem(key, defaultSidebarsWidth[key]);\n}\n\nfunction setSidebarWidths(key, dimension) {\n  const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n  setItem(key, newDimension);\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n    props.controls,\n  );\n\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [width, setWidth] = useState(\n    getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n  );\n  const tabId = useTabId();\n\n  const theme = useTheme();\n\n  const addHistory = useCallback(\n    async ({ isReplace = false, title } = {}) => {\n      const formData = props.dashboardId\n        ? {\n            ...props.form_data,\n            dashboardId: props.dashboardId,\n          }\n        : props.form_data;\n      const { id: datasourceId, type: datasourceType } = props.datasource;\n\n      updateHistory(\n        formData,\n        datasourceId,\n        datasourceType,\n        isReplace,\n        props.standalone,\n        props.force,\n        title,\n        tabId,\n      );\n    },\n    [\n      props.dashboardId,\n      props.form_data,\n      props.datasource.id,\n      props.datasource.type,\n      props.standalone,\n      props.force,\n      tabId,\n    ],\n  );\n\n  const handlePopstate = useCallback(() => {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        props.force,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }, [props.actions, props.chart.id, props.timeout]);\n\n  const onQuery = useCallback(() => {\n    props.actions.setForceQuery(false);\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  const handleKeydown = useCallback(\n    event => {\n      const controlOrCommand = event.ctrlKey || event.metaKey;\n      if (controlOrCommand) {\n        const isEnter = event.key === 'Enter' || event.keyCode === 13;\n        const isS = event.key === 's' || event.keyCode === 83;\n        if (isEnter) {\n          onQuery();\n        } else if (isS) {\n          if (props.slice) {\n            props.actions\n              .saveSlice(props.form_data, {\n                action: 'overwrite',\n                slice_id: props.slice.slice_id,\n                slice_name: props.slice.slice_name,\n                add_to_dash: 'noSave',\n                goto_dash: false,\n              })\n              .then(({ data }) => {\n                window.location = data.slice.slice_url;\n              });\n          }\n        }\n      }\n    },\n    [onQuery, props.actions, props.form_data, props.slice],\n  );\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  useComponentDidMount(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n  });\n\n  useChangeEffect(tabId, (previous, current) => {\n    if (current) {\n      addHistory({ isReplace: true });\n    }\n  });\n\n  const previousHandlePopstate = usePrevious(handlePopstate);\n  useEffect(() => {\n    if (previousHandlePopstate) {\n      window.removeEventListener('popstate', previousHandlePopstate);\n    }\n    window.addEventListener('popstate', handlePopstate);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n    };\n  }, [handlePopstate, previousHandlePopstate]);\n\n  const previousHandleKeyDown = usePrevious(handleKeydown);\n  useEffect(() => {\n    if (previousHandleKeyDown) {\n      window.removeEventListener('keydown', previousHandleKeyDown);\n    }\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, [handleKeydown, previousHandleKeyDown]);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = useCallback(\n    controlsChanged => {\n      const newQueryFormData = controlsChanged\n        ? {\n            ...props.chart.latestQueryFormData,\n            ...getFormDataFromControls(pick(props.controls, controlsChanged)),\n          }\n        : getFormDataFromControls(props.controls);\n      props.actions.updateQueryFormData(newQueryFormData, props.chart.id);\n      props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n      addHistory();\n    },\n    [\n      addHistory,\n      props.actions,\n      props.chart.id,\n      props.chart.latestQueryFormData,\n      props.controls,\n    ],\n  );\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (\n      previousControls &&\n      props.chart.latestQueryFormData.viz_type === props.controls.viz_type.value\n    ) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const displayControlsChanged = changedControlKeys.filter(\n        key => props.controls[key].renderTrigger,\n      );\n      if (displayControlsChanged.length > 0) {\n        reRenderChart(displayControlsChanged);\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof lastQueriedControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            lastQueriedControls[key].value,\n            { ignoreFields: ['datasourceWarning'] },\n          ),\n      );\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useChangeEffect(props.saveAction, () => {\n    if (['saveas', 'overwrite'].includes(props.saveAction)) {\n      onQuery();\n      addHistory({ isReplace: true });\n      props.actions.setSaveAction(null);\n    }\n  });\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  const errorMessage = useMemo(() => {\n    const controlsWithErrors = Object.values(props.controls).filter(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      control => control.validationErrors,\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages\n      .map(message => {\n        const matchingLabels = controlsWithErrors\n          .filter(control => control.validationErrors?.includes(message))\n          .map(control => control.label);\n        return [matchingLabels, message];\n      })\n      .map(([labels, message]) => (\n        <div key={message}>\n          {labels.length > 1 ? t('Controls labeled ') : t('Control labeled ')}\n          <strong>{` ${labels.join(', ')}`}</strong>\n          <span>: {message}</span>\n        </div>\n      ));\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }, [props.controls]);\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        {...props}\n        errorMessage={errorMessage}\n        chartIsStale={chartIsStale}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <ExploreContainer>\n      <ConnectedExploreChartHeader\n        actions={props.actions}\n        canOverwrite={props.can_overwrite}\n        canDownload={props.can_download}\n        dashboardId={props.dashboardId}\n        isStarred={props.isStarred}\n        slice={props.slice}\n        sliceName={props.sliceName}\n        table_name={props.table_name}\n        formData={props.form_data}\n        chart={props.chart}\n        ownState={props.ownState}\n        user={props.user}\n        reports={props.reports}\n        saveDisabled={errorMessage || props.chart.chartStatus === 'loading'}\n        metadata={props.metadata}\n      />\n      <ExplorePanelContainer id=\"explore-container\">\n        <Global\n          styles={css`\n            .navbar {\n              margin-bottom: 0;\n            }\n            body {\n              height: 100vh;\n              max-height: 100vh;\n              overflow: hidden;\n            }\n            #app-menu,\n            #app {\n              flex: 1 1 auto;\n            }\n            #app {\n              flex-basis: 100%;\n              overflow: hidden;\n              height: 100%;\n            }\n            #app-menu {\n              flex-shrink: 0;\n            }\n          `}\n        />\n        <Resizable\n          onResizeStop={(evt, direction, ref, d) => {\n            setWidth(ref.getBoundingClientRect().width);\n            setSidebarWidths(LocalStorageKeys.DatasourceWidth, d);\n          }}\n          defaultSize={{\n            width: getSidebarWidths(LocalStorageKeys.DatasourceWidth),\n            height: '100%',\n          }}\n          minWidth={defaultSidebarsWidth[LocalStorageKeys.DatasourceWidth]}\n          maxWidth=\"33%\"\n          enable={{ right: true }}\n          className={\n            isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n          }\n        >\n          <div className=\"title-container\">\n            <span className=\"horizontal-text\">{t('Chart Source')}</span>\n            <span\n              role=\"button\"\n              tabIndex={0}\n              className=\"action-button\"\n              onClick={toggleCollapse}\n            >\n              <Icons.Expand\n                className=\"collapse-icon\"\n                iconColor={theme.colors.primary.base}\n                iconSize=\"l\"\n              />\n            </span>\n          </div>\n          <DataSourcePanel\n            formData={props.form_data}\n            datasource={props.datasource}\n            controls={props.controls}\n            actions={props.actions}\n            width={width}\n            user={props.user}\n          />\n        </Resizable>\n        {isCollapsed ? (\n          <div\n            className=\"sidebar\"\n            onClick={toggleCollapse}\n            data-test=\"open-datasource-tab\"\n            role=\"button\"\n            tabIndex={0}\n          >\n            <span role=\"button\" tabIndex={0} className=\"action-button\">\n              <Tooltip title={t('Open Datasource tab')}>\n                <Icons.Collapse\n                  className=\"collapse-icon\"\n                  iconColor={theme.colors.primary.base}\n                  iconSize=\"l\"\n                />\n              </Tooltip>\n            </span>\n          </div>\n        ) : null}\n        <Resizable\n          onResizeStop={(evt, direction, ref, d) =>\n            setSidebarWidths(LocalStorageKeys.ControlsWidth, d)\n          }\n          defaultSize={{\n            width: getSidebarWidths(LocalStorageKeys.ControlsWidth),\n            height: '100%',\n          }}\n          minWidth={defaultSidebarsWidth[LocalStorageKeys.ControlsWidth]}\n          maxWidth=\"33%\"\n          enable={{ right: true }}\n          className=\"col-sm-3 explore-column controls-column\"\n        >\n          <ConnectedControlPanelsContainer\n            exploreState={props.exploreState}\n            actions={props.actions}\n            form_data={props.form_data}\n            controls={props.controls}\n            chart={props.chart}\n            datasource_type={props.datasource_type}\n            isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n            onQuery={onQuery}\n            onStop={onStop}\n            canStopQuery={props.can_add || props.can_overwrite}\n            errorMessage={errorMessage}\n            chartIsStale={chartIsStale}\n          />\n        </Resizable>\n        <div\n          className={cx(\n            'main-explore-content',\n            isCollapsed ? 'col-sm-9' : 'col-sm-7',\n          )}\n        >\n          {renderChartContainer()}\n        </div>\n      </ExplorePanelContainer>\n      {props.isSaveModalVisible && (\n        <SaveModal\n          addDangerToast={props.addDangerToast}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n    </ExploreContainer>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const {\n    explore,\n    charts,\n    common,\n    impressionId,\n    dataMask,\n    reports,\n    user,\n    saveModal,\n  } = state;\n  const { controls, slice, datasource, metadata, hiddenFormData } = explore;\n  const form_data = omit(\n    getFormDataFromControls(controls),\n    Object.keys(hiddenFormData ?? {}),\n  );\n  const slice_id = form_data.slice_id ?? slice?.slice_id ?? 0; // 0 - unsaved chart\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask[slice_id]?.ownState,\n    },\n  );\n  const chart = charts[slice_id];\n\n  let dashboardId = Number(explore.form_data?.dashboardId);\n  if (Number.isNaN(dashboardId)) {\n    dashboardId = undefined;\n  }\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource,\n    datasource_type: datasource.type,\n    datasourceId: datasource.datasource_id,\n    dashboardId,\n    controls: explore.controls,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    can_overwrite: !!explore.can_overwrite,\n    column_formats: datasource?.column_formats ?? null,\n    containerId: slice\n      ? `slice-container-${slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice,\n    sliceName: explore.sliceName ?? slice?.slice_name ?? null,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: datasource.table_name,\n    vizType: form_data.viz_type,\n    standalone: !!explore.standalone,\n    force: !!explore.force,\n    chart,\n    timeout: common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: dataMask[slice_id]?.ownState,\n    impressionId,\n    user,\n    exploreState: explore,\n    reports,\n    metadata,\n    saveAction: explore.saveAction,\n    isSaveModalVisible: saveModal.isVisible,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...datasourcesActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(withToasts(React.memo(ExploreViewContainer)));\n"],"mappings":"8cAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACxE,OAAOC,SAAS,MAAM,YAAY;AAClC,SAASC,kBAAkB,QAAQ,OAAO;AAC1C,SAASC,OAAO,QAAQ,aAAa;AACrC;EACEC,MAAM;EACNC,CAAC;EACDC,GAAG;EACHC,QAAQ;EACRC,OAAO;EACPC,eAAe;EACfC,oBAAoB;EACpBC,WAAW;AACN,mBAAmB;;AAE1B,SAASC,SAAS,QAAQ,cAAc;AACxC,SAASC,gBAAgB,QAAQ,+BAA+B;AAChE,SAASC,MAAM,QAAQ,gBAAgB;AACvC,SAASC,OAAO,QAAQ,wBAAwB;AAChD,OAAOC,KAAK,MAAM,sBAAsB;AACxC;EACEC,OAAO;EACPC,OAAO;EACPC,gBAAgB;AACX,+BAA+B;AACtC,SAASC,yBAAyB,EAAEC,UAAU,QAAQ,eAAe;AACrE,SAASC,eAAe,QAAQ,gBAAgB;AAChD,OAAO,KAAKC,UAAU,MAAM,oBAAoB;AAChD;EACEC,0BAA0B;EAC1BC,mCAAmC;AAC9B,qBAAqB;AAC5B,SAASC,WAAW,QAAQ,oBAAoB;AAChD,OAAOC,EAAE,MAAM,YAAY;AAC3B,OAAO,KAAKC,YAAY,MAAM,kCAAkC;AAChE,SAASC,uBAAuB,QAAQ,mCAAmC;AAC3E,SAASC,cAAc,QAAQ,+BAA+B;AAC9D,SAASC,kBAAkB,QAAQ,8CAA8C;AACjF,SAASC,YAAY,EAAEC,WAAW,QAAQ,mCAAmC;AAC7E,SAASC,kBAAkB,QAAQ,wCAAwC;AAC3E,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,SAASC,uBAAuB,QAAQ,0BAA0B;AAClE,OAAO,KAAKC,cAAc,MAAM,oCAAoC;AACpE,OAAO,KAAKC,gBAAgB,MAAM,sCAAsC;AACxE,SAASC,QAAQ,QAAQ,oBAAoB;AAC7C,OAAOC,UAAU,MAAM,yCAAyC;AAChE,OAAOC,iBAAiB,MAAM,sBAAsB;AACpD,OAAOC,+BAA+B,MAAM,2BAA2B;AACvE,OAAOC,SAAS,MAAM,cAAc;AACpC,OAAOC,eAAe,MAAM,oBAAoB;AAChD,OAAOC,2BAA2B,MAAM,uBAAuB;AAC/D,OAAOC,gBAAgB,MAAM,qBAAqB,CAAC,SAAAC,GAAA,IAAAC,aAAA;;AAEnD,MAAMC,SAAS,GAAG;EAChB,GAAGR,iBAAiB,CAACQ,SAAS;EAC9BC,OAAO,EAAEjD,SAAS,CAACkD,MAAM,CAACC,UAAU;EACpCC,eAAe,EAAEpD,SAAS,CAACqD,MAAM,CAACF,UAAU;EAC5CG,WAAW,EAAEtD,SAAS,CAACuD,MAAM;EAC7BC,uBAAuB,EAAExD,SAAS,CAACyD,IAAI,CAACN,UAAU;EAClDO,KAAK,EAAE7B,cAAc,CAACsB,UAAU;EAChCQ,KAAK,EAAE3D,SAAS,CAACkD,MAAM;EACvBU,SAAS,EAAE5D,SAAS,CAACqD,MAAM;EAC3BQ,QAAQ,EAAE7D,SAAS,CAACkD,MAAM,CAACC,UAAU;EACrCW,YAAY,EAAE9D,SAAS,CAACqD,MAAM;EAC9BU,SAAS,EAAE/D,SAAS,CAACkD,MAAM,CAACC,UAAU;EACtCa,UAAU,EAAEhE,SAAS,CAACyD,IAAI,CAACN,UAAU;EACrCc,KAAK,EAAEjE,SAAS,CAACyD,IAAI;EACrBS,OAAO,EAAElE,SAAS,CAACuD,MAAM;EACzBY,YAAY,EAAEnE,SAAS,CAACqD,MAAM;EAC9Be,OAAO,EAAEpE,SAAS,CAACqD,MAAM;EACzBgB,UAAU,EAAErE,SAAS,CAACqD,MAAM;EAC5BiB,kBAAkB,EAAEtE,SAAS,CAACyD;AAChC,CAAC;;AAED,MAAMc,qBAAqB,GAAGpE,MAAM,CAACqE,GAAI;AACzC,IAAI,CAAC,EAAEC,KAAK,CAAC,CAAC,KAAKpE,GAAI;AACvB,kBAAkBoE,KAAK,CAACC,MAAM,CAACC,SAAS,CAACC,MAAO;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4BH,KAAK,CAACC,MAAM,CAACC,SAAS,CAACE,MAAO;AAC1D;AACA;AACA;AACA,iBAAiBJ,KAAK,CAACK,QAAQ,GAAG,CAAE;AACpC;AACA;AACA;AACA,0BAA0BL,KAAK,CAACC,MAAM,CAACC,SAAS,CAACC,MAAO;AACxD,iBAAiBH,KAAK,CAACK,QAAQ,GAAG,CAAE;AACpC,gCAAgCL,KAAK,CAACC,MAAM,CAACC,SAAS,CAACE,MAAO;AAC9D;AACA;AACA;AACA,mBAAmBJ,KAAK,CAACK,QAAQ,GAAG,GAAI;AACxC,+BAA+BL,KAAK,CAACC,MAAM,CAACC,SAAS,CAACE,MAAO;AAC7D,mBAAmBJ,KAAK,CAACK,QAAQ,GAAG,CAAE;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmBL,KAAK,CAACK,QAAQ,GAAG,CAAE,QAAOL,KAAK,CAACK,QAAQ,GAAG,CAAE;AAChE;AACA;AACA,qBAAqBL,KAAK,CAACM,UAAU,CAACC,KAAK,CAACC,CAAE;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0BR,KAAK,CAACC,MAAM,CAACC,SAAS,CAACO,MAAO;AACxD,iBAAiBT,KAAK,CAACK,QAAQ,GAAG,CAAE;AACpC,eAAeL,KAAK,CAACK,QAAQ,GAAG,CAAE;AAClC;AACA;AACA,eAAeL,KAAK,CAACC,MAAM,CAACS,OAAO,CAACC,IAAK;AACzC;AACA,GAAI;AACJ,CAAC;;AAED,MAAMC,aAAa,GAAGC,SAAA;EACpB;EACEC,QAAQ;EACRC,YAAY;EACZC,cAAc;EACdC,SAAS;EACT1B,UAAU;EACVC,KAAK;EACL0B,KAAK;EACLC,KAAK;EACF;IACH,MAAMC,OAAO,GAAG,EAAE,GAAGN,QAAQ,CAAC,CAAC;IAC/B,MAAMO,OAAO,GAAGP,QAAQ,CAACQ,QAAQ;IACjC,MAAMC,MAAM,GAAG,IAAIC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC;IAC1D,MAAMC,eAAe,GAAGC,MAAM,CAACC,WAAW,CAACP,MAAM,CAAC;;IAElD,IAAIF,OAAO,EAAE;MACXO,eAAe,CAACjF,UAAU,CAACoF,OAAO,CAACC,IAAI,CAAC,GAAGX,OAAO;IACpD,CAAC,MAAM;MACLO,eAAe,CAACjF,UAAU,CAACoE,YAAY,CAACiB,IAAI,CAAC,GAAGjB,YAAY;MAC5Da,eAAe,CAACjF,UAAU,CAACqE,cAAc,CAACgB,IAAI,CAAC,GAAGhB,cAAc;IAClE;;IAEA,MAAMiB,SAAS,GAAG,CAAAb,OAAO,oBAAPA,OAAO,CAAEc,UAAU,KAAI,CAAC,CAAC;IAC3CL,MAAM,CAACM,OAAO,CAACF,SAAS,CAAC,CAACG,OAAO,CAAC,CAAC,CAACC,GAAG,EAAEC,KAAK,CAAC,KAAK;MAClD,IAAI,CAAC5F,yBAAyB,CAAC6F,QAAQ,CAACF,GAAG,CAAC,EAAE;QAC5CT,eAAe,CAACS,GAAG,CAAC,GAAGC,KAAK;MAC9B;IACF,CAAC,CAAC;;IAEF,IAAI;MACF,IAAID,GAAG;MACP,IAAIG,aAAa;MACjB,IAAIvB,SAAS,EAAE;QACboB,GAAG,GAAG,MAAM/E,YAAY;UACtByD,YAAY;UACZC,cAAc;UACdF,QAAQ;UACRO,OAAO;UACPF;QACF,CAAC;QACDqB,aAAa,GAAG,cAAc;MAChC,CAAC,MAAM;QACLH,GAAG,GAAGrF,WAAW,CAACL,UAAU,CAAC8F,WAAW,CAAC;QACzC,MAAMlF,WAAW;UACfwD,YAAY;UACZC,cAAc;UACdqB,GAAG;UACHvB,QAAQ;UACRO,OAAO;UACPF;QACF,CAAC;QACDqB,aAAa,GAAG,WAAW;MAC7B;MACA;MACA,IAAIf,MAAM,CAACC,QAAQ,CAACgB,QAAQ,CAACC,UAAU,CAAC,UAAU,CAAC,EAAE;QACnD,MAAMC,GAAG,GAAGnF,eAAe;UACzB8B,UAAU,GAAG5C,UAAU,CAAC4C,UAAU,CAACyC,IAAI,GAAG,IAAI;UAC9C;YACE,CAACrF,UAAU,CAAC8F,WAAW,CAACT,IAAI,GAAGK,GAAG;YAClC,GAAGT;UACL,CAAC;UACDpC;QACF,CAAC;QACDiC,MAAM,CAACoB,OAAO,CAACL,aAAa,CAAC,CAACpB,OAAO,EAAEF,KAAK,EAAE0B,GAAG,CAAC;MACpD;IACF,CAAC,CAAC,OAAOE,CAAC,EAAE;MACVhH,OAAO,CAACiH,IAAI,CAAC,oCAAoC,EAAED,CAAC,CAAC;IACvD;EACF,CAAC;EACD;AACF,CAAC;;AAED,MAAME,oBAAoB,GAAG;EAC3BC,cAAc,EAAE,GAAG;EACnBC,gBAAgB,EAAE;AACpB,CAAC;;AAED,SAASC,gBAAgBA,CAACd,GAAG,EAAE;EAC7B,OAAO9F,OAAO,CAAC8F,GAAG,EAAEW,oBAAoB,CAACX,GAAG,CAAC,CAAC;AAChD;;AAEA,SAASe,gBAAgBA,CAACf,GAAG,EAAEgB,SAAS,EAAE;EACxC,MAAMC,YAAY,GAAGC,MAAM,CAACJ,gBAAgB,CAACd,GAAG,CAAC,CAAC,GAAGgB,SAAS,CAACG,KAAK;EACpEhH,OAAO,CAAC6F,GAAG,EAAEiB,YAAY,CAAC;AAC5B;;AAEA,SAASG,oBAAoBA,CAACC,KAAK,EAAE;EACnC,MAAMC,oBAAoB,GAAGxH,gBAAgB,CAAC,CAAC;EAC/C,MAAMyH,aAAa,GAAGD,oBAAoB,CAACE,cAAc,CAACH,KAAK,CAAC/D,OAAO,CAAC;EACxE,MAAMmE,sBAAsB,GAAGF,aAAa,IAAIA,aAAa,CAACG,QAAQ;EACtE,MAAMC,uBAAuB,GAAG/H,WAAW,CAAC6H,sBAAsB,CAAC;;EAEnE;EACA,MAAMG,gBAAgB,GAAGhI,WAAW,CAACyH,KAAK,CAACtE,QAAQ,CAAC;EACpD;EACA,MAAM,CAAC8E,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG7I,QAAQ;IAC5DoI,KAAK,CAACtE;EACR,CAAC;;EAED,MAAM,CAACgF,WAAW,EAAEC,cAAc,CAAC,GAAG/I,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACkI,KAAK,EAAEc,QAAQ,CAAC,GAAGhJ,QAAQ;IAChC6H,gBAAgB,CAAC1G,gBAAgB,CAAC8H,eAAe;EACnD,CAAC;EACD,MAAMpD,KAAK,GAAGtD,QAAQ,CAAC,CAAC;;EAExB,MAAMmC,KAAK,GAAGnE,QAAQ,CAAC,CAAC;;EAExB,MAAM2I,UAAU,GAAGrJ,WAAW;IAC5B,OAAO,EAAE8F,SAAS,GAAG,KAAK,EAAEC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK;MAC3C,MAAMJ,QAAQ,GAAG4C,KAAK,CAAC7E,WAAW;MAC9B;QACE,GAAG6E,KAAK,CAACpE,SAAS;QAClBT,WAAW,EAAE6E,KAAK,CAAC7E;MACrB,CAAC;MACD6E,KAAK,CAACpE,SAAS;MACnB,MAAM,EAAEmF,EAAE,EAAE1D,YAAY,EAAE2D,IAAI,EAAE1D,cAAc,CAAC,CAAC,GAAG0C,KAAK,CAACiB,UAAU;;MAEnE/D,aAAa;QACXE,QAAQ;QACRC,YAAY;QACZC,cAAc;QACdC,SAAS;QACTyC,KAAK,CAACnE,UAAU;QAChBmE,KAAK,CAAClE,KAAK;QACX0B,KAAK;QACLC;MACF,CAAC;IACH,CAAC;IACD;IACEuC,KAAK,CAAC7E,WAAW;IACjB6E,KAAK,CAACpE,SAAS;IACfoE,KAAK,CAACiB,UAAU,CAACF,EAAE;IACnBf,KAAK,CAACiB,UAAU,CAACD,IAAI;IACrBhB,KAAK,CAACnE,UAAU;IAChBmE,KAAK,CAAClE,KAAK;IACX2B,KAAK;;EAET,CAAC;;EAED,MAAMyD,cAAc,GAAGzJ,WAAW,CAAC,MAAM;IACvC,MAAM2F,QAAQ,GAAGW,MAAM,CAACoB,OAAO,CAACgC,KAAK;IACrC,IAAI/D,QAAQ,IAAIe,MAAM,CAACiD,IAAI,CAAChE,QAAQ,CAAC,CAACiE,MAAM,EAAE;MAC5CrB,KAAK,CAAClF,OAAO,CAACwG,kBAAkB,CAAClE,QAAQ,CAAC;MAC1C4C,KAAK,CAAClF,OAAO,CAACyG,iBAAiB;QAC7BnE,QAAQ;QACR4C,KAAK,CAAClE,KAAK;QACXkE,KAAK,CAACjE,OAAO;QACbiE,KAAK,CAACzE,KAAK,CAACwF;MACd,CAAC;IACH;EACF,CAAC,EAAE,CAACf,KAAK,CAAClF,OAAO,EAAEkF,KAAK,CAACzE,KAAK,CAACwF,EAAE,EAAEf,KAAK,CAACjE,OAAO,CAAC,CAAC;;EAElD,MAAMyF,OAAO,GAAG/J,WAAW,CAAC,MAAM;IAChCuI,KAAK,CAAClF,OAAO,CAAC2G,aAAa,CAAC,KAAK,CAAC;IAClCzB,KAAK,CAAClF,OAAO,CAAC4G,YAAY,CAAC,IAAI,EAAE1B,KAAK,CAACzE,KAAK,CAACwF,EAAE,CAAC;IAChDD,UAAU,CAAC,CAAC;IACZL,sBAAsB,CAACT,KAAK,CAACtE,QAAQ,CAAC;EACxC,CAAC,EAAE,CAACsE,KAAK,CAACtE,QAAQ,EAAEoF,UAAU,EAAEd,KAAK,CAAClF,OAAO,EAAEkF,KAAK,CAACzE,KAAK,CAACwF,EAAE,CAAC,CAAC;;EAE/D,MAAMY,aAAa,GAAGlK,WAAW;IAC/B,CAAAmK,KAAK,KAAI;MACP,MAAMC,gBAAgB,GAAGD,KAAK,CAACE,OAAO,IAAIF,KAAK,CAACG,OAAO;MACvD,IAAIF,gBAAgB,EAAE;QACpB,MAAMG,OAAO,GAAGJ,KAAK,CAACjD,GAAG,KAAK,OAAO,IAAIiD,KAAK,CAACK,OAAO,KAAK,EAAE;QAC7D,MAAMC,GAAG,GAAGN,KAAK,CAACjD,GAAG,KAAK,GAAG,IAAIiD,KAAK,CAACK,OAAO,KAAK,EAAE;QACrD,IAAID,OAAO,EAAE;UACXR,OAAO,CAAC,CAAC;QACX,CAAC,MAAM,IAAIU,GAAG,EAAE;UACd,IAAIlC,KAAK,CAACxE,KAAK,EAAE;YACfwE,KAAK,CAAClF,OAAO;YACVqH,SAAS,CAACnC,KAAK,CAACpE,SAAS,EAAE;cAC1BwG,MAAM,EAAE,WAAW;cACnBxE,QAAQ,EAAEoC,KAAK,CAACxE,KAAK,CAACoC,QAAQ;cAC9ByE,UAAU,EAAErC,KAAK,CAACxE,KAAK,CAAC6G,UAAU;cAClCC,WAAW,EAAE,QAAQ;cACrBC,SAAS,EAAE;YACb,CAAC,CAAC;YACDC,IAAI,CAAC,CAAC,EAAEC,IAAI,CAAC,CAAC,KAAK;cAClB1E,MAAM,CAACC,QAAQ,GAAGyE,IAAI,CAACjH,KAAK,CAACkH,SAAS;YACxC,CAAC,CAAC;UACN;QACF;MACF;IACF,CAAC;IACD,CAAClB,OAAO,EAAExB,KAAK,CAAClF,OAAO,EAAEkF,KAAK,CAACpE,SAAS,EAAEoE,KAAK,CAACxE,KAAK;EACvD,CAAC;;EAED,SAASmH,MAAMA,CAAA,EAAG;IAChB,IAAI3C,KAAK,CAACzE,KAAK,IAAIyE,KAAK,CAACzE,KAAK,CAACqH,eAAe,EAAE;MAC9C5C,KAAK,CAACzE,KAAK,CAACqH,eAAe,CAACC,KAAK,CAAC,CAAC;IACrC;EACF;;EAEA,SAASC,cAAcA,CAAA,EAAG;IACxBnC,cAAc,CAAC,CAACD,WAAW,CAAC;EAC9B;;EAEApI,oBAAoB,CAAC,MAAM;IACzB0H,KAAK,CAAClF,OAAO,CAACiI,QAAQ,CAAC3J,0BAA0B,CAAC;EACpD,CAAC,CAAC;;EAEFf,eAAe,CAACoF,KAAK,EAAE,CAACuF,QAAQ,EAAEC,OAAO,KAAK;IAC5C,IAAIA,OAAO,EAAE;MACXnC,UAAU,CAAC,EAAEvD,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;IACjC;EACF,CAAC,CAAC;;EAEF,MAAM2F,sBAAsB,GAAG3K,WAAW,CAAC2I,cAAc,CAAC;EAC1DxJ,SAAS,CAAC,MAAM;IACd,IAAIwL,sBAAsB,EAAE;MAC1BnF,MAAM,CAACoF,mBAAmB,CAAC,UAAU,EAAED,sBAAsB,CAAC;IAChE;IACAnF,MAAM,CAACqF,gBAAgB,CAAC,UAAU,EAAElC,cAAc,CAAC;IACnD,OAAO,MAAM;MACXnD,MAAM,CAACoF,mBAAmB,CAAC,UAAU,EAAEjC,cAAc,CAAC;IACxD,CAAC;EACH,CAAC,EAAE,CAACA,cAAc,EAAEgC,sBAAsB,CAAC,CAAC;;EAE5C,MAAMG,qBAAqB,GAAG9K,WAAW,CAACoJ,aAAa,CAAC;EACxDjK,SAAS,CAAC,MAAM;IACd,IAAI2L,qBAAqB,EAAE;MACzBtF,MAAM,CAACoF,mBAAmB,CAAC,SAAS,EAAEE,qBAAqB,CAAC;IAC9D;IACAC,QAAQ,CAACF,gBAAgB,CAAC,SAAS,EAAEzB,aAAa,CAAC;IACnD,OAAO,MAAM;MACX2B,QAAQ,CAACH,mBAAmB,CAAC,SAAS,EAAExB,aAAa,CAAC;IACxD,CAAC;EACH,CAAC,EAAE,CAACA,aAAa,EAAE0B,qBAAqB,CAAC,CAAC;;EAE1C3L,SAAS,CAAC,MAAM;IACd,IAAI4I,uBAAuB,IAAI,CAACF,sBAAsB,EAAE;MACtD;MACAJ,KAAK,CAAClF,OAAO,CAACyI,0BAA0B,CAAC,CAAC;IAC5C;EACF,CAAC,EAAE,CAACnD,sBAAsB,CAAC,CAAC;;EAE5B1I,SAAS,CAAC,MAAM;IACd,MAAM8L,QAAQ,GAAGrF,MAAM,CAACsF,MAAM,CAACzD,KAAK,CAACtE,QAAQ,CAAC,CAACgI,IAAI;MACjD,CAAAC,OAAO;MACLA,OAAO,CAACC,gBAAgB,IAAID,OAAO,CAACC,gBAAgB,CAACvC,MAAM,GAAG;IAClE,CAAC;IACD,IAAI,CAACmC,QAAQ,EAAE;MACbxD,KAAK,CAAClF,OAAO,CAAC4G,YAAY,CAAC,IAAI,EAAE1B,KAAK,CAACzE,KAAK,CAACwF,EAAE,CAAC;IAClD;EACF,CAAC,EAAE,EAAE,CAAC;;EAEN,MAAM8C,aAAa,GAAGpM,WAAW;IAC/B,CAAAqM,eAAe,KAAI;MACjB,MAAMC,gBAAgB,GAAGD,eAAe;MACpC;QACE,GAAG9D,KAAK,CAACzE,KAAK,CAACyI,mBAAmB;QAClC,GAAGhK,uBAAuB,CAACiK,KAAA,CAAKjE,KAAK,CAACtE,QAAQ,EAAEoI,eAAe,CAAC;MAClE,CAAC;MACD9J,uBAAuB,CAACgG,KAAK,CAACtE,QAAQ,CAAC;MAC3CsE,KAAK,CAAClF,OAAO,CAACoJ,mBAAmB,CAACH,gBAAgB,EAAE/D,KAAK,CAACzE,KAAK,CAACwF,EAAE,CAAC;MACnEf,KAAK,CAAClF,OAAO,CAACqJ,eAAe,CAAC,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,EAAErE,KAAK,CAACzE,KAAK,CAACwF,EAAE,CAAC;MACnED,UAAU,CAAC,CAAC;IACd,CAAC;IACD;IACEA,UAAU;IACVd,KAAK,CAAClF,OAAO;IACbkF,KAAK,CAACzE,KAAK,CAACwF,EAAE;IACdf,KAAK,CAACzE,KAAK,CAACyI,mBAAmB;IAC/BhE,KAAK,CAACtE,QAAQ;;EAElB,CAAC;;EAED;EACAhE,SAAS,CAAC,MAAM;IACd;IACE6I,gBAAgB;IAChBP,KAAK,CAACzE,KAAK,CAACyI,mBAAmB,CAACM,QAAQ,KAAKtE,KAAK,CAACtE,QAAQ,CAAC4I,QAAQ,CAAC1F,KAAK;IAC1E;MACA;MACEoB,KAAK,CAACtE,QAAQ,CAACuF,UAAU;MACxBV,gBAAgB,CAACU,UAAU,IAAI,IAAI;MAClCjB,KAAK,CAACtE,QAAQ,CAACuF,UAAU,CAACrC,KAAK,KAAK2B,gBAAgB,CAACU,UAAU,CAACrC,KAAK,CAAC;MACxE;QACA;QACAnF,uBAAuB,CAACuG,KAAK,CAACpE,SAAS,CAACqF,UAAU,EAAE,IAAI,CAAC;MAC3D;;MAEA,MAAMsD,kBAAkB,GAAGpG,MAAM,CAACiD,IAAI,CAACpB,KAAK,CAACtE,QAAQ,CAAC,CAAC8I,MAAM;QAC3D,CAAA7F,GAAG;QACD,OAAO4B,gBAAgB,CAAC5B,GAAG,CAAC,KAAK,WAAW;QAC5C,CAACzF,eAAe;UACd8G,KAAK,CAACtE,QAAQ,CAACiD,GAAG,CAAC,CAACC,KAAK;UACzB2B,gBAAgB,CAAC5B,GAAG,CAAC,CAACC;QACxB;MACJ,CAAC;;MAED;MACA,MAAM6F,sBAAsB,GAAGF,kBAAkB,CAACC,MAAM;QACtD,CAAA7F,GAAG,KAAIqB,KAAK,CAACtE,QAAQ,CAACiD,GAAG,CAAC,CAAC+F;MAC7B,CAAC;MACD,IAAID,sBAAsB,CAACpD,MAAM,GAAG,CAAC,EAAE;QACrCwC,aAAa,CAACY,sBAAsB,CAAC;MACvC;IACF;EACF,CAAC,EAAE,CAACzE,KAAK,CAACtE,QAAQ,EAAEsE,KAAK,CAAC2E,QAAQ,CAAC,CAAC;;EAEpC,MAAMC,YAAY,GAAGjN,OAAO,CAAC,MAAM;IACjC,IAAI6I,mBAAmB,EAAE;MACvB,MAAM+D,kBAAkB,GAAGpG,MAAM,CAACiD,IAAI,CAACpB,KAAK,CAACtE,QAAQ,CAAC,CAAC8I,MAAM;QAC3D,CAAA7F,GAAG;QACD,OAAO6B,mBAAmB,CAAC7B,GAAG,CAAC,KAAK,WAAW;QAC/C,CAACzF,eAAe;UACd8G,KAAK,CAACtE,QAAQ,CAACiD,GAAG,CAAC,CAACC,KAAK;UACzB4B,mBAAmB,CAAC7B,GAAG,CAAC,CAACC,KAAK;UAC9B,EAAEiG,YAAY,EAAE,CAAC,mBAAmB,CAAC,CAAC;QACxC;MACJ,CAAC;;MAED,OAAON,kBAAkB,CAACb,IAAI;QAC5B,CAAA/E,GAAG;QACD,CAACqB,KAAK,CAACtE,QAAQ,CAACiD,GAAG,CAAC,CAAC+F,aAAa;QAClC,CAAC1E,KAAK,CAACtE,QAAQ,CAACiD,GAAG,CAAC,CAACmG;MACzB,CAAC;IACH;IACA,OAAO,KAAK;EACd,CAAC,EAAE,CAACtE,mBAAmB,EAAER,KAAK,CAACtE,QAAQ,CAAC,CAAC;;EAEzCrD,eAAe,CAAC2H,KAAK,CAAC9D,UAAU,EAAE,MAAM;IACtC,IAAI,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC2C,QAAQ,CAACmB,KAAK,CAAC9D,UAAU,CAAC,EAAE;MACtDsF,OAAO,CAAC,CAAC;MACTV,UAAU,CAAC,EAAEvD,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;MAC/ByC,KAAK,CAAClF,OAAO,CAACiK,aAAa,CAAC,IAAI,CAAC;IACnC;EACF,CAAC,CAAC;;EAEFrN,SAAS,CAAC,MAAM;IACd,IAAIsI,KAAK,CAAC2E,QAAQ,KAAKK,SAAS,EAAE;MAChCxD,OAAO,CAAC,CAAC;MACTqC,aAAa,CAAC,CAAC;IACjB;EACF,CAAC,EAAE,CAAC7D,KAAK,CAAC2E,QAAQ,CAAC,CAAC;;EAEpB,IAAIC,YAAY,EAAE;IAChB5E,KAAK,CAAClF,OAAO,CAACiI,QAAQ,CAAC1J,mCAAmC,CAAC;EAC7D;;EAEA,MAAM4L,YAAY,GAAGtN,OAAO,CAAC,MAAM;IACjC,MAAMuN,kBAAkB,GAAG/G,MAAM,CAACsF,MAAM,CAACzD,KAAK,CAACtE,QAAQ,CAAC,CAAC8I,MAAM;MAC7D,CAAAb,OAAO;MACLA,OAAO,CAACC,gBAAgB,IAAID,OAAO,CAACC,gBAAgB,CAACvC,MAAM,GAAG;IAClE,CAAC;IACD,IAAI6D,kBAAkB,CAAC7D,MAAM,KAAK,CAAC,EAAE;MACnC,OAAO,IAAI;IACb;;IAEA,MAAM8D,aAAa,GAAGD,kBAAkB,CAACE,GAAG;MAC1C,CAAAzB,OAAO,KAAIA,OAAO,CAACC;IACrB,CAAC;IACD,MAAMyB,mBAAmB,GAAG,CAAC,GAAG,IAAIC,GAAG,CAACH,aAAa,CAACI,IAAI,CAAC,CAAC,CAAC,CAAC;;IAE9D,MAAMC,MAAM,GAAGH,mBAAmB;IAC/BD,GAAG,CAAC,CAAAK,OAAO,KAAI;MACd,MAAMC,cAAc,GAAGR,kBAAkB;MACtCV,MAAM,CAAC,CAAAb,OAAO,UAAAgC,qBAAA,SAAAA,qBAAA,GAAIhC,OAAO,CAACC,gBAAgB,qBAAxB+B,qBAAA,CAA0B9G,QAAQ,CAAC4G,OAAO,CAAC,GAAC;MAC9DL,GAAG,CAAC,CAAAzB,OAAO,KAAIA,OAAO,CAACiC,KAAK,CAAC;MAChC,OAAO,CAACF,cAAc,EAAED,OAAO,CAAC;IAClC,CAAC,CAAC;IACDL,GAAG,CAAC,CAAC,CAACS,MAAM,EAAEJ,OAAO,CAAC;IACrB7K,aAAA,UAAK+D,GAAG,EAAE8G,OAAQ;IACfI,MAAM,CAACxE,MAAM,GAAG,CAAC,GAAGpJ,CAAC,CAAC,mBAAmB,CAAC,GAAGA,CAAC,CAAC,kBAAkB,CAAC;IACnE2C,aAAA,iBAAU,IAAGiL,MAAM,CAACC,IAAI,CAAC,IAAI,CAAE,EAAU,CAAC;IAC1ClL,aAAA,eAAM,IAAE,EAAC6K,OAAc;IACpB;IACN,CAAC;;IAEJ,IAAIR,YAAY;IAChB,IAAIO,MAAM,CAACnE,MAAM,GAAG,CAAC,EAAE;MACrB4D,YAAY,GAAGrK,aAAA,UAAKmL,KAAK,EAAE,EAAEC,SAAS,EAAE,MAAM,CAAC,CAAE,IAAER,MAAY,CAAC;IAClE;IACA,OAAOP,YAAY;EACrB,CAAC,EAAE,CAACjF,KAAK,CAACtE,QAAQ,CAAC,CAAC;;EAEpB,SAASuK,oBAAoBA,CAAA,EAAG;IAC9B;MACErL,aAAA,CAACP,iBAAiB,EAAA6L,QAAA;MACZlG,KAAK;QACTiF,YAAY,EAAEA,YAAa;QAC3BL,YAAY,EAAEA,YAAa;QAC3BpD,OAAO,EAAEA,OAAQ;MAClB,CAAC;;EAEN;;EAEA,IAAIxB,KAAK,CAACnE,UAAU,EAAE;IACpB,OAAOoK,oBAAoB,CAAC,CAAC;EAC/B;;EAEA;IACErL,aAAA,CAACF,gBAAgB;IACfE,aAAA,CAACH,2BAA2B;MAC1BK,OAAO,EAAEkF,KAAK,CAAClF,OAAQ;MACvBqL,YAAY,EAAEnG,KAAK,CAACoG,aAAc;MAClCC,WAAW,EAAErG,KAAK,CAACsG,YAAa;MAChCnL,WAAW,EAAE6E,KAAK,CAAC7E,WAAY;MAC/BoL,SAAS,EAAEvG,KAAK,CAACuG,SAAU;MAC3B/K,KAAK,EAAEwE,KAAK,CAACxE,KAAM;MACnBC,SAAS,EAAEuE,KAAK,CAACvE,SAAU;MAC3B+K,UAAU,EAAExG,KAAK,CAACwG,UAAW;MAC7BpJ,QAAQ,EAAE4C,KAAK,CAACpE,SAAU;MAC1BL,KAAK,EAAEyE,KAAK,CAACzE,KAAM;MACnBoJ,QAAQ,EAAE3E,KAAK,CAAC2E,QAAS;MACzB8B,IAAI,EAAEzG,KAAK,CAACyG,IAAK;MACjBC,OAAO,EAAE1G,KAAK,CAAC0G,OAAQ;MACvBC,YAAY,EAAE1B,YAAY,IAAIjF,KAAK,CAACzE,KAAK,CAACqL,WAAW,KAAK,SAAU;MACpEC,QAAQ,EAAE7G,KAAK,CAAC6G,QAAS;IAC1B,CAAC;IACFjM,aAAA,CAACwB,qBAAqB,IAAC2E,EAAE,EAAC,mBAAmB;IAC3CnG,aAAA,CAAClC,MAAM;MACLoO,MAAM,EAAE5O,GAAI;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAY;IACH,CAAC;IACF0C,aAAA,CAACpC,SAAS;MACRuO,YAAY,EAAEA,CAACC,GAAG,EAAEC,SAAS,EAAEC,GAAG,EAAEC,CAAC,KAAK;QACxCvG,QAAQ,CAACsG,GAAG,CAACE,qBAAqB,CAAC,CAAC,CAACtH,KAAK,CAAC;QAC3CJ,gBAAgB,CAAC3G,gBAAgB,CAAC8H,eAAe,EAAEsG,CAAC,CAAC;MACvD,CAAE;MACFE,WAAW,EAAE;QACXvH,KAAK,EAAEL,gBAAgB,CAAC1G,gBAAgB,CAAC8H,eAAe,CAAC;QACzDyG,MAAM,EAAE;MACV,CAAE;MACFC,QAAQ,EAAEjI,oBAAoB,CAACvG,gBAAgB,CAAC8H,eAAe,CAAE;MACjE2G,QAAQ,EAAC,KAAK;MACdC,MAAM,EAAE,EAAEC,KAAK,EAAE,IAAI,CAAC,CAAE;MACxBC,SAAS;MACPjH,WAAW,GAAG,SAAS,GAAG,sCAC3B;;;IAED9F,aAAA,UAAK+M,SAAS,EAAC,iBAAiB;IAC9B/M,aAAA,WAAM+M,SAAS,EAAC,iBAAiB,IAAE1P,CAAC,CAAC,cAAc,CAAQ,CAAC;IAC5D2C,aAAA;MACEgN,IAAI,EAAC,QAAQ;MACbC,QAAQ,EAAE,CAAE;MACZF,SAAS,EAAC,eAAe;MACzBG,OAAO,EAAEhF,cAAe;;IAExBlI,aAAA,CAAChC,KAAK,CAACmP,MAAM;MACXJ,SAAS,EAAC,eAAe;MACzBK,SAAS,EAAE1L,KAAK,CAACC,MAAM,CAACS,OAAO,CAACC,IAAK;MACrCgL,QAAQ,EAAC,GAAG;IACb;IACG;IACH,CAAC;IACNrN,aAAA,CAACJ,eAAe;MACd4C,QAAQ,EAAE4C,KAAK,CAACpE,SAAU;MAC1BqF,UAAU,EAAEjB,KAAK,CAACiB,UAAW;MAC7BvF,QAAQ,EAAEsE,KAAK,CAACtE,QAAS;MACzBZ,OAAO,EAAEkF,KAAK,CAAClF,OAAQ;MACvBgF,KAAK,EAAEA,KAAM;MACb2G,IAAI,EAAEzG,KAAK,CAACyG,IAAK;IAClB;IACQ,CAAC;IACX/F,WAAW;IACV9F,aAAA;MACE+M,SAAS,EAAC,SAAS;MACnBG,OAAO,EAAEhF,cAAe;MACxB,aAAU,qBAAqB;MAC/B8E,IAAI,EAAC,QAAQ;MACbC,QAAQ,EAAE,CAAE;;IAEZjN,aAAA,WAAMgN,IAAI,EAAC,QAAQ,EAACC,QAAQ,EAAE,CAAE,EAACF,SAAS,EAAC,eAAe;IACxD/M,aAAA,CAACjC,OAAO,IAAC6E,KAAK,EAAEvF,CAAC,CAAC,qBAAqB,CAAE;IACvC2C,aAAA,CAAChC,KAAK,CAACsP,QAAQ;MACbP,SAAS,EAAC,eAAe;MACzBK,SAAS,EAAE1L,KAAK,CAACC,MAAM,CAACS,OAAO,CAACC,IAAK;MACrCgL,QAAQ,EAAC,GAAG;IACb;IACM;IACL;IACH,CAAC;IACJ,IAAI;IACRrN,aAAA,CAACpC,SAAS;MACRuO,YAAY,EAAEA,CAACC,GAAG,EAAEC,SAAS,EAAEC,GAAG,EAAEC,CAAC;MACnCzH,gBAAgB,CAAC3G,gBAAgB,CAACoP,aAAa,EAAEhB,CAAC,CACnD;;MACDE,WAAW,EAAE;QACXvH,KAAK,EAAEL,gBAAgB,CAAC1G,gBAAgB,CAACoP,aAAa,CAAC;QACvDb,MAAM,EAAE;MACV,CAAE;MACFC,QAAQ,EAAEjI,oBAAoB,CAACvG,gBAAgB,CAACoP,aAAa,CAAE;MAC/DX,QAAQ,EAAC,KAAK;MACdC,MAAM,EAAE,EAAEC,KAAK,EAAE,IAAI,CAAC,CAAE;MACxBC,SAAS,EAAC,yCAAyC;;IAEnD/M,aAAA,CAACN,+BAA+B;MAC9B8N,YAAY,EAAEpI,KAAK,CAACoI,YAAa;MACjCtN,OAAO,EAAEkF,KAAK,CAAClF,OAAQ;MACvBc,SAAS,EAAEoE,KAAK,CAACpE,SAAU;MAC3BF,QAAQ,EAAEsE,KAAK,CAACtE,QAAS;MACzBH,KAAK,EAAEyE,KAAK,CAACzE,KAAM;MACnBN,eAAe,EAAE+E,KAAK,CAAC/E,eAAgB;MACvCI,uBAAuB,EAAE2E,KAAK,CAAC3E,uBAAwB;MACvDmG,OAAO,EAAEA,OAAQ;MACjBmB,MAAM,EAAEA,MAAO;MACf0F,YAAY,EAAErI,KAAK,CAACsI,OAAO,IAAItI,KAAK,CAACoG,aAAc;MACnDnB,YAAY,EAAEA,YAAa;MAC3BL,YAAY,EAAEA,YAAa;IAC5B;IACQ,CAAC;IACZhK,aAAA;MACE+M,SAAS,EAAEpO,EAAE;QACX,sBAAsB;QACtBmH,WAAW,GAAG,UAAU,GAAG;MAC7B,CAAE;;IAEDuF,oBAAoB,CAAC;IACnB;IACgB,CAAC;IACvBjG,KAAK,CAAC7D,kBAAkB;IACvBvB,aAAA,CAACL,SAAS;MACRgO,cAAc,EAAEvI,KAAK,CAACuI,cAAe;MACrCzN,OAAO,EAAEkF,KAAK,CAAClF,OAAQ;MACvBc,SAAS,EAAEoE,KAAK,CAACpE,SAAU;MAC3BH,SAAS,EAAEuE,KAAK,CAACvE,SAAU;MAC3BN,WAAW,EAAE6E,KAAK,CAAC7E,WAAY;IAChC;;IAEa,CAAC;;AAEvB,CAACqN,aAAA,CAzcQzI,oBAAoB,2uBACEtH,gBAAgB,EAGbF,WAAW,EAGlBA,WAAW,EAUtB4B,QAAQ,EAERhC,QAAQ,EA4FtBG,oBAAoB,EAIpBD,eAAe,EAMgBE,WAAW,EAWZA,WAAW,EAwGzCF,eAAe;;AA+NjB0H,oBAAoB,CAAClF,SAAS,GAAGA,SAAS;;AAE1C,SAAS4N,eAAeA,CAACtH,KAAK,EAAE,KAAAuH,IAAA,EAAAC,mBAAA,EAAAC,kBAAA,EAAAC,kBAAA,EAAAC,qBAAA,EAAAC,KAAA,EAAAC,kBAAA,EAAAC,mBAAA;EAC9B,MAAM;IACJC,OAAO;IACPC,MAAM;IACNC,MAAM;IACNpN,YAAY;IACZqN,QAAQ;IACR3C,OAAO;IACPD,IAAI;IACJ6C;EACF,CAAC,GAAGnI,KAAK;EACT,MAAM,EAAEzF,QAAQ,EAAEF,KAAK,EAAEyF,UAAU,EAAE4F,QAAQ,EAAE0C,cAAc,CAAC,CAAC,GAAGL,OAAO;EACzE,MAAMtN,SAAS,GAAG4N,KAAA;IAChBxP,uBAAuB,CAAC0B,QAAQ,CAAC;IACjCyC,MAAM,CAACiD,IAAI,CAACmI,cAAc,WAAdA,cAAc,GAAI,CAAC,CAAC;EAClC,CAAC;EACD,MAAM3L,QAAQ,IAAA8K,IAAA,IAAAC,mBAAA,GAAG/M,SAAS,CAACgC,QAAQ,YAAA+K,mBAAA,GAAInN,KAAK,oBAALA,KAAK,CAAEoC,QAAQ,YAAA8K,IAAA,GAAI,CAAC,CAAC,CAAC;EAC7D9M,SAAS,CAAC6N,eAAe,GAAG9P,kBAAkB;IAC5C,EAAE,GAAGiC,SAAS,CAAC6N,eAAe,CAAC,CAAC;IAChC;MACE,KAAAb,kBAAA,GAAGS,QAAQ,CAACzL,QAAQ,CAAC,qBAAlBgL,kBAAA,CAAoBjE,QAAQ;IACjC;EACF,CAAC;EACD,MAAMpJ,KAAK,GAAG4N,MAAM,CAACvL,QAAQ,CAAC;;EAE9B,IAAIzC,WAAW,GAAG0E,MAAM,EAAAgJ,kBAAA,GAACK,OAAO,CAACtN,SAAS,qBAAjBiN,kBAAA,CAAmB1N,WAAW,CAAC;EACxD,IAAI0E,MAAM,CAAC6J,KAAK,CAACvO,WAAW,CAAC,EAAE;IAC7BA,WAAW,GAAG6J,SAAS;EACzB;;EAEA,OAAO;IACL3J,uBAAuB,EAAE6N,OAAO,CAAC7N,uBAAuB;IACxD4F,UAAU;IACVhG,eAAe,EAAEgG,UAAU,CAACD,IAAI;IAChC3D,YAAY,EAAE4D,UAAU,CAAC0I,aAAa;IACtCxO,WAAW;IACXO,QAAQ,EAAEwN,OAAO,CAACxN,QAAQ;IAC1B4M,OAAO,EAAE,CAAC,CAACY,OAAO,CAACZ,OAAO;IAC1BhC,YAAY,EAAE,CAAC,CAAC4C,OAAO,CAAC5C,YAAY;IACpCF,aAAa,EAAE,CAAC,CAAC8C,OAAO,CAAC9C,aAAa;IACtCwD,cAAc,GAAAd,qBAAA,GAAE7H,UAAU,oBAAVA,UAAU,CAAE2I,cAAc,YAAAd,qBAAA,GAAI,IAAI;IAClDe,WAAW,EAAErO,KAAK;IACb,mBAAkBA,KAAK,CAACoC,QAAS,EAAC;IACnC,iBAAiB;IACrB2I,SAAS,EAAE2C,OAAO,CAAC3C,SAAS;IAC5B/K,KAAK;IACLC,SAAS,GAAAsN,KAAA,IAAAC,kBAAA,GAAEE,OAAO,CAACzN,SAAS,YAAAuN,kBAAA,GAAIxN,KAAK,oBAALA,KAAK,CAAE6G,UAAU,YAAA0G,KAAA,GAAI,IAAI;IACzDe,aAAa,EAAEZ,OAAO,CAACY,aAAa;IACpClO,SAAS;IACT4K,UAAU,EAAEvF,UAAU,CAACuF,UAAU;IACjCvK,OAAO,EAAEL,SAAS,CAAC0I,QAAQ;IAC3BzI,UAAU,EAAE,CAAC,CAACqN,OAAO,CAACrN,UAAU;IAChCC,KAAK,EAAE,CAAC,CAACoN,OAAO,CAACpN,KAAK;IACtBP,KAAK;IACLQ,OAAO,EAAEqN,MAAM,CAACW,IAAI,CAACC,0BAA0B;IAC/CrF,QAAQ,GAAAsE,mBAAA,GAAEI,QAAQ,CAACzL,QAAQ,CAAC,qBAAlBqL,mBAAA,CAAoBtE,QAAQ;IACtC3I,YAAY;IACZyK,IAAI;IACJ2B,YAAY,EAAEc,OAAO;IACrBxC,OAAO;IACPG,QAAQ;IACR3K,UAAU,EAAEgN,OAAO,CAAChN,UAAU;IAC9BC,kBAAkB,EAAEmN,SAAS,CAACW;EAChC,CAAC;AACH;;AAEA,SAASC,kBAAkBA,CAACC,QAAQ,EAAE;EACpC,MAAMrP,OAAO,GAAG;IACd,GAAGb,cAAc;IACjB,GAAGH,kBAAkB;IACrB,GAAGI,gBAAgB;IACnB,GAAGV,YAAY;IACf,GAAGL;EACL,CAAC;EACD,OAAO;IACL2B,OAAO,EAAEhD,kBAAkB,CAACgD,OAAO,EAAEqP,QAAQ;EAC/C,CAAC;AACH,CAAC,MAAAC,QAAA;;AAEcrS,OAAO;EACpB0Q,eAAe;EACfyB;AACF,CAAC,CAAC9P,UAAU,eAAC5C,KAAK,CAAC6S,IAAI,CAACtK,oBAAoB,CAAC,CAAC,CAAC,CAH/C,eAAAqK,QAAA,CAGgD,mBAAAE,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAxF,SAAA,MAAAsF,cAAA,WAAAA,cAAA,CAAAG,QAAA,CA5sB1C5P,SAAS,+HAAAyP,cAAA,CAAAG,QAAA,CAqBTrO,qBAAqB,2IAAAkO,cAAA,CAAAG,QAAA,CAiErBvN,aAAa,mIAAAoN,cAAA,CAAAG,QAAA,CAyEbnL,oBAAoB,0IAAAgL,cAAA,CAAAG,QAAA,CAKjBhL,gBAAgB,sIAAA6K,cAAA,CAAAG,QAAA,CAIhB/K,gBAAgB,sIAAA4K,cAAA,CAAAG,QAAA,CAKhB1K,oBAAoB,0IAAAuK,cAAA,CAAAG,QAAA,CA6cpBhC,eAAe,qIAAA6B,cAAA,CAAAG,QAAA,CAkEfP,kBAAkB,wIAAAI,cAAA,CAAAG,QAAA,CAAAL,QAAA,qJAAAM,WAAA,UAAAH,oBAAA,mBAAAA,oBAAA,CAAAG,WAAA,GAAA1F,SAAA,CAAA0F,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}