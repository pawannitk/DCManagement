{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getClientErrorObject, SupersetClient, t } from '@superset-ui/core';\nimport rison from 'rison';\nimport { cacheWrapper } from 'src/utils/cacheWrapper';\nconst localCache = new Map();\nconst cachedSupersetGet = cacheWrapper(SupersetClient.get, localCache, ({ endpoint }) => endpoint || '');\nexport const tagToSelectOption = (tag) => ({\n  value: tag.id,\n  label: tag.name,\n  key: tag.id\n});\nexport const loadTags = async (search, page, pageSize) => {\n  const searchColumn = 'name';\n  const query = rison.encode({\n    filters: [\n    { col: searchColumn, opr: 'ct', value: search },\n    { col: 'type', opr: 'custom_tag', value: true }],\n\n    page,\n    page_size: pageSize,\n    order_column: searchColumn,\n    order_direction: 'asc'\n  });\n  const getErrorMessage = ({ error, message }) => {\n    let errorText = message || error || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to read tags');\n    }\n    return errorText;\n  };\n  return cachedSupersetGet({\n    endpoint: `/api/v1/tag/?q=${query}`\n  }).\n  then((response) => {\n    const data = response.json.result.map(tagToSelectOption);\n    return {\n      data,\n      totalCount: response.json.count\n    };\n  }).\n  catch(async (error) => {\n    const errorMessage = getErrorMessage(await getClientErrorObject(error));\n    throw new Error(errorMessage);\n  });\n};;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(localCache, \"localCache\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Tags/utils.tsx\");reactHotLoader.register(cachedSupersetGet, \"cachedSupersetGet\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Tags/utils.tsx\");reactHotLoader.register(tagToSelectOption, \"tagToSelectOption\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Tags/utils.tsx\");reactHotLoader.register(loadTags, \"loadTags\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Tags/utils.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["getClientErrorObject","SupersetClient","t","rison","cacheWrapper","localCache","Map","cachedSupersetGet","get","endpoint","tagToSelectOption","tag","value","id","label","name","key","loadTags","search","page","pageSize","searchColumn","query","encode","filters","col","opr","page_size","order_column","order_direction","getErrorMessage","error","message","errorText","then","response","data","json","result","map","totalCount","count","catch","errorMessage","Error","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Tags/utils.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  ClientErrorObject,\n  getClientErrorObject,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport Tag from 'src/types/TagType';\n\nimport rison from 'rison';\nimport { cacheWrapper } from 'src/utils/cacheWrapper';\n\nconst localCache = new Map<string, any>();\n\nconst cachedSupersetGet = cacheWrapper(\n  SupersetClient.get,\n  localCache,\n  ({ endpoint }) => endpoint || '',\n);\n\ntype SelectTagsValue = {\n  value: number | undefined;\n  label: string | undefined;\n  key: number | undefined;\n};\n\nexport const tagToSelectOption = (\n  tag: Tag & { table_name: string },\n): SelectTagsValue => ({\n  value: tag.id,\n  label: tag.name,\n  key: tag.id,\n});\n\nexport const loadTags = async (\n  search: string,\n  page: number,\n  pageSize: number,\n) => {\n  const searchColumn = 'name';\n  const query = rison.encode({\n    filters: [\n      { col: searchColumn, opr: 'ct', value: search },\n      { col: 'type', opr: 'custom_tag', value: true },\n    ],\n    page,\n    page_size: pageSize,\n    order_column: searchColumn,\n    order_direction: 'asc',\n  });\n\n  const getErrorMessage = ({ error, message }: ClientErrorObject) => {\n    let errorText = message || error || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to read tags');\n    }\n    return errorText;\n  };\n\n  return cachedSupersetGet({\n    endpoint: `/api/v1/tag/?q=${query}`,\n  })\n    .then(response => {\n      const data: {\n        label: string;\n        value: string | number;\n      }[] = response.json.result.map(tagToSelectOption);\n      return {\n        data,\n        totalCount: response.json.count,\n      };\n    })\n    .catch(async error => {\n      const errorMessage = getErrorMessage(await getClientErrorObject(error));\n      throw new Error(errorMessage);\n    });\n};\n"],"mappings":"wSAAA;;;;;;;;;;;;;;;;;;AAmBA,SAEEA,oBAAoB,EACpBC,cAAc,EACdC,CAAC,QACI,mBAAmB;AAG1B,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,YAAY,QAAQ,wBAAwB;AAErD,MAAMC,UAAU,GAAG,IAAIC,GAAG,EAAe;AAEzC,MAAMC,iBAAiB,GAAGH,YAAY,CACpCH,cAAc,CAACO,GAAG,EAClBH,UAAU,EACV,CAAC,EAAEI,QAAQ,EAAE,KAAKA,QAAQ,IAAI,EAAE,CACjC;AAQD,OAAO,MAAMC,iBAAiB,GAAGA,CAC/BC,GAAiC,MACZ;EACrBC,KAAK,EAAED,GAAG,CAACE,EAAE;EACbC,KAAK,EAAEH,GAAG,CAACI,IAAI;EACfC,GAAG,EAAEL,GAAG,CAACE;CACV,CAAC;AAEF,OAAO,MAAMI,QAAQ,GAAG,MAAAA,CACtBC,MAAc,EACdC,IAAY,EACZC,QAAgB,KACd;EACF,MAAMC,YAAY,GAAG,MAAM;EAC3B,MAAMC,KAAK,GAAGnB,KAAK,CAACoB,MAAM,CAAC;IACzBC,OAAO,EAAE;IACP,EAAEC,GAAG,EAAEJ,YAAY,EAAEK,GAAG,EAAE,IAAI,EAAEd,KAAK,EAAEM,MAAM,EAAE;IAC/C,EAAEO,GAAG,EAAE,MAAM,EAAEC,GAAG,EAAE,YAAY,EAAEd,KAAK,EAAE,IAAI,EAAE,CAChD;;IACDO,IAAI;IACJQ,SAAS,EAAEP,QAAQ;IACnBQ,YAAY,EAAEP,YAAY;IAC1BQ,eAAe,EAAE;GAClB,CAAC;EAEF,MAAMC,eAAe,GAAGA,CAAC,EAAEC,KAAK,EAAEC,OAAO,EAAqB,KAAI;IAChE,IAAIC,SAAS,GAAGD,OAAO,IAAID,KAAK,IAAI7B,CAAC,CAAC,uBAAuB,CAAC;IAC9D,IAAI8B,OAAO,KAAK,WAAW,EAAE;MAC3BC,SAAS,GAAG/B,CAAC,CAAC,yCAAyC,CAAC;;IAE1D,OAAO+B,SAAS;EAClB,CAAC;EAED,OAAO1B,iBAAiB,CAAC;IACvBE,QAAQ,EAAE,kBAAkBa,KAAK;GAClC,CAAC;EACCY,IAAI,CAAC,CAAAC,QAAQ,KAAG;IACf,MAAMC,IAAI,GAGJD,QAAQ,CAACE,IAAI,CAACC,MAAM,CAACC,GAAG,CAAC7B,iBAAiB,CAAC;IACjD,OAAO;MACL0B,IAAI;MACJI,UAAU,EAAEL,QAAQ,CAACE,IAAI,CAACI;KAC3B;EACH,CAAC,CAAC;EACDC,KAAK,CAAC,OAAMX,KAAK,KAAG;IACnB,MAAMY,YAAY,GAAGb,eAAe,CAAC,MAAM9B,oBAAoB,CAAC+B,KAAK,CAAC,CAAC;IACvE,MAAM,IAAIa,KAAK,CAACD,YAAY,CAAC;EAC/B,CAAC,CAAC;AACN,CAAC,CAAC,mBAAAE,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAC,SAAA,MAAAH,cAAA,WAAAA,cAAA,CAAAI,QAAA,CAhEI5C,UAAU,wGAAAwC,cAAA,CAAAI,QAAA,CAEV1C,iBAAiB,+GAAAsC,cAAA,CAAAI,QAAA,CAYVvC,iBAAiB,+GAAAmC,cAAA,CAAAI,QAAA,CAQjBhC,QAAQ,8HAAAiC,WAAA,UAAAJ,oBAAA,mBAAAA,oBAAA,CAAAI,WAAA,GAAAF,SAAA,CAAAE,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}