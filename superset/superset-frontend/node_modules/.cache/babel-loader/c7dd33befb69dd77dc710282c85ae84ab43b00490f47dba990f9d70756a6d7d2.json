{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\nimport { useSelector } from 'react-redux';\nimport { useEffect, useMemo, useState } from 'react';\nimport { NATIVE_FILTER_PREFIX } from '../FiltersConfigModal/utils';\nexport const useFilters = () => {\n  const preselectedNativeFilters = useSelector((state) => {var _state$dashboardState;return (_state$dashboardState = state.dashboardState) == null ? void 0 : _state$dashboardState.preselectNativeFilters;});\n  const nativeFilters = useSelector((state) => state.nativeFilters.filters);\n  return useMemo(() => Object.entries(nativeFilters).reduce((acc, [filterId, filter]) => ({\n    ...acc,\n    [filterId]: {\n      ...filter,\n      preselect: preselectedNativeFilters == null ? void 0 : preselectedNativeFilters[filterId]\n    }\n  }), {}), [nativeFilters, preselectedNativeFilters]);\n};__signature__(useFilters, \"useSelector{preselectedNativeFilters}\\nuseSelector{nativeFilters}\\nuseMemo{}\", () => [useSelector, useSelector]);\nexport const useNativeFiltersDataMask = () => {\n  const dataMask = useSelector((state) => state.dataMask);\n  return useMemo(() => Object.values(dataMask).\n  filter((item) => String(item.id).startsWith(NATIVE_FILTER_PREFIX)).\n  reduce((prev, next) => ({ ...prev, [next.id]: next }), {}), [dataMask]);\n};__signature__(useNativeFiltersDataMask, \"useSelector{dataMask}\\nuseMemo{}\", () => [useSelector]);\nexport const useFilterUpdates = (dataMaskSelected, setDataMaskSelected) => {\n  const filters = useFilters();\n  const dataMaskApplied = useNativeFiltersDataMask();\n  useEffect(() => {\n    // Remove deleted filters from local state\n    Object.keys(dataMaskSelected).forEach((selectedId) => {\n      if (!filters[selectedId]) {\n        setDataMaskSelected((draft) => {\n          delete draft[selectedId];\n        });\n      }\n    });\n  }, [dataMaskApplied, dataMaskSelected, filters, setDataMaskSelected]);\n};\n// Load filters after charts loaded\n__signature__(useFilterUpdates, \"useFilters{filters}\\nuseNativeFiltersDataMask{dataMaskApplied}\\nuseEffect{}\", () => [useFilters, useNativeFiltersDataMask]);export const useInitialization = () => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const filters = useFilters();\n  const charts = useSelector((state) => state.charts);\n  // We need to know how much charts now shown on dashboard to know how many of all charts should be loaded\n  let numberOfLoadingCharts = 0;\n  if (!isInitialized) {\n    numberOfLoadingCharts = document.querySelectorAll('[data-ui-anchor=\"chart\"]').length;\n  }\n  useEffect(() => {\n    if (isInitialized) {\n      return;\n    }\n    if (Object.values(filters).find(({ requiredFirst }) => requiredFirst)) {\n      setIsInitialized(true);\n      return;\n    }\n    // For some dashboards may be there are no charts on first page,\n    // so we check up to 1 sec if there is at least on chart to load\n    let filterTimeout;\n    if (numberOfLoadingCharts === 0) {\n      filterTimeout = setTimeout(() => {\n        setIsInitialized(true);\n      }, 1000);\n    }\n    // @ts-ignore\n    if (numberOfLoadingCharts > 0 && filterTimeout !== undefined) {\n      clearTimeout(filterTimeout);\n    }\n    const numberOfLoadedCharts = Object.values(charts).filter(({ chartStatus }) => chartStatus !== 'loading').length;\n    if (numberOfLoadingCharts > 0 &&\n    numberOfLoadedCharts >= numberOfLoadingCharts) {\n      setIsInitialized(true);\n    }\n  }, [charts, isInitialized, numberOfLoadingCharts]);\n  return isInitialized;\n};__signature__(useInitialization, \"useState{[isInitialized, setIsInitialized](false)}\\nuseFilters{filters}\\nuseSelector{charts}\\nuseEffect{}\", () => [useFilters, useSelector]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(useFilters, \"useFilters\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/state.ts\");reactHotLoader.register(useNativeFiltersDataMask, \"useNativeFiltersDataMask\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/state.ts\");reactHotLoader.register(useFilterUpdates, \"useFilterUpdates\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/state.ts\");reactHotLoader.register(useInitialization, \"useInitialization\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/state.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useSelector","useEffect","useMemo","useState","NATIVE_FILTER_PREFIX","useFilters","preselectedNativeFilters","state","_state$dashboardState","dashboardState","preselectNativeFilters","nativeFilters","filters","Object","entries","reduce","acc","filterId","filter","preselect","__signature__","useNativeFiltersDataMask","dataMask","values","item","String","id","startsWith","prev","next","useFilterUpdates","dataMaskSelected","setDataMaskSelected","dataMaskApplied","keys","forEach","selectedId","draft","useInitialization","isInitialized","setIsInitialized","charts","numberOfLoadingCharts","document","querySelectorAll","length","find","requiredFirst","filterTimeout","setTimeout","undefined","clearTimeout","numberOfLoadedCharts","chartStatus","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/state.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\nimport { useSelector } from 'react-redux';\nimport {\n  DataMaskState,\n  DataMaskStateWithId,\n  DataMaskWithId,\n  Filter,\n  Filters,\n} from '@superset-ui/core';\nimport { useEffect, useMemo, useState } from 'react';\nimport { ChartsState, RootState } from 'src/dashboard/types';\nimport { NATIVE_FILTER_PREFIX } from '../FiltersConfigModal/utils';\n\nexport const useFilters = () => {\n  const preselectedNativeFilters = useSelector<any, Filters>(\n    state => state.dashboardState?.preselectNativeFilters,\n  );\n  const nativeFilters = useSelector<RootState, Filters>(\n    state => state.nativeFilters.filters,\n  );\n  return useMemo(\n    () =>\n      Object.entries(nativeFilters).reduce(\n        (acc, [filterId, filter]: [string, Filter]) => ({\n          ...acc,\n          [filterId]: {\n            ...filter,\n            preselect: preselectedNativeFilters?.[filterId],\n          },\n        }),\n        {} as Filters,\n      ),\n    [nativeFilters, preselectedNativeFilters],\n  );\n};\n\nexport const useNativeFiltersDataMask = () => {\n  const dataMask = useSelector<RootState, DataMaskStateWithId>(\n    state => state.dataMask,\n  );\n\n  return useMemo(\n    () =>\n      Object.values(dataMask)\n        .filter((item: DataMaskWithId) =>\n          String(item.id).startsWith(NATIVE_FILTER_PREFIX),\n        )\n        .reduce(\n          (prev, next: DataMaskWithId) => ({ ...prev, [next.id]: next }),\n          {},\n        ) as DataMaskStateWithId,\n    [dataMask],\n  );\n};\n\nexport const useFilterUpdates = (\n  dataMaskSelected: DataMaskState,\n  setDataMaskSelected: (arg0: (arg0: DataMaskState) => void) => void,\n) => {\n  const filters = useFilters();\n  const dataMaskApplied = useNativeFiltersDataMask();\n  useEffect(() => {\n    // Remove deleted filters from local state\n    Object.keys(dataMaskSelected).forEach(selectedId => {\n      if (!filters[selectedId]) {\n        setDataMaskSelected(draft => {\n          delete draft[selectedId];\n        });\n      }\n    });\n  }, [dataMaskApplied, dataMaskSelected, filters, setDataMaskSelected]);\n};\n\n// Load filters after charts loaded\nexport const useInitialization = () => {\n  const [isInitialized, setIsInitialized] = useState<boolean>(false);\n  const filters = useFilters();\n  const charts = useSelector<RootState, ChartsState>(state => state.charts);\n\n  // We need to know how much charts now shown on dashboard to know how many of all charts should be loaded\n  let numberOfLoadingCharts = 0;\n  if (!isInitialized) {\n    numberOfLoadingCharts = document.querySelectorAll(\n      '[data-ui-anchor=\"chart\"]',\n    ).length;\n  }\n  useEffect(() => {\n    if (isInitialized) {\n      return;\n    }\n\n    if (Object.values(filters).find(({ requiredFirst }) => requiredFirst)) {\n      setIsInitialized(true);\n      return;\n    }\n\n    // For some dashboards may be there are no charts on first page,\n    // so we check up to 1 sec if there is at least on chart to load\n    let filterTimeout: NodeJS.Timeout;\n    if (numberOfLoadingCharts === 0) {\n      filterTimeout = setTimeout(() => {\n        setIsInitialized(true);\n      }, 1000);\n    }\n\n    // @ts-ignore\n    if (numberOfLoadingCharts > 0 && filterTimeout !== undefined) {\n      clearTimeout(filterTimeout);\n    }\n\n    const numberOfLoadedCharts = Object.values(charts).filter(\n      ({ chartStatus }) => chartStatus !== 'loading',\n    ).length;\n    if (\n      numberOfLoadingCharts > 0 &&\n      numberOfLoadedCharts >= numberOfLoadingCharts\n    ) {\n      setIsInitialized(true);\n    }\n  }, [charts, isInitialized, numberOfLoadingCharts]);\n\n  return isInitialized;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}