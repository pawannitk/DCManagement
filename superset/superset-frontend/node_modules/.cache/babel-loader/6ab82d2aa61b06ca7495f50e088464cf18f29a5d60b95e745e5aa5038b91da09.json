{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef, useEffect, useMemo, forwardRef, useImperativeHandle, useLayoutEffect, useCallback } from 'react';\nimport { styled } from '@superset-ui/core';\nimport { init } from 'echarts';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst Styles = styled.div`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\nfunction Echart({ width, height, echartOptions, eventHandlers, zrEventHandlers, selectedValues = {}, refs }, ref) {\n  const divRef = useRef(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef();\n  const currentSelection = useMemo(() => Object.keys(selectedValues) || [], [selectedValues]);\n  const previousSelection = useRef([]);\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current\n  }));\n  useEffect(() => {\n    if (!divRef.current)\n    return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {var _chartRef$current, _chartRef$current2;\n      (_chartRef$current = chartRef.current) == null ? void 0 : _chartRef$current.off(name);\n      (_chartRef$current2 = chartRef.current) == null ? void 0 : _chartRef$current2.on(name, handler);\n    });\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {var _chartRef$current3, _chartRef$current4;\n      (_chartRef$current3 = chartRef.current) == null ? void 0 : _chartRef$current3.getZr().off(name);\n      (_chartRef$current4 = chartRef.current) == null ? void 0 : _chartRef$current4.getZr().on(name, handler);\n    });\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current)\n    return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter((value) => !currentSelection.includes(value))\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n  const handleSizeChange = useCallback(({ width, height }) => {\n    if (chartRef.current) {\n      chartRef.current.resize({ width, height });\n    }\n  }, []);\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => {var _chartRef$current5;return (_chartRef$current5 = chartRef.current) == null ? void 0 : _chartRef$current5.dispose();};\n  }, []);\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n  return ___EmotionJSX(Styles, { ref: divRef, height: height, width: width });\n}__signature__(Echart, \"useRef{divRef}\\nuseRef{chartRef}\\nuseMemo{currentSelection}\\nuseRef{previousSelection}\\nuseImperativeHandle{}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{handleSizeChange}\\nuseEffect{}\\nuseLayoutEffect{}\", () => [useImperativeHandle]);const _default = /*#__PURE__*/\nforwardRef(Echart);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(Styles, \"Styles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx\");reactHotLoader.register(Echart, \"Echart\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useRef","useEffect","useMemo","forwardRef","useImperativeHandle","useLayoutEffect","useCallback","styled","init","jsx","___EmotionJSX","Styles","div","height","width","Echart","echartOptions","eventHandlers","zrEventHandlers","selectedValues","refs","ref","divRef","chartRef","currentSelection","Object","keys","previousSelection","getEchartInstance","current","entries","forEach","name","handler","_chartRef$current","_chartRef$current2","off","on","_chartRef$current3","_chartRef$current4","getZr","setOption","dispatchAction","type","dataIndex","filter","value","includes","length","handleSizeChange","resize","_chartRef$current5","dispose","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}