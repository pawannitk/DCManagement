{"ast":null,"code":"import _pick from \"lodash/pick\";import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, styled, getExtensionsRegistry } from '@superset-ui/core';\nimport React, { useEffect, useRef, useState, useReducer, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { setItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport Tabs from 'src/components/Tabs';\nimport { AntdSelect, Upload } from 'src/components';\nimport Alert from 'src/components/Alert';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport IconButton from 'src/components/IconButton';\nimport InfoTooltip from 'src/components/InfoTooltip';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ValidatedInput from 'src/components/Form/LabeledErrorBoundInput';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport ErrorAlert from 'src/components/ImportModal/ErrorAlert';\nimport { testDatabaseConnection, useSingleViewResource, useAvailableDatabases, useDatabaseValidation, getDatabaseImages, getConnectionAlert, useImportResource } from 'src/views/CRUD/hooks';\nimport { useCommonConf } from 'src/features/databases/state';\nimport Loading from 'src/components/Loading';\n\nimport { ConfigurationMethod, Engines } from '../types';\nimport ExtraOptions from './ExtraOptions';\nimport SqlAlchemyForm from './SqlAlchemyForm';\nimport DatabaseConnectionForm from './DatabaseConnectionForm';\nimport { antDAlertStyles, antdWarningAlertStyles, StyledAlertMargin, antDModalNoPaddingStyles, antDModalStyles, antDTabsStyles, buttonLinkStyles, importDbButtonLinkStyles, alchemyButtonLinkStyles, TabHeader, formHelperStyles, formStyles, StyledAlignment, SelectDatabaseStyles, infoTooltip, StyledFooterButton, StyledStickyHeader, formScrollableStyles, StyledUploadWrapper } from './styles';\nimport ModalHeader, { DOCUMENTATION_LINK } from './ModalHeader';\nimport SSHTunnelForm from './SSHTunnelForm';\nimport SSHTunnelSwitch from './SSHTunnelSwitch';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst extensionsRegistry = getExtensionsRegistry();\nconst DEFAULT_EXTRA = JSON.stringify({ allows_virtual_table_explore: true });\nconst engineSpecificAlertMapping = {\n  [Engines.GSheet]: {\n    message: 'Why do I need to create a database?',\n    description: 'To begin using your Google Sheets, you need to create a database first. ' +\n    'Databases are used as a way to identify ' +\n    'your data so that it can be queried and visualized. This ' +\n    'database will hold all of your individual Google Sheets ' +\n    'you choose to connect here.'\n  }\n};\nconst TabsStyled = styled(Tabs)`\n  .ant-tabs-content {\n    display: flex;\n    width: 100%;\n    overflow: inherit;\n\n    & > .ant-tabs-tabpane {\n      position: relative;\n    }\n  }\n`;\nconst ErrorAlertContainer = styled.div`\n  ${({ theme }) => `\n    margin: ${theme.gridUnit * 8}px ${theme.gridUnit * 4}px;\n  `};\n`;\nconst SSHTunnelContainer = styled.div`\n  ${({ theme }) => `\n    padding: 0px ${theme.gridUnit * 4}px;\n  `};\n`;\nexport var ActionType;\n(function (ActionType) {\n  ActionType[ActionType[\"AddTableCatalogSheet\"] = 0] = \"AddTableCatalogSheet\";\n  ActionType[ActionType[\"ConfigMethodChange\"] = 1] = \"ConfigMethodChange\";\n  ActionType[ActionType[\"DbSelected\"] = 2] = \"DbSelected\";\n  ActionType[ActionType[\"EditorChange\"] = 3] = \"EditorChange\";\n  ActionType[ActionType[\"ExtraEditorChange\"] = 4] = \"ExtraEditorChange\";\n  ActionType[ActionType[\"ExtraInputChange\"] = 5] = \"ExtraInputChange\";\n  ActionType[ActionType[\"Fetched\"] = 6] = \"Fetched\";\n  ActionType[ActionType[\"InputChange\"] = 7] = \"InputChange\";\n  ActionType[ActionType[\"ParametersChange\"] = 8] = \"ParametersChange\";\n  ActionType[ActionType[\"QueryChange\"] = 9] = \"QueryChange\";\n  ActionType[ActionType[\"RemoveTableCatalogSheet\"] = 10] = \"RemoveTableCatalogSheet\";\n  ActionType[ActionType[\"Reset\"] = 11] = \"Reset\";\n  ActionType[ActionType[\"TextChange\"] = 12] = \"TextChange\";\n  ActionType[ActionType[\"ParametersSSHTunnelChange\"] = 13] = \"ParametersSSHTunnelChange\";\n  ActionType[ActionType[\"SetSSHTunnelLoginMethod\"] = 14] = \"SetSSHTunnelLoginMethod\";\n  ActionType[ActionType[\"RemoveSSHTunnelConfig\"] = 15] = \"RemoveSSHTunnelConfig\";\n})(ActionType || (ActionType = {}));\nexport var AuthType;\n(function (AuthType) {\n  AuthType[AuthType[\"Password\"] = 0] = \"Password\";\n  AuthType[AuthType[\"PrivateKey\"] = 1] = \"PrivateKey\";\n})(AuthType || (AuthType = {}));\nconst StyledBtns = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  margin-left: ${({ theme }) => theme.gridUnit * 3}px;\n`;\nexport function dbReducer(state, action) {var _action$payload$type, _trimmedState$catalog, _action$payload, _action$payload$param;\n  const trimmedState = {\n    ...(state || {})\n  };\n  let query = {};\n  let query_input = '';\n  let parametersCatalog;\n  let actionPayloadJson;\n  const extraJson = JSON.parse(trimmedState.extra || '{}');\n  switch (action.type) {\n    case ActionType.ExtraEditorChange:\n      // \"extra\" payload in state is a string\n      try {\n        // we don't want to stringify encoded strings twice\n        actionPayloadJson = JSON.parse(action.payload.json || '{}');\n      }\n      catch (e) {\n        actionPayloadJson = action.payload.json;\n      }\n      return {\n        ...trimmedState,\n        extra: JSON.stringify({\n          ...extraJson,\n          [action.payload.name]: actionPayloadJson\n        })\n      };\n    case ActionType.ExtraInputChange:\n      // \"extra\" payload in state is a string\n      if (action.payload.name === 'schema_cache_timeout' ||\n      action.payload.name === 'table_cache_timeout') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            metadata_cache_timeout: {\n              ...(extraJson == null ? void 0 : extraJson.metadata_cache_timeout),\n              [action.payload.name]: action.payload.value\n            }\n          })\n        };\n      }\n      if (action.payload.name === 'schemas_allowed_for_file_upload') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            schemas_allowed_for_file_upload: (action.payload.value || '').\n            split(',').\n            filter((schema) => schema !== '')\n          })\n        };\n      }\n      if (action.payload.name === 'http_path') {var _action$payload$value;\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            engine_params: {\n              connect_args: {\n                [action.payload.name]: (_action$payload$value = action.payload.value) == null ? void 0 : _action$payload$value.trim()\n              }\n            }\n          })\n        };\n      }\n      if (action.payload.name === 'expand_rows') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            schema_options: {\n              ...(extraJson == null ? void 0 : extraJson.schema_options),\n              [action.payload.name]: !!action.payload.value\n            }\n          })\n        };\n      }\n      return {\n        ...trimmedState,\n        extra: JSON.stringify({\n          ...extraJson,\n          [action.payload.name]: action.payload.type === 'checkbox' ?\n          action.payload.checked :\n          action.payload.value\n        })\n      };\n    case ActionType.InputChange:\n      if (action.payload.type === 'checkbox') {\n        return {\n          ...trimmedState,\n          [action.payload.name]: action.payload.checked\n        };\n      }\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.value\n      };\n    case ActionType.ParametersChange:\n      // catalog params will always have a catalog state for\n      // dbs that use a catalog, i.e., gsheets, even if the\n      // fields are empty strings\n      if ((_action$payload$type = action.payload.type) != null && _action$payload$type.startsWith('catalog') &&\n      trimmedState.catalog !== undefined) {var _action$payload$type2;\n        // Formatting wrapping google sheets table catalog\n        const catalogCopy = [...trimmedState.catalog];\n        const idx = (_action$payload$type2 = action.payload.type) == null ? void 0 : _action$payload$type2.split('-')[1];\n        const catalogToUpdate = catalogCopy[idx] || {};\n        catalogToUpdate[action.payload.name] = action.payload.value;\n        // insert updated catalog to existing state\n        catalogCopy.splice(parseInt(idx, 10), 1, catalogToUpdate);\n        // format catalog for state\n        // eslint-disable-next-line array-callback-return\n        parametersCatalog = catalogCopy.reduce((obj, item) => {\n          const catalog = { ...obj };\n          catalog[item.name] = item.value;\n          return catalog;\n        }, {});\n        return {\n          ...trimmedState,\n          catalog: catalogCopy,\n          parameters: {\n            ...trimmedState.parameters,\n            catalog: parametersCatalog\n          }\n        };\n      }\n      return {\n        ...trimmedState,\n        parameters: {\n          ...trimmedState.parameters,\n          [action.payload.name]: action.payload.value\n        }\n      };\n    case ActionType.ParametersSSHTunnelChange:\n      return {\n        ...trimmedState,\n        ssh_tunnel: {\n          ...trimmedState.ssh_tunnel,\n          [action.payload.name]: action.payload.value\n        }\n      };\n    case ActionType.SetSSHTunnelLoginMethod:{\n        let ssh_tunnel = {};\n        if (trimmedState != null && trimmedState.ssh_tunnel) {\n          // remove any attributes that are considered sensitive\n          ssh_tunnel = _pick(trimmedState.ssh_tunnel, [\n          'id',\n          'server_address',\n          'server_port',\n          'username']\n          );\n        }\n        if (action.payload.login_method === AuthType.PrivateKey) {var _trimmedState$ssh_tun, _trimmedState$ssh_tun2;\n          return {\n            ...trimmedState,\n            ssh_tunnel: {\n              private_key: trimmedState == null ? void 0 : (_trimmedState$ssh_tun = trimmedState.ssh_tunnel) == null ? void 0 : _trimmedState$ssh_tun.private_key,\n              private_key_password: trimmedState == null ? void 0 : (_trimmedState$ssh_tun2 = trimmedState.ssh_tunnel) == null ? void 0 : _trimmedState$ssh_tun2.private_key_password,\n              ...ssh_tunnel\n            }\n          };\n        }\n        if (action.payload.login_method === AuthType.Password) {var _trimmedState$ssh_tun3;\n          return {\n            ...trimmedState,\n            ssh_tunnel: {\n              password: trimmedState == null ? void 0 : (_trimmedState$ssh_tun3 = trimmedState.ssh_tunnel) == null ? void 0 : _trimmedState$ssh_tun3.password,\n              ...ssh_tunnel\n            }\n          };\n        }\n        return {\n          ...trimmedState\n        };\n      }\n    case ActionType.RemoveSSHTunnelConfig:\n      return {\n        ...trimmedState,\n        ssh_tunnel: undefined\n      };\n    case ActionType.AddTableCatalogSheet:\n      if (trimmedState.catalog !== undefined) {\n        return {\n          ...trimmedState,\n          catalog: [...trimmedState.catalog, { name: '', value: '' }]\n        };\n      }\n      return {\n        ...trimmedState,\n        catalog: [{ name: '', value: '' }]\n      };\n    case ActionType.RemoveTableCatalogSheet:\n      (_trimmedState$catalog = trimmedState.catalog) == null ? void 0 : _trimmedState$catalog.splice(action.payload.indexToDelete, 1);\n      return {\n        ...trimmedState\n      };\n    case ActionType.EditorChange:\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.json\n      };\n    case ActionType.QueryChange:\n      return {\n        ...trimmedState,\n        parameters: {\n          ...trimmedState.parameters,\n          query: Object.fromEntries(new URLSearchParams(action.payload.value))\n        },\n        query_input: action.payload.value\n      };\n    case ActionType.TextChange:\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.value\n      };\n    case ActionType.Fetched:\n      // convert query to a string and store in query_input\n      query = ((_action$payload = action.payload) == null ? void 0 : (_action$payload$param = _action$payload.parameters) == null ? void 0 : _action$payload$param.query) || {};\n      query_input = Object.entries(query).\n      map(([key, value]) => `${key}=${value}`).\n      join('&');\n      if (action.payload.masked_encrypted_extra &&\n      action.payload.configuration_method === ConfigurationMethod.DynamicForm) {var _extraJsonPayload$eng;\n        // \"extra\" payload from the api is a string\n        const extraJsonPayload = {\n          ...JSON.parse(action.payload.extra || '{}')\n        };\n        const payloadCatalog = (_extraJsonPayload$eng = extraJsonPayload.engine_params) == null ? void 0 : _extraJsonPayload$eng.catalog;\n        const engineRootCatalog = Object.entries(payloadCatalog || {}).map(([name, value]) => ({ name, value }));\n        return {\n          ...action.payload,\n          engine: action.payload.backend || trimmedState.engine,\n          configuration_method: action.payload.configuration_method,\n          catalog: engineRootCatalog,\n          parameters: {\n            ...(action.payload.parameters || trimmedState.parameters),\n            catalog: payloadCatalog\n          },\n          query_input\n        };\n      }\n      return {\n        ...action.payload,\n        masked_encrypted_extra: action.payload.masked_encrypted_extra || '',\n        engine: action.payload.backend || trimmedState.engine,\n        configuration_method: action.payload.configuration_method,\n        parameters: action.payload.parameters || trimmedState.parameters,\n        ssh_tunnel: action.payload.ssh_tunnel || trimmedState.ssh_tunnel,\n        query_input\n      };\n    case ActionType.DbSelected:\n      // set initial state for blank form\n      return {\n        ...action.payload,\n        extra: DEFAULT_EXTRA,\n        expose_in_sqllab: true\n      };\n    case ActionType.ConfigMethodChange:\n      return {\n        ...action.payload\n      };\n    case ActionType.Reset:\n    default:\n      return null;\n  }\n}\nconst DEFAULT_TAB_KEY = '1';\nconst DatabaseModal = ({ addDangerToast, addSuccessToast, onDatabaseAdd, onHide, show, databaseId, dbEngine }) => {var _extensionsRegistry$g, _availableDbs$databas3, _availableDbs$databas4, _db$parameters2;\n  const [db, setDB] = useReducer(dbReducer, null);\n  // Database fetch logic\n  const { state: { loading: dbLoading, resource: dbFetched, error: dbErrors }, fetchResource, createResource, updateResource, clearError } = useSingleViewResource('database', t('database'), addDangerToast, 'connection');\n  const [tabKey, setTabKey] = useState(DEFAULT_TAB_KEY);\n  const [availableDbs, getAvailableDbs] = useAvailableDatabases();\n  const [validationErrors, getValidation, setValidationErrors] = useDatabaseValidation();\n  const [hasConnectedDb, setHasConnectedDb] = useState(false);\n  const [showCTAbtns, setShowCTAbtns] = useState(false);\n  const [dbName, setDbName] = useState('');\n  const [editNewDb, setEditNewDb] = useState(false);\n  const [isLoading, setLoading] = useState(false);\n  const [testInProgress, setTestInProgress] = useState(false);\n  const [passwords, setPasswords] = useState({});\n  const [sshTunnelPasswords, setSSHTunnelPasswords] = useState({});\n  const [sshTunnelPrivateKeys, setSSHTunnelPrivateKeys] = useState({});\n  const [sshTunnelPrivateKeyPasswords, setSSHTunnelPrivateKeyPasswords] = useState({});\n  const [confirmedOverwrite, setConfirmedOverwrite] = useState(false);\n  const [fileList, setFileList] = useState([]);\n  const [importingModal, setImportingModal] = useState(false);\n  const [importingErrorMessage, setImportingErrorMessage] = useState();\n  const [passwordFields, setPasswordFields] = useState([]);\n  const [sshTunnelPasswordFields, setSSHTunnelPasswordFields] = useState([]);\n  const [sshTunnelPrivateKeyFields, setSSHTunnelPrivateKeyFields] = useState([]);\n  const [sshTunnelPrivateKeyPasswordFields, setSSHTunnelPrivateKeyPasswordFields] = useState([]);\n  const [extraExtensionComponentState, setExtraExtensionComponentState] = useState({});\n  const SSHTunnelSwitchComponent = (_extensionsRegistry$g = extensionsRegistry.get('ssh_tunnel.form.switch')) != null ? _extensionsRegistry$g : SSHTunnelSwitch;\n  const [useSSHTunneling, setUseSSHTunneling] = useState(undefined);\n  let dbConfigExtraExtension = extensionsRegistry.get('databaseconnection.extraOption');\n  if (dbConfigExtraExtension) {\n    // add method for db modal to store data\n    dbConfigExtraExtension = {\n      ...dbConfigExtraExtension,\n      onEdit: (componentState) => {\n        setExtraExtensionComponentState({\n          ...extraExtensionComponentState,\n          ...componentState\n        });\n      }\n    };\n  }\n  const conf = useCommonConf();\n  const dbImages = getDatabaseImages();\n  const connectionAlert = getConnectionAlert();\n  const isEditMode = !!databaseId;\n  const hasAlert = connectionAlert || !!(db != null && db.engine && engineSpecificAlertMapping[db.engine]);\n  const useSqlAlchemyForm = (db == null ? void 0 : db.configuration_method) === ConfigurationMethod.SqlalchemyUri;\n  const useTabLayout = isEditMode || useSqlAlchemyForm;\n  const isDynamic = (engine) => {var _availableDbs$databas, _availableDbs$databas2;return (availableDbs == null ? void 0 : (_availableDbs$databas = availableDbs.databases) == null ? void 0 : (_availableDbs$databas2 = _availableDbs$databas.find((DB) => DB.backend === engine || DB.engine === engine)) == null ? void 0 : _availableDbs$databas2.parameters) !== undefined;};\n  const showDBError = validationErrors || dbErrors;\n  const history = useHistory();\n  const dbModel =\n  // TODO: we need a centralized engine in one place\n  // first try to match both engine and driver\n  (availableDbs == null ? void 0 : (_availableDbs$databas3 = availableDbs.databases) == null ? void 0 : _availableDbs$databas3.find((available) => available.engine === (isEditMode ? db == null ? void 0 : db.backend : db == null ? void 0 : db.engine) &&\n  available.default_driver === (db == null ? void 0 : db.driver))) || (\n  // alternatively try to match only engine\n  availableDbs == null ? void 0 : (_availableDbs$databas4 = availableDbs.databases) == null ? void 0 : _availableDbs$databas4.find((available) => available.engine === (isEditMode ? db == null ? void 0 : db.backend : db == null ? void 0 : db.engine))) ||\n  {};\n  // Test Connection logic\n  const testConnection = () => {var _db$database_name;\n    if (!(db != null && db.sqlalchemy_uri)) {\n      addDangerToast(t('Please enter a SQLAlchemy URI to test'));\n      return;\n    }\n    const connection = {\n      sqlalchemy_uri: (db == null ? void 0 : db.sqlalchemy_uri) || '',\n      database_name: (db == null ? void 0 : (_db$database_name = db.database_name) == null ? void 0 : _db$database_name.trim()) || undefined,\n      impersonate_user: (db == null ? void 0 : db.impersonate_user) || undefined,\n      extra: db == null ? void 0 : db.extra,\n      masked_encrypted_extra: (db == null ? void 0 : db.masked_encrypted_extra) || '',\n      server_cert: (db == null ? void 0 : db.server_cert) || undefined,\n      ssh_tunnel: !_isEmpty(db == null ? void 0 : db.ssh_tunnel) && useSSHTunneling ?\n      {\n        ...db.ssh_tunnel,\n        server_port: Number(db.ssh_tunnel.server_port)\n      } :\n      undefined\n    };\n    setTestInProgress(true);\n    testDatabaseConnection(connection, (errorMsg) => {\n      setTestInProgress(false);\n      addDangerToast(errorMsg);\n    }, (errorMsg) => {\n      setTestInProgress(false);\n      addSuccessToast(errorMsg);\n    });\n  };\n  const getPlaceholder = (field) => {\n    if (field === 'database') {\n      return t('e.g. world_population');\n    }\n    return undefined;\n  };\n  const removeFile = (removedFile) => {\n    setFileList(fileList.filter((file) => file.uid !== removedFile.uid));\n    return false;\n  };\n  const onChange = useCallback((type, payload) => {\n    setDB({ type, payload });\n  }, []);\n  const handleClearValidationErrors = useCallback(() => {\n    setValidationErrors(null);\n  }, [setValidationErrors]);\n  const handleParametersChange = useCallback(({ target }) => {\n    onChange(ActionType.ParametersChange, {\n      type: target.type,\n      name: target.name,\n      checked: target.checked,\n      value: target.value\n    });\n  }, [onChange]);\n  const onClose = () => {\n    setDB({ type: ActionType.Reset });\n    setHasConnectedDb(false);\n    handleClearValidationErrors(); // reset validation errors on close\n    clearError();\n    setEditNewDb(false);\n    setFileList([]);\n    setImportingModal(false);\n    setImportingErrorMessage('');\n    setPasswordFields([]);\n    setSSHTunnelPasswordFields([]);\n    setSSHTunnelPrivateKeyFields([]);\n    setSSHTunnelPrivateKeyPasswordFields([]);\n    setPasswords({});\n    setSSHTunnelPasswords({});\n    setSSHTunnelPrivateKeys({});\n    setSSHTunnelPrivateKeyPasswords({});\n    setConfirmedOverwrite(false);\n    setUseSSHTunneling(undefined);\n    onHide();\n  };\n  const redirectURL = (url) => {\n    history.push(url);\n  };\n  // Database import logic\n  const { state: { alreadyExists, passwordsNeeded, sshPasswordNeeded, sshPrivateKeyNeeded, sshPrivateKeyPasswordNeeded, loading: importLoading, failed: importErrored }, importResource } = useImportResource('database', t('database'), (msg) => {\n    setImportingErrorMessage(msg);\n  });\n  const onSave = async () => {var _dbConfigExtraExtensi, _dbToUpdate$parameter7;\n    let dbConfigExtraExtensionOnSaveError;\n    setLoading(true);\n    (_dbConfigExtraExtensi = dbConfigExtraExtension) == null ? void 0 : _dbConfigExtraExtensi.\n    onSave(extraExtensionComponentState, db).\n    then(({ error }) => {\n      if (error) {\n        dbConfigExtraExtensionOnSaveError = error;\n        addDangerToast(error);\n      }\n    });\n    if (dbConfigExtraExtensionOnSaveError) {\n      setLoading(false);\n      return;\n    }\n    // Clone DB object\n    const dbToUpdate = { ...(db || {}) };\n    if (dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm) {var _dbToUpdate$parameter, _dbToUpdate$parameter2;\n      // Validate DB before saving\n      if (dbToUpdate != null && (_dbToUpdate$parameter = dbToUpdate.parameters) != null && _dbToUpdate$parameter.catalog) {\n        // need to stringify gsheets catalog to allow it to be serialized\n        dbToUpdate.extra = JSON.stringify({\n          ...JSON.parse(dbToUpdate.extra || '{}'),\n          engine_params: {\n            catalog: dbToUpdate.parameters.catalog\n          }\n        });\n      }\n      const errors = await getValidation(dbToUpdate, true);\n      if (!_isEmpty(validationErrors) || errors != null && errors.length) {\n        addDangerToast(t('Connection failed, please check your connection settings.'));\n        setLoading(false);\n        return;\n      }\n      const parameters_schema = isEditMode ? (_dbToUpdate$parameter2 =\n      dbToUpdate.parameters_schema) == null ? void 0 : _dbToUpdate$parameter2.properties :\n      dbModel == null ? void 0 : dbModel.parameters.properties;\n      const additionalEncryptedExtra = JSON.parse(dbToUpdate.masked_encrypted_extra || '{}');\n      const paramConfigArray = Object.keys(parameters_schema || {});\n      paramConfigArray.forEach((paramConfig) => {var _dbToUpdate$parameter3;\n        /*\n         * Parameters that are annotated with the `x-encrypted-extra` properties should be\n         * moved to `masked_encrypted_extra`, so that they are stored encrypted in the\n         * backend when the database is created or edited.\n         */\n        if (parameters_schema[paramConfig]['x-encrypted-extra'] && (_dbToUpdate$parameter3 =\n        dbToUpdate.parameters) != null && _dbToUpdate$parameter3[paramConfig]) {var _dbToUpdate$parameter4;\n          if (typeof ((_dbToUpdate$parameter4 = dbToUpdate.parameters) == null ? void 0 : _dbToUpdate$parameter4[paramConfig]) === 'object') {var _dbToUpdate$parameter5;\n            // add new encrypted extra to masked_encrypted_extra object\n            additionalEncryptedExtra[paramConfig] = (_dbToUpdate$parameter5 =\n            dbToUpdate.parameters) == null ? void 0 : _dbToUpdate$parameter5[paramConfig];\n            // The backend expects `masked_encrypted_extra` as a string for historical\n            // reasons.\n            dbToUpdate.parameters[paramConfig] = JSON.stringify(dbToUpdate.parameters[paramConfig]);\n          } else\n          {var _dbToUpdate$parameter6;\n            additionalEncryptedExtra[paramConfig] = JSON.parse(((_dbToUpdate$parameter6 = dbToUpdate.parameters) == null ? void 0 : _dbToUpdate$parameter6[paramConfig]) || '{}');\n          }\n        }\n      });\n      // cast the new encrypted extra object into a string\n      dbToUpdate.masked_encrypted_extra = JSON.stringify(additionalEncryptedExtra);\n      // this needs to be added by default to gsheets\n      if (dbToUpdate.engine === Engines.GSheet) {\n        dbToUpdate.impersonate_user = true;\n      }\n    }\n    if (dbToUpdate != null && (_dbToUpdate$parameter7 = dbToUpdate.parameters) != null && _dbToUpdate$parameter7.catalog) {\n      // need to stringify gsheets catalog to allow it to be serialized\n      dbToUpdate.extra = JSON.stringify({\n        ...JSON.parse(dbToUpdate.extra || '{}'),\n        engine_params: {\n          catalog: dbToUpdate.parameters.catalog\n        }\n      });\n    }\n    // strictly checking for false as an indication that the toggle got unchecked\n    if (useSSHTunneling === false) {\n      // remove ssh tunnel\n      dbToUpdate.ssh_tunnel = null;\n    }\n    if (db != null && db.id) {\n      const result = await updateResource(db.id, dbToUpdate, dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm);\n      if (result) {var _dbConfigExtraExtensi2;\n        if (onDatabaseAdd)\n        onDatabaseAdd();\n        (_dbConfigExtraExtensi2 = dbConfigExtraExtension) == null ? void 0 : _dbConfigExtraExtensi2.\n        onSave(extraExtensionComponentState, db).\n        then(({ error }) => {\n          if (error) {\n            dbConfigExtraExtensionOnSaveError = error;\n            addDangerToast(error);\n          }\n        });\n        if (dbConfigExtraExtensionOnSaveError) {\n          setLoading(false);\n          return;\n        }\n        if (!editNewDb) {\n          onClose();\n          addSuccessToast(t('Database settings updated'));\n        }\n      }\n    } else\n    if (db) {\n      // Create\n      const dbId = await createResource(dbToUpdate, dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm);\n      if (dbId) {var _dbConfigExtraExtensi3;\n        setHasConnectedDb(true);\n        if (onDatabaseAdd)\n        onDatabaseAdd();\n        (_dbConfigExtraExtensi3 = dbConfigExtraExtension) == null ? void 0 : _dbConfigExtraExtensi3.\n        onSave(extraExtensionComponentState, db).\n        then(({ error }) => {\n          if (error) {\n            dbConfigExtraExtensionOnSaveError = error;\n            addDangerToast(error);\n          }\n        });\n        if (dbConfigExtraExtensionOnSaveError) {\n          setLoading(false);\n          return;\n        }\n        if (useTabLayout) {\n          // tab layout only has one step\n          // so it should close immediately on save\n          onClose();\n          addSuccessToast(t('Database connected'));\n        }\n      }\n    } else\n    {\n      // Import - doesn't use db state\n      setImportingModal(true);\n      if (!(fileList[0].originFileObj instanceof File)) {\n        return;\n      }\n      const dbId = await importResource(fileList[0].originFileObj, passwords, sshTunnelPasswords, sshTunnelPrivateKeys, sshTunnelPrivateKeyPasswords, confirmedOverwrite);\n      if (dbId) {\n        if (onDatabaseAdd)\n        onDatabaseAdd();\n        onClose();\n        addSuccessToast(t('Database connected'));\n      }\n    }\n    setShowCTAbtns(true);\n    setEditNewDb(false);\n    setLoading(false);\n  };\n  // Initialize\n  const fetchDB = () => {\n    if (isEditMode && databaseId) {\n      if (!dbLoading) {\n        fetchResource(databaseId).catch((e) => addDangerToast(t('Sorry there was an error fetching database information: %s', e.message)));\n      }\n    }\n  };\n  const setDatabaseModel = (database_name) => {\n    if (database_name === 'Other') {\n      // Allow users to connect to DB via legacy SQLA form\n      setDB({\n        type: ActionType.DbSelected,\n        payload: {\n          database_name,\n          configuration_method: ConfigurationMethod.SqlalchemyUri,\n          engine: undefined,\n          engine_information: {\n            supports_file_upload: true\n          }\n        }\n      });\n    } else\n    {\n      const selectedDbModel = availableDbs == null ? void 0 : availableDbs.databases.filter((db) => db.name === database_name)[0];\n      const { engine, parameters, engine_information, default_driver, sqlalchemy_uri_placeholder } = selectedDbModel;\n      const isDynamic = parameters !== undefined;\n      setDB({\n        type: ActionType.DbSelected,\n        payload: {\n          database_name,\n          engine,\n          configuration_method: isDynamic ?\n          ConfigurationMethod.DynamicForm :\n          ConfigurationMethod.SqlalchemyUri,\n          engine_information,\n          driver: default_driver,\n          sqlalchemy_uri_placeholder\n        }\n      });\n      if (engine === Engines.GSheet) {\n        // only create a catalog if the DB is Google Sheets\n        setDB({ type: ActionType.AddTableCatalogSheet });\n      }\n    }\n  };\n  const renderAvailableSelector = () => {var _ref, _connectionAlert$ADD_;return ___EmotionJSX(\"div\", { className: \"available\" },\n    ___EmotionJSX(\"h4\", { className: \"available-label\" },\n    t('Or choose from a list of other databases we support:')\n    ),\n    ___EmotionJSX(\"div\", { className: \"control-label\" }, t('Supported databases')),\n    ___EmotionJSX(AntdSelect, { className: \"available-select\", onChange: setDatabaseModel, placeholder: t('Choose a database...'), showSearch: true }, (_ref =\n    [...((availableDbs == null ? void 0 : availableDbs.databases) || [])]) == null ? void 0 : _ref.\n    sort((a, b) => a.name.localeCompare(b.name)).\n    map((database, index) => ___EmotionJSX(AntdSelect.Option, { value: database.name, key: `database-${index}` },\n    database.name\n    )),\n\n    ___EmotionJSX(AntdSelect.Option, { value: \"Other\", key: \"Other\" },\n    t('Other')\n    )\n    ),\n    ___EmotionJSX(Alert, { showIcon: true, closable: false, css: (theme) => antDAlertStyles(theme), type: \"info\", message: (connectionAlert == null ? void 0 : (_connectionAlert$ADD_ = connectionAlert.ADD_DATABASE) == null ? void 0 : _connectionAlert$ADD_.message) ||\n      t('Want to add a new database?'), description: connectionAlert != null && connectionAlert.ADD_DATABASE ? ___EmotionJSX(React.Fragment, null,\n      t('Any databases that allow connections via SQL Alchemy URIs can be added. '),\n      ___EmotionJSX(\"a\", { href: connectionAlert == null ? void 0 : connectionAlert.ADD_DATABASE.contact_link, target: \"_blank\", rel: \"noopener noreferrer\" },\n      connectionAlert == null ? void 0 : connectionAlert.ADD_DATABASE.contact_description_link\n      ), ' ',\n      connectionAlert == null ? void 0 : connectionAlert.ADD_DATABASE.description\n      ) : ___EmotionJSX(React.Fragment, null,\n      t('Any databases that allow connections via SQL Alchemy URIs can be added. Learn about how to connect a database driver '),\n      ___EmotionJSX(\"a\", { href: DOCUMENTATION_LINK, target: \"_blank\", rel: \"noopener noreferrer\" },\n      t('here')\n      ), \".\"\n\n      ) })\n    );};\n  const renderPreferredSelector = () => {var _availableDbs$databas5;return ___EmotionJSX(\"div\", { className: \"preferred\" },\n    availableDbs == null ? void 0 : (_availableDbs$databas5 = availableDbs.databases) == null ? void 0 : _availableDbs$databas5.\n    filter((db) => db.preferred).\n    map((database) => ___EmotionJSX(IconButton, { className: \"preferred-item\", onClick: () => setDatabaseModel(database.name), buttonText: database.name, icon: dbImages == null ? void 0 : dbImages[database.engine], key: `${database.name}` }))\n    );};\n  const handleBackButtonOnFinish = () => {\n    if (dbFetched) {\n      fetchResource(dbFetched.id);\n    }\n    setShowCTAbtns(false);\n    setEditNewDb(true);\n  };\n  const handleBackButtonOnConnect = () => {\n    if (editNewDb)\n    setHasConnectedDb(false);\n    if (importingModal)\n    setImportingModal(false);\n    if (importErrored) {\n      setImportingModal(false);\n      setImportingErrorMessage('');\n      setPasswordFields([]);\n      setSSHTunnelPasswordFields([]);\n      setSSHTunnelPrivateKeyFields([]);\n      setSSHTunnelPrivateKeyPasswordFields([]);\n      setPasswords({});\n      setSSHTunnelPasswords({});\n      setSSHTunnelPrivateKeys({});\n      setSSHTunnelPrivateKeyPasswords({});\n    }\n    setDB({ type: ActionType.Reset });\n    setFileList([]);\n  };\n  const handleDisableOnImport = () => {\n    if (importLoading ||\n    alreadyExists.length && !confirmedOverwrite ||\n    passwordsNeeded.length && JSON.stringify(passwords) === '{}' ||\n    sshPasswordNeeded.length &&\n    JSON.stringify(sshTunnelPasswords) === '{}' ||\n    sshPrivateKeyNeeded.length &&\n    JSON.stringify(sshTunnelPrivateKeys) === '{}' ||\n    sshPrivateKeyPasswordNeeded.length &&\n    JSON.stringify(sshTunnelPrivateKeyPasswords) === '{}')\n    return true;\n    return false;\n  };\n  const renderModalFooter = () => {\n    if (db) {\n      // if db show back + connect\n      if (!hasConnectedDb || editNewDb) {\n        return ___EmotionJSX(React.Fragment, null,\n        ___EmotionJSX(StyledFooterButton, { key: \"back\", onClick: handleBackButtonOnConnect },\n        t('Back')\n        ),\n        ___EmotionJSX(StyledFooterButton, { key: \"submit\", buttonStyle: \"primary\", onClick: onSave, loading: isLoading },\n        t('Connect')\n        )\n        );\n      }\n      return ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(StyledFooterButton, { key: \"back\", onClick: handleBackButtonOnFinish },\n      t('Back')\n      ),\n      ___EmotionJSX(StyledFooterButton, { key: \"submit\", buttonStyle: \"primary\", onClick: onSave, \"data-test\": \"modal-confirm-button\", loading: isLoading },\n      t('Finish')\n      )\n      );\n    }\n    // Import doesn't use db state, so footer will not render in the if statement above\n    if (importingModal) {\n      return ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(StyledFooterButton, { key: \"back\", onClick: handleBackButtonOnConnect },\n      t('Back')\n      ),\n      ___EmotionJSX(StyledFooterButton, { key: \"submit\", buttonStyle: \"primary\", onClick: onSave, disabled: handleDisableOnImport(), loading: isLoading },\n      t('Connect')\n      )\n      );\n    }\n    return ___EmotionJSX(React.Fragment, null);\n  };\n  const renderEditModalFooter = (db) => ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(StyledFooterButton, { key: \"close\", onClick: onClose },\n  t('Close')\n  ),\n  ___EmotionJSX(StyledFooterButton, { key: \"submit\", buttonStyle: \"primary\", onClick: onSave, disabled: db == null ? void 0 : db.is_managed_externally, loading: isLoading, tooltip: db != null && db.is_managed_externally ?\n    t(\"This database is managed externally, and can't be edited in Superset\") :\n    '' },\n  t('Finish')\n  )\n  );\n  const firstUpdate = useRef(true); // Captures first render\n  // Only runs when importing files don't need user input\n  useEffect(() => {\n    // Will not run on first render\n    if (firstUpdate.current) {\n      firstUpdate.current = false;\n      return;\n    }\n    if (!importLoading &&\n    !alreadyExists.length &&\n    !passwordsNeeded.length &&\n    !sshPasswordNeeded.length &&\n    !sshPrivateKeyNeeded.length &&\n    !sshPrivateKeyPasswordNeeded.length &&\n    !isLoading && // This prevents a double toast for non-related imports\n    !importErrored // This prevents a success toast on error\n    ) {\n      onClose();\n      addSuccessToast(t('Database connected'));\n    }\n  }, [\n  alreadyExists,\n  passwordsNeeded,\n  importLoading,\n  importErrored,\n  sshPasswordNeeded,\n  sshPrivateKeyNeeded,\n  sshPrivateKeyPasswordNeeded]\n  );\n  useEffect(() => {\n    if (show) {\n      setTabKey(DEFAULT_TAB_KEY);\n      setLoading(true);\n      getAvailableDbs();\n    }\n    if (databaseId && show) {\n      fetchDB();\n    }\n  }, [show, databaseId]);\n  useEffect(() => {\n    if (dbFetched) {\n      setDB({\n        type: ActionType.Fetched,\n        payload: dbFetched\n      });\n      // keep a copy of the name separate for display purposes\n      // because it shouldn't change when the form is updated\n      setDbName(dbFetched.database_name);\n    }\n  }, [dbFetched]);\n  useEffect(() => {\n    if (isLoading) {\n      setLoading(false);\n    }\n    if (availableDbs && dbEngine) {\n      // set model if passed into props\n      setDatabaseModel(dbEngine);\n    }\n  }, [availableDbs]);\n  // This forces the modal to scroll until the importing filename is in view\n  useEffect(() => {\n    if (importingModal) {\n      document.\n      getElementsByClassName('ant-upload-list-item-name')[0].\n      scrollIntoView();\n    }\n  }, [importingModal]);\n  useEffect(() => {\n    setPasswordFields([...passwordsNeeded]);\n  }, [passwordsNeeded]);\n  useEffect(() => {\n    setSSHTunnelPasswordFields([...sshPasswordNeeded]);\n  }, [sshPasswordNeeded]);\n  useEffect(() => {\n    setSSHTunnelPrivateKeyFields([...sshPrivateKeyNeeded]);\n  }, [sshPrivateKeyNeeded]);\n  useEffect(() => {\n    setSSHTunnelPrivateKeyPasswordFields([...sshPrivateKeyPasswordNeeded]);\n  }, [sshPrivateKeyPasswordNeeded]);\n  useEffect(() => {var _db$parameters;\n    if ((db == null ? void 0 : (_db$parameters = db.parameters) == null ? void 0 : _db$parameters.ssh) !== undefined) {\n      setUseSSHTunneling(db.parameters.ssh);\n    }\n  }, [db == null ? void 0 : (_db$parameters2 = db.parameters) == null ? void 0 : _db$parameters2.ssh]);\n  const onDbImport = async (info) => {\n    setImportingErrorMessage('');\n    setPasswordFields([]);\n    setSSHTunnelPasswordFields([]);\n    setSSHTunnelPrivateKeyFields([]);\n    setSSHTunnelPrivateKeyPasswordFields([]);\n    setPasswords({});\n    setSSHTunnelPasswords({});\n    setSSHTunnelPrivateKeys({});\n    setSSHTunnelPrivateKeyPasswords({});\n    setImportingModal(true);\n    setFileList([\n    {\n      ...info.file,\n      status: 'done'\n    }]\n    );\n    if (!(info.file.originFileObj instanceof File))\n    return;\n    const dbId = await importResource(info.file.originFileObj, passwords, sshTunnelPasswords, sshTunnelPrivateKeys, sshTunnelPrivateKeyPasswords, confirmedOverwrite);\n    if (dbId)\n    onDatabaseAdd == null ? void 0 : onDatabaseAdd();\n  };\n  const passwordNeededField = () => {\n    if (!passwordFields.length &&\n    !sshTunnelPasswordFields.length &&\n    !sshTunnelPrivateKeyFields.length &&\n    !sshTunnelPrivateKeyPasswordFields.length)\n    return null;\n    const files = [\n    ...new Set([\n    ...passwordFields,\n    ...sshTunnelPasswordFields,\n    ...sshTunnelPrivateKeyFields,\n    ...sshTunnelPrivateKeyPasswordFields]\n    )];\n\n    return files.map((database) => ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(StyledAlertMargin, null,\n    ___EmotionJSX(Alert, { closable: false, css: (theme) => antDAlertStyles(theme), type: \"info\", showIcon: true, message: \"Database passwords\", description: t(`The passwords for the databases below are needed in order to import them. Please note that the \"Secure Extra\" and \"Certificate\" sections of the database configuration are not present in explore files and should be added manually after the import if they are needed.`) })\n    ),\n    (passwordFields == null ? void 0 : passwordFields.indexOf(database)) >= 0 && ___EmotionJSX(ValidatedInput, { id: \"password_needed\", name: \"password_needed\", required: true, value: passwords[database], onChange: (event) => setPasswords({ ...passwords, [database]: event.target.value }), validationMethods: { onBlur: () => {} }, errorMessage: validationErrors == null ? void 0 : validationErrors.password_needed, label: t('%s PASSWORD', database.slice(10)), css: formScrollableStyles }),\n    (sshTunnelPasswordFields == null ? void 0 : sshTunnelPasswordFields.indexOf(database)) >= 0 && ___EmotionJSX(ValidatedInput, { id: \"ssh_tunnel_password_needed\", name: \"ssh_tunnel_password_needed\", required: true, value: sshTunnelPasswords[database], onChange: (event) => setSSHTunnelPasswords({\n        ...sshTunnelPasswords,\n        [database]: event.target.value\n      }), validationMethods: { onBlur: () => {} }, errorMessage: validationErrors == null ? void 0 : validationErrors.ssh_tunnel_password_needed, label: t('%s SSH TUNNEL PASSWORD', database.slice(10)), css: formScrollableStyles }),\n    (sshTunnelPrivateKeyFields == null ? void 0 : sshTunnelPrivateKeyFields.indexOf(database)) >= 0 && ___EmotionJSX(ValidatedInput, { id: \"ssh_tunnel_private_key_needed\", name: \"ssh_tunnel_private_key_needed\", required: true, value: sshTunnelPrivateKeys[database], onChange: (event) => setSSHTunnelPrivateKeys({\n        ...sshTunnelPrivateKeys,\n        [database]: event.target.value\n      }), validationMethods: { onBlur: () => {} }, errorMessage: validationErrors == null ? void 0 : validationErrors.ssh_tunnel_private_key_needed, label: t('%s SSH TUNNEL PRIVATE KEY', database.slice(10)), css: formScrollableStyles }),\n    (sshTunnelPrivateKeyPasswordFields == null ? void 0 : sshTunnelPrivateKeyPasswordFields.indexOf(database)) >= 0 && ___EmotionJSX(ValidatedInput, { id: \"ssh_tunnel_private_key_password_needed\", name: \"ssh_tunnel_private_key_password_needed\", required: true, value: sshTunnelPrivateKeyPasswords[database], onChange: (event) => setSSHTunnelPrivateKeyPasswords({\n        ...sshTunnelPrivateKeyPasswords,\n        [database]: event.target.value\n      }), validationMethods: { onBlur: () => {} }, errorMessage: validationErrors == null ? void 0 : validationErrors.ssh_tunnel_private_key_password_needed, label: t('%s SSH TUNNEL PRIVATE KEY PASSWORD', database.slice(10)), css: formScrollableStyles })\n    ));\n  };\n  const importingErrorAlert = () => {\n    if (!importingErrorMessage)\n    return null;\n    return ___EmotionJSX(StyledAlertMargin, null,\n    ___EmotionJSX(ErrorAlert, { errorMessage: importingErrorMessage, showDbInstallInstructions: passwordFields.length > 0 })\n    );\n  };\n  const confirmOverwrite = (event) => {var _event$currentTarget$, _event$currentTarget;\n    const targetValue = (_event$currentTarget$ = (_event$currentTarget = event.currentTarget) == null ? void 0 : _event$currentTarget.value) != null ? _event$currentTarget$ : '';\n    setConfirmedOverwrite(targetValue.toUpperCase() === t('OVERWRITE'));\n  };\n  const confirmOverwriteField = () => {\n    if (!alreadyExists.length)\n    return null;\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(StyledAlertMargin, null,\n    ___EmotionJSX(Alert, { closable: false, css: (theme) => antdWarningAlertStyles(theme), type: \"warning\", showIcon: true, message: \"\", description: t('You are importing one or more databases that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?') })\n    ),\n    ___EmotionJSX(ValidatedInput, { id: \"confirm_overwrite\", name: \"confirm_overwrite\", required: true, validationMethods: { onBlur: () => {} }, errorMessage: validationErrors == null ? void 0 : validationErrors.confirm_overwrite, label: t('Type \"%s\" to confirm', t('OVERWRITE')), onChange: confirmOverwrite, css: formScrollableStyles })\n    );\n  };\n  const tabChange = (key) => setTabKey(key);\n  const renderStepTwoAlert = () => {var _connectionAlert$REGI, _engineSpecificAlertM, _connectionAlert$DEFA, _engineSpecificAlertM2, _connectionAlert$DEFA2;\n    const { hostname } = window.location;\n    let ipAlert = (connectionAlert == null ? void 0 : (_connectionAlert$REGI = connectionAlert.REGIONAL_IPS) == null ? void 0 : _connectionAlert$REGI.default) || '';\n    const regionalIPs = (connectionAlert == null ? void 0 : connectionAlert.REGIONAL_IPS) || {};\n    Object.entries(regionalIPs).forEach(([ipRegion, ipRange]) => {\n      const regex = new RegExp(ipRegion);\n      if (hostname.match(regex))\n      ipAlert = ipRange;\n    });\n    return (db == null ? void 0 : db.engine) && ___EmotionJSX(StyledAlertMargin, null,\n    ___EmotionJSX(Alert, { closable: false, css: (theme) => antDAlertStyles(theme), type: \"info\", showIcon: true, message: ((_engineSpecificAlertM = engineSpecificAlertMapping[db.engine]) == null ? void 0 : _engineSpecificAlertM.message) || (\n      connectionAlert == null ? void 0 : (_connectionAlert$DEFA = connectionAlert.DEFAULT) == null ? void 0 : _connectionAlert$DEFA.message), description: ((_engineSpecificAlertM2 = engineSpecificAlertMapping[db.engine]) == null ? void 0 : _engineSpecificAlertM2.description) ||\n      (connectionAlert == null ? void 0 : (_connectionAlert$DEFA2 = connectionAlert.DEFAULT) == null ? void 0 : _connectionAlert$DEFA2.description) + ipAlert })\n    );\n  };\n  // eslint-disable-next-line consistent-return\n  const errorAlert = () => {\n    let alertErrors = [];\n    if (!_isEmpty(dbErrors)) {\n      alertErrors =\n      typeof dbErrors === 'object' ?\n      Object.values(dbErrors) :\n      typeof dbErrors === 'string' ?\n      [dbErrors] :\n      [];\n    } else\n    if (!_isEmpty(validationErrors) &&\n    (validationErrors == null ? void 0 : validationErrors.error_type) === 'GENERIC_DB_ENGINE_ERROR') {\n      alertErrors = [\n      (validationErrors == null ? void 0 : validationErrors.description) || (validationErrors == null ? void 0 : validationErrors.message)];\n\n    }\n    if (alertErrors.length) {var _alertErrors;\n      return ___EmotionJSX(ErrorAlertContainer, null,\n      ___EmotionJSX(ErrorMessageWithStackTrace, { title: t('Database Creation Error'), description: t('We are unable to connect to your database. Click \"See more\" for database-provided information that may help troubleshoot the issue.'), subtitle: ((_alertErrors = alertErrors) == null ? void 0 : _alertErrors[0]) || (validationErrors == null ? void 0 : validationErrors.description), copyText: validationErrors == null ? void 0 : validationErrors.description })\n      );\n    }\n    return ___EmotionJSX(React.Fragment, null);\n  };\n  const fetchAndSetDB = () => {\n    setLoading(true);\n    fetchResource(dbFetched == null ? void 0 : dbFetched.id).then((r) => {\n      setItem(LocalStorageKeys.Database, r);\n    });\n  };\n  const renderSSHTunnelForm = () => ___EmotionJSX(SSHTunnelForm, { db: db, onSSHTunnelParametersChange: ({ target }) => {\n      onChange(ActionType.ParametersSSHTunnelChange, {\n        type: target.type,\n        name: target.name,\n        value: target.value\n      });\n      handleClearValidationErrors();\n    }, setSSHTunnelLoginMethod: (method) => setDB({\n      type: ActionType.SetSSHTunnelLoginMethod,\n      payload: { login_method: method }\n    }) });\n  const renderCTABtns = () => ___EmotionJSX(StyledBtns, null,\n  ___EmotionJSX(Button, { buttonStyle: \"secondary\", onClick: () => {\n      setLoading(true);\n      fetchAndSetDB();\n      redirectURL('/dataset/add/');\n    } },\n  t('CREATE DATASET')\n  ),\n  ___EmotionJSX(Button, { buttonStyle: \"secondary\", onClick: () => {\n      setLoading(true);\n      fetchAndSetDB();\n      redirectURL(`/sqllab?db=true`);\n    } },\n  t('QUERY DATA IN SQL LAB')\n  )\n  );\n  const renderDatabaseConnectionForm = () => ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(DatabaseConnectionForm, { isEditMode: isEditMode, db: db, sslForced: false, dbModel: dbModel, onAddTableCatalog: () => {\n      setDB({ type: ActionType.AddTableCatalogSheet });\n    }, onQueryChange: ({ target }) => onChange(ActionType.QueryChange, {\n      name: target.name,\n      value: target.value\n    }), onExtraInputChange: ({ target }) => onChange(ActionType.ExtraInputChange, {\n      name: target.name,\n      value: target.value\n    }), onRemoveTableCatalog: (idx) => {\n      setDB({\n        type: ActionType.RemoveTableCatalogSheet,\n        payload: { indexToDelete: idx }\n      });\n    }, onParametersChange: handleParametersChange, onChange: ({ target }) => onChange(ActionType.TextChange, {\n      name: target.name,\n      value: target.value\n    }), getValidation: () => getValidation(db), validationErrors: validationErrors, getPlaceholder: getPlaceholder, clearValidationErrors: handleClearValidationErrors }),\n  useSSHTunneling && ___EmotionJSX(SSHTunnelContainer, null, renderSSHTunnelForm())\n  );\n  const renderFinishState = () => {\n    if (!editNewDb) {\n      return ___EmotionJSX(ExtraOptions, { extraExtension: dbConfigExtraExtension, db: db, onInputChange: ({ target }) => onChange(ActionType.InputChange, {\n          type: target.type,\n          name: target.name,\n          checked: target.checked,\n          value: target.value\n        }), onTextChange: ({ target }) => onChange(ActionType.TextChange, {\n          name: target.name,\n          value: target.value\n        }), onEditorChange: (payload) => onChange(ActionType.EditorChange, payload), onExtraInputChange: ({ target }) => {\n          onChange(ActionType.ExtraInputChange, {\n            type: target.type,\n            name: target.name,\n            checked: target.checked,\n            value: target.value\n          });\n        }, onExtraEditorChange: (payload) => onChange(ActionType.ExtraEditorChange, payload) });\n    }\n    return renderDatabaseConnectionForm();\n  };\n  if (fileList.length > 0 && (\n  alreadyExists.length ||\n  passwordFields.length ||\n  sshTunnelPasswordFields.length ||\n  sshTunnelPrivateKeyFields.length ||\n  sshTunnelPrivateKeyPasswordFields.length)) {\n    return ___EmotionJSX(Modal, { centered: true, css: (theme) => [\n      antDModalNoPaddingStyles,\n      antDModalStyles(theme),\n      formHelperStyles(theme),\n      formStyles(theme)],\n      footer: renderModalFooter(), maskClosable: false, name: \"database\", onHide: onClose, onHandledPrimaryAction: onSave, primaryButtonName: t('Connect'), show: show, title: ___EmotionJSX(\"h4\", null, t('Connect a database')), width: \"500px\" },\n    ___EmotionJSX(ModalHeader, { db: db, dbName: dbName, dbModel: dbModel, fileList: fileList, hasConnectedDb: hasConnectedDb, isEditMode: isEditMode, isLoading: isLoading, useSqlAlchemyForm: useSqlAlchemyForm }),\n    confirmOverwriteField(),\n    importingErrorAlert(),\n    passwordNeededField()\n    );\n  }\n  const modalFooter = isEditMode ?\n  renderEditModalFooter(db) :\n  renderModalFooter();\n  return useTabLayout ? ___EmotionJSX(Modal, { css: (theme) => [\n    antDTabsStyles,\n    antDModalNoPaddingStyles,\n    antDModalStyles(theme),\n    formHelperStyles(theme),\n    formStyles(theme)],\n    name: \"database\", \"data-test\": \"database-modal\", onHandledPrimaryAction: onSave, onHide: onClose, primaryButtonName: isEditMode ? t('Save') : t('Connect'), width: \"500px\", centered: true, show: show, title: ___EmotionJSX(\"h4\", null, isEditMode ? t('Edit database') : t('Connect a database')), footer: modalFooter, maskClosable: false },\n  ___EmotionJSX(StyledStickyHeader, null,\n  ___EmotionJSX(TabHeader, null,\n  ___EmotionJSX(ModalHeader, { isLoading: isLoading, isEditMode: isEditMode, useSqlAlchemyForm: useSqlAlchemyForm, hasConnectedDb: hasConnectedDb, db: db, dbName: dbName, dbModel: dbModel })\n  )\n  ),\n  ___EmotionJSX(TabsStyled, { defaultActiveKey: DEFAULT_TAB_KEY, activeKey: tabKey, onTabClick: tabChange, animated: { inkBar: true, tabPane: true } },\n  ___EmotionJSX(Tabs.TabPane, { tab: ___EmotionJSX(\"span\", null, t('Basic')), key: \"1\" },\n  useSqlAlchemyForm ? ___EmotionJSX(StyledAlignment, null,\n  ___EmotionJSX(SqlAlchemyForm, { db: db, onInputChange: ({ target }) => onChange(ActionType.InputChange, {\n      type: target.type,\n      name: target.name,\n      checked: target.checked,\n      value: target.value\n    }), conf: conf, testConnection: testConnection, testInProgress: testInProgress },\n  ___EmotionJSX(SSHTunnelSwitchComponent, { dbModel: dbModel, db: db, changeMethods: {\n      onParametersChange: handleParametersChange\n    }, clearValidationErrors: handleClearValidationErrors }),\n  useSSHTunneling && renderSSHTunnelForm()\n  ),\n  isDynamic((db == null ? void 0 : db.backend) || (db == null ? void 0 : db.engine)) && !isEditMode && ___EmotionJSX(\"div\", { css: (theme) => infoTooltip(theme) },\n  ___EmotionJSX(Button, { buttonStyle: \"link\", onClick: () => setDB({\n      type: ActionType.ConfigMethodChange,\n      payload: {\n        database_name: db == null ? void 0 : db.database_name,\n        configuration_method: ConfigurationMethod.DynamicForm,\n        engine: db == null ? void 0 : db.engine\n      }\n    }), css: (theme) => alchemyButtonLinkStyles(theme) },\n  t('Connect this database using the dynamic form instead')\n  ),\n  ___EmotionJSX(InfoTooltip, { tooltip: t('Click this link to switch to an alternate form that exposes only the required fields needed to connect this database.'), viewBox: \"0 -6 24 24\" })\n  )\n  ) : renderDatabaseConnectionForm(),\n  !isEditMode && ___EmotionJSX(StyledAlertMargin, null,\n  ___EmotionJSX(Alert, { closable: false, css: (theme) => antDAlertStyles(theme), message: t('Additional fields may be required'), showIcon: true, description: ___EmotionJSX(React.Fragment, null,\n    t('Select databases require additional fields to be completed in the Advanced tab to successfully connect the database. Learn what requirements your databases has '),\n    ___EmotionJSX(\"a\", { href: DOCUMENTATION_LINK, target: \"_blank\", rel: \"noopener noreferrer\", className: \"additional-fields-alert-description\" },\n    t('here')\n    ), \".\"\n\n    ), type: \"info\" })\n  ),\n  showDBError && errorAlert()\n  ),\n  ___EmotionJSX(Tabs.TabPane, { tab: ___EmotionJSX(\"span\", null, t('Advanced')), key: \"2\" },\n  ___EmotionJSX(ExtraOptions, { extraExtension: dbConfigExtraExtension, db: db, onInputChange: ({ target }) => onChange(ActionType.InputChange, {\n      type: target.type,\n      name: target.name,\n      checked: target.checked,\n      value: target.value\n    }), onTextChange: ({ target }) => onChange(ActionType.TextChange, {\n      name: target.name,\n      value: target.value\n    }), onEditorChange: (payload) => onChange(ActionType.EditorChange, payload), onExtraInputChange: ({ target }) => {\n      onChange(ActionType.ExtraInputChange, {\n        type: target.type,\n        name: target.name,\n        checked: target.checked,\n        value: target.value\n      });\n    }, onExtraEditorChange: (payload) => {\n      onChange(ActionType.ExtraEditorChange, payload);\n    } })\n  )\n  )\n  ) : ___EmotionJSX(Modal, { css: (theme) => [\n    antDModalNoPaddingStyles,\n    antDModalStyles(theme),\n    formHelperStyles(theme),\n    formStyles(theme)],\n    name: \"database\", onHandledPrimaryAction: onSave, onHide: onClose, primaryButtonName: hasConnectedDb ? t('Finish') : t('Connect'), width: \"500px\", centered: true, show: show, title: ___EmotionJSX(\"h4\", null, t('Connect a database')), footer: renderModalFooter(), maskClosable: false },\n  !isLoading && hasConnectedDb ? ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(ModalHeader, { isLoading: isLoading, isEditMode: isEditMode, useSqlAlchemyForm: useSqlAlchemyForm, hasConnectedDb: hasConnectedDb, db: db, dbName: dbName, dbModel: dbModel, editNewDb: editNewDb }),\n  showCTAbtns && renderCTABtns(),\n  renderFinishState()\n  ) : ___EmotionJSX(React.Fragment, null,\n\n  !isLoading && (\n  !db ? ___EmotionJSX(SelectDatabaseStyles, null,\n  ___EmotionJSX(ModalHeader, { isLoading: isLoading, isEditMode: isEditMode, useSqlAlchemyForm: useSqlAlchemyForm, hasConnectedDb: hasConnectedDb, db: db, dbName: dbName, dbModel: dbModel }),\n  renderPreferredSelector(),\n  renderAvailableSelector(),\n  ___EmotionJSX(StyledUploadWrapper, null,\n  ___EmotionJSX(Upload, { name: \"databaseFile\", id: \"databaseFile\", \"data-test\": \"database-file-input\", accept: \".yaml,.json,.yml,.zip\", customRequest: () => {}, onChange: onDbImport, onRemove: removeFile },\n  ___EmotionJSX(Button, { \"data-test\": \"import-database-btn\", buttonStyle: \"link\", type: \"link\", css: importDbButtonLinkStyles },\n  t('Import database from file')\n  )\n  )\n  ),\n  importingErrorAlert()\n  ) : ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(ModalHeader, { isLoading: isLoading, isEditMode: isEditMode, useSqlAlchemyForm: useSqlAlchemyForm, hasConnectedDb: hasConnectedDb, db: db, dbName: dbName, dbModel: dbModel }),\n  hasAlert && renderStepTwoAlert(),\n  renderDatabaseConnectionForm(),\n  ___EmotionJSX(\"div\", { css: (theme) => infoTooltip(theme) },\n  dbModel.engine !== Engines.GSheet && ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(Button, { \"data-test\": \"sqla-connect-btn\", buttonStyle: \"link\", onClick: () => setDB({\n      type: ActionType.ConfigMethodChange,\n      payload: {\n        engine: db.engine,\n        configuration_method: ConfigurationMethod.SqlalchemyUri,\n        database_name: db.database_name\n      }\n    }), css: buttonLinkStyles },\n  t('Connect this database with a SQLAlchemy URI string instead')\n  ),\n  ___EmotionJSX(InfoTooltip, { tooltip: t('Click this link to switch to an alternate form that allows you to input the SQLAlchemy URL for this database manually.'), viewBox: \"0 -6 24 24\" })\n  )\n  ),\n\n  showDBError && errorAlert()\n  ))\n  ),\n  isLoading && ___EmotionJSX(Loading, null)\n  );\n};__signature__(DatabaseModal, \"useReducer{[db, setDB](null)}\\nuseSingleViewResource{{ state: { loading: dbLoading, resource: dbFetched, error: dbErrors }, fetchResource, createResource, updateResource, clearError, }}\\nuseState{[tabKey, setTabKey](DEFAULT_TAB_KEY)}\\nuseAvailableDatabases{[availableDbs, getAvailableDbs]}\\nuseDatabaseValidation{[validationErrors, getValidation, setValidationErrors]}\\nuseState{[hasConnectedDb, setHasConnectedDb](false)}\\nuseState{[showCTAbtns, setShowCTAbtns](false)}\\nuseState{[dbName, setDbName]('')}\\nuseState{[editNewDb, setEditNewDb](false)}\\nuseState{[isLoading, setLoading](false)}\\nuseState{[testInProgress, setTestInProgress](false)}\\nuseState{[passwords, setPasswords]({})}\\nuseState{[sshTunnelPasswords, setSSHTunnelPasswords]({})}\\nuseState{[sshTunnelPrivateKeys, setSSHTunnelPrivateKeys]({})}\\nuseState{[sshTunnelPrivateKeyPasswords, setSSHTunnelPrivateKeyPasswords]({})}\\nuseState{[confirmedOverwrite, setConfirmedOverwrite](false)}\\nuseState{[fileList, setFileList]([])}\\nuseState{[importingModal, setImportingModal](false)}\\nuseState{[importingErrorMessage, setImportingErrorMessage]}\\nuseState{[passwordFields, setPasswordFields]([])}\\nuseState{[sshTunnelPasswordFields, setSSHTunnelPasswordFields]([])}\\nuseState{[sshTunnelPrivateKeyFields, setSSHTunnelPrivateKeyFields]([])}\\nuseState{[sshTunnelPrivateKeyPasswordFields, setSSHTunnelPrivateKeyPasswordFields,]([])}\\nuseState{[extraExtensionComponentState, setExtraExtensionComponentState]({})}\\nuseState{[useSSHTunneling, setUseSSHTunneling](undefined)}\\nuseCommonConf{conf}\\nuseHistory{history}\\nuseCallback{onChange}\\nuseCallback{handleClearValidationErrors}\\nuseCallback{handleParametersChange}\\nuseImportResource{{ state: { alreadyExists, passwordsNeeded, sshPasswordNeeded, sshPrivateKeyNeeded, sshPrivateKeyPasswordNeeded, loading: importLoading, failed: importErrored, }, importResource, }}\\nuseRef{firstUpdate}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\", () => [useSingleViewResource, useAvailableDatabases, useDatabaseValidation, useCommonConf, useHistory, useImportResource]);const _default =\nwithToasts(DatabaseModal);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(extensionsRegistry, \"extensionsRegistry\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(DEFAULT_EXTRA, \"DEFAULT_EXTRA\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(engineSpecificAlertMapping, \"engineSpecificAlertMapping\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(TabsStyled, \"TabsStyled\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(ErrorAlertContainer, \"ErrorAlertContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(SSHTunnelContainer, \"SSHTunnelContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(ActionType, \"ActionType\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(AuthType, \"AuthType\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(StyledBtns, \"StyledBtns\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(dbReducer, \"dbReducer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(DEFAULT_TAB_KEY, \"DEFAULT_TAB_KEY\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(DatabaseModal, \"DatabaseModal\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["t","styled","getExtensionsRegistry","React","useEffect","useRef","useState","useReducer","useCallback","useHistory","setItem","LocalStorageKeys","Tabs","AntdSelect","Upload","Alert","Modal","Button","IconButton","InfoTooltip","withToasts","ValidatedInput","ErrorMessageWithStackTrace","ErrorAlert","testDatabaseConnection","useSingleViewResource","useAvailableDatabases","useDatabaseValidation","getDatabaseImages","getConnectionAlert","useImportResource","useCommonConf","Loading","ConfigurationMethod","Engines","ExtraOptions","SqlAlchemyForm","DatabaseConnectionForm","antDAlertStyles","antdWarningAlertStyles","StyledAlertMargin","antDModalNoPaddingStyles","antDModalStyles","antDTabsStyles","buttonLinkStyles","importDbButtonLinkStyles","alchemyButtonLinkStyles","TabHeader","formHelperStyles","formStyles","StyledAlignment","SelectDatabaseStyles","infoTooltip","StyledFooterButton","StyledStickyHeader","formScrollableStyles","StyledUploadWrapper","ModalHeader","DOCUMENTATION_LINK","SSHTunnelForm","SSHTunnelSwitch","jsx","___EmotionJSX","extensionsRegistry","DEFAULT_EXTRA","JSON","stringify","allows_virtual_table_explore","engineSpecificAlertMapping","GSheet","message","description","TabsStyled","ErrorAlertContainer","div","theme","gridUnit","SSHTunnelContainer","ActionType","AuthType","StyledBtns","dbReducer","state","action","_action$payload$type","_trimmedState$catalog","_action$payload","_action$payload$param","trimmedState","query","query_input","parametersCatalog","actionPayloadJson","extraJson","parse","extra","type","ExtraEditorChange","payload","json","e","name","ExtraInputChange","metadata_cache_timeout","value","schemas_allowed_for_file_upload","split","filter","schema","_action$payload$value","engine_params","connect_args","trim","schema_options","checked","InputChange","ParametersChange","startsWith","catalog","undefined","_action$payload$type2","catalogCopy","idx","catalogToUpdate","splice","parseInt","reduce","obj","item","parameters","ParametersSSHTunnelChange","ssh_tunnel","SetSSHTunnelLoginMethod","_pick","login_method","PrivateKey","_trimmedState$ssh_tun","_trimmedState$ssh_tun2","private_key","private_key_password","Password","_trimmedState$ssh_tun3","password","RemoveSSHTunnelConfig","AddTableCatalogSheet","RemoveTableCatalogSheet","indexToDelete","EditorChange","QueryChange","Object","fromEntries","URLSearchParams","TextChange","Fetched","entries","map","key","join","masked_encrypted_extra","configuration_method","DynamicForm","_extraJsonPayload$eng","extraJsonPayload","payloadCatalog","engineRootCatalog","engine","backend","DbSelected","expose_in_sqllab","ConfigMethodChange","Reset","DEFAULT_TAB_KEY","DatabaseModal","addDangerToast","addSuccessToast","onDatabaseAdd","onHide","show","databaseId","dbEngine","_extensionsRegistry$g","_availableDbs$databas3","_availableDbs$databas4","_db$parameters2","db","setDB","loading","dbLoading","resource","dbFetched","error","dbErrors","fetchResource","createResource","updateResource","clearError","tabKey","setTabKey","availableDbs","getAvailableDbs","validationErrors","getValidation","setValidationErrors","hasConnectedDb","setHasConnectedDb","showCTAbtns","setShowCTAbtns","dbName","setDbName","editNewDb","setEditNewDb","isLoading","setLoading","testInProgress","setTestInProgress","passwords","setPasswords","sshTunnelPasswords","setSSHTunnelPasswords","sshTunnelPrivateKeys","setSSHTunnelPrivateKeys","sshTunnelPrivateKeyPasswords","setSSHTunnelPrivateKeyPasswords","confirmedOverwrite","setConfirmedOverwrite","fileList","setFileList","importingModal","setImportingModal","importingErrorMessage","setImportingErrorMessage","passwordFields","setPasswordFields","sshTunnelPasswordFields","setSSHTunnelPasswordFields","sshTunnelPrivateKeyFields","setSSHTunnelPrivateKeyFields","sshTunnelPrivateKeyPasswordFields","setSSHTunnelPrivateKeyPasswordFields","extraExtensionComponentState","setExtraExtensionComponentState","SSHTunnelSwitchComponent","get","useSSHTunneling","setUseSSHTunneling","dbConfigExtraExtension","onEdit","componentState","conf","dbImages","connectionAlert","isEditMode","hasAlert","useSqlAlchemyForm","SqlalchemyUri","useTabLayout","isDynamic","_availableDbs$databas","_availableDbs$databas2","databases","find","DB","showDBError","history","dbModel","available","default_driver","driver","testConnection","_db$database_name","sqlalchemy_uri","connection","database_name","impersonate_user","server_cert","_isEmpty","server_port","Number","errorMsg","getPlaceholder","field","removeFile","removedFile","file","uid","onChange","handleClearValidationErrors","handleParametersChange","target","onClose","redirectURL","url","push","alreadyExists","passwordsNeeded","sshPasswordNeeded","sshPrivateKeyNeeded","sshPrivateKeyPasswordNeeded","importLoading","failed","importErrored","importResource","msg","onSave","_dbConfigExtraExtensi","_dbToUpdate$parameter7","dbConfigExtraExtensionOnSaveError","then","dbToUpdate","_dbToUpdate$parameter","_dbToUpdate$parameter2","errors","length","parameters_schema","properties","additionalEncryptedExtra","paramConfigArray","keys","forEach","paramConfig","_dbToUpdate$parameter3","_dbToUpdate$parameter4","_dbToUpdate$parameter5","_dbToUpdate$parameter6","id","result","_dbConfigExtraExtensi2","dbId","_dbConfigExtraExtensi3","originFileObj","File","fetchDB","catch","setDatabaseModel","engine_information","supports_file_upload","selectedDbModel","sqlalchemy_uri_placeholder","renderAvailableSelector","_ref","_connectionAlert$ADD_","className","placeholder","showSearch","sort","a","b","localeCompare","database","index","Option","showIcon","closable","css","ADD_DATABASE","Fragment","href","contact_link","rel","contact_description_link","renderPreferredSelector","_availableDbs$databas5","preferred","onClick","buttonText","icon","handleBackButtonOnFinish","handleBackButtonOnConnect","handleDisableOnImport","renderModalFooter","buttonStyle","disabled","renderEditModalFooter","is_managed_externally","tooltip","firstUpdate","current","document","getElementsByClassName","scrollIntoView","_db$parameters","ssh","onDbImport","info","status","passwordNeededField","files","Set","indexOf","required","event","validationMethods","onBlur","errorMessage","password_needed","label","slice","ssh_tunnel_password_needed","ssh_tunnel_private_key_needed","ssh_tunnel_private_key_password_needed","importingErrorAlert","showDbInstallInstructions","confirmOverwrite","_event$currentTarget$","_event$currentTarget","targetValue","currentTarget","toUpperCase","confirmOverwriteField","confirm_overwrite","tabChange","renderStepTwoAlert","_connectionAlert$REGI","_engineSpecificAlertM","_connectionAlert$DEFA","_engineSpecificAlertM2","_connectionAlert$DEFA2","hostname","window","location","ipAlert","REGIONAL_IPS","default","regionalIPs","ipRegion","ipRange","regex","RegExp","match","DEFAULT","errorAlert","alertErrors","values","error_type","_alertErrors","title","subtitle","copyText","fetchAndSetDB","r","Database","renderSSHTunnelForm","onSSHTunnelParametersChange","setSSHTunnelLoginMethod","method","renderCTABtns","renderDatabaseConnectionForm","sslForced","onAddTableCatalog","onQueryChange","onExtraInputChange","onRemoveTableCatalog","onParametersChange","clearValidationErrors","renderFinishState","extraExtension","onInputChange","onTextChange","onEditorChange","onExtraEditorChange","centered","footer","maskClosable","onHandledPrimaryAction","primaryButtonName","width","modalFooter","defaultActiveKey","activeKey","onTabClick","animated","inkBar","tabPane","TabPane","tab","changeMethods","viewBox","accept","customRequest","onRemove","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/features/databases/DatabaseModal/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  styled,\n  SupersetTheme,\n  getExtensionsRegistry,\n} from '@superset-ui/core';\nimport React, {\n  FunctionComponent,\n  useEffect,\n  useRef,\n  useState,\n  useReducer,\n  Reducer,\n  useCallback,\n} from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { setItem, LocalStorageKeys } from 'src/utils/localStorageHelpers';\nimport { UploadChangeParam, UploadFile } from 'antd/lib/upload/interface';\nimport Tabs from 'src/components/Tabs';\nimport { AntdSelect, Upload } from 'src/components';\nimport Alert from 'src/components/Alert';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport IconButton from 'src/components/IconButton';\nimport InfoTooltip from 'src/components/InfoTooltip';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport ValidatedInput from 'src/components/Form/LabeledErrorBoundInput';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport ErrorAlert from 'src/components/ImportModal/ErrorAlert';\nimport {\n  testDatabaseConnection,\n  useSingleViewResource,\n  useAvailableDatabases,\n  useDatabaseValidation,\n  getDatabaseImages,\n  getConnectionAlert,\n  useImportResource,\n} from 'src/views/CRUD/hooks';\nimport { useCommonConf } from 'src/features/databases/state';\nimport Loading from 'src/components/Loading';\nimport { isEmpty, pick } from 'lodash';\nimport {\n  DatabaseObject,\n  DatabaseForm,\n  ConfigurationMethod,\n  CatalogObject,\n  Engines,\n  ExtraJson,\n  CustomTextType,\n} from '../types';\nimport ExtraOptions from './ExtraOptions';\nimport SqlAlchemyForm from './SqlAlchemyForm';\nimport DatabaseConnectionForm from './DatabaseConnectionForm';\nimport {\n  antDAlertStyles,\n  antdWarningAlertStyles,\n  StyledAlertMargin,\n  antDModalNoPaddingStyles,\n  antDModalStyles,\n  antDTabsStyles,\n  buttonLinkStyles,\n  importDbButtonLinkStyles,\n  alchemyButtonLinkStyles,\n  TabHeader,\n  formHelperStyles,\n  formStyles,\n  StyledAlignment,\n  SelectDatabaseStyles,\n  infoTooltip,\n  StyledFooterButton,\n  StyledStickyHeader,\n  formScrollableStyles,\n  StyledUploadWrapper,\n} from './styles';\nimport ModalHeader, { DOCUMENTATION_LINK } from './ModalHeader';\nimport SSHTunnelForm from './SSHTunnelForm';\nimport SSHTunnelSwitch from './SSHTunnelSwitch';\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst DEFAULT_EXTRA = JSON.stringify({ allows_virtual_table_explore: true });\n\nconst engineSpecificAlertMapping = {\n  [Engines.GSheet]: {\n    message: 'Why do I need to create a database?',\n    description:\n      'To begin using your Google Sheets, you need to create a database first. ' +\n      'Databases are used as a way to identify ' +\n      'your data so that it can be queried and visualized. This ' +\n      'database will hold all of your individual Google Sheets ' +\n      'you choose to connect here.',\n  },\n};\n\nconst TabsStyled = styled(Tabs)`\n  .ant-tabs-content {\n    display: flex;\n    width: 100%;\n    overflow: inherit;\n\n    & > .ant-tabs-tabpane {\n      position: relative;\n    }\n  }\n`;\n\nconst ErrorAlertContainer = styled.div`\n  ${({ theme }) => `\n    margin: ${theme.gridUnit * 8}px ${theme.gridUnit * 4}px;\n  `};\n`;\n\nconst SSHTunnelContainer = styled.div`\n  ${({ theme }) => `\n    padding: 0px ${theme.gridUnit * 4}px;\n  `};\n`;\n\ninterface DatabaseModalProps {\n  addDangerToast: (msg: string) => void;\n  addSuccessToast: (msg: string) => void;\n  onDatabaseAdd?: (database?: DatabaseObject) => void;\n  onHide: () => void;\n  show: boolean;\n  databaseId: number | undefined; // If included, will go into edit mode\n  dbEngine: string | undefined; // if included goto step 2 with engine already set\n}\n\nexport enum ActionType {\n  AddTableCatalogSheet,\n  ConfigMethodChange,\n  DbSelected,\n  EditorChange,\n  ExtraEditorChange,\n  ExtraInputChange,\n  Fetched,\n  InputChange,\n  ParametersChange,\n  QueryChange,\n  RemoveTableCatalogSheet,\n  Reset,\n  TextChange,\n  ParametersSSHTunnelChange,\n  SetSSHTunnelLoginMethod,\n  RemoveSSHTunnelConfig,\n}\n\nexport enum AuthType {\n  Password,\n  PrivateKey,\n}\n\ninterface DBReducerPayloadType {\n  target?: string;\n  name: string;\n  json?: string;\n  type?: string;\n  checked?: boolean;\n  value?: string;\n}\n\nexport type DBReducerActionType =\n  | {\n      type:\n        | ActionType.ExtraEditorChange\n        | ActionType.ExtraInputChange\n        | ActionType.TextChange\n        | ActionType.QueryChange\n        | ActionType.InputChange\n        | ActionType.EditorChange\n        | ActionType.ParametersChange\n        | ActionType.ParametersSSHTunnelChange;\n      payload: DBReducerPayloadType;\n    }\n  | {\n      type: ActionType.Fetched;\n      payload: Partial<DatabaseObject>;\n    }\n  | {\n      type: ActionType.DbSelected;\n      payload: {\n        database_name?: string;\n        engine?: string;\n        configuration_method: ConfigurationMethod;\n        engine_information?: {};\n        driver?: string;\n        sqlalchemy_uri_placeholder?: string;\n      };\n    }\n  | {\n      type:\n        | ActionType.Reset\n        | ActionType.RemoveSSHTunnelConfig\n        | ActionType.AddTableCatalogSheet;\n    }\n  | {\n      type: ActionType.RemoveTableCatalogSheet;\n      payload: {\n        indexToDelete: number;\n      };\n    }\n  | {\n      type: ActionType.ConfigMethodChange;\n      payload: {\n        database_name?: string;\n        engine?: string;\n        configuration_method: ConfigurationMethod;\n      };\n    }\n  | {\n      type: ActionType.SetSSHTunnelLoginMethod;\n      payload: {\n        login_method: AuthType;\n      };\n    };\n\nconst StyledBtns = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  margin-left: ${({ theme }) => theme.gridUnit * 3}px;\n`;\n\nexport function dbReducer(\n  state: Partial<DatabaseObject> | null,\n  action: DBReducerActionType,\n): Partial<DatabaseObject> | null {\n  const trimmedState = {\n    ...(state || {}),\n  };\n  let query = {};\n  let query_input = '';\n  let parametersCatalog;\n  let actionPayloadJson;\n  const extraJson: ExtraJson = JSON.parse(trimmedState.extra || '{}');\n\n  switch (action.type) {\n    case ActionType.ExtraEditorChange:\n      // \"extra\" payload in state is a string\n      try {\n        // we don't want to stringify encoded strings twice\n        actionPayloadJson = JSON.parse(action.payload.json || '{}');\n      } catch (e) {\n        actionPayloadJson = action.payload.json;\n      }\n      return {\n        ...trimmedState,\n        extra: JSON.stringify({\n          ...extraJson,\n          [action.payload.name]: actionPayloadJson,\n        }),\n      };\n    case ActionType.ExtraInputChange:\n      // \"extra\" payload in state is a string\n      if (\n        action.payload.name === 'schema_cache_timeout' ||\n        action.payload.name === 'table_cache_timeout'\n      ) {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            metadata_cache_timeout: {\n              ...extraJson?.metadata_cache_timeout,\n              [action.payload.name]: action.payload.value,\n            },\n          }),\n        };\n      }\n      if (action.payload.name === 'schemas_allowed_for_file_upload') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            schemas_allowed_for_file_upload: (action.payload.value || '')\n              .split(',')\n              .filter(schema => schema !== ''),\n          }),\n        };\n      }\n      if (action.payload.name === 'http_path') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            engine_params: {\n              connect_args: {\n                [action.payload.name]: action.payload.value?.trim(),\n              },\n            },\n          }),\n        };\n      }\n      if (action.payload.name === 'expand_rows') {\n        return {\n          ...trimmedState,\n          extra: JSON.stringify({\n            ...extraJson,\n            schema_options: {\n              ...extraJson?.schema_options,\n              [action.payload.name]: !!action.payload.value,\n            },\n          }),\n        };\n      }\n      return {\n        ...trimmedState,\n        extra: JSON.stringify({\n          ...extraJson,\n          [action.payload.name]:\n            action.payload.type === 'checkbox'\n              ? action.payload.checked\n              : action.payload.value,\n        }),\n      };\n    case ActionType.InputChange:\n      if (action.payload.type === 'checkbox') {\n        return {\n          ...trimmedState,\n          [action.payload.name]: action.payload.checked,\n        };\n      }\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.value,\n      };\n    case ActionType.ParametersChange:\n      // catalog params will always have a catalog state for\n      // dbs that use a catalog, i.e., gsheets, even if the\n      // fields are empty strings\n      if (\n        action.payload.type?.startsWith('catalog') &&\n        trimmedState.catalog !== undefined\n      ) {\n        // Formatting wrapping google sheets table catalog\n        const catalogCopy: CatalogObject[] = [...trimmedState.catalog];\n        const idx = action.payload.type?.split('-')[1];\n        const catalogToUpdate: CatalogObject = catalogCopy[idx] || {};\n        catalogToUpdate[action.payload.name] = action.payload.value;\n\n        // insert updated catalog to existing state\n        catalogCopy.splice(parseInt(idx, 10), 1, catalogToUpdate);\n\n        // format catalog for state\n        // eslint-disable-next-line array-callback-return\n        parametersCatalog = catalogCopy.reduce((obj, item: any) => {\n          const catalog = { ...obj };\n          catalog[item.name] = item.value;\n          return catalog;\n        }, {});\n\n        return {\n          ...trimmedState,\n          catalog: catalogCopy,\n          parameters: {\n            ...trimmedState.parameters,\n            catalog: parametersCatalog,\n          },\n        };\n      }\n      return {\n        ...trimmedState,\n        parameters: {\n          ...trimmedState.parameters,\n          [action.payload.name]: action.payload.value,\n        },\n      };\n\n    case ActionType.ParametersSSHTunnelChange:\n      return {\n        ...trimmedState,\n        ssh_tunnel: {\n          ...trimmedState.ssh_tunnel,\n          [action.payload.name]: action.payload.value,\n        },\n      };\n    case ActionType.SetSSHTunnelLoginMethod: {\n      let ssh_tunnel = {};\n      if (trimmedState?.ssh_tunnel) {\n        // remove any attributes that are considered sensitive\n        ssh_tunnel = pick(trimmedState.ssh_tunnel, [\n          'id',\n          'server_address',\n          'server_port',\n          'username',\n        ]);\n      }\n      if (action.payload.login_method === AuthType.PrivateKey) {\n        return {\n          ...trimmedState,\n          ssh_tunnel: {\n            private_key: trimmedState?.ssh_tunnel?.private_key,\n            private_key_password:\n              trimmedState?.ssh_tunnel?.private_key_password,\n            ...ssh_tunnel,\n          },\n        };\n      }\n      if (action.payload.login_method === AuthType.Password) {\n        return {\n          ...trimmedState,\n          ssh_tunnel: {\n            password: trimmedState?.ssh_tunnel?.password,\n            ...ssh_tunnel,\n          },\n        };\n      }\n      return {\n        ...trimmedState,\n      };\n    }\n    case ActionType.RemoveSSHTunnelConfig:\n      return {\n        ...trimmedState,\n        ssh_tunnel: undefined,\n      };\n    case ActionType.AddTableCatalogSheet:\n      if (trimmedState.catalog !== undefined) {\n        return {\n          ...trimmedState,\n          catalog: [...trimmedState.catalog, { name: '', value: '' }],\n        };\n      }\n      return {\n        ...trimmedState,\n        catalog: [{ name: '', value: '' }],\n      };\n    case ActionType.RemoveTableCatalogSheet:\n      trimmedState.catalog?.splice(action.payload.indexToDelete, 1);\n      return {\n        ...trimmedState,\n      };\n    case ActionType.EditorChange:\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.json,\n      };\n    case ActionType.QueryChange:\n      return {\n        ...trimmedState,\n        parameters: {\n          ...trimmedState.parameters,\n          query: Object.fromEntries(new URLSearchParams(action.payload.value)),\n        },\n        query_input: action.payload.value,\n      };\n    case ActionType.TextChange:\n      return {\n        ...trimmedState,\n        [action.payload.name]: action.payload.value,\n      };\n    case ActionType.Fetched:\n      // convert query to a string and store in query_input\n      query = action.payload?.parameters?.query || {};\n      query_input = Object.entries(query)\n        .map(([key, value]) => `${key}=${value}`)\n        .join('&');\n\n      if (\n        action.payload.masked_encrypted_extra &&\n        action.payload.configuration_method === ConfigurationMethod.DynamicForm\n      ) {\n        // \"extra\" payload from the api is a string\n        const extraJsonPayload: ExtraJson = {\n          ...JSON.parse((action.payload.extra as string) || '{}'),\n        };\n\n        const payloadCatalog = extraJsonPayload.engine_params?.catalog;\n\n        const engineRootCatalog = Object.entries(payloadCatalog || {}).map(\n          ([name, value]: string[]) => ({ name, value }),\n        );\n\n        return {\n          ...action.payload,\n          engine: action.payload.backend || trimmedState.engine,\n          configuration_method: action.payload.configuration_method,\n          catalog: engineRootCatalog,\n          parameters: {\n            ...(action.payload.parameters || trimmedState.parameters),\n            catalog: payloadCatalog,\n          },\n          query_input,\n        };\n      }\n      return {\n        ...action.payload,\n        masked_encrypted_extra: action.payload.masked_encrypted_extra || '',\n        engine: action.payload.backend || trimmedState.engine,\n        configuration_method: action.payload.configuration_method,\n        parameters: action.payload.parameters || trimmedState.parameters,\n        ssh_tunnel: action.payload.ssh_tunnel || trimmedState.ssh_tunnel,\n        query_input,\n      };\n\n    case ActionType.DbSelected:\n      // set initial state for blank form\n      return {\n        ...action.payload,\n        extra: DEFAULT_EXTRA,\n        expose_in_sqllab: true,\n      };\n    case ActionType.ConfigMethodChange:\n      return {\n        ...action.payload,\n      };\n\n    case ActionType.Reset:\n    default:\n      return null;\n  }\n}\n\nconst DEFAULT_TAB_KEY = '1';\n\nconst DatabaseModal: FunctionComponent<DatabaseModalProps> = ({\n  addDangerToast,\n  addSuccessToast,\n  onDatabaseAdd,\n  onHide,\n  show,\n  databaseId,\n  dbEngine,\n}) => {\n  const [db, setDB] = useReducer<\n    Reducer<Partial<DatabaseObject> | null, DBReducerActionType>\n  >(dbReducer, null);\n  // Database fetch logic\n  const {\n    state: { loading: dbLoading, resource: dbFetched, error: dbErrors },\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError,\n  } = useSingleViewResource<DatabaseObject>(\n    'database',\n    t('database'),\n    addDangerToast,\n    'connection',\n  );\n\n  const [tabKey, setTabKey] = useState<string>(DEFAULT_TAB_KEY);\n  const [availableDbs, getAvailableDbs] = useAvailableDatabases();\n  const [validationErrors, getValidation, setValidationErrors] =\n    useDatabaseValidation();\n  const [hasConnectedDb, setHasConnectedDb] = useState<boolean>(false);\n  const [showCTAbtns, setShowCTAbtns] = useState(false);\n  const [dbName, setDbName] = useState('');\n  const [editNewDb, setEditNewDb] = useState<boolean>(false);\n  const [isLoading, setLoading] = useState<boolean>(false);\n  const [testInProgress, setTestInProgress] = useState<boolean>(false);\n  const [passwords, setPasswords] = useState<Record<string, string>>({});\n  const [sshTunnelPasswords, setSSHTunnelPasswords] = useState<\n    Record<string, string>\n  >({});\n  const [sshTunnelPrivateKeys, setSSHTunnelPrivateKeys] = useState<\n    Record<string, string>\n  >({});\n  const [sshTunnelPrivateKeyPasswords, setSSHTunnelPrivateKeyPasswords] =\n    useState<Record<string, string>>({});\n  const [confirmedOverwrite, setConfirmedOverwrite] = useState<boolean>(false);\n  const [fileList, setFileList] = useState<UploadFile[]>([]);\n  const [importingModal, setImportingModal] = useState<boolean>(false);\n  const [importingErrorMessage, setImportingErrorMessage] = useState<string>();\n  const [passwordFields, setPasswordFields] = useState<string[]>([]);\n  const [sshTunnelPasswordFields, setSSHTunnelPasswordFields] = useState<\n    string[]\n  >([]);\n  const [sshTunnelPrivateKeyFields, setSSHTunnelPrivateKeyFields] = useState<\n    string[]\n  >([]);\n  const [\n    sshTunnelPrivateKeyPasswordFields,\n    setSSHTunnelPrivateKeyPasswordFields,\n  ] = useState<string[]>([]);\n  const [extraExtensionComponentState, setExtraExtensionComponentState] =\n    useState<object>({});\n\n  const SSHTunnelSwitchComponent =\n    extensionsRegistry.get('ssh_tunnel.form.switch') ?? SSHTunnelSwitch;\n\n  const [useSSHTunneling, setUseSSHTunneling] = useState<boolean | undefined>(\n    undefined,\n  );\n\n  let dbConfigExtraExtension = extensionsRegistry.get(\n    'databaseconnection.extraOption',\n  );\n\n  if (dbConfigExtraExtension) {\n    // add method for db modal to store data\n    dbConfigExtraExtension = {\n      ...dbConfigExtraExtension,\n      onEdit: componentState => {\n        setExtraExtensionComponentState({\n          ...extraExtensionComponentState,\n          ...componentState,\n        });\n      },\n    };\n  }\n\n  const conf = useCommonConf();\n  const dbImages = getDatabaseImages();\n  const connectionAlert = getConnectionAlert();\n  const isEditMode = !!databaseId;\n  const hasAlert =\n    connectionAlert || !!(db?.engine && engineSpecificAlertMapping[db.engine]);\n  const useSqlAlchemyForm =\n    db?.configuration_method === ConfigurationMethod.SqlalchemyUri;\n  const useTabLayout = isEditMode || useSqlAlchemyForm;\n  const isDynamic = (engine: string | undefined) =>\n    availableDbs?.databases?.find(\n      (DB: DatabaseObject) => DB.backend === engine || DB.engine === engine,\n    )?.parameters !== undefined;\n  const showDBError = validationErrors || dbErrors;\n  const history = useHistory();\n\n  const dbModel: DatabaseForm =\n    // TODO: we need a centralized engine in one place\n\n    // first try to match both engine and driver\n    availableDbs?.databases?.find(\n      (available: {\n        engine: string | undefined;\n        default_driver: string | undefined;\n      }) =>\n        available.engine === (isEditMode ? db?.backend : db?.engine) &&\n        available.default_driver === db?.driver,\n    ) ||\n    // alternatively try to match only engine\n    availableDbs?.databases?.find(\n      (available: { engine: string | undefined }) =>\n        available.engine === (isEditMode ? db?.backend : db?.engine),\n    ) ||\n    {};\n\n  // Test Connection logic\n  const testConnection = () => {\n    if (!db?.sqlalchemy_uri) {\n      addDangerToast(t('Please enter a SQLAlchemy URI to test'));\n      return;\n    }\n\n    const connection = {\n      sqlalchemy_uri: db?.sqlalchemy_uri || '',\n      database_name: db?.database_name?.trim() || undefined,\n      impersonate_user: db?.impersonate_user || undefined,\n      extra: db?.extra,\n      masked_encrypted_extra: db?.masked_encrypted_extra || '',\n      server_cert: db?.server_cert || undefined,\n      ssh_tunnel:\n        !isEmpty(db?.ssh_tunnel) && useSSHTunneling\n          ? {\n              ...db.ssh_tunnel,\n              server_port: Number(db.ssh_tunnel!.server_port),\n            }\n          : undefined,\n    };\n    setTestInProgress(true);\n    testDatabaseConnection(\n      connection,\n      (errorMsg: string) => {\n        setTestInProgress(false);\n        addDangerToast(errorMsg);\n      },\n      (errorMsg: string) => {\n        setTestInProgress(false);\n        addSuccessToast(errorMsg);\n      },\n    );\n  };\n\n  const getPlaceholder = (field: string) => {\n    if (field === 'database') {\n      return t('e.g. world_population');\n    }\n    return undefined;\n  };\n\n  const removeFile = (removedFile: UploadFile) => {\n    setFileList(fileList.filter(file => file.uid !== removedFile.uid));\n    return false;\n  };\n\n  const onChange = useCallback(\n    (\n      type: DBReducerActionType['type'],\n      payload: CustomTextType | DBReducerPayloadType,\n    ) => {\n      setDB({ type, payload } as DBReducerActionType);\n    },\n    [],\n  );\n\n  const handleClearValidationErrors = useCallback(() => {\n    setValidationErrors(null);\n  }, [setValidationErrors]);\n\n  const handleParametersChange = useCallback(\n    ({ target }: { target: HTMLInputElement }) => {\n      onChange(ActionType.ParametersChange, {\n        type: target.type,\n        name: target.name,\n        checked: target.checked,\n        value: target.value,\n      });\n    },\n    [onChange],\n  );\n\n  const onClose = () => {\n    setDB({ type: ActionType.Reset });\n    setHasConnectedDb(false);\n    handleClearValidationErrors(); // reset validation errors on close\n    clearError();\n    setEditNewDb(false);\n    setFileList([]);\n    setImportingModal(false);\n    setImportingErrorMessage('');\n    setPasswordFields([]);\n    setSSHTunnelPasswordFields([]);\n    setSSHTunnelPrivateKeyFields([]);\n    setSSHTunnelPrivateKeyPasswordFields([]);\n    setPasswords({});\n    setSSHTunnelPasswords({});\n    setSSHTunnelPrivateKeys({});\n    setSSHTunnelPrivateKeyPasswords({});\n    setConfirmedOverwrite(false);\n    setUseSSHTunneling(undefined);\n    onHide();\n  };\n\n  const redirectURL = (url: string) => {\n    history.push(url);\n  };\n\n  // Database import logic\n  const {\n    state: {\n      alreadyExists,\n      passwordsNeeded,\n      sshPasswordNeeded,\n      sshPrivateKeyNeeded,\n      sshPrivateKeyPasswordNeeded,\n      loading: importLoading,\n      failed: importErrored,\n    },\n    importResource,\n  } = useImportResource('database', t('database'), msg => {\n    setImportingErrorMessage(msg);\n  });\n\n  const onSave = async () => {\n    let dbConfigExtraExtensionOnSaveError;\n\n    setLoading(true);\n\n    dbConfigExtraExtension\n      ?.onSave(extraExtensionComponentState, db)\n      .then(({ error }: { error: any }) => {\n        if (error) {\n          dbConfigExtraExtensionOnSaveError = error;\n          addDangerToast(error);\n        }\n      });\n\n    if (dbConfigExtraExtensionOnSaveError) {\n      setLoading(false);\n      return;\n    }\n    // Clone DB object\n    const dbToUpdate = { ...(db || {}) };\n\n    if (dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm) {\n      // Validate DB before saving\n      if (dbToUpdate?.parameters?.catalog) {\n        // need to stringify gsheets catalog to allow it to be serialized\n        dbToUpdate.extra = JSON.stringify({\n          ...JSON.parse(dbToUpdate.extra || '{}'),\n          engine_params: {\n            catalog: dbToUpdate.parameters.catalog,\n          },\n        });\n      }\n\n      const errors = await getValidation(dbToUpdate, true);\n      if (!isEmpty(validationErrors) || errors?.length) {\n        addDangerToast(\n          t('Connection failed, please check your connection settings.'),\n        );\n        setLoading(false);\n        return;\n      }\n\n      const parameters_schema = isEditMode\n        ? dbToUpdate.parameters_schema?.properties\n        : dbModel?.parameters.properties;\n      const additionalEncryptedExtra = JSON.parse(\n        dbToUpdate.masked_encrypted_extra || '{}',\n      );\n      const paramConfigArray = Object.keys(parameters_schema || {});\n\n      paramConfigArray.forEach(paramConfig => {\n        /*\n         * Parameters that are annotated with the `x-encrypted-extra` properties should be\n         * moved to `masked_encrypted_extra`, so that they are stored encrypted in the\n         * backend when the database is created or edited.\n         */\n        if (\n          parameters_schema[paramConfig]['x-encrypted-extra'] &&\n          dbToUpdate.parameters?.[paramConfig]\n        ) {\n          if (typeof dbToUpdate.parameters?.[paramConfig] === 'object') {\n            // add new encrypted extra to masked_encrypted_extra object\n            additionalEncryptedExtra[paramConfig] =\n              dbToUpdate.parameters?.[paramConfig];\n            // The backend expects `masked_encrypted_extra` as a string for historical\n            // reasons.\n            dbToUpdate.parameters[paramConfig] = JSON.stringify(\n              dbToUpdate.parameters[paramConfig],\n            );\n          } else {\n            additionalEncryptedExtra[paramConfig] = JSON.parse(\n              dbToUpdate.parameters?.[paramConfig] || '{}',\n            );\n          }\n        }\n      });\n      // cast the new encrypted extra object into a string\n      dbToUpdate.masked_encrypted_extra = JSON.stringify(\n        additionalEncryptedExtra,\n      );\n      // this needs to be added by default to gsheets\n      if (dbToUpdate.engine === Engines.GSheet) {\n        dbToUpdate.impersonate_user = true;\n      }\n    }\n\n    if (dbToUpdate?.parameters?.catalog) {\n      // need to stringify gsheets catalog to allow it to be serialized\n      dbToUpdate.extra = JSON.stringify({\n        ...JSON.parse(dbToUpdate.extra || '{}'),\n        engine_params: {\n          catalog: dbToUpdate.parameters.catalog,\n        },\n      });\n    }\n\n    // strictly checking for false as an indication that the toggle got unchecked\n    if (useSSHTunneling === false) {\n      // remove ssh tunnel\n      dbToUpdate.ssh_tunnel = null;\n    }\n\n    if (db?.id) {\n      const result = await updateResource(\n        db.id as number,\n        dbToUpdate as DatabaseObject,\n        dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm, // onShow toast on SQLA Forms\n      );\n      if (result) {\n        if (onDatabaseAdd) onDatabaseAdd();\n        dbConfigExtraExtension\n          ?.onSave(extraExtensionComponentState, db)\n          .then(({ error }: { error: any }) => {\n            if (error) {\n              dbConfigExtraExtensionOnSaveError = error;\n              addDangerToast(error);\n            }\n          });\n        if (dbConfigExtraExtensionOnSaveError) {\n          setLoading(false);\n          return;\n        }\n        if (!editNewDb) {\n          onClose();\n          addSuccessToast(t('Database settings updated'));\n        }\n      }\n    } else if (db) {\n      // Create\n      const dbId = await createResource(\n        dbToUpdate as DatabaseObject,\n        dbToUpdate.configuration_method === ConfigurationMethod.DynamicForm, // onShow toast on SQLA Forms\n      );\n      if (dbId) {\n        setHasConnectedDb(true);\n        if (onDatabaseAdd) onDatabaseAdd();\n        dbConfigExtraExtension\n          ?.onSave(extraExtensionComponentState, db)\n          .then(({ error }: { error: any }) => {\n            if (error) {\n              dbConfigExtraExtensionOnSaveError = error;\n              addDangerToast(error);\n            }\n          });\n        if (dbConfigExtraExtensionOnSaveError) {\n          setLoading(false);\n          return;\n        }\n\n        if (useTabLayout) {\n          // tab layout only has one step\n          // so it should close immediately on save\n          onClose();\n          addSuccessToast(t('Database connected'));\n        }\n      }\n    } else {\n      // Import - doesn't use db state\n      setImportingModal(true);\n\n      if (!(fileList[0].originFileObj instanceof File)) {\n        return;\n      }\n\n      const dbId = await importResource(\n        fileList[0].originFileObj,\n        passwords,\n        sshTunnelPasswords,\n        sshTunnelPrivateKeys,\n        sshTunnelPrivateKeyPasswords,\n        confirmedOverwrite,\n      );\n      if (dbId) {\n        if (onDatabaseAdd) onDatabaseAdd();\n        onClose();\n        addSuccessToast(t('Database connected'));\n      }\n    }\n\n    setShowCTAbtns(true);\n    setEditNewDb(false);\n    setLoading(false);\n  };\n\n  // Initialize\n  const fetchDB = () => {\n    if (isEditMode && databaseId) {\n      if (!dbLoading) {\n        fetchResource(databaseId).catch(e =>\n          addDangerToast(\n            t(\n              'Sorry there was an error fetching database information: %s',\n              e.message,\n            ),\n          ),\n        );\n      }\n    }\n  };\n\n  const setDatabaseModel = (database_name: string) => {\n    if (database_name === 'Other') {\n      // Allow users to connect to DB via legacy SQLA form\n      setDB({\n        type: ActionType.DbSelected,\n        payload: {\n          database_name,\n          configuration_method: ConfigurationMethod.SqlalchemyUri,\n          engine: undefined,\n          engine_information: {\n            supports_file_upload: true,\n          },\n        },\n      });\n    } else {\n      const selectedDbModel = availableDbs?.databases.filter(\n        (db: DatabaseObject) => db.name === database_name,\n      )[0];\n      const {\n        engine,\n        parameters,\n        engine_information,\n        default_driver,\n        sqlalchemy_uri_placeholder,\n      } = selectedDbModel;\n      const isDynamic = parameters !== undefined;\n      setDB({\n        type: ActionType.DbSelected,\n        payload: {\n          database_name,\n          engine,\n          configuration_method: isDynamic\n            ? ConfigurationMethod.DynamicForm\n            : ConfigurationMethod.SqlalchemyUri,\n          engine_information,\n          driver: default_driver,\n          sqlalchemy_uri_placeholder,\n        },\n      });\n\n      if (engine === Engines.GSheet) {\n        // only create a catalog if the DB is Google Sheets\n        setDB({ type: ActionType.AddTableCatalogSheet });\n      }\n    }\n  };\n\n  const renderAvailableSelector = () => (\n    <div className=\"available\">\n      <h4 className=\"available-label\">\n        {t('Or choose from a list of other databases we support:')}\n      </h4>\n      <div className=\"control-label\">{t('Supported databases')}</div>\n      <AntdSelect\n        className=\"available-select\"\n        onChange={setDatabaseModel}\n        placeholder={t('Choose a database...')}\n        showSearch\n      >\n        {[...(availableDbs?.databases || [])]\n          ?.sort((a: DatabaseForm, b: DatabaseForm) =>\n            a.name.localeCompare(b.name),\n          )\n          .map((database: DatabaseForm, index: number) => (\n            <AntdSelect.Option value={database.name} key={`database-${index}`}>\n              {database.name}\n            </AntdSelect.Option>\n          ))}\n        {/* Allow users to connect to DB via legacy SQLA form */}\n        <AntdSelect.Option value=\"Other\" key=\"Other\">\n          {t('Other')}\n        </AntdSelect.Option>\n      </AntdSelect>\n      <Alert\n        showIcon\n        closable={false}\n        css={(theme: SupersetTheme) => antDAlertStyles(theme)}\n        type=\"info\"\n        message={\n          connectionAlert?.ADD_DATABASE?.message ||\n          t('Want to add a new database?')\n        }\n        description={\n          connectionAlert?.ADD_DATABASE ? (\n            <>\n              {t(\n                'Any databases that allow connections via SQL Alchemy URIs can be added. ',\n              )}\n              <a\n                href={connectionAlert?.ADD_DATABASE.contact_link}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                {connectionAlert?.ADD_DATABASE.contact_description_link}\n              </a>{' '}\n              {connectionAlert?.ADD_DATABASE.description}\n            </>\n          ) : (\n            <>\n              {t(\n                'Any databases that allow connections via SQL Alchemy URIs can be added. Learn about how to connect a database driver ',\n              )}\n              <a\n                href={DOCUMENTATION_LINK}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                {t('here')}\n              </a>\n              .\n            </>\n          )\n        }\n      />\n    </div>\n  );\n\n  const renderPreferredSelector = () => (\n    <div className=\"preferred\">\n      {availableDbs?.databases\n        ?.filter((db: DatabaseForm) => db.preferred)\n        .map((database: DatabaseForm) => (\n          <IconButton\n            className=\"preferred-item\"\n            onClick={() => setDatabaseModel(database.name)}\n            buttonText={database.name}\n            icon={dbImages?.[database.engine]}\n            key={`${database.name}`}\n          />\n        ))}\n    </div>\n  );\n\n  const handleBackButtonOnFinish = () => {\n    if (dbFetched) {\n      fetchResource(dbFetched.id as number);\n    }\n    setShowCTAbtns(false);\n    setEditNewDb(true);\n  };\n\n  const handleBackButtonOnConnect = () => {\n    if (editNewDb) setHasConnectedDb(false);\n    if (importingModal) setImportingModal(false);\n    if (importErrored) {\n      setImportingModal(false);\n      setImportingErrorMessage('');\n      setPasswordFields([]);\n      setSSHTunnelPasswordFields([]);\n      setSSHTunnelPrivateKeyFields([]);\n      setSSHTunnelPrivateKeyPasswordFields([]);\n      setPasswords({});\n      setSSHTunnelPasswords({});\n      setSSHTunnelPrivateKeys({});\n      setSSHTunnelPrivateKeyPasswords({});\n    }\n    setDB({ type: ActionType.Reset });\n    setFileList([]);\n  };\n\n  const handleDisableOnImport = () => {\n    if (\n      importLoading ||\n      (alreadyExists.length && !confirmedOverwrite) ||\n      (passwordsNeeded.length && JSON.stringify(passwords) === '{}') ||\n      (sshPasswordNeeded.length &&\n        JSON.stringify(sshTunnelPasswords) === '{}') ||\n      (sshPrivateKeyNeeded.length &&\n        JSON.stringify(sshTunnelPrivateKeys) === '{}') ||\n      (sshPrivateKeyPasswordNeeded.length &&\n        JSON.stringify(sshTunnelPrivateKeyPasswords) === '{}')\n    )\n      return true;\n    return false;\n  };\n\n  const renderModalFooter = () => {\n    if (db) {\n      // if db show back + connect\n      if (!hasConnectedDb || editNewDb) {\n        return (\n          <>\n            <StyledFooterButton key=\"back\" onClick={handleBackButtonOnConnect}>\n              {t('Back')}\n            </StyledFooterButton>\n            <StyledFooterButton\n              key=\"submit\"\n              buttonStyle=\"primary\"\n              onClick={onSave}\n              loading={isLoading}\n            >\n              {t('Connect')}\n            </StyledFooterButton>\n          </>\n        );\n      }\n\n      return (\n        <>\n          <StyledFooterButton key=\"back\" onClick={handleBackButtonOnFinish}>\n            {t('Back')}\n          </StyledFooterButton>\n          <StyledFooterButton\n            key=\"submit\"\n            buttonStyle=\"primary\"\n            onClick={onSave}\n            data-test=\"modal-confirm-button\"\n            loading={isLoading}\n          >\n            {t('Finish')}\n          </StyledFooterButton>\n        </>\n      );\n    }\n\n    // Import doesn't use db state, so footer will not render in the if statement above\n    if (importingModal) {\n      return (\n        <>\n          <StyledFooterButton key=\"back\" onClick={handleBackButtonOnConnect}>\n            {t('Back')}\n          </StyledFooterButton>\n          <StyledFooterButton\n            key=\"submit\"\n            buttonStyle=\"primary\"\n            onClick={onSave}\n            disabled={handleDisableOnImport()}\n            loading={isLoading}\n          >\n            {t('Connect')}\n          </StyledFooterButton>\n        </>\n      );\n    }\n\n    return <></>;\n  };\n\n  const renderEditModalFooter = (db: Partial<DatabaseObject> | null) => (\n    <>\n      <StyledFooterButton key=\"close\" onClick={onClose}>\n        {t('Close')}\n      </StyledFooterButton>\n      <StyledFooterButton\n        key=\"submit\"\n        buttonStyle=\"primary\"\n        onClick={onSave}\n        disabled={db?.is_managed_externally}\n        loading={isLoading}\n        tooltip={\n          db?.is_managed_externally\n            ? t(\n                \"This database is managed externally, and can't be edited in Superset\",\n              )\n            : ''\n        }\n      >\n        {t('Finish')}\n      </StyledFooterButton>\n    </>\n  );\n\n  const firstUpdate = useRef(true); // Captures first render\n  // Only runs when importing files don't need user input\n  useEffect(() => {\n    // Will not run on first render\n    if (firstUpdate.current) {\n      firstUpdate.current = false;\n      return;\n    }\n\n    if (\n      !importLoading &&\n      !alreadyExists.length &&\n      !passwordsNeeded.length &&\n      !sshPasswordNeeded.length &&\n      !sshPrivateKeyNeeded.length &&\n      !sshPrivateKeyPasswordNeeded.length &&\n      !isLoading && // This prevents a double toast for non-related imports\n      !importErrored // This prevents a success toast on error\n    ) {\n      onClose();\n      addSuccessToast(t('Database connected'));\n    }\n  }, [\n    alreadyExists,\n    passwordsNeeded,\n    importLoading,\n    importErrored,\n    sshPasswordNeeded,\n    sshPrivateKeyNeeded,\n    sshPrivateKeyPasswordNeeded,\n  ]);\n\n  useEffect(() => {\n    if (show) {\n      setTabKey(DEFAULT_TAB_KEY);\n      setLoading(true);\n      getAvailableDbs();\n    }\n    if (databaseId && show) {\n      fetchDB();\n    }\n  }, [show, databaseId]);\n\n  useEffect(() => {\n    if (dbFetched) {\n      setDB({\n        type: ActionType.Fetched,\n        payload: dbFetched,\n      });\n      // keep a copy of the name separate for display purposes\n      // because it shouldn't change when the form is updated\n      setDbName(dbFetched.database_name);\n    }\n  }, [dbFetched]);\n\n  useEffect(() => {\n    if (isLoading) {\n      setLoading(false);\n    }\n\n    if (availableDbs && dbEngine) {\n      // set model if passed into props\n      setDatabaseModel(dbEngine);\n    }\n  }, [availableDbs]);\n\n  // This forces the modal to scroll until the importing filename is in view\n  useEffect(() => {\n    if (importingModal) {\n      document\n        .getElementsByClassName('ant-upload-list-item-name')[0]\n        .scrollIntoView();\n    }\n  }, [importingModal]);\n\n  useEffect(() => {\n    setPasswordFields([...passwordsNeeded]);\n  }, [passwordsNeeded]);\n\n  useEffect(() => {\n    setSSHTunnelPasswordFields([...sshPasswordNeeded]);\n  }, [sshPasswordNeeded]);\n\n  useEffect(() => {\n    setSSHTunnelPrivateKeyFields([...sshPrivateKeyNeeded]);\n  }, [sshPrivateKeyNeeded]);\n\n  useEffect(() => {\n    setSSHTunnelPrivateKeyPasswordFields([...sshPrivateKeyPasswordNeeded]);\n  }, [sshPrivateKeyPasswordNeeded]);\n\n  useEffect(() => {\n    if (db?.parameters?.ssh !== undefined) {\n      setUseSSHTunneling(db.parameters.ssh);\n    }\n  }, [db?.parameters?.ssh]);\n\n  const onDbImport = async (info: UploadChangeParam) => {\n    setImportingErrorMessage('');\n    setPasswordFields([]);\n    setSSHTunnelPasswordFields([]);\n    setSSHTunnelPrivateKeyFields([]);\n    setSSHTunnelPrivateKeyPasswordFields([]);\n    setPasswords({});\n    setSSHTunnelPasswords({});\n    setSSHTunnelPrivateKeys({});\n    setSSHTunnelPrivateKeyPasswords({});\n    setImportingModal(true);\n    setFileList([\n      {\n        ...info.file,\n        status: 'done',\n      },\n    ]);\n\n    if (!(info.file.originFileObj instanceof File)) return;\n    const dbId = await importResource(\n      info.file.originFileObj,\n      passwords,\n      sshTunnelPasswords,\n      sshTunnelPrivateKeys,\n      sshTunnelPrivateKeyPasswords,\n      confirmedOverwrite,\n    );\n    if (dbId) onDatabaseAdd?.();\n  };\n\n  const passwordNeededField = () => {\n    if (\n      !passwordFields.length &&\n      !sshTunnelPasswordFields.length &&\n      !sshTunnelPrivateKeyFields.length &&\n      !sshTunnelPrivateKeyPasswordFields.length\n    )\n      return null;\n\n    const files = [\n      ...new Set([\n        ...passwordFields,\n        ...sshTunnelPasswordFields,\n        ...sshTunnelPrivateKeyFields,\n        ...sshTunnelPrivateKeyPasswordFields,\n      ]),\n    ];\n\n    return files.map(database => (\n      <>\n        <StyledAlertMargin>\n          <Alert\n            closable={false}\n            css={(theme: SupersetTheme) => antDAlertStyles(theme)}\n            type=\"info\"\n            showIcon\n            message=\"Database passwords\"\n            description={t(\n              `The passwords for the databases below are needed in order to import them. Please note that the \"Secure Extra\" and \"Certificate\" sections of the database configuration are not present in explore files and should be added manually after the import if they are needed.`,\n            )}\n          />\n        </StyledAlertMargin>\n        {passwordFields?.indexOf(database) >= 0 && (\n          <ValidatedInput\n            id=\"password_needed\"\n            name=\"password_needed\"\n            required\n            value={passwords[database]}\n            onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n              setPasswords({ ...passwords, [database]: event.target.value })\n            }\n            validationMethods={{ onBlur: () => {} }}\n            errorMessage={validationErrors?.password_needed}\n            label={t('%s PASSWORD', database.slice(10))}\n            css={formScrollableStyles}\n          />\n        )}\n        {sshTunnelPasswordFields?.indexOf(database) >= 0 && (\n          <ValidatedInput\n            id=\"ssh_tunnel_password_needed\"\n            name=\"ssh_tunnel_password_needed\"\n            required\n            value={sshTunnelPasswords[database]}\n            onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n              setSSHTunnelPasswords({\n                ...sshTunnelPasswords,\n                [database]: event.target.value,\n              })\n            }\n            validationMethods={{ onBlur: () => {} }}\n            errorMessage={validationErrors?.ssh_tunnel_password_needed}\n            label={t('%s SSH TUNNEL PASSWORD', database.slice(10))}\n            css={formScrollableStyles}\n          />\n        )}\n        {sshTunnelPrivateKeyFields?.indexOf(database) >= 0 && (\n          <ValidatedInput\n            id=\"ssh_tunnel_private_key_needed\"\n            name=\"ssh_tunnel_private_key_needed\"\n            required\n            value={sshTunnelPrivateKeys[database]}\n            onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n              setSSHTunnelPrivateKeys({\n                ...sshTunnelPrivateKeys,\n                [database]: event.target.value,\n              })\n            }\n            validationMethods={{ onBlur: () => {} }}\n            errorMessage={validationErrors?.ssh_tunnel_private_key_needed}\n            label={t('%s SSH TUNNEL PRIVATE KEY', database.slice(10))}\n            css={formScrollableStyles}\n          />\n        )}\n        {sshTunnelPrivateKeyPasswordFields?.indexOf(database) >= 0 && (\n          <ValidatedInput\n            id=\"ssh_tunnel_private_key_password_needed\"\n            name=\"ssh_tunnel_private_key_password_needed\"\n            required\n            value={sshTunnelPrivateKeyPasswords[database]}\n            onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n              setSSHTunnelPrivateKeyPasswords({\n                ...sshTunnelPrivateKeyPasswords,\n                [database]: event.target.value,\n              })\n            }\n            validationMethods={{ onBlur: () => {} }}\n            errorMessage={\n              validationErrors?.ssh_tunnel_private_key_password_needed\n            }\n            label={t('%s SSH TUNNEL PRIVATE KEY PASSWORD', database.slice(10))}\n            css={formScrollableStyles}\n          />\n        )}\n      </>\n    ));\n  };\n\n  const importingErrorAlert = () => {\n    if (!importingErrorMessage) return null;\n\n    return (\n      <StyledAlertMargin>\n        <ErrorAlert\n          errorMessage={importingErrorMessage}\n          showDbInstallInstructions={passwordFields.length > 0}\n        />\n      </StyledAlertMargin>\n    );\n  };\n\n  const confirmOverwrite = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const targetValue = (event.currentTarget?.value as string) ?? '';\n    setConfirmedOverwrite(targetValue.toUpperCase() === t('OVERWRITE'));\n  };\n\n  const confirmOverwriteField = () => {\n    if (!alreadyExists.length) return null;\n\n    return (\n      <>\n        <StyledAlertMargin>\n          <Alert\n            closable={false}\n            css={(theme: SupersetTheme) => antdWarningAlertStyles(theme)}\n            type=\"warning\"\n            showIcon\n            message=\"\"\n            description={t(\n              'You are importing one or more databases that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?',\n            )}\n          />\n        </StyledAlertMargin>\n        <ValidatedInput\n          id=\"confirm_overwrite\"\n          name=\"confirm_overwrite\"\n          required\n          validationMethods={{ onBlur: () => {} }}\n          errorMessage={validationErrors?.confirm_overwrite}\n          label={t('Type \"%s\" to confirm', t('OVERWRITE'))}\n          onChange={confirmOverwrite}\n          css={formScrollableStyles}\n        />\n      </>\n    );\n  };\n\n  const tabChange = (key: string) => setTabKey(key);\n\n  const renderStepTwoAlert = () => {\n    const { hostname } = window.location;\n    let ipAlert = connectionAlert?.REGIONAL_IPS?.default || '';\n    const regionalIPs = connectionAlert?.REGIONAL_IPS || {};\n    Object.entries(regionalIPs).forEach(([ipRegion, ipRange]) => {\n      const regex = new RegExp(ipRegion);\n      if (hostname.match(regex)) ipAlert = ipRange;\n    });\n    return (\n      db?.engine && (\n        <StyledAlertMargin>\n          <Alert\n            closable={false}\n            css={(theme: SupersetTheme) => antDAlertStyles(theme)}\n            type=\"info\"\n            showIcon\n            message={\n              engineSpecificAlertMapping[db.engine]?.message ||\n              connectionAlert?.DEFAULT?.message\n            }\n            description={\n              engineSpecificAlertMapping[db.engine]?.description ||\n              connectionAlert?.DEFAULT?.description + ipAlert\n            }\n          />\n        </StyledAlertMargin>\n      )\n    );\n  };\n\n  // eslint-disable-next-line consistent-return\n  const errorAlert = () => {\n    let alertErrors: string[] = [];\n    if (!isEmpty(dbErrors)) {\n      alertErrors =\n        typeof dbErrors === 'object'\n          ? Object.values(dbErrors)\n          : typeof dbErrors === 'string'\n            ? [dbErrors]\n            : [];\n    } else if (\n      !isEmpty(validationErrors) &&\n      validationErrors?.error_type === 'GENERIC_DB_ENGINE_ERROR'\n    ) {\n      alertErrors = [\n        validationErrors?.description || validationErrors?.message,\n      ];\n    }\n    if (alertErrors.length) {\n      return (\n        <ErrorAlertContainer>\n          <ErrorMessageWithStackTrace\n            title={t('Database Creation Error')}\n            description={t(\n              'We are unable to connect to your database. Click \"See more\" for database-provided information that may help troubleshoot the issue.',\n            )}\n            subtitle={alertErrors?.[0] || validationErrors?.description}\n            copyText={validationErrors?.description}\n          />\n        </ErrorAlertContainer>\n      );\n    }\n    return <></>;\n  };\n\n  const fetchAndSetDB = () => {\n    setLoading(true);\n    fetchResource(dbFetched?.id as number).then(r => {\n      setItem(LocalStorageKeys.Database, r);\n    });\n  };\n\n  const renderSSHTunnelForm = () => (\n    <SSHTunnelForm\n      db={db as DatabaseObject}\n      onSSHTunnelParametersChange={({ target }) => {\n        onChange(ActionType.ParametersSSHTunnelChange, {\n          type: target.type,\n          name: target.name,\n          value: target.value,\n        });\n        handleClearValidationErrors();\n      }}\n      setSSHTunnelLoginMethod={(method: AuthType) =>\n        setDB({\n          type: ActionType.SetSSHTunnelLoginMethod,\n          payload: { login_method: method },\n        })\n      }\n    />\n  );\n\n  const renderCTABtns = () => (\n    <StyledBtns>\n      <Button\n        buttonStyle=\"secondary\"\n        onClick={() => {\n          setLoading(true);\n          fetchAndSetDB();\n          redirectURL('/dataset/add/');\n        }}\n      >\n        {t('CREATE DATASET')}\n      </Button>\n      <Button\n        buttonStyle=\"secondary\"\n        onClick={() => {\n          setLoading(true);\n          fetchAndSetDB();\n          redirectURL(`/sqllab?db=true`);\n        }}\n      >\n        {t('QUERY DATA IN SQL LAB')}\n      </Button>\n    </StyledBtns>\n  );\n\n  const renderDatabaseConnectionForm = () => (\n    <>\n      <DatabaseConnectionForm\n        isEditMode={isEditMode}\n        db={db as DatabaseObject}\n        sslForced={false}\n        dbModel={dbModel}\n        onAddTableCatalog={() => {\n          setDB({ type: ActionType.AddTableCatalogSheet });\n        }}\n        onQueryChange={({ target }: { target: HTMLInputElement }) =>\n          onChange(ActionType.QueryChange, {\n            name: target.name,\n            value: target.value,\n          })\n        }\n        onExtraInputChange={({ target }: { target: HTMLInputElement }) =>\n          onChange(ActionType.ExtraInputChange, {\n            name: target.name,\n            value: target.value,\n          })\n        }\n        onRemoveTableCatalog={(idx: number) => {\n          setDB({\n            type: ActionType.RemoveTableCatalogSheet,\n            payload: { indexToDelete: idx },\n          });\n        }}\n        onParametersChange={handleParametersChange}\n        onChange={({ target }: { target: HTMLInputElement }) =>\n          onChange(ActionType.TextChange, {\n            name: target.name,\n            value: target.value,\n          })\n        }\n        getValidation={() => getValidation(db)}\n        validationErrors={validationErrors}\n        getPlaceholder={getPlaceholder}\n        clearValidationErrors={handleClearValidationErrors}\n      />\n      {useSSHTunneling && (\n        <SSHTunnelContainer>{renderSSHTunnelForm()}</SSHTunnelContainer>\n      )}\n    </>\n  );\n\n  const renderFinishState = () => {\n    if (!editNewDb) {\n      return (\n        <ExtraOptions\n          extraExtension={dbConfigExtraExtension}\n          db={db as DatabaseObject}\n          onInputChange={({ target }: { target: HTMLInputElement }) =>\n            onChange(ActionType.InputChange, {\n              type: target.type,\n              name: target.name,\n              checked: target.checked,\n              value: target.value,\n            })\n          }\n          onTextChange={({ target }: { target: HTMLTextAreaElement }) =>\n            onChange(ActionType.TextChange, {\n              name: target.name,\n              value: target.value,\n            })\n          }\n          onEditorChange={(payload: { name: string; json: any }) =>\n            onChange(ActionType.EditorChange, payload)\n          }\n          onExtraInputChange={({ target }: { target: HTMLInputElement }) => {\n            onChange(ActionType.ExtraInputChange, {\n              type: target.type,\n              name: target.name,\n              checked: target.checked,\n              value: target.value,\n            });\n          }}\n          onExtraEditorChange={(payload: { name: string; json: any }) =>\n            onChange(ActionType.ExtraEditorChange, payload)\n          }\n        />\n      );\n    }\n    return renderDatabaseConnectionForm();\n  };\n\n  if (\n    fileList.length > 0 &&\n    (alreadyExists.length ||\n      passwordFields.length ||\n      sshTunnelPasswordFields.length ||\n      sshTunnelPrivateKeyFields.length ||\n      sshTunnelPrivateKeyPasswordFields.length)\n  ) {\n    return (\n      <Modal\n        centered\n        css={(theme: SupersetTheme) => [\n          antDModalNoPaddingStyles,\n          antDModalStyles(theme),\n          formHelperStyles(theme),\n          formStyles(theme),\n        ]}\n        footer={renderModalFooter()}\n        maskClosable={false}\n        name=\"database\"\n        onHide={onClose}\n        onHandledPrimaryAction={onSave}\n        primaryButtonName={t('Connect')}\n        show={show}\n        title={<h4>{t('Connect a database')}</h4>}\n        width=\"500px\"\n      >\n        <ModalHeader\n          db={db}\n          dbName={dbName}\n          dbModel={dbModel}\n          fileList={fileList}\n          hasConnectedDb={hasConnectedDb}\n          isEditMode={isEditMode}\n          isLoading={isLoading}\n          useSqlAlchemyForm={useSqlAlchemyForm}\n        />\n        {confirmOverwriteField()}\n        {importingErrorAlert()}\n        {passwordNeededField()}\n      </Modal>\n    );\n  }\n  const modalFooter = isEditMode\n    ? renderEditModalFooter(db)\n    : renderModalFooter();\n  return useTabLayout ? (\n    <Modal\n      css={(theme: SupersetTheme) => [\n        antDTabsStyles,\n        antDModalNoPaddingStyles,\n        antDModalStyles(theme),\n        formHelperStyles(theme),\n        formStyles(theme),\n      ]}\n      name=\"database\"\n      data-test=\"database-modal\"\n      onHandledPrimaryAction={onSave}\n      onHide={onClose}\n      primaryButtonName={isEditMode ? t('Save') : t('Connect')}\n      width=\"500px\"\n      centered\n      show={show}\n      title={\n        <h4>{isEditMode ? t('Edit database') : t('Connect a database')}</h4>\n      }\n      footer={modalFooter}\n      maskClosable={false}\n    >\n      <StyledStickyHeader>\n        <TabHeader>\n          <ModalHeader\n            isLoading={isLoading}\n            isEditMode={isEditMode}\n            useSqlAlchemyForm={useSqlAlchemyForm}\n            hasConnectedDb={hasConnectedDb}\n            db={db}\n            dbName={dbName}\n            dbModel={dbModel}\n          />\n        </TabHeader>\n      </StyledStickyHeader>\n      <TabsStyled\n        defaultActiveKey={DEFAULT_TAB_KEY}\n        activeKey={tabKey}\n        onTabClick={tabChange}\n        animated={{ inkBar: true, tabPane: true }}\n      >\n        <Tabs.TabPane tab={<span>{t('Basic')}</span>} key=\"1\">\n          {useSqlAlchemyForm ? (\n            <StyledAlignment>\n              <SqlAlchemyForm\n                db={db as DatabaseObject}\n                onInputChange={({ target }: { target: HTMLInputElement }) =>\n                  onChange(ActionType.InputChange, {\n                    type: target.type,\n                    name: target.name,\n                    checked: target.checked,\n                    value: target.value,\n                  })\n                }\n                conf={conf}\n                testConnection={testConnection}\n                testInProgress={testInProgress}\n              >\n                <SSHTunnelSwitchComponent\n                  dbModel={dbModel}\n                  db={db as DatabaseObject}\n                  changeMethods={{\n                    onParametersChange: handleParametersChange,\n                  }}\n                  clearValidationErrors={handleClearValidationErrors}\n                />\n                {useSSHTunneling && renderSSHTunnelForm()}\n              </SqlAlchemyForm>\n              {isDynamic(db?.backend || db?.engine) && !isEditMode && (\n                <div css={(theme: SupersetTheme) => infoTooltip(theme)}>\n                  <Button\n                    buttonStyle=\"link\"\n                    onClick={() =>\n                      setDB({\n                        type: ActionType.ConfigMethodChange,\n                        payload: {\n                          database_name: db?.database_name,\n                          configuration_method: ConfigurationMethod.DynamicForm,\n                          engine: db?.engine,\n                        },\n                      })\n                    }\n                    css={theme => alchemyButtonLinkStyles(theme)}\n                  >\n                    {t('Connect this database using the dynamic form instead')}\n                  </Button>\n                  <InfoTooltip\n                    tooltip={t(\n                      'Click this link to switch to an alternate form that exposes only the required fields needed to connect this database.',\n                    )}\n                    viewBox=\"0 -6 24 24\"\n                  />\n                </div>\n              )}\n            </StyledAlignment>\n          ) : (\n            renderDatabaseConnectionForm()\n          )}\n          {!isEditMode && (\n            <StyledAlertMargin>\n              <Alert\n                closable={false}\n                css={(theme: SupersetTheme) => antDAlertStyles(theme)}\n                message={t('Additional fields may be required')}\n                showIcon\n                description={\n                  <>\n                    {t(\n                      'Select databases require additional fields to be completed in the Advanced tab to successfully connect the database. Learn what requirements your databases has ',\n                    )}\n                    <a\n                      href={DOCUMENTATION_LINK}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"additional-fields-alert-description\"\n                    >\n                      {t('here')}\n                    </a>\n                    .\n                  </>\n                }\n                type=\"info\"\n              />\n            </StyledAlertMargin>\n          )}\n          {showDBError && errorAlert()}\n        </Tabs.TabPane>\n        <Tabs.TabPane tab={<span>{t('Advanced')}</span>} key=\"2\">\n          <ExtraOptions\n            extraExtension={dbConfigExtraExtension}\n            db={db as DatabaseObject}\n            onInputChange={({ target }: { target: HTMLInputElement }) =>\n              onChange(ActionType.InputChange, {\n                type: target.type,\n                name: target.name,\n                checked: target.checked,\n                value: target.value,\n              })\n            }\n            onTextChange={({ target }: { target: HTMLTextAreaElement }) =>\n              onChange(ActionType.TextChange, {\n                name: target.name,\n                value: target.value,\n              })\n            }\n            onEditorChange={(payload: { name: string; json: any }) =>\n              onChange(ActionType.EditorChange, payload)\n            }\n            onExtraInputChange={({ target }: { target: HTMLInputElement }) => {\n              onChange(ActionType.ExtraInputChange, {\n                type: target.type,\n                name: target.name,\n                checked: target.checked,\n                value: target.value,\n              });\n            }}\n            onExtraEditorChange={(payload: { name: string; json: any }) => {\n              onChange(ActionType.ExtraEditorChange, payload);\n            }}\n          />\n        </Tabs.TabPane>\n      </TabsStyled>\n    </Modal>\n  ) : (\n    <Modal\n      css={(theme: SupersetTheme) => [\n        antDModalNoPaddingStyles,\n        antDModalStyles(theme),\n        formHelperStyles(theme),\n        formStyles(theme),\n      ]}\n      name=\"database\"\n      onHandledPrimaryAction={onSave}\n      onHide={onClose}\n      primaryButtonName={hasConnectedDb ? t('Finish') : t('Connect')}\n      width=\"500px\"\n      centered\n      show={show}\n      title={<h4>{t('Connect a database')}</h4>}\n      footer={renderModalFooter()}\n      maskClosable={false}\n    >\n      {!isLoading && hasConnectedDb ? (\n        <>\n          <ModalHeader\n            isLoading={isLoading}\n            isEditMode={isEditMode}\n            useSqlAlchemyForm={useSqlAlchemyForm}\n            hasConnectedDb={hasConnectedDb}\n            db={db}\n            dbName={dbName}\n            dbModel={dbModel}\n            editNewDb={editNewDb}\n          />\n          {showCTAbtns && renderCTABtns()}\n          {renderFinishState()}\n        </>\n      ) : (\n        <>\n          {/* Dynamic Form Step 1 */}\n          {!isLoading &&\n            (!db ? (\n              <SelectDatabaseStyles>\n                <ModalHeader\n                  isLoading={isLoading}\n                  isEditMode={isEditMode}\n                  useSqlAlchemyForm={useSqlAlchemyForm}\n                  hasConnectedDb={hasConnectedDb}\n                  db={db}\n                  dbName={dbName}\n                  dbModel={dbModel}\n                />\n                {renderPreferredSelector()}\n                {renderAvailableSelector()}\n                <StyledUploadWrapper>\n                  <Upload\n                    name=\"databaseFile\"\n                    id=\"databaseFile\"\n                    data-test=\"database-file-input\"\n                    accept=\".yaml,.json,.yml,.zip\"\n                    customRequest={() => {}}\n                    onChange={onDbImport}\n                    onRemove={removeFile}\n                  >\n                    <Button\n                      data-test=\"import-database-btn\"\n                      buttonStyle=\"link\"\n                      type=\"link\"\n                      css={importDbButtonLinkStyles}\n                    >\n                      {t('Import database from file')}\n                    </Button>\n                  </Upload>\n                </StyledUploadWrapper>\n                {importingErrorAlert()}\n              </SelectDatabaseStyles>\n            ) : (\n              <>\n                <ModalHeader\n                  isLoading={isLoading}\n                  isEditMode={isEditMode}\n                  useSqlAlchemyForm={useSqlAlchemyForm}\n                  hasConnectedDb={hasConnectedDb}\n                  db={db}\n                  dbName={dbName}\n                  dbModel={dbModel}\n                />\n                {hasAlert && renderStepTwoAlert()}\n                {renderDatabaseConnectionForm()}\n                <div css={(theme: SupersetTheme) => infoTooltip(theme)}>\n                  {dbModel.engine !== Engines.GSheet && (\n                    <>\n                      <Button\n                        data-test=\"sqla-connect-btn\"\n                        buttonStyle=\"link\"\n                        onClick={() =>\n                          setDB({\n                            type: ActionType.ConfigMethodChange,\n                            payload: {\n                              engine: db.engine,\n                              configuration_method:\n                                ConfigurationMethod.SqlalchemyUri,\n                              database_name: db.database_name,\n                            },\n                          })\n                        }\n                        css={buttonLinkStyles}\n                      >\n                        {t(\n                          'Connect this database with a SQLAlchemy URI string instead',\n                        )}\n                      </Button>\n                      <InfoTooltip\n                        tooltip={t(\n                          'Click this link to switch to an alternate form that allows you to input the SQLAlchemy URL for this database manually.',\n                        )}\n                        viewBox=\"0 -6 24 24\"\n                      />\n                    </>\n                  )}\n                </div>\n                {/* Step 2 */}\n                {showDBError && errorAlert()}\n              </>\n            ))}\n        </>\n      )}\n      {isLoading && <Loading />}\n    </Modal>\n  );\n};\n\nexport default withToasts(DatabaseModal);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}