{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { forwardRef, useCallback, useImperativeHandle, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Behavior, ensureIsArray, FeatureFlag, getChartMetadataRegistry, isFeatureEnabled, t, useTheme } from '@superset-ui/core';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport var ContextMenuItem;\n(function (ContextMenuItem) {\n  ContextMenuItem[ContextMenuItem[\"CrossFilter\"] = 0] = \"CrossFilter\";\n  ContextMenuItem[ContextMenuItem[\"DrillToDetail\"] = 1] = \"DrillToDetail\";\n  ContextMenuItem[ContextMenuItem[\"DrillBy\"] = 2] = \"DrillBy\";\n  ContextMenuItem[ContextMenuItem[\"All\"] = 3] = \"All\";\n})(ContextMenuItem || (ContextMenuItem = {}));\nconst ChartContextMenu = ({ id, formData, onSelection, onClose, displayedItems = ContextMenuItem.All, additionalConfig }, ref) => {var _getChartMetadataRegi, _getChartMetadataRegi2;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state) => {var _state$user;return findPermission('can_explore', 'Superset', (_state$user = state.user) == null ? void 0 : _state$user.roles);});\n  const canWriteExploreFormData = useSelector((state) => {var _state$user2;return findPermission('can_write', 'ExploreFormDataRestApi', (_state$user2 = state.user) == null ? void 0 : _state$user2.roles);});\n  const canDatasourceSamples = useSelector((state) => {var _state$user3;return findPermission('can_samples', 'Datasource', (_state$user3 = state.user) == null ? void 0 : _state$user3.roles);});\n  const canDrill = useSelector((state) => {var _state$user4;return findPermission('can_drill', 'Dashboard', (_state$user4 = state.user) == null ? void 0 : _state$user4.roles);});\n  const canDrillBy = (canExplore || canDrill) && canWriteExploreFormData;\n  const canDrillToDetail = (canExplore || canDrill) && canDatasourceSamples;\n  const crossFiltersEnabled = useSelector(({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled);\n  const isDisplayed = (item) => displayedItems === ContextMenuItem.All ||\n  ensureIsArray(displayedItems).includes(item);\n  const [{ filters, clientX, clientY }, setState] = useState({ clientX: 0, clientY: 0 });\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n  const menuItems = [];\n  const showDrillToDetail = isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n  canDrillToDetail &&\n  isDisplayed(ContextMenuItem.DrillToDetail);\n  const showDrillBy = isFeatureEnabled(FeatureFlag.DrillBy) &&\n  canDrillBy &&\n  isDisplayed(ContextMenuItem.DrillBy);\n  const showCrossFilters = isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n  isDisplayed(ContextMenuItem.CrossFilter);\n  const isCrossFilteringSupportedByChart = (_getChartMetadataRegi = getChartMetadataRegistry().\n  get(formData.viz_type)) == null ? void 0 : (_getChartMetadataRegi2 = _getChartMetadataRegi.\n  behaviors) == null ? void 0 : _getChartMetadataRegi2.includes(Behavior.InteractiveChart);\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n  if (showCrossFilters) {var _filters$crossFilter;\n    const isCrossFilterDisabled = !isCrossFilteringSupportedByChart ||\n    !crossFiltersEnabled ||\n    !(filters != null && filters.crossFilter);\n    let crossFilteringTooltipTitle = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null,\n      t('Cross-filter will be applied to all of the charts that use this dataset.')\n      ),\n      ___EmotionJSX(\"div\", null,\n      t('You can also just click on the chart to apply cross-filter.')\n      )\n      );\n    } else\n    if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null, t('Cross-filtering is not enabled for this dashboard.'))\n      );\n    } else\n    if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null,\n      t('This visualization type does not support cross-filtering.')\n      )\n      );\n    } else\n    if (!(filters != null && filters.crossFilter)) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null, t(`You can't apply cross-filter on this data point.`))\n      );\n    }\n    menuItems.push(___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Menu.Item, { key: \"cross-filtering-menu-item\", disabled: isCrossFilterDisabled, onClick: () => {\n        if (filters != null && filters.crossFilter) {\n          dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n        }\n      } },\n    filters != null && (_filters$crossFilter = filters.crossFilter) != null && _filters$crossFilter.isCurrentValueSelected ? t('Remove cross-filter') : ___EmotionJSX(\"div\", null,\n    t('Add cross-filter'),\n    ___EmotionJSX(MenuItemTooltip, { title: crossFilteringTooltipTitle, color: !isCrossFilterDisabled ?\n      theme.colors.grayscale.base :\n      undefined })\n    )\n    ),\n    itemsCount > 1 && ___EmotionJSX(Menu.Divider, null)\n    ));\n  }\n  if (showDrillToDetail) {\n    menuItems.push(___EmotionJSX(DrillDetailMenuItems, _extends({ chartId: id, formData: formData, filters: filters == null ? void 0 : filters.drillToDetail, isContextMenu: true, contextMenuY: clientY, onSelection: onSelection, submenuIndex: showCrossFilters ? 2 : 1, showModal: drillModalIsOpen, setShowModal: setDrillModalIsOpen }, (additionalConfig == null ? void 0 : additionalConfig.drillToDetail) || {})));\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(___EmotionJSX(DrillByMenuItems, _extends({ drillByConfig: filters == null ? void 0 : filters.drillBy, onSelection: onSelection, formData: formData, contextMenuY: clientY, submenuIndex: submenuIndex }, (additionalConfig == null ? void 0 : additionalConfig.drillBy) || {})));\n  }\n  const open = useCallback((clientX, clientY, filters) => {var _document$getElementB;\n    const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n    setState({\n      clientX,\n      clientY: adjustedY,\n      filters\n    });\n    // Since Ant Design's Dropdown does not offer an imperative API\n    // and we can't attach event triggers to charts SVG elements, we\n    // use a hidden span that gets clicked on when receiving click events\n    // from the charts.\n    (_document$getElementB = document.getElementById(`hidden-span-${id}`)) == null ? void 0 : _document$getElementB.click();\n  }, [id, itemsCount]);\n  useImperativeHandle(ref, () => ({\n    open\n  }), [open]);\n  return /*#__PURE__*/ReactDOM.createPortal(___EmotionJSX(Dropdown, { overlay: ___EmotionJSX(Menu, { className: \"chart-context-menu\", \"data-test\": \"chart-context-menu\" },\n    menuItems.length ? menuItems : ___EmotionJSX(Menu.Item, { disabled: true }, \"No actions\")\n    ), trigger: ['click'], onVisibleChange: (value) => !value && onClose() },\n  ___EmotionJSX(\"span\", { id: `hidden-span-${id}`, css: /*#__PURE__*/_css({\n      visibility: 'hidden',\n      position: 'fixed',\n      top: clientY,\n      left: clientX,\n      width: 1,\n      height: 1\n    }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ChartContextMenu;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3Bhd2Fuay9Eb2N1bWVudHMvZGNpbS9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvY29tcG9uZW50cy9DaGFydC9DaGFydENvbnRleHRNZW51L0NoYXJ0Q29udGV4dE1lbnUudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTRKcUMiLCJmaWxlIjoiL2hvbWUvcGF3YW5rL0RvY3VtZW50cy9kY2ltL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9jb21wb25lbnRzL0NoYXJ0L0NoYXJ0Q29udGV4dE1lbnUvQ2hhcnRDb250ZXh0TWVudS50c3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QsIHsgZm9yd2FyZFJlZiwgdXNlQ2FsbGJhY2ssIHVzZUltcGVyYXRpdmVIYW5kbGUsIHVzZVN0YXRlLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IHsgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgQmVoYXZpb3IsIGVuc3VyZUlzQXJyYXksIEZlYXR1cmVGbGFnLCBnZXRDaGFydE1ldGFkYXRhUmVnaXN0cnksIGlzRmVhdHVyZUVuYWJsZWQsIHQsIHVzZVRoZW1lLCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IGZpbmRQZXJtaXNzaW9uIH0gZnJvbSAnc3JjL3V0aWxzL2ZpbmRQZXJtaXNzaW9uJztcbmltcG9ydCB7IE1lbnUgfSBmcm9tICdzcmMvY29tcG9uZW50cy9NZW51JztcbmltcG9ydCB7IEFudGREcm9wZG93biBhcyBEcm9wZG93biB9IGZyb20gJ3NyYy9jb21wb25lbnRzL2luZGV4JztcbmltcG9ydCB7IHVwZGF0ZURhdGFNYXNrIH0gZnJvbSAnc3JjL2RhdGFNYXNrL2FjdGlvbnMnO1xuaW1wb3J0IHsgRHJpbGxEZXRhaWxNZW51SXRlbXMgfSBmcm9tICcuLi9EcmlsbERldGFpbCc7XG5pbXBvcnQgeyBnZXRNZW51QWRqdXN0ZWRZIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgTWVudUl0ZW1Ub29sdGlwIH0gZnJvbSAnLi4vRGlzYWJsZWRNZW51SXRlbVRvb2x0aXAnO1xuaW1wb3J0IHsgRHJpbGxCeU1lbnVJdGVtcyB9IGZyb20gJy4uL0RyaWxsQnkvRHJpbGxCeU1lbnVJdGVtcyc7XG5leHBvcnQgdmFyIENvbnRleHRNZW51SXRlbTtcbihmdW5jdGlvbiAoQ29udGV4dE1lbnVJdGVtKSB7XG4gICAgQ29udGV4dE1lbnVJdGVtW0NvbnRleHRNZW51SXRlbVtcIkNyb3NzRmlsdGVyXCJdID0gMF0gPSBcIkNyb3NzRmlsdGVyXCI7XG4gICAgQ29udGV4dE1lbnVJdGVtW0NvbnRleHRNZW51SXRlbVtcIkRyaWxsVG9EZXRhaWxcIl0gPSAxXSA9IFwiRHJpbGxUb0RldGFpbFwiO1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJEcmlsbEJ5XCJdID0gMl0gPSBcIkRyaWxsQnlcIjtcbiAgICBDb250ZXh0TWVudUl0ZW1bQ29udGV4dE1lbnVJdGVtW1wiQWxsXCJdID0gM10gPSBcIkFsbFwiO1xufSkoQ29udGV4dE1lbnVJdGVtIHx8IChDb250ZXh0TWVudUl0ZW0gPSB7fSkpO1xuY29uc3QgQ2hhcnRDb250ZXh0TWVudSA9ICh7IGlkLCBmb3JtRGF0YSwgb25TZWxlY3Rpb24sIG9uQ2xvc2UsIGRpc3BsYXllZEl0ZW1zID0gQ29udGV4dE1lbnVJdGVtLkFsbCwgYWRkaXRpb25hbENvbmZpZywgfSwgcmVmKSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCBjYW5FeHBsb3JlID0gdXNlU2VsZWN0b3IoKHN0YXRlKSA9PiBmaW5kUGVybWlzc2lvbignY2FuX2V4cGxvcmUnLCAnU3VwZXJzZXQnLCBzdGF0ZS51c2VyPy5yb2xlcykpO1xuICAgIGNvbnN0IGNhbldyaXRlRXhwbG9yZUZvcm1EYXRhID0gdXNlU2VsZWN0b3IoKHN0YXRlKSA9PiBmaW5kUGVybWlzc2lvbignY2FuX3dyaXRlJywgJ0V4cGxvcmVGb3JtRGF0YVJlc3RBcGknLCBzdGF0ZS51c2VyPy5yb2xlcykpO1xuICAgIGNvbnN0IGNhbkRhdGFzb3VyY2VTYW1wbGVzID0gdXNlU2VsZWN0b3IoKHN0YXRlKSA9PiBmaW5kUGVybWlzc2lvbignY2FuX3NhbXBsZXMnLCAnRGF0YXNvdXJjZScsIHN0YXRlLnVzZXI/LnJvbGVzKSk7XG4gICAgY29uc3QgY2FuRHJpbGwgPSB1c2VTZWxlY3Rvcigoc3RhdGUpID0+IGZpbmRQZXJtaXNzaW9uKCdjYW5fZHJpbGwnLCAnRGFzaGJvYXJkJywgc3RhdGUudXNlcj8ucm9sZXMpKTtcbiAgICBjb25zdCBjYW5EcmlsbEJ5ID0gKGNhbkV4cGxvcmUgfHwgY2FuRHJpbGwpICYmIGNhbldyaXRlRXhwbG9yZUZvcm1EYXRhO1xuICAgIGNvbnN0IGNhbkRyaWxsVG9EZXRhaWwgPSAoY2FuRXhwbG9yZSB8fCBjYW5EcmlsbCkgJiYgY2FuRGF0YXNvdXJjZVNhbXBsZXM7XG4gICAgY29uc3QgY3Jvc3NGaWx0ZXJzRW5hYmxlZCA9IHVzZVNlbGVjdG9yKCh7IGRhc2hib2FyZEluZm8gfSkgPT4gZGFzaGJvYXJkSW5mby5jcm9zc0ZpbHRlcnNFbmFibGVkKTtcbiAgICBjb25zdCBpc0Rpc3BsYXllZCA9IChpdGVtKSA9PiBkaXNwbGF5ZWRJdGVtcyA9PT0gQ29udGV4dE1lbnVJdGVtLkFsbCB8fFxuICAgICAgICBlbnN1cmVJc0FycmF5KGRpc3BsYXllZEl0ZW1zKS5pbmNsdWRlcyhpdGVtKTtcbiAgICBjb25zdCBbeyBmaWx0ZXJzLCBjbGllbnRYLCBjbGllbnRZIH0sIHNldFN0YXRlXSA9IHVzZVN0YXRlKHsgY2xpZW50WDogMCwgY2xpZW50WTogMCB9KTtcbiAgICBjb25zdCBbZHJpbGxNb2RhbElzT3Blbiwgc2V0RHJpbGxNb2RhbElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgbWVudUl0ZW1zID0gW107XG4gICAgY29uc3Qgc2hvd0RyaWxsVG9EZXRhaWwgPSBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRyaWxsVG9EZXRhaWwpICYmXG4gICAgICAgIGNhbkRyaWxsVG9EZXRhaWwgJiZcbiAgICAgICAgaXNEaXNwbGF5ZWQoQ29udGV4dE1lbnVJdGVtLkRyaWxsVG9EZXRhaWwpO1xuICAgIGNvbnN0IHNob3dEcmlsbEJ5ID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EcmlsbEJ5KSAmJlxuICAgICAgICBjYW5EcmlsbEJ5ICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5EcmlsbEJ5KTtcbiAgICBjb25zdCBzaG93Q3Jvc3NGaWx0ZXJzID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EYXNoYm9hcmRDcm9zc0ZpbHRlcnMpICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5Dcm9zc0ZpbHRlcik7XG4gICAgY29uc3QgaXNDcm9zc0ZpbHRlcmluZ1N1cHBvcnRlZEJ5Q2hhcnQgPSBnZXRDaGFydE1ldGFkYXRhUmVnaXN0cnkoKVxuICAgICAgICAuZ2V0KGZvcm1EYXRhLnZpel90eXBlKVxuICAgICAgICA/LmJlaGF2aW9ycz8uaW5jbHVkZXMoQmVoYXZpb3IuSW50ZXJhY3RpdmVDaGFydCk7XG4gICAgbGV0IGl0ZW1zQ291bnQgPSAwO1xuICAgIGlmIChzaG93Q3Jvc3NGaWx0ZXJzKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgKz0gMTtcbiAgICB9XG4gICAgaWYgKHNob3dEcmlsbFRvRGV0YWlsKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgKz0gMjsgLy8gRHJpbGwgdG8gZGV0YWlsIGFsd2F5cyBoYXMgMiB0b3AtbGV2ZWwgbWVudSBpdGVtc1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsQnkpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAxO1xuICAgIH1cbiAgICBpZiAoaXRlbXNDb3VudCA9PT0gMCkge1xuICAgICAgICBpdGVtc0NvdW50ID0gMTsgLy8gXCJObyBhY3Rpb25zXCIgYXBwZWFycyBpZiBubyBhY3Rpb25zIGluIG1lbnVcbiAgICB9XG4gICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgY29uc3QgaXNDcm9zc0ZpbHRlckRpc2FibGVkID0gIWlzQ3Jvc3NGaWx0ZXJpbmdTdXBwb3J0ZWRCeUNoYXJ0IHx8XG4gICAgICAgICAgICAhY3Jvc3NGaWx0ZXJzRW5hYmxlZCB8fFxuICAgICAgICAgICAgIWZpbHRlcnM/LmNyb3NzRmlsdGVyO1xuICAgICAgICBsZXQgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSBudWxsO1xuICAgICAgICBpZiAoIWlzQ3Jvc3NGaWx0ZXJEaXNhYmxlZCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAge3QoJ0Nyb3NzLWZpbHRlciB3aWxsIGJlIGFwcGxpZWQgdG8gYWxsIG9mIHRoZSBjaGFydHMgdGhhdCB1c2UgdGhpcyBkYXRhc2V0LicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnWW91IGNhbiBhbHNvIGp1c3QgY2xpY2sgb24gdGhlIGNoYXJ0IHRvIGFwcGx5IGNyb3NzLWZpbHRlci4nKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghY3Jvc3NGaWx0ZXJzRW5hYmxlZCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2Pnt0KCdDcm9zcy1maWx0ZXJpbmcgaXMgbm90IGVuYWJsZWQgZm9yIHRoaXMgZGFzaGJvYXJkLicpfTwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFpc0Nyb3NzRmlsdGVyaW5nU3VwcG9ydGVkQnlDaGFydCkge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAge3QoJ1RoaXMgdmlzdWFsaXphdGlvbiB0eXBlIGRvZXMgbm90IHN1cHBvcnQgY3Jvc3MtZmlsdGVyaW5nLicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFmaWx0ZXJzPy5jcm9zc0ZpbHRlcikge1xuICAgICAgICAgICAgY3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGUgPSAoPD5cbiAgICAgICAgICA8ZGl2Pnt0KGBZb3UgY2FuJ3QgYXBwbHkgY3Jvc3MtZmlsdGVyIG9uIHRoaXMgZGF0YSBwb2ludC5gKX08L2Rpdj5cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBtZW51SXRlbXMucHVzaCg8PlxuICAgICAgICA8TWVudS5JdGVtIGtleT1cImNyb3NzLWZpbHRlcmluZy1tZW51LWl0ZW1cIiBkaXNhYmxlZD17aXNDcm9zc0ZpbHRlckRpc2FibGVkfSBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcnM/LmNyb3NzRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHVwZGF0ZURhdGFNYXNrKGlkLCBmaWx0ZXJzLmNyb3NzRmlsdGVyLmRhdGFNYXNrKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfX0+XG4gICAgICAgICAge2ZpbHRlcnM/LmNyb3NzRmlsdGVyPy5pc0N1cnJlbnRWYWx1ZVNlbGVjdGVkID8gKHQoJ1JlbW92ZSBjcm9zcy1maWx0ZXInKSkgOiAoPGRpdj5cbiAgICAgICAgICAgICAge3QoJ0FkZCBjcm9zcy1maWx0ZXInKX1cbiAgICAgICAgICAgICAgPE1lbnVJdGVtVG9vbHRpcCB0aXRsZT17Y3Jvc3NGaWx0ZXJpbmdUb29sdGlwVGl0bGV9IGNvbG9yPXshaXNDcm9zc0ZpbHRlckRpc2FibGVkXG4gICAgICAgICAgICAgICAgICAgID8gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkfS8+XG4gICAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2l0ZW1zQ291bnQgPiAxICYmIDxNZW51LkRpdmlkZXIgLz59XG4gICAgICA8Lz4pO1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsVG9EZXRhaWwpIHtcbiAgICAgICAgbWVudUl0ZW1zLnB1c2goPERyaWxsRGV0YWlsTWVudUl0ZW1zIGNoYXJ0SWQ9e2lkfSBmb3JtRGF0YT17Zm9ybURhdGF9IGZpbHRlcnM9e2ZpbHRlcnM/LmRyaWxsVG9EZXRhaWx9IGlzQ29udGV4dE1lbnUgY29udGV4dE1lbnVZPXtjbGllbnRZfSBvblNlbGVjdGlvbj17b25TZWxlY3Rpb259IHN1Ym1lbnVJbmRleD17c2hvd0Nyb3NzRmlsdGVycyA/IDIgOiAxfSBzaG93TW9kYWw9e2RyaWxsTW9kYWxJc09wZW59IHNldFNob3dNb2RhbD17c2V0RHJpbGxNb2RhbElzT3Blbn0gey4uLihhZGRpdGlvbmFsQ29uZmlnPy5kcmlsbFRvRGV0YWlsIHx8IHt9KX0vPik7XG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxCeSkge1xuICAgICAgICBsZXQgc3VibWVudUluZGV4ID0gMDtcbiAgICAgICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgICAgIHN1Ym1lbnVJbmRleCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaG93RHJpbGxUb0RldGFpbCkge1xuICAgICAgICAgICAgc3VibWVudUluZGV4ICs9IDI7XG4gICAgICAgIH1cbiAgICAgICAgbWVudUl0ZW1zLnB1c2goPERyaWxsQnlNZW51SXRlbXMgZHJpbGxCeUNvbmZpZz17ZmlsdGVycz8uZHJpbGxCeX0gb25TZWxlY3Rpb249e29uU2VsZWN0aW9ufSBmb3JtRGF0YT17Zm9ybURhdGF9IGNvbnRleHRNZW51WT17Y2xpZW50WX0gc3VibWVudUluZGV4PXtzdWJtZW51SW5kZXh9IHsuLi4oYWRkaXRpb25hbENvbmZpZz8uZHJpbGxCeSB8fCB7fSl9Lz4pO1xuICAgIH1cbiAgICBjb25zdCBvcGVuID0gdXNlQ2FsbGJhY2soKGNsaWVudFgsIGNsaWVudFksIGZpbHRlcnMpID0+IHtcbiAgICAgICAgY29uc3QgYWRqdXN0ZWRZID0gZ2V0TWVudUFkanVzdGVkWShjbGllbnRZLCBpdGVtc0NvdW50KTtcbiAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgY2xpZW50WCxcbiAgICAgICAgICAgIGNsaWVudFk6IGFkanVzdGVkWSxcbiAgICAgICAgICAgIGZpbHRlcnMsXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBTaW5jZSBBbnQgRGVzaWduJ3MgRHJvcGRvd24gZG9lcyBub3Qgb2ZmZXIgYW4gaW1wZXJhdGl2ZSBBUElcbiAgICAgICAgLy8gYW5kIHdlIGNhbid0IGF0dGFjaCBldmVudCB0cmlnZ2VycyB0byBjaGFydHMgU1ZHIGVsZW1lbnRzLCB3ZVxuICAgICAgICAvLyB1c2UgYSBoaWRkZW4gc3BhbiB0aGF0IGdldHMgY2xpY2tlZCBvbiB3aGVuIHJlY2VpdmluZyBjbGljayBldmVudHNcbiAgICAgICAgLy8gZnJvbSB0aGUgY2hhcnRzLlxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaGlkZGVuLXNwYW4tJHtpZH1gKT8uY2xpY2soKTtcbiAgICB9LCBbaWQsIGl0ZW1zQ291bnRdKTtcbiAgICB1c2VJbXBlcmF0aXZlSGFuZGxlKHJlZiwgKCkgPT4gKHtcbiAgICAgICAgb3BlbixcbiAgICB9KSwgW29wZW5dKTtcbiAgICByZXR1cm4gUmVhY3RET00uY3JlYXRlUG9ydGFsKDxEcm9wZG93biBvdmVybGF5PXs8TWVudSBjbGFzc05hbWU9XCJjaGFydC1jb250ZXh0LW1lbnVcIiBkYXRhLXRlc3Q9XCJjaGFydC1jb250ZXh0LW1lbnVcIj5cbiAgICAgICAgICB7bWVudUl0ZW1zLmxlbmd0aCA/IChtZW51SXRlbXMpIDogKDxNZW51Lkl0ZW0gZGlzYWJsZWQ+Tm8gYWN0aW9uczwvTWVudS5JdGVtPil9XG4gICAgICAgIDwvTWVudT59IHRyaWdnZXI9e1snY2xpY2snXX0gb25WaXNpYmxlQ2hhbmdlPXt2YWx1ZSA9PiAhdmFsdWUgJiYgb25DbG9zZSgpfT5cbiAgICAgIDxzcGFuIGlkPXtgaGlkZGVuLXNwYW4tJHtpZH1gfSBjc3M9e3tcbiAgICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgICAgICB0b3A6IGNsaWVudFksXG4gICAgICAgICAgICBsZWZ0OiBjbGllbnRYLFxuICAgICAgICAgICAgd2lkdGg6IDEsXG4gICAgICAgICAgICBoZWlnaHQ6IDEsXG4gICAgICAgIH19Lz5cbiAgICA8L0Ryb3Bkb3duPiwgZG9jdW1lbnQuYm9keSk7XG59O1xuZXhwb3J0IGRlZmF1bHQgZm9yd2FyZFJlZihDaGFydENvbnRleHRNZW51KTtcbiJdfQ== */\") })\n  ), document.body);\n};__signature__(ChartContextMenu, \"useTheme{theme}\\nuseDispatch{dispatch}\\nuseSelector{canExplore}\\nuseSelector{canWriteExploreFormData}\\nuseSelector{canDatasourceSamples}\\nuseSelector{canDrill}\\nuseSelector{crossFiltersEnabled}\\nuseState{[{ filters, clientX, clientY }, setState]({ clientX: 0, clientY: 0 })}\\nuseState{[drillModalIsOpen, setDrillModalIsOpen](false)}\\nuseCallback{open}\\nuseImperativeHandle{}\", () => [useTheme, useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useImperativeHandle]);const _default = /*#__PURE__*/\nforwardRef(ChartContextMenu);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ContextMenuItem, \"ContextMenuItem\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(ChartContextMenu, \"ChartContextMenu\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","forwardRef","useCallback","useImperativeHandle","useState","ReactDOM","useDispatch","useSelector","Behavior","ensureIsArray","FeatureFlag","getChartMetadataRegistry","isFeatureEnabled","t","useTheme","findPermission","Menu","AntdDropdown","Dropdown","updateDataMask","DrillDetailMenuItems","getMenuAdjustedY","MenuItemTooltip","DrillByMenuItems","jsx","___EmotionJSX","ContextMenuItem","ChartContextMenu","id","formData","onSelection","onClose","displayedItems","All","additionalConfig","ref","_getChartMetadataRegi","_getChartMetadataRegi2","theme","dispatch","canExplore","state","_state$user","user","roles","canWriteExploreFormData","_state$user2","canDatasourceSamples","_state$user3","canDrill","_state$user4","canDrillBy","canDrillToDetail","crossFiltersEnabled","dashboardInfo","isDisplayed","item","includes","filters","clientX","clientY","setState","drillModalIsOpen","setDrillModalIsOpen","menuItems","showDrillToDetail","DrillToDetail","showDrillBy","DrillBy","showCrossFilters","DashboardCrossFilters","CrossFilter","isCrossFilteringSupportedByChart","get","viz_type","behaviors","InteractiveChart","itemsCount","_filters$crossFilter","isCrossFilterDisabled","crossFilter","crossFilteringTooltipTitle","Fragment","push","Item","key","disabled","onClick","dataMask","isCurrentValueSelected","title","color","colors","grayscale","base","undefined","Divider","_extends","chartId","drillToDetail","isContextMenu","contextMenuY","submenuIndex","showModal","setShowModal","drillByConfig","drillBy","open","_document$getElementB","adjustedY","document","getElementById","click","createPortal","overlay","className","length","trigger","onVisibleChange","value","css","_css","visibility","position","top","left","width","height","process","env","NODE_ENV","body","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  Behavior,\n  ContextMenuFilters,\n  ensureIsArray,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  isFeatureEnabled,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { RootState } from 'src/dashboard/types';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';\n\nexport enum ContextMenuItem {\n  CrossFilter,\n  DrillToDetail,\n  DrillBy,\n  All,\n}\nexport interface ChartContextMenuProps {\n  id: number;\n  formData: QueryFormData;\n  onSelection: () => void;\n  onClose: () => void;\n  additionalConfig?: {\n    crossFilter?: Record<string, any>;\n    drillToDetail?: Record<string, any>;\n    drillBy?: Record<string, any>;\n  };\n  displayedItems?: ContextMenuItem[] | ContextMenuItem;\n}\n\nexport interface ChartContextMenuRef {\n  open: (\n    clientX: number,\n    clientY: number,\n    filters?: ContextMenuFilters,\n  ) => void;\n}\n\nconst ChartContextMenu = (\n  {\n    id,\n    formData,\n    onSelection,\n    onClose,\n    displayedItems = ContextMenuItem.All,\n    additionalConfig,\n  }: ChartContextMenuProps,\n  ref: RefObject<ChartContextMenuRef>,\n) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n  const canWriteExploreFormData = useSelector((state: RootState) =>\n    findPermission('can_write', 'ExploreFormDataRestApi', state.user?.roles),\n  );\n  const canDatasourceSamples = useSelector((state: RootState) =>\n    findPermission('can_samples', 'Datasource', state.user?.roles),\n  );\n  const canDrill = useSelector((state: RootState) =>\n    findPermission('can_drill', 'Dashboard', state.user?.roles),\n  );\n  const canDrillBy = (canExplore || canDrill) && canWriteExploreFormData;\n  const canDrillToDetail = (canExplore || canDrill) && canDatasourceSamples;\n  const crossFiltersEnabled = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n  );\n\n  const isDisplayed = (item: ContextMenuItem) =>\n    displayedItems === ContextMenuItem.All ||\n    ensureIsArray(displayedItems).includes(item);\n\n  const [{ filters, clientX, clientY }, setState] = useState<{\n    clientX: number;\n    clientY: number;\n    filters?: ContextMenuFilters;\n  }>({ clientX: 0, clientY: 0 });\n\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n\n  const menuItems = [];\n\n  const showDrillToDetail =\n    isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n    canDrillToDetail &&\n    isDisplayed(ContextMenuItem.DrillToDetail);\n\n  const showDrillBy =\n    isFeatureEnabled(FeatureFlag.DrillBy) &&\n    canDrillBy &&\n    isDisplayed(ContextMenuItem.DrillBy);\n\n  const showCrossFilters =\n    isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n    isDisplayed(ContextMenuItem.CrossFilter);\n\n  const isCrossFilteringSupportedByChart = getChartMetadataRegistry()\n    .get(formData.viz_type)\n    ?.behaviors?.includes(Behavior.InteractiveChart);\n\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n\n  if (showCrossFilters) {\n    const isCrossFilterDisabled =\n      !isCrossFilteringSupportedByChart ||\n      !crossFiltersEnabled ||\n      !filters?.crossFilter;\n\n    let crossFilteringTooltipTitle: ReactNode = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t(\n              'Cross-filter will be applied to all of the charts that use this dataset.',\n            )}\n          </div>\n          <div>\n            {t('You can also just click on the chart to apply cross-filter.')}\n          </div>\n        </>\n      );\n    } else if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t('Cross-filtering is not enabled for this dashboard.')}</div>\n        </>\n      );\n    } else if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t('This visualization type does not support cross-filtering.')}\n          </div>\n        </>\n      );\n    } else if (!filters?.crossFilter) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t(`You can't apply cross-filter on this data point.`)}</div>\n        </>\n      );\n    }\n    menuItems.push(\n      <>\n        <Menu.Item\n          key=\"cross-filtering-menu-item\"\n          disabled={isCrossFilterDisabled}\n          onClick={() => {\n            if (filters?.crossFilter) {\n              dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n            }\n          }}\n        >\n          {filters?.crossFilter?.isCurrentValueSelected ? (\n            t('Remove cross-filter')\n          ) : (\n            <div>\n              {t('Add cross-filter')}\n              <MenuItemTooltip\n                title={crossFilteringTooltipTitle}\n                color={\n                  !isCrossFilterDisabled\n                    ? theme.colors.grayscale.base\n                    : undefined\n                }\n              />\n            </div>\n          )}\n        </Menu.Item>\n        {itemsCount > 1 && <Menu.Divider />}\n      </>,\n    );\n  }\n  if (showDrillToDetail) {\n    menuItems.push(\n      <DrillDetailMenuItems\n        chartId={id}\n        formData={formData}\n        filters={filters?.drillToDetail}\n        isContextMenu\n        contextMenuY={clientY}\n        onSelection={onSelection}\n        submenuIndex={showCrossFilters ? 2 : 1}\n        showModal={drillModalIsOpen}\n        setShowModal={setDrillModalIsOpen}\n        {...(additionalConfig?.drillToDetail || {})}\n      />,\n    );\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(\n      <DrillByMenuItems\n        drillByConfig={filters?.drillBy}\n        onSelection={onSelection}\n        formData={formData}\n        contextMenuY={clientY}\n        submenuIndex={submenuIndex}\n        {...(additionalConfig?.drillBy || {})}\n      />,\n    );\n  }\n\n  const open = useCallback(\n    (clientX: number, clientY: number, filters?: ContextMenuFilters) => {\n      const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n      setState({\n        clientX,\n        clientY: adjustedY,\n        filters,\n      });\n\n      // Since Ant Design's Dropdown does not offer an imperative API\n      // and we can't attach event triggers to charts SVG elements, we\n      // use a hidden span that gets clicked on when receiving click events\n      // from the charts.\n      document.getElementById(`hidden-span-${id}`)?.click();\n    },\n    [id, itemsCount],\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      open,\n    }),\n    [open],\n  );\n\n  return ReactDOM.createPortal(\n    <Dropdown\n      overlay={\n        <Menu className=\"chart-context-menu\" data-test=\"chart-context-menu\">\n          {menuItems.length ? (\n            menuItems\n          ) : (\n            <Menu.Item disabled>No actions</Menu.Item>\n          )}\n        </Menu>\n      }\n      trigger={['click']}\n      onVisibleChange={value => !value && onClose()}\n    >\n      <span\n        id={`hidden-span-${id}`}\n        css={{\n          visibility: 'hidden',\n          position: 'fixed',\n          top: clientY,\n          left: clientX,\n          width: 1,\n          height: 1,\n        }}\n      />\n    </Dropdown>,\n    document.body,\n  );\n};\n\nexport default forwardRef(ChartContextMenu);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}