{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray, t, tn } from '@superset-ui/core';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Select } from 'src/components';\nimport { FilterPluginStyle, StyledFormItem, StatusMessage } from '../common';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport default function PluginFilterTimegrain(props) {\n  const { data, formData, height, width, setDataMask, setHoveredFilter, unsetHoveredFilter, setFocusedFilter, unsetFocusedFilter, setFilterActive, filterState, inputRef } = props;\n  const { defaultValue } = formData;\n  const [value, setValue] = useState(defaultValue != null ? defaultValue : []);\n  const durationMap = useMemo(() => data.reduce((agg, { duration, name }) => ({\n    ...agg,\n    [duration]: name\n  }), {}), [JSON.stringify(data)]);\n  const handleChange = (values) => {\n    const resultValue = ensureIsArray(values);\n    const [timeGrain] = resultValue;\n    const label = timeGrain ? durationMap[timeGrain] : undefined;\n    const extraFormData = {};\n    if (timeGrain) {\n      extraFormData.time_grain_sqla = timeGrain;\n    }\n    setValue(resultValue);\n    setDataMask({\n      extraFormData,\n      filterState: {\n        label,\n        value: resultValue.length ? resultValue : null\n      }\n    });\n  };\n  useEffect(() => {\n    handleChange(defaultValue != null ? defaultValue : []);\n    // I think after Config Modal update some filter it re-creates default value for all other filters\n    // so we can process it like this `JSON.stringify` or start to use `Immer`\n  }, [JSON.stringify(defaultValue)]);\n  useEffect(() => {var _filterState$value;\n    handleChange((_filterState$value = filterState.value) != null ? _filterState$value : []);\n  }, [JSON.stringify(filterState.value)]);\n  const placeholderText = (data || []).length === 0 ?\n  t('No data') :\n  tn('%s option', '%s options', data.length, data.length);\n  const formItemData = {};\n  if (filterState.validateMessage) {\n    formItemData.extra = ___EmotionJSX(StatusMessage, { status: filterState.validateStatus },\n    filterState.validateMessage\n    );\n  }\n  const options = (data || []).map((row) => {\n    const { name, duration } = row;\n    return {\n      label: name,\n      value: duration\n    };\n  });\n  return ___EmotionJSX(FilterPluginStyle, { height: height, width: width },\n  ___EmotionJSX(StyledFormItem, _extends({ validateStatus: filterState.validateStatus }, formItemData),\n  ___EmotionJSX(Select, { allowClear: true, value: value, placeholder: placeholderText\n    // @ts-ignore\n    , onChange: handleChange, onBlur: unsetFocusedFilter, onFocus: setFocusedFilter, onMouseEnter: setHoveredFilter, onMouseLeave: unsetHoveredFilter, ref: inputRef, options: options, onDropdownVisibleChange: setFilterActive })\n  )\n  );\n}__signature__(PluginFilterTimegrain, \"useState{[value, setValue](defaultValue ?? [])}\\nuseMemo{durationMap}\\nuseEffect{}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(PluginFilterTimegrain, \"PluginFilterTimegrain\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/filters/components/TimeGrain/TimeGrainFilterPlugin.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["ensureIsArray","t","tn","React","useEffect","useMemo","useState","Select","FilterPluginStyle","StyledFormItem","StatusMessage","jsx","___EmotionJSX","PluginFilterTimegrain","props","data","formData","height","width","setDataMask","setHoveredFilter","unsetHoveredFilter","setFocusedFilter","unsetFocusedFilter","setFilterActive","filterState","inputRef","defaultValue","value","setValue","durationMap","reduce","agg","duration","name","JSON","stringify","handleChange","values","resultValue","timeGrain","label","undefined","extraFormData","time_grain_sqla","length","_filterState$value","placeholderText","formItemData","validateMessage","extra","status","validateStatus","options","map","row","_extends","allowClear","placeholder","onChange","onBlur","onFocus","onMouseEnter","onMouseLeave","ref","onDropdownVisibleChange","__signature__","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/filters/components/TimeGrain/TimeGrainFilterPlugin.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  ExtraFormData,\n  t,\n  TimeGranularity,\n  tn,\n} from '@superset-ui/core';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Select } from 'src/components';\nimport { FormItemProps } from 'antd/lib/form';\nimport { FilterPluginStyle, StyledFormItem, StatusMessage } from '../common';\nimport { PluginFilterTimeGrainProps } from './types';\n\nexport default function PluginFilterTimegrain(\n  props: PluginFilterTimeGrainProps,\n) {\n  const {\n    data,\n    formData,\n    height,\n    width,\n    setDataMask,\n    setHoveredFilter,\n    unsetHoveredFilter,\n    setFocusedFilter,\n    unsetFocusedFilter,\n    setFilterActive,\n    filterState,\n    inputRef,\n  } = props;\n  const { defaultValue } = formData;\n\n  const [value, setValue] = useState<string[]>(defaultValue ?? []);\n  const durationMap = useMemo(\n    () =>\n      data.reduce(\n        (agg, { duration, name }: { duration: string; name: string }) => ({\n          ...agg,\n          [duration]: name,\n        }),\n        {} as { [key in string]: string },\n      ),\n    [JSON.stringify(data)],\n  );\n\n  const handleChange = (values: string[] | string | undefined | null) => {\n    const resultValue: string[] = ensureIsArray<string>(values);\n    const [timeGrain] = resultValue;\n    const label = timeGrain ? durationMap[timeGrain] : undefined;\n\n    const extraFormData: ExtraFormData = {};\n    if (timeGrain) {\n      extraFormData.time_grain_sqla = timeGrain as TimeGranularity;\n    }\n    setValue(resultValue);\n    setDataMask({\n      extraFormData,\n      filterState: {\n        label,\n        value: resultValue.length ? resultValue : null,\n      },\n    });\n  };\n\n  useEffect(() => {\n    handleChange(defaultValue ?? []);\n    // I think after Config Modal update some filter it re-creates default value for all other filters\n    // so we can process it like this `JSON.stringify` or start to use `Immer`\n  }, [JSON.stringify(defaultValue)]);\n\n  useEffect(() => {\n    handleChange(filterState.value ?? []);\n  }, [JSON.stringify(filterState.value)]);\n\n  const placeholderText =\n    (data || []).length === 0\n      ? t('No data')\n      : tn('%s option', '%s options', data.length, data.length);\n\n  const formItemData: FormItemProps = {};\n  if (filterState.validateMessage) {\n    formItemData.extra = (\n      <StatusMessage status={filterState.validateStatus}>\n        {filterState.validateMessage}\n      </StatusMessage>\n    );\n  }\n\n  const options = (data || []).map(\n    (row: { name: string; duration: string }) => {\n      const { name, duration } = row;\n      return {\n        label: name,\n        value: duration,\n      };\n    },\n  );\n\n  return (\n    <FilterPluginStyle height={height} width={width}>\n      <StyledFormItem\n        validateStatus={filterState.validateStatus}\n        {...formItemData}\n      >\n        <Select\n          allowClear\n          value={value}\n          placeholder={placeholderText}\n          // @ts-ignore\n          onChange={handleChange}\n          onBlur={unsetFocusedFilter}\n          onFocus={setFocusedFilter}\n          onMouseEnter={setHoveredFilter}\n          onMouseLeave={unsetHoveredFilter}\n          ref={inputRef}\n          options={options}\n          onDropdownVisibleChange={setFilterActive}\n        />\n      </StyledFormItem>\n    </FilterPluginStyle>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}