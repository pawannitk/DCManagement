{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient, getClientErrorObject } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport withToasts from 'src/components/MessageToasts/withToasts';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nfunction isLabeledValue(arg) {\n  return arg.value !== undefined;\n}\nconst SelectAsyncControl = ({ addDangerToast, allowClear = true, ariaLabel, dataEndpoint, multi = true, mutator, onChange, placeholder, value, ...props }) => {\n  const [options, setOptions] = useState([]);\n  const handleOnChange = (val) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map((v) => isLabeledValue(v) ? v.value : v);\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n  const getValue = () => {\n    const currentValue = value || (props.default !== undefined ? props.default : undefined);\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find((o) => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n  useEffect(() => {\n    const onError = (response) => getClientErrorObject(response).then((e) => {\n      const { error } = e;\n      addDangerToast(t('Error while fetching data: %s', error));\n    });\n    const loadOptions = () => SupersetClient.get({\n      endpoint: dataEndpoint\n    }).\n    then((response) => {\n      const data = mutator ? mutator(response.json) : response.json.result;\n      setOptions(data);\n    }).\n    catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n  return ___EmotionJSX(Select, { allowClear: allowClear, ariaLabel: ariaLabel || t('Select ...'), value: getValue(), header: ___EmotionJSX(ControlHeader, props), mode: multi ? 'multiple' : 'single', onChange: handleOnChange, options: options, placeholder: placeholder });\n};__signature__(SelectAsyncControl, \"useState{[options, setOptions]([])}\\nuseEffect{}\");const _default =\nwithToasts(SelectAsyncControl);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(isLabeledValue, \"isLabeledValue\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");reactHotLoader.register(SelectAsyncControl, \"SelectAsyncControl\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useEffect","useState","t","SupersetClient","getClientErrorObject","ControlHeader","Select","withToasts","jsx","___EmotionJSX","isLabeledValue","arg","value","undefined","SelectAsyncControl","addDangerToast","allowClear","ariaLabel","dataEndpoint","multi","mutator","onChange","placeholder","props","options","setOptions","handleOnChange","val","onChangeVal","Array","isArray","values","map","v","getValue","currentValue","default","find","o","onError","response","then","e","error","loadOptions","get","endpoint","data","json","result","catch","header","mode","__signature__","_default","reactHotLoader","reactHotLoaderGlobal","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient, getClientErrorObject } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport { SelectOptionsType, SelectProps } from 'src/components/Select/types';\nimport { SelectValue, LabeledValue } from 'antd/lib/select';\nimport withToasts from 'src/components/MessageToasts/withToasts';\n\ntype SelectAsyncProps = Omit<SelectProps, 'options' | 'ariaLabel' | 'onChange'>;\n\ninterface SelectAsyncControlProps extends SelectAsyncProps {\n  addDangerToast: (error: string) => void;\n  ariaLabel?: string;\n  dataEndpoint: string;\n  default?: SelectValue;\n  mutator?: (response: Record<string, any>) => SelectOptionsType;\n  multi?: boolean;\n  onChange: (val: SelectValue) => void;\n  // ControlHeader related props\n  description?: string;\n  hovered?: boolean;\n  label?: string;\n}\n\nfunction isLabeledValue(arg: any): arg is LabeledValue {\n  return arg.value !== undefined;\n}\n\nconst SelectAsyncControl = ({\n  addDangerToast,\n  allowClear = true,\n  ariaLabel,\n  dataEndpoint,\n  multi = true,\n  mutator,\n  onChange,\n  placeholder,\n  value,\n  ...props\n}: SelectAsyncControlProps) => {\n  const [options, setOptions] = useState<SelectOptionsType>([]);\n\n  const handleOnChange = (val: SelectValue) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map(v => (isLabeledValue(v) ? v.value : v));\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n\n  const getValue = () => {\n    const currentValue =\n      value || (props.default !== undefined ? props.default : undefined);\n\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find(o => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n\n  useEffect(() => {\n    const onError = (response: Response) =>\n      getClientErrorObject(response).then(e => {\n        const { error } = e;\n        addDangerToast(t('Error while fetching data: %s', error));\n      });\n    const loadOptions = () =>\n      SupersetClient.get({\n        endpoint: dataEndpoint,\n      })\n        .then(response => {\n          const data = mutator ? mutator(response.json) : response.json.result;\n          setOptions(data);\n        })\n        .catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n\n  return (\n    <Select\n      allowClear={allowClear}\n      ariaLabel={ariaLabel || t('Select ...')}\n      value={getValue()}\n      header={<ControlHeader {...props} />}\n      mode={multi ? 'multiple' : 'single'}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default withToasts(SelectAsyncControl);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}