{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; // [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */\n\n/* eslint-disable */\n\nimport d3tip from 'd3-tip';\nimport { getContrastingColor, t } from '@superset-ui/core';\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar CalHeatMap = function () {\n  'use strict';\n\n  var self = this;\n  self.tip = d3tip().\n  attr('class', 'd3-tip').\n  direction('n').\n  offset([-5, 0]).\n  html(\n    (d) => `\n      ${self.options.timeFormatter(d.t)}: <strong>${self.options.valueFormatter(\n      d.v\n    )}</strong>\n    `\n  );\n  self.legendTip = d3tip().\n  attr('class', 'd3-tip').\n  direction('n').\n  offset([-5, 0]).\n  html((d) => self.options.valueFormatter(d));\n\n  this.allowedDataType = ['json', 'csv', 'tsv', 'txt'];\n\n  // Default settings\n  this.options = {\n    // selector string of the container to append the graph to\n    // Accept any string value accepted by document.querySelector or CSS3\n    // or an Element object\n    itemSelector: '#cal-heatmap',\n\n    // Whether to paint the calendar on init()\n    // Used by testsuite to reduce testing time\n    paintOnLoad: true,\n\n    // ================================================\n    // DOMAIN\n    // ================================================\n\n    // Number of domain to display on the graph\n    range: 12,\n\n    // Size of each cell, in pixel\n    cellSize: 10,\n\n    // Padding between each cell, in pixel\n    cellPadding: 2,\n\n    // For rounded subdomain rectangles, in pixels\n    cellRadius: 0,\n\n    domainGutter: 2,\n\n    domainMargin: [0, 0, 0, 0],\n\n    valueFormatter: (d) => d,\n\n    timeFormatter: (d) => d,\n\n    domain: 'hour',\n\n    subDomain: 'min',\n\n    // Number of columns to split the subDomains to\n    // If not null, will takes precedence over rowLimit\n    colLimit: null,\n\n    // Number of rows to split the subDomains to\n    // Will be ignored if colLimit is not null\n    rowLimit: null,\n\n    // First day of the week is Monday\n    // 0 to start the week on Sunday\n    weekStartOnMonday: true,\n\n    // Start date of the graph\n    // @default now\n    start: new Date(),\n\n    minDate: null,\n\n    maxDate: null,\n\n    // ================================================\n    // DATA\n    // ================================================\n\n    // Data source\n    // URL, where to fetch the original datas\n    data: '',\n\n    // Data type\n    // Default: json\n    dataType: this.allowedDataType[0],\n\n    // Payload sent when using POST http method\n    // Leave to null (default) for GET request\n    // Expect a string, formatted like \"a=b;c=d\"\n    dataPostPayload: null,\n\n    // Additional headers sent when requesting data\n    // Expect an object formatted like:\n    // { 'X-CSRF-TOKEN': 'token' }\n    dataRequestHeaders: null,\n\n    // Whether to consider missing date:value from the datasource\n    // as equal to 0, or just leave them as missing\n    considerMissingDataAsZero: false,\n\n    // Load remote data on calendar creation\n    // When false, the calendar will be left empty\n    loadOnInit: true,\n\n    // Calendar orientation\n    // false: display domains side by side\n    // true : display domains one under the other\n    verticalOrientation: false,\n\n    // Domain dynamic width/height\n    // The width on a domain depends on the number of\n    domainDynamicDimension: true,\n\n    // Domain Label properties\n    label: {\n      // valid: top, right, bottom, left\n      position: 'bottom',\n\n      // Valid: left, center, right\n      // Also valid are the direct svg values: start, middle, end\n      align: 'center',\n\n      // By default, there is no margin/padding around the label\n      offset: {\n        x: 0,\n        y: 0\n      },\n\n      rotate: null,\n\n      // Used only on vertical orientation\n      width: 100,\n\n      // Used only on horizontal orientation\n      height: null\n    },\n\n    // ================================================\n    // LEGEND\n    // ================================================\n\n    // Threshold for the legend\n    legend: [10, 20, 30, 40],\n\n    // Whether to display the legend\n    displayLegend: true,\n\n    legendCellSize: 10,\n\n    legendCellPadding: 2,\n\n    legendMargin: [0, 0, 0, 0],\n\n    // Legend vertical position\n    // top: place legend above calendar\n    // bottom: place legend below the calendar\n    legendVerticalPosition: 'bottom',\n\n    // Legend horizontal position\n    // accepted values: left, center, right\n    legendHorizontalPosition: 'left',\n\n    // Legend rotation\n    // accepted values: horizontal, vertical\n    legendOrientation: 'horizontal',\n\n    // Objects holding all the heatmap different colors\n    // null to disable, and use the default css styles\n    //\n    // Examples:\n    // legendColors: {\n    //    min: \"green\",\n    //    max: \"red\",\n    //    empty: \"#ffffff\",\n    //    base: \"grey\",\n    //    overflow: \"red\",\n    //    colorScaler: null,\n    // }\n    legendColors: null,\n\n    // ================================================\n    // HIGHLIGHT\n    // ================================================\n\n    // List of dates to highlight\n    // Valid values:\n    // - []: don't highlight anything\n    // - \"now\": highlight the current date\n    // - an array of Date objects: highlight the specified dates\n    highlight: [],\n\n    // ================================================\n    // TEXT FORMATTING / i18n\n    // ================================================\n\n    // Name of the items to represent in the calendar\n    itemName: ['item', 'items'],\n\n    // Formatting of the domain label\n    // @default: null, will use the formatting according to domain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    domainLabelFormat: null,\n\n    // Formatting of the title displayed when hovering a subDomain cell\n    subDomainTitleFormat: {\n      empty: '{date}',\n      filled: '{count} {name} {connector} {date}'\n    },\n\n    // Formatting of the {date} used in subDomainTitleFormat\n    // @default: null, will use the formatting according to subDomain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainDateFormat: null,\n\n    // Formatting of the text inside each subDomain cell\n    // @default: null, no text\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainTextFormat: null,\n\n    // Formatting of the title displayed when hovering a legend cell\n    legendTitleFormat: {\n      lower: t('less than {min} {name}'),\n      inner: t('between {down} and {up} {name}'),\n      upper: t('more than {max} {name}')\n    },\n\n    // Animation duration, in ms\n    animationDuration: 500,\n\n    nextSelector: false,\n\n    previousSelector: false,\n\n    itemNamespace: 'cal-heatmap',\n\n    tooltip: false,\n\n    // ================================================\n    // EVENTS CALLBACK\n    // ================================================\n\n    // Callback when clicking on a time block\n    onClick: null,\n\n    // Callback after painting the empty calendar\n    // Can be used to trigger an API call, once the calendar is ready to be filled\n    afterLoad: null,\n\n    // Callback after loading the next domain in the calendar\n    afterLoadNextDomain: null,\n\n    // Callback after loading the previous domain in the calendar\n    afterLoadPreviousDomain: null,\n\n    // Callback after finishing all actions on the calendar\n    onComplete: null,\n\n    // Callback after fetching the datas, but before applying them to the calendar\n    // Used mainly to convert the datas if they're not formatted like expected\n    // Takes the fetched \"data\" object as argument, must return a json object\n    // formatted like {timestamp:count, timestamp2:count2},\n    afterLoadData: function (timestamps) {\n      // See https://github.com/wa0x6e/cal-heatmap/issues/126#issuecomment-373301803\n      const stdTimezoneOffset = (date) => {\n        const jan = new Date(date.getFullYear(), 0, 1);\n        const jul = new Date(date.getFullYear(), 6, 1);\n        return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());\n      };\n      const offset = stdTimezoneOffset(new Date()) * 60;\n      let results = {};\n      for (let timestamp in timestamps) {\n        const value = timestamps[timestamp];\n        timestamp = parseInt(timestamp, 10);\n        results[timestamp + offset] = value;\n      }\n      return results;\n    },\n\n    // Callback triggered after calling and completing update().\n    afterUpdate: null,\n\n    // Callback triggered after calling next().\n    // The `status` argument is equal to true if there is no\n    // more next domain to load\n    //\n    // This callback is also executed once, after calling previous(),\n    // only when the max domain is reached\n    onMaxDomainReached: null,\n\n    // Callback triggered after calling previous().\n    // The `status` argument is equal to true if there is no\n    // more previous domain to load\n    //\n    // This callback is also executed once, after calling next(),\n    // only when the min domain is reached\n    onMinDomainReached: null\n  };\n\n  this._domainType = {\n    min: {\n      name: 'minute',\n      level: 10,\n      maxItemNumber: 60,\n      defaultRowNumber: 10,\n      defaultColumnNumber: 6,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMinutes() / self._domainType.min.row(d));\n        },\n        y: function (d) {\n          return d.getMinutes() % self._domainType.min.row(d);\n        }\n      },\n      format: {\n        date: '%H:%M, %A %B %-e, %Y',\n        legend: '',\n        connector: 'at'\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n          d.getMinutes()\n        ).getTime();\n      }\n    },\n    hour: {\n      name: 'hour',\n      level: 20,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 24;\n          case 'week':\n            return 24 * 7;\n          case 'month':\n            return (\n              24 * (\n              self.options.domainDynamicDimension ?\n              self.getDayCountInMonth(d) :\n              31));\n\n        }\n      },\n      defaultRowNumber: 6,\n      defaultColumnNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 4;\n          case 'week':\n            return 28;\n          case 'month':\n            return self.options.domainDynamicDimension ?\n            self.getDayCountInMonth(d) :\n            31;\n        }\n      },\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          if (self.options.domain === 'month') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + (d.getDate() - 1) * 24) /\n                self._domainType.hour.row(d)\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              (d.getDate() - 1) * 4);\n\n          } else if (self.options.domain === 'week') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + self.getWeekDay(d) * 24) /\n                self._domainType.hour.row(d)\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              self.getWeekDay(d) * 4);\n\n          }\n          return Math.floor(d.getHours() / self._domainType.hour.row(d));\n        },\n        y: function (d) {\n          var p = d.getHours();\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'month':\n                p += (d.getDate() - 1) * 24;\n                break;\n              case 'week':\n                p += self.getWeekDay(d) * 24;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.hour.row(d));\n        }\n      },\n      format: {\n        date: '%Hh, %A %B %-e, %Y',\n        legend: '%H:00',\n        connector: 'at'\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours()\n        ).getTime();\n      }\n    },\n    day: {\n      name: 'day',\n      level: 30,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'week':\n            return 7;\n          case 'month':\n            return self.options.domainDynamicDimension ?\n            self.getDayCountInMonth(d) :\n            31;\n          case 'year':\n            return self.options.domainDynamicDimension ?\n            self.getDayCountInYear(d) :\n            366;\n        }\n      },\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'week':\n            return 1;\n          case 'month':\n            return self.options.domainDynamicDimension &&\n            !self.options.verticalOrientation ?\n            self.getWeekNumber(\n              new Date(d.getFullYear(), d.getMonth() + 1, 0)\n            ) -\n            self.getWeekNumber(d) +\n            1 :\n            6;\n          case 'year':\n            return self.options.domainDynamicDimension ?\n            self.getWeekNumber(new Date(d.getFullYear(), 11, 31)) -\n            self.getWeekNumber(new Date(d.getFullYear(), 0)) +\n            1 :\n            54;\n        }\n      },\n      defaultRowNumber: 7,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'week':\n              return Math.floor(\n                self.getWeekDay(d) / self._domainType.day.row(d)\n              );\n            case 'month':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (d.getDate() - 1) / self._domainType.day.row(d)\n                );\n              }\n              return (\n                self.getWeekNumber(d) -\n                self.getWeekNumber(new Date(d.getFullYear(), d.getMonth())));\n\n            case 'year':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (self.getDayOfYear(d) - 1) / self._domainType.day.row(d)\n                );\n              }\n              return self.getWeekNumber(d);\n          }\n        },\n        y: function (d) {\n          var p = self.getWeekDay(d);\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'year':\n                p = self.getDayOfYear(d) - 1;\n                break;\n              case 'week':\n                p = self.getWeekDay(d);\n                break;\n              case 'month':\n                p = d.getDate() - 1;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.day.row(d));\n        }\n      },\n      format: {\n        date: '%A %B %-e, %Y',\n        legend: '%e %b',\n        connector: 'on'\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();\n      }\n    },\n    week: {\n      name: 'week',\n      level: 40,\n      maxItemNumber: 54,\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'year':\n            return self._domainType.week.maxItemNumber;\n          case 'month':\n            return self.options.domainDynamicDimension ?\n            self.getWeekNumber(\n              new Date(d.getFullYear(), d.getMonth() + 1, 0)\n            ) - self.getWeekNumber(d) :\n            5;\n        }\n      },\n      defaultRowNumber: 1,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'year':\n              return Math.floor(\n                self.getWeekNumber(d) / self._domainType.week.row(d)\n              );\n            case 'month':\n              return Math.floor(\n                self.getMonthWeekNumber(d) / self._domainType.week.row(d)\n              );\n          }\n        },\n        y: function (d) {\n          return self.getWeekNumber(d) % self._domainType.week.row(d);\n        }\n      },\n      format: {\n        date: '%B Week #%W',\n        legend: '%B Week #%W',\n        connector: 'in'\n      },\n      extractUnit: function (d) {\n        var dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        // According to ISO-8601, week number computation are based on week starting on Monday\n        var weekDay = dt.getDay() - (self.options.weekStartOnMonday ? 1 : 0);\n        if (weekDay < 0) {\n          weekDay = 6;\n        }\n        dt.setDate(dt.getDate() - weekDay);\n        return dt.getTime();\n      }\n    },\n    month: {\n      name: 'month',\n      level: 50,\n      maxItemNumber: 12,\n      defaultColumnNumber: 12,\n      defaultRowNumber: 1,\n      row: function () {\n        return self.getSubDomainRowNumber();\n      },\n      column: function () {\n        return self.getSubDomainColumnNumber();\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMonth() / self._domainType.month.row(d));\n        },\n        y: function (d) {\n          return d.getMonth() % self._domainType.month.row(d);\n        }\n      },\n      format: {\n        date: '%B %Y',\n        legend: '%B',\n        connector: 'in'\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth()).getTime();\n      }\n    },\n    year: {\n      name: 'year',\n      level: 60,\n      row: function () {\n        return self.options.rowLimit || 1;\n      },\n      column: function () {\n        return self.options.colLimit || 1;\n      },\n      position: {\n        x: function () {\n          return 1;\n        },\n        y: function () {\n          return 1;\n        }\n      },\n      format: {\n        date: '%Y',\n        legend: '%Y',\n        connector: 'in'\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear()).getTime();\n      }\n    }\n  };\n\n  for (var type in this._domainType) {\n    if (this._domainType.hasOwnProperty(type)) {\n      var d = this._domainType[type];\n      this._domainType['x_' + type] = {\n        name: 'x_' + type,\n        level: d.type,\n        maxItemNumber: d.maxItemNumber,\n        defaultRowNumber: d.defaultRowNumber,\n        defaultColumnNumber: d.defaultColumnNumber,\n        row: d.column,\n        column: d.row,\n        position: {\n          x: d.position.y,\n          y: d.position.x\n        },\n        format: d.format,\n        extractUnit: d.extractUnit\n      };\n    }\n  }\n\n  // Record the address of the last inserted domain when browsing\n  this.lastInsertedSvg = null;\n\n  this._completed = false;\n\n  // Record all the valid domains\n  // Each domain value is a timestamp in milliseconds\n  this._domains = d3.map();\n\n  this.graphDim = {\n    width: 0,\n    height: 0\n  };\n\n  this.legendDim = {\n    width: 0,\n    height: 0\n  };\n\n  this.NAVIGATE_LEFT = 1;\n  this.NAVIGATE_RIGHT = 2;\n\n  // Various update mode when using the update() API\n  this.RESET_ALL_ON_UPDATE = 0;\n  this.RESET_SINGLE_ON_UPDATE = 1;\n  this.APPEND_ON_UPDATE = 2;\n\n  this.DEFAULT_LEGEND_MARGIN = 10;\n\n  this.root = null;\n  this.tooltip = null;\n\n  this._maxDomainReached = false;\n  this._minDomainReached = false;\n\n  this.domainPosition = new DomainPosition();\n  this.Legend = null;\n  this.legendScale = null;\n\n  // List of domains that are skipped because of DST\n  // All times belonging to these domains should be re-assigned to the previous domain\n  this.DSTDomain = [];\n\n  /**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */\n  this._init = function () {\n    self.\n    getDomain(self.options.start).\n    map(function (d) {\n      return d.getTime();\n    }).\n    map(function (d) {\n      self._domains.set(\n        d,\n        self.getSubDomain(d).map(function (d) {\n          return {\n            t: self._domainType[self.options.subDomain].extractUnit(d),\n            v: null\n          };\n        })\n      );\n    });\n\n    self.root = d3.\n    select(self.options.itemSelector).\n    append('svg').\n    attr('class', 'cal-heatmap-container');\n\n    self.root.attr('x', 0).attr('y', 0).append('svg').attr('class', 'graph');\n\n    self.Legend = new Legend(self);\n\n    if (self.options.paintOnLoad) {\n      _initCalendar();\n    }\n    self.root.call(self.tip);\n    self.root.call(self.legendTip);\n\n    return true;\n  };\n\n  function _initCalendar() {\n    self.verticalDomainLabel =\n    self.options.label.position === 'top' ||\n    self.options.label.position === 'bottom';\n\n    self.domainVerticalLabelHeight =\n    self.options.label.height === null ?\n    Math.max(25, self.options.cellSize * 2) :\n    self.options.label.height;\n    self.domainHorizontalLabelWidth = 0;\n\n    if (\n    self.options.domainLabelFormat === '' &&\n    self.options.label.height === null)\n    {\n      self.domainVerticalLabelHeight = 0;\n    }\n\n    if (!self.verticalDomainLabel) {\n      self.domainVerticalLabelHeight = 0;\n      self.domainHorizontalLabelWidth = self.options.label.width;\n    }\n\n    self.paint();\n\n    // =========================================================================//\n    // ATTACHING DOMAIN NAVIGATION EVENT                    //\n    // =========================================================================//\n    if (self.options.nextSelector !== false) {\n      d3.select(self.options.nextSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadNextDomain(1);\n        }\n      );\n    }\n\n    if (self.options.previousSelector !== false) {\n      d3.select(self.options.previousSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadPreviousDomain(1);\n        }\n      );\n    }\n\n    self.Legend.redraw(\n      self.graphDim.width -\n      self.options.domainGutter -\n      self.options.cellPadding\n    );\n    self.afterLoad();\n\n    var domains = self.getDomainKeys();\n\n    // Fill the graph with some datas\n    if (self.options.loadOnInit) {\n      self.getDatas(\n        self.options.data,\n        new Date(domains[0]),\n        self.getSubDomain(domains[domains.length - 1]).pop(),\n        function () {\n          self.fill();\n          self.onComplete();\n        }\n      );\n    } else {\n      self.onComplete();\n    }\n\n    self.checkIfMinDomainIsReached(domains[0]);\n    self.checkIfMaxDomainIsReached(self.getNextDomain().getTime());\n  }\n\n  // Return the width of the domain block, without the domain gutter\n  // @param int d Domain start timestamp\n  function w(d, outer) {\n    var width =\n    self.options.cellSize *\n    self._domainType[self.options.subDomain].column(d) +\n    self.options.cellPadding *\n    self._domainType[self.options.subDomain].column(d);\n    if (arguments.length === 2 && outer === true) {\n      return width +=\n      self.domainHorizontalLabelWidth +\n      self.options.domainGutter +\n      self.options.domainMargin[1] +\n      self.options.domainMargin[3];\n    }\n    return width;\n  }\n\n  // Return the height of the domain block, without the domain gutter\n  function h(d, outer) {\n    var height =\n    self.options.cellSize * self._domainType[self.options.subDomain].row(d) +\n    self.options.cellPadding *\n    self._domainType[self.options.subDomain].row(d);\n    if (arguments.length === 2 && outer === true) {\n      height +=\n      self.options.domainGutter +\n      self.domainVerticalLabelHeight +\n      self.options.domainMargin[0] +\n      self.options.domainMargin[2];\n    }\n    return height;\n  }\n\n  /**\n   *\n   *\n   * @param int navigationDir\n   */\n  this.paint = function (navigationDir) {\n    var options = self.options;\n\n    if (arguments.length === 0) {\n      navigationDir = false;\n    }\n\n    // Painting all the domains\n    var domainSvg = self.root.\n    select('.graph').\n    selectAll('.graph-domain').\n    data(\n      function () {\n        var data = self.getDomainKeys();\n        return navigationDir === self.NAVIGATE_LEFT ? data.reverse() : data;\n      },\n      function (d) {\n        return d;\n      }\n    );\n    var enteringDomainDim = 0;\n    var exitingDomainDim = 0;\n\n    // =========================================================================//\n    // PAINTING DOMAIN                              //\n    // =========================================================================//\n\n    var svg = domainSvg.\n    enter().\n    append('svg').\n    attr('width', function (d) {\n      return w(d, true);\n    }).\n    attr('height', function (d) {\n      return h(d, true);\n    }).\n    attr('x', function (d) {\n      if (options.verticalOrientation) {\n        self.graphDim.width = Math.max(self.graphDim.width, w(d, true));\n        return 0;\n      } else {\n        return getDomainPosition(d, self.graphDim, 'width', w(d, true));\n      }\n    }).\n    attr('y', function (d) {\n      if (options.verticalOrientation) {\n        return getDomainPosition(d, self.graphDim, 'height', h(d, true));\n      } else {\n        self.graphDim.height = Math.max(self.graphDim.height, h(d, true));\n        return 0;\n      }\n    }).\n    attr('class', function (d) {\n      var classname = 'graph-domain';\n      var date = new Date(d);\n      switch (options.domain) {\n        case 'hour':\n          classname += ' h_' + date.getHours();\n        /* falls through */\n        case 'day':\n          classname += ' d_' + date.getDate() + ' dy_' + date.getDay();\n        /* falls through */\n        case 'week':\n          classname += ' w_' + self.getWeekNumber(date);\n        /* falls through */\n        case 'month':\n          classname += ' m_' + (date.getMonth() + 1);\n        /* falls through */\n        case 'year':\n          classname += ' y_' + date.getFullYear();\n      }\n      return classname;\n    });\n    self.lastInsertedSvg = svg;\n\n    function getDomainPosition(domainIndex, graphDim, axis, domainDim) {\n      var tmp = 0;\n      switch (navigationDir) {\n        case false:\n          tmp = graphDim[axis];\n\n          graphDim[axis] += domainDim;\n          self.domainPosition.setPosition(domainIndex, tmp);\n          return tmp;\n\n        case self.NAVIGATE_RIGHT:\n          self.domainPosition.setPosition(domainIndex, graphDim[axis]);\n\n          enteringDomainDim = domainDim;\n          exitingDomainDim = self.domainPosition.getPositionFromIndex(1);\n\n          self.domainPosition.shiftRightBy(exitingDomainDim);\n          return graphDim[axis];\n\n        case self.NAVIGATE_LEFT:\n          tmp = -domainDim;\n\n          enteringDomainDim = -tmp;\n          exitingDomainDim = graphDim[axis] - self.domainPosition.getLast();\n\n          self.domainPosition.setPosition(domainIndex, tmp);\n          self.domainPosition.shiftLeftBy(enteringDomainDim);\n          return tmp;\n      }\n    }\n\n    svg.\n    append('rect').\n    attr('width', function (d) {\n      return w(d, true) - options.domainGutter - options.cellPadding;\n    }).\n    attr('height', function (d) {\n      return h(d, true) - options.domainGutter - options.cellPadding;\n    }).\n    attr('class', 'domain-background');\n\n    // =========================================================================//\n    // PAINTING SUBDOMAINS                            //\n    // =========================================================================//\n    var subDomainSvgGroup = svg.\n    append('svg').\n    attr('x', function () {\n      if (options.label.position === 'left') {\n        return self.domainHorizontalLabelWidth + options.domainMargin[3];\n      } else {\n        return options.domainMargin[3];\n      }\n    }).\n    attr('y', function () {\n      if (options.label.position === 'top') {\n        return self.domainVerticalLabelHeight + options.domainMargin[0];\n      } else {\n        return options.domainMargin[0];\n      }\n    }).\n    attr('class', 'graph-subdomain-group');\n    var rect = subDomainSvgGroup.\n    selectAll('g').\n    data(function (d) {\n      return self._domains.get(d);\n    }).\n    enter().\n    append('g');\n    rect.\n    append('rect').\n    attr('class', function (d) {\n      return (\n        'graph-rect' +\n        self.getHighlightClassName(d.t) + (\n        options.onClick !== null ? ' hover_cursor' : ''));\n\n    }).\n    attr('width', options.cellSize).\n    attr('height', options.cellSize).\n    attr('x', function (d) {\n      return self.positionSubDomainX(d.t);\n    }).\n    attr('y', function (d) {\n      return self.positionSubDomainY(d.t);\n    }).\n    on('click', function (d) {\n      if (options.onClick !== null) {\n        return self.onClick(new Date(d.t), d.v);\n      }\n    }).\n    call(function (selection) {\n      if (options.cellRadius > 0) {\n        selection.\n        attr('rx', options.cellRadius).\n        attr('ry', options.cellRadius);\n      }\n\n      if (\n      self.legendScale !== null &&\n      options.legendColors !== null &&\n      options.legendColors.hasOwnProperty('base'))\n      {\n        selection.attr('fill', options.legendColors.base);\n      }\n\n      if (options.tooltip) {\n        selection.\n        on('mouseover', function (d) {\n          self.tip.show(d, this);\n        }).\n        on('mouseout', function () {\n          self.tip.hide(d);\n        });\n      }\n    });\n\n    // Appending a title to each subdomain\n    if (!options.tooltip) {\n      rect.append('title').text(function (d) {\n        return self.formatDate(new Date(d.t), options.subDomainDateFormat);\n      });\n    }\n\n    // =========================================================================//\n    // PAINTING LABEL                              //\n    // =========================================================================//\n    if (options.domainLabelFormat !== '') {\n      svg.\n      append('text').\n      attr('class', 'graph-label').\n      attr('y', function (d) {\n        var y = options.domainMargin[0];\n        switch (options.label.position) {\n          case 'top':\n            y += self.domainVerticalLabelHeight / 2;\n            break;\n          case 'bottom':\n            y += h(d) + self.domainVerticalLabelHeight / 2;\n        }\n\n        return (\n          y +\n          options.label.offset.y * (\n          options.label.rotate === 'right' &&\n          options.label.position === 'right' ||\n          options.label.rotate === 'left' &&\n          options.label.position === 'left' ?\n          -1 :\n          1));\n\n      }).\n      attr('x', function (d) {\n        var x = options.domainMargin[3];\n        switch (options.label.position) {\n          case 'right':\n            x += w(d);\n            break;\n          case 'bottom':\n          case 'top':\n            x += w(d) / 2;\n        }\n\n        if (options.label.align === 'right') {\n          return (\n            x +\n            self.domainHorizontalLabelWidth -\n            options.label.offset.x * (\n            options.label.rotate === 'right' ? -1 : 1));\n\n        }\n        return x + options.label.offset.x;\n      }).\n      attr('text-anchor', function () {\n        switch (options.label.align) {\n          case 'start':\n          case 'left':\n            return 'start';\n          case 'end':\n          case 'right':\n            return 'end';\n          default:\n            return 'middle';\n        }\n      }).\n      attr('dominant-baseline', function () {\n        return self.verticalDomainLabel ? 'middle' : 'top';\n      }).\n      text(function (d) {\n        return self.formatDate(new Date(d), options.domainLabelFormat);\n      }).\n      call(domainRotate);\n    }\n\n    function domainRotate(selection) {\n      switch (options.label.rotate) {\n        case 'right':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(90), ';\n            switch (options.label.position) {\n              case 'right':\n                s += 'translate(-' + w(d) + ' , -' + w(d) + ')';\n                break;\n              case 'left':\n                s += 'translate(0, -' + self.domainHorizontalLabelWidth + ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n        case 'left':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(270), ';\n            switch (options.label.position) {\n              case 'right':\n                s +=\n                'translate(-' + (\n                w(d) + self.domainHorizontalLabelWidth) +\n                ' , ' +\n                w(d) +\n                ')';\n                break;\n              case 'left':\n                s +=\n                'translate(-' +\n                self.domainHorizontalLabelWidth +\n                ' , ' +\n                self.domainHorizontalLabelWidth +\n                ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n      }\n    }\n\n    // =========================================================================//\n    // PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n    // =========================================================================//\n    if (options.subDomainTextFormat !== null) {\n      rect.\n      append('text').\n      attr('class', function (d) {\n        return 'subdomain-text' + self.getHighlightClassName(d.t);\n      }).\n      attr('x', function (d) {\n        return self.positionSubDomainX(d.t) + options.cellSize / 2;\n      }).\n      attr('y', function (d) {\n        return self.positionSubDomainY(d.t) + options.cellSize / 2;\n      }).\n      attr('text-anchor', 'middle').\n      attr('dominant-baseline', 'central').\n      text(function (d) {\n        return self.formatDate(new Date(d.t), options.subDomainTextFormat);\n      });\n    }\n\n    // =========================================================================//\n    // ANIMATION                                //\n    // =========================================================================//\n\n    if (navigationDir !== false) {\n      domainSvg.\n      transition().\n      duration(options.animationDuration).\n      attr('x', function (d) {\n        return options.verticalOrientation ?\n        0 :\n        self.domainPosition.getPosition(d);\n      }).\n      attr('y', function (d) {\n        return options.verticalOrientation ?\n        self.domainPosition.getPosition(d) :\n        0;\n      });\n    }\n\n    var tempWidth = self.graphDim.width;\n    var tempHeight = self.graphDim.height;\n\n    if (options.verticalOrientation) {\n      self.graphDim.height += enteringDomainDim - exitingDomainDim;\n    } else {\n      self.graphDim.width += enteringDomainDim - exitingDomainDim;\n    }\n\n    // At the time of exit, domainsWidth and domainsHeight already automatically shifted\n    domainSvg.\n    exit().\n    transition().\n    duration(options.animationDuration).\n    attr('x', function (d) {\n      if (options.verticalOrientation) {\n        return 0;\n      } else {\n        switch (navigationDir) {\n          case self.NAVIGATE_LEFT:\n            return Math.min(self.graphDim.width, tempWidth);\n          case self.NAVIGATE_RIGHT:\n            return -w(d, true);\n        }\n      }\n    }).\n    attr('y', function (d) {\n      if (options.verticalOrientation) {\n        switch (navigationDir) {\n          case self.NAVIGATE_LEFT:\n            return Math.min(self.graphDim.height, tempHeight);\n          case self.NAVIGATE_RIGHT:\n            return -h(d, true);\n        }\n      } else {\n        return 0;\n      }\n    }).\n    remove();\n\n    // Resize the root container\n    self.resize();\n  };\n};\n\nCalHeatMap.prototype = {\n  /**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */\n  /* jshint maxstatements:false */\n  init: function (settings) {\n    'use strict';\n\n    var parent = this;\n\n    var options = parent.options = mergeRecursive(parent.options, settings);\n\n    // Fatal errors\n    // Stop script execution on error\n    validateDomainType();\n    validateSelector(options.itemSelector, false, 'itemSelector');\n\n    if (parent.allowedDataType.indexOf(options.dataType) === -1) {\n      throw new Error(\n        \"The data type '\" + options.dataType + \"' is not valid data type\"\n      );\n    }\n\n    if (d3.select(options.itemSelector)[0][0] === null) {\n      throw new Error(\n        \"The node '\" +\n        options.itemSelector +\n        \"' specified in itemSelector does not exists\"\n      );\n    }\n\n    try {\n      validateSelector(options.nextSelector, true, 'nextSelector');\n      validateSelector(options.previousSelector, true, 'previousSelector');\n    } catch (error) {\n      console.log(error.message);\n      return false;\n    }\n\n    // If other settings contains error, will fallback to default\n\n    if (!settings.hasOwnProperty('subDomain')) {\n      this.options.subDomain = getOptimalSubDomain(settings.domain);\n    }\n\n    if (\n    typeof options.itemNamespace !== 'string' ||\n    options.itemNamespace === '')\n    {\n      console.log(\n        'itemNamespace can not be empty, falling back to cal-heatmap'\n      );\n      options.itemNamespace = 'cal-heatmap';\n    }\n\n    // Don't touch these settings\n    var s = [\n    'data',\n    'onComplete',\n    'onClick',\n    'afterLoad',\n    'afterLoadData',\n    'afterLoadPreviousDomain',\n    'afterLoadNextDomain',\n    'afterUpdate'];\n\n\n    for (var k in s) {\n      if (settings.hasOwnProperty(s[k])) {\n        options[s[k]] = settings[s[k]];\n      }\n    }\n\n    options.subDomainDateFormat =\n    typeof options.subDomainDateFormat === 'string' ||\n    typeof options.subDomainDateFormat === 'function' ?\n    options.subDomainDateFormat :\n    this._domainType[options.subDomain].format.date;\n    options.domainLabelFormat =\n    typeof options.domainLabelFormat === 'string' ||\n    typeof options.domainLabelFormat === 'function' ?\n    options.domainLabelFormat :\n    this._domainType[options.domain].format.legend;\n    options.subDomainTextFormat =\n    typeof options.subDomainTextFormat === 'string' &&\n    options.subDomainTextFormat !== '' ||\n    typeof options.subDomainTextFormat === 'function' ?\n    options.subDomainTextFormat :\n    null;\n    options.domainMargin = expandMarginSetting(options.domainMargin);\n    options.legendMargin = expandMarginSetting(options.legendMargin);\n    options.highlight = parent.expandDateSetting(options.highlight);\n    options.itemName = expandItemName(options.itemName);\n    options.colLimit = parseColLimit(options.colLimit);\n    options.rowLimit = parseRowLimit(options.rowLimit);\n    if (!settings.hasOwnProperty('legendMargin')) {\n      autoAddLegendMargin();\n    }\n    autoAlignLabel();\n\n    /**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */\n    function validateSelector(selector, canBeFalse, name) {\n      if (\n      (canBeFalse && selector === false ||\n      selector instanceof Element ||\n      typeof selector === 'string') &&\n      selector !== '')\n      {\n        return true;\n      }\n      throw new Error('The ' + name + ' is not valid');\n    }\n\n    /**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */\n    function getOptimalSubDomain(domain) {\n      switch (domain) {\n        case 'year':\n          return 'month';\n        case 'month':\n          return 'day';\n        case 'week':\n          return 'day';\n        case 'day':\n          return 'hour';\n        default:\n          return 'min';\n      }\n    }\n\n    /**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */\n    function validateDomainType() {\n      if (\n      !parent._domainType.hasOwnProperty(options.domain) ||\n      options.domain === 'min' ||\n      options.domain.substring(0, 2) === 'x_')\n      {\n        throw new Error(\"The domain '\" + options.domain + \"' is not valid\");\n      }\n\n      if (\n      !parent._domainType.hasOwnProperty(options.subDomain) ||\n      options.subDomain === 'year')\n      {\n        throw new Error(\n          \"The subDomain '\" + options.subDomain + \"' is not valid\"\n        );\n      }\n\n      if (\n      parent._domainType[options.domain].level <=\n      parent._domainType[options.subDomain].level)\n      {\n        throw new Error(\n          \"'\" +\n          options.subDomain +\n          \"' is not a valid subDomain to '\" +\n          options.domain +\n          \"'\"\n        );\n      }\n\n      return true;\n    }\n\n    /**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */\n    function autoAlignLabel() {\n      // Auto-align label, depending on it's position\n      if (\n      !settings.hasOwnProperty('label') ||\n      settings.hasOwnProperty('label') &&\n      !settings.label.hasOwnProperty('align'))\n      {\n        switch (options.label.position) {\n          case 'left':\n            options.label.align = 'right';\n            break;\n          case 'right':\n            options.label.align = 'left';\n            break;\n          default:\n            options.label.align = 'center';\n        }\n\n        if (options.label.rotate === 'left') {\n          options.label.align = 'right';\n        } else if (options.label.rotate === 'right') {\n          options.label.align = 'left';\n        }\n      }\n\n      if (\n      !settings.hasOwnProperty('label') ||\n      settings.hasOwnProperty('label') &&\n      !settings.label.hasOwnProperty('offset'))\n      {\n        if (\n        options.label.position === 'left' ||\n        options.label.position === 'right')\n        {\n          options.label.offset = {\n            x: 10,\n            y: 15\n          };\n        }\n      }\n    }\n\n    /**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */\n    function autoAddLegendMargin() {\n      switch (options.legendVerticalPosition) {\n        case 'top':\n          options.legendMargin[2] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'bottom':\n          options.legendMargin[0] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'middle':\n        case 'center':\n          options.legendMargin[\n          options.legendHorizontalPosition === 'right' ? 3 : 1] =\n          parent.DEFAULT_LEGEND_MARGIN;\n      }\n    }\n\n    /**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */\n    function expandMarginSetting(value) {\n      if (typeof value === 'number') {\n        value = [value];\n      }\n\n      if (!Array.isArray(value)) {\n        console.log('Margin only takes an integer or an array of integers');\n        value = [0];\n      }\n\n      switch (value.length) {\n        case 1:\n          return [value[0], value[0], value[0], value[0]];\n        case 2:\n          return [value[0], value[1], value[0], value[1]];\n        case 3:\n          return [value[0], value[1], value[2], value[1]];\n        case 4:\n          return value;\n        default:\n          return value.slice(0, 4);\n      }\n    }\n\n    /**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */\n    function expandItemName(value) {\n      if (typeof value === 'string') {\n        return [value, value + (value !== '' ? 's' : '')];\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 1) {\n          return [value[0], value[0] + 's'];\n        } else if (value.length > 2) {\n          return value.slice(0, 2);\n        }\n\n        return value;\n      }\n\n      return ['item', 'items'];\n    }\n\n    function parseColLimit(value) {\n      return value > 0 ? value : null;\n    }\n\n    function parseRowLimit(value) {\n      if (value > 0 && options.colLimit > 0) {\n        console.log(\n          'colLimit and rowLimit are mutually exclusive, rowLimit will be ignored'\n        );\n        return null;\n      }\n      return value > 0 ? value : null;\n    }\n\n    return this._init();\n  },\n\n  /**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */\n  expandDateSetting: function (value) {\n    'use strict';\n\n    if (!Array.isArray(value)) {\n      value = [value];\n    }\n\n    return value.\n    map(function (data) {\n      if (data === 'now') {\n        return new Date();\n      }\n      if (data instanceof Date) {\n        return data;\n      }\n      return false;\n    }).\n    filter(function (d) {\n      return d !== false;\n    });\n  },\n\n  /**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It's used to limit the painting to only a subset of the calendar\n   * @return void\n   */\n  fill: function (svg) {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n\n    if (arguments.length === 0) {\n      svg = parent.root.selectAll('.graph-domain');\n    }\n\n    var rect = svg.\n    selectAll('svg').\n    selectAll('g').\n    data(function (d) {\n      return parent._domains.get(d);\n    });\n    /**\n     * Colorize the cell via a style attribute if enabled\n     */\n    function addStyle(element) {\n      if (parent.legendScale === null) {\n        return false;\n      }\n\n      element.attr('fill', function (d) {\n        if (\n        d.v === null &&\n        options.hasOwnProperty('considerMissingDataAsZero') &&\n        !options.considerMissingDataAsZero)\n        {\n          if (options.legendColors.hasOwnProperty('base')) {\n            return options.legendColors.base;\n          }\n        }\n\n        if (\n        options.legendColors !== null &&\n        options.legendColors.hasOwnProperty('empty') && (\n        d.v === 0 ||\n        d.v === null &&\n        options.hasOwnProperty('considerMissingDataAsZero') &&\n        options.considerMissingDataAsZero))\n        {\n          return options.legendColors.empty;\n        }\n\n        if (\n        d.v < 0 &&\n        options.legend[0] > 0 &&\n        options.legendColors !== null &&\n        options.legendColors.hasOwnProperty('overflow'))\n        {\n          return options.legendColors.overflow;\n        }\n\n        return parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1])\n        );\n      });\n    }\n\n    rect.\n    transition().\n    duration(options.animationDuration).\n    select('rect').\n    attr('class', function (d) {\n      var htmlClass = parent.getHighlightClassName(d.t).trim().split(' ');\n      var pastDate = parent.dateIsLessThan(d.t, new Date());\n      var sameDate = parent.dateIsEqual(d.t, new Date());\n\n      if (\n      parent.legendScale === null ||\n      d.v === null &&\n      options.hasOwnProperty('considerMissingDataAsZero') &&\n      !options.considerMissingDataAsZero &&\n      !options.legendColors.hasOwnProperty('base'))\n      {\n        htmlClass.push('graph-rect');\n      }\n\n      if (sameDate) {\n        htmlClass.push('now');\n      } else if (!pastDate) {\n        htmlClass.push('future');\n      }\n\n      if (d.v !== null) {\n        htmlClass.push(\n          parent.Legend.getClass(d.v, parent.legendScale === null)\n        );\n      } else if (options.considerMissingDataAsZero && pastDate) {\n        htmlClass.push(\n          parent.Legend.getClass(0, parent.legendScale === null)\n        );\n      }\n\n      if (options.onClick !== null) {\n        htmlClass.push('hover_cursor');\n      }\n\n      return htmlClass.join(' ');\n    }).\n    call(addStyle);\n\n    rect.\n    transition().\n    duration(options.animationDuration).\n    select('title').\n    text(function (d) {\n      return parent.getSubDomainTitle(d);\n    });\n\n    function formatSubDomainText(element) {\n      if (typeof options.subDomainTextFormat === 'function') {\n        element.text(function (d) {\n          return options.subDomainTextFormat(d.t, d.v);\n        });\n      }\n    }\n\n    /**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */\n    rect.\n    transition().\n    duration(options.animationDuration).\n    select('text').\n    attr('class', function (d) {\n      return 'subdomain-text' + parent.getHighlightClassName(d.t);\n    }).\n    call(formatSubDomainText).\n    attr('fill', (d) => {\n      if (!d.v) return '#000';\n      const rgb = parent.legendScale(\n        Math.min(d.v, options.legend[options.legend.length - 1])\n      );\n      return getContrastingColor(rgb, 135);\n    });\n  },\n\n  /**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */\n  formatStringWithObject: function (formatted, args) {\n    'use strict';\n    for (var prop in args) {\n      if (args.hasOwnProperty(prop)) {\n        var regexp = new RegExp('\\\\{' + prop + '\\\\}', 'gi');\n        formatted = formatted.replace(regexp, args[prop]);\n      }\n    }\n    return formatted;\n  },\n\n  // =========================================================================//\n  // EVENTS CALLBACK                              //\n  // =========================================================================//\n\n  /**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */\n  triggerEvent: function (eventName, successArgs, skip) {\n    'use strict';\n\n    if (arguments.length === 3 && skip || this.options[eventName] === null) {\n      return true;\n    }\n\n    if (typeof this.options[eventName] === 'function') {\n      if (typeof successArgs === 'function') {\n        successArgs = successArgs();\n      }\n      return this.options[eventName].apply(this, successArgs);\n    } else {\n      console.log('Provided callback for ' + eventName + ' is not a function.');\n      return false;\n    }\n  },\n\n  /**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */\n  onClick: function (d, itemNb) {\n    'use strict';\n\n    return this.triggerEvent('onClick', [d, itemNb]);\n  },\n\n  /**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */\n  afterLoad: function () {\n    'use strict';\n\n    return this.triggerEvent('afterLoad');\n  },\n\n  /**\n   * Event triggered after completing drawing and filling the calendar\n   */\n  onComplete: function () {\n    'use strict';\n\n    var response = this.triggerEvent('onComplete', [], this._completed);\n    this._completed = true;\n    return response;\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadPreviousDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadPreviousDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadNextDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadNextDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */\n  onMinDomainReached: function (reached) {\n    'use strict';\n\n    this._minDomainReached = reached;\n    return this.triggerEvent('onMinDomainReached', [reached]);\n  },\n\n  /**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */\n  onMaxDomainReached: function (reached) {\n    'use strict';\n\n    this._maxDomainReached = reached;\n    return this.triggerEvent('onMaxDomainReached', [reached]);\n  },\n\n  checkIfMinDomainIsReached: function (date, upperBound) {\n    'use strict';\n\n    if (this.minDomainIsReached(date)) {\n      this.onMinDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._maxDomainReached && !this.maxDomainIsReached(upperBound)) {\n        this.onMaxDomainReached(false);\n      }\n    }\n  },\n\n  checkIfMaxDomainIsReached: function (date, lowerBound) {\n    'use strict';\n\n    if (this.maxDomainIsReached(date)) {\n      this.onMaxDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._minDomainReached && !this.minDomainIsReached(lowerBound)) {\n        this.onMinDomainReached(false);\n      }\n    }\n  },\n\n  afterUpdate: function () {\n    'use strict';\n\n    return this.triggerEvent('afterUpdate');\n  },\n\n  // =========================================================================//\n  // FORMATTER                                //\n  // =========================================================================//\n\n  formatNumber: d3.format(',g'),\n\n  formatDate: function (d, format) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      format = 'title';\n    }\n\n    if (typeof format === 'function') {\n      return format(d);\n    } else {\n      var f = d3.time.format(format);\n      return f(d);\n    }\n  },\n\n  getSubDomainTitle: function (d) {\n    'use strict';\n\n    if (d.v === null && !this.options.considerMissingDataAsZero) {\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.empty,\n        {\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat\n          )\n        }\n      );\n    } else {\n      var value = d.v;\n      // Consider null as 0\n      if (value === null && this.options.considerMissingDataAsZero) {\n        value = 0;\n      }\n\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.filled,\n        {\n          count: this.formatNumber(value),\n          name: this.options.itemName[value !== 1 ? 1 : 0],\n          connector: this._domainType[this.options.subDomain].format.connector,\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat\n          )\n        }\n      );\n    }\n  },\n\n  // =========================================================================//\n  // DOMAIN NAVIGATION                            //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it's not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */\n  loadNextDomain: function (n) {\n    'use strict';\n\n    if (this._maxDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_RIGHT,\n      this.getDomain(this.getNextDomain(), n)\n    );\n\n    this.afterLoadNextDomain(bound.end);\n    this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(), bound.start);\n\n    return true;\n  },\n\n  /**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it's not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */\n  loadPreviousDomain: function (n) {\n    'use strict';\n\n    if (this._minDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_LEFT,\n      this.getDomain(this.getDomainKeys()[0], -n).reverse()\n    );\n\n    this.afterLoadPreviousDomain(bound.start);\n    this.checkIfMinDomainIsReached(bound.start, bound.end);\n\n    return true;\n  },\n\n  loadNewDomains: function (direction, newDomains) {\n    'use strict';\n\n    var parent = this;\n    var backward = direction === this.NAVIGATE_LEFT;\n    var i = -1;\n    var total = newDomains.length;\n    var domains = this.getDomainKeys();\n\n    function buildSubDomain(d) {\n      return {\n        t: parent._domainType[parent.options.subDomain].extractUnit(d),\n        v: null\n      };\n    }\n\n    // Remove out of bound domains from list of new domains to prepend\n    while (++i < total) {\n      if (backward && this.minDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i + 1);\n        break;\n      }\n      if (!backward && this.maxDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i);\n        break;\n      }\n    }\n\n    newDomains = newDomains.slice(-this.options.range);\n\n    for (i = 0, total = newDomains.length; i < total; i += 1) {\n      this._domains.set(\n        newDomains[i].getTime(),\n        this.getSubDomain(newDomains[i]).map(buildSubDomain)\n      );\n\n      this._domains.remove(backward ? domains.pop() : domains.shift());\n    }\n\n    domains = this.getDomainKeys();\n\n    if (backward) {\n      newDomains = newDomains.reverse();\n    }\n\n    this.paint(direction);\n\n    this.getDatas(\n      this.options.data,\n      newDomains[0],\n      this.getSubDomain(newDomains[newDomains.length - 1]).pop(),\n      function () {\n        parent.fill(parent.lastInsertedSvg);\n      }\n    );\n\n    return {\n      start: newDomains[backward ? 0 : 1],\n      end: domains[domains.length - 1]\n    };\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */\n  maxDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.maxDate !== null &&\n      this.options.maxDate.getTime() < datetimestamp);\n\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */\n  minDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.minDate !== null &&\n      this.options.minDate.getTime() >= datetimestamp);\n\n  },\n\n  /**\n   * Return the list of the calendar's domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */\n  getDomainKeys: function () {\n    'use strict';\n\n    return this._domains.\n    keys().\n    map(function (d) {\n      return parseInt(d, 10);\n    }).\n    sort(function (a, b) {\n      return a - b;\n    });\n  },\n\n  // =========================================================================//\n  // POSITIONNING                                //\n  // =========================================================================//\n\n  positionSubDomainX: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.x(\n      new Date(d)\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  positionSubDomainY: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.y(\n      new Date(d)\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  getSubDomainColumnNumber: function (d) {\n    'use strict';\n\n    if (this.options.rowLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.rowLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultColumnNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.colLimit || j;\n  },\n\n  getSubDomainRowNumber: function (d) {\n    'use strict';\n\n    if (this.options.colLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.colLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultRowNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.rowLimit || j;\n  },\n\n  /**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */\n  getHighlightClassName: function (d) {\n    'use strict';\n\n    d = new Date(d);\n\n    if (this.options.highlight.length > 0) {\n      for (var i in this.options.highlight) {\n        if (this.dateIsEqual(this.options.highlight[i], d)) {\n          return this.isNow(this.options.highlight[i]) ?\n          ' highlight-now' :\n          ' highlight';\n        }\n      }\n    }\n    return '';\n  },\n\n  /**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */\n  isNow: function (d) {\n    'use strict';\n\n    return this.dateIsEqual(d, new Date());\n  },\n\n  /**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */\n  /* jshint maxcomplexity: false */\n  dateIsEqual: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours() &&\n          dateA.getMinutes() === dateB.getMinutes());\n\n      case 'x_hour':\n      case 'hour':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours());\n\n      case 'x_day':\n      case 'day':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate());\n\n      case 'x_week':\n      case 'week':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          this.getWeekNumber(dateA) === this.getWeekNumber(dateB));\n\n      case 'x_month':\n      case 'month':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth());\n\n      default:\n        return false;\n    }\n  },\n\n  /**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */\n  dateIsLessThan: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    function normalizedMillis(date, subdomain) {\n      switch (subdomain) {\n        case 'x_min':\n        case 'min':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n            date.getMinutes()\n          ).getTime();\n        case 'x_hour':\n        case 'hour':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours()\n          ).getTime();\n        case 'x_day':\n        case 'day':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate()\n          ).getTime();\n        case 'x_week':\n        case 'week':\n        case 'x_month':\n        case 'month':\n          return new Date(date.getFullYear(), date.getMonth()).getTime();\n        default:\n          return date.getTime();\n      }\n    }\n\n    return (\n      normalizedMillis(dateA, this.options.subDomain) <\n      normalizedMillis(dateB, this.options.subDomain));\n\n  },\n\n  // =========================================================================//\n  // DATE COMPUTATION                              //\n  // =========================================================================//\n\n  /**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */\n  getDayOfYear: d3.time.format('%j'),\n\n  /**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */\n  getWeekNumber: function (d) {\n    'use strict';\n\n    var f =\n    this.options.weekStartOnMonday === true ?\n    d3.time.format('%W') :\n    d3.time.format('%U');\n    return f(d);\n  },\n\n  /**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */\n  getMonthWeekNumber: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n\n    var monthFirstWeekNumber = this.getWeekNumber(\n      new Date(d.getFullYear(), d.getMonth())\n    );\n    return this.getWeekNumber(d) - monthFirstWeekNumber - 1;\n  },\n\n  /**\n   * Return the number of weeks in the dates' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date's year\n   */\n  getWeekNumberInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n  },\n\n  /**\n   * Return the number of days in the date's month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's month\n   */\n  getDayCountInMonth: function (d) {\n    'use strict';\n\n    return this.getEndOfMonth(d).getDate();\n  },\n\n  /**\n   * Return the number of days in the date's year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's year\n   */\n  getDayCountInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), 1, 29).getMonth() === 1 ? 366 : 365;\n  },\n\n  /**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */\n  getWeekDay: function (d) {\n    'use strict';\n\n    if (this.options.weekStartOnMonday === false) {\n      return d.getDay();\n    }\n    return d.getDay() === 0 ? 6 : d.getDay() - 1;\n  },\n\n  /**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */\n  getEndOfMonth: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), d.getMonth() + 1, 0);\n  },\n\n  /**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */\n  jumpDate: function (date, count, step) {\n    'use strict';\n\n    var d = new Date(date);\n    switch (step) {\n      case 'hour':\n        d.setHours(d.getHours() + count);\n        break;\n      case 'day':\n        d.setHours(d.getHours() + count * 24);\n        break;\n      case 'week':\n        d.setHours(d.getHours() + count * 24 * 7);\n        break;\n      case 'month':\n        d.setMonth(d.getMonth() + count);\n        break;\n      case 'year':\n        d.setFullYear(d.getFullYear() + count);\n    }\n\n    return new Date(d);\n  },\n\n  // =========================================================================//\n  // DOMAIN COMPUTATION                            //\n  // =========================================================================//\n\n  /**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */\n  getMinuteDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours()\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours()\n      );\n    } else {\n      stop = new Date(+start + range * 1000 * 60);\n    }\n    return d3.time.minutes(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getHourDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours()\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours()\n      );\n    } else {\n      stop = new Date(start);\n      stop.setHours(stop.getHours() + range);\n    }\n\n    var domains = d3.time.hours(Math.min(start, stop), Math.max(start, stop));\n\n    // Passing from DST to standard time\n    // If there are 25 hours, let's compress the duplicate hours\n    var i = 0;\n    var total = domains.length;\n    for (i = 0; i < total; i += 1) {\n      if (i > 0 && domains[i].getHours() === domains[i - 1].getHours()) {\n        this.DSTDomain.push(domains[i].getTime());\n        domains.splice(i, 1);\n        break;\n      }\n    }\n\n    // d3.time.hours is returning more hours than needed when changing\n    // from DST to standard time, because there is really 2 hours between\n    // 1am and 2am!\n    if (typeof range === 'number' && domains.length > Math.abs(range)) {\n      domains.splice(domains.length - 1, 1);\n    }\n\n    return domains;\n  },\n\n  /**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getDayDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth(), range.getDate());\n    } else {\n      stop = new Date(start);\n      stop = new Date(stop.setDate(stop.getDate() + parseInt(range, 10)));\n    }\n\n    return d3.time.days(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getWeekDomain: function (d, range) {\n    'use strict';\n\n    var weekStart;\n\n    if (this.options.weekStartOnMonday === false) {\n      weekStart = new Date(\n        d.getFullYear(),\n        d.getMonth(),\n        d.getDate() - d.getDay()\n      );\n    } else {\n      if (d.getDay() === 1) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n      } else if (d.getDay() === 0) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        weekStart.setDate(weekStart.getDate() - 6);\n      } else {\n        weekStart = new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate() - d.getDay() + 1\n        );\n      }\n    }\n\n    var endDate = new Date(weekStart);\n\n    var stop = range;\n    if (typeof range !== 'object') {\n      stop = new Date(endDate.setDate(endDate.getDate() + range * 7));\n    }\n\n    return this.options.weekStartOnMonday === true ?\n    d3.time.mondays(Math.min(weekStart, stop), Math.max(weekStart, stop)) :\n    d3.time.sundays(Math.min(weekStart, stop), Math.max(weekStart, stop));\n  },\n\n  /**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */\n  getMonthDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth());\n    } else {\n      stop = new Date(start);\n      stop = stop.setMonth(stop.getMonth() + range);\n    }\n\n    return d3.time.months(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getYearDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), 0);\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), 0);\n    } else {\n      stop = new Date(d.getFullYear() + range, 0);\n    }\n\n    return d3.time.years(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */\n  getDomain: function (date, range) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    if (arguments.length < 2) {\n      range = this.options.range;\n    }\n\n    switch (this.options.domain) {\n      case 'hour':\n        var domains = this.getHourDomain(date, range);\n\n        // Case where an hour is missing, when passing from standard time to DST\n        // Missing hour is perfectly acceptabl in subDomain, but not in domains\n        if (typeof range === 'number' && domains.length < range) {\n          if (range > 0) {\n            domains.push(this.getHourDomain(domains[domains.length - 1], 2)[1]);\n          } else {\n            domains.shift(this.getHourDomain(domains[0], -2)[0]);\n          }\n        }\n        return domains;\n      case 'day':\n        return this.getDayDomain(date, range);\n      case 'week':\n        return this.getWeekDomain(date, range);\n      case 'month':\n        return this.getMonthDomain(date, range);\n      case 'year':\n        return this.getYearDomain(date, range);\n    }\n  },\n\n  /* jshint maxcomplexity: false */\n  getSubDomain: function (date) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    var parent = this;\n\n    /**\n     * @return int\n     */\n    var computeDaySubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'year':\n          return parent.getDayCountInYear(date);\n        case 'month':\n          return parent.getDayCountInMonth(date);\n        case 'week':\n          return 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeMinSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'hour':\n          return 60;\n        case 'day':\n          return 60 * 24;\n        case 'week':\n          return 60 * 24 * 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeHourSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'day':\n          return 24;\n        case 'week':\n          return 168;\n        case 'month':\n          return parent.getDayCountInMonth(date) * 24;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeWeekSubDomainSize = function (date, domain) {\n      if (domain === 'month') {\n        var endOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        var endWeekNb = parent.getWeekNumber(endOfMonth);\n        var startWeekNb = parent.getWeekNumber(\n          new Date(date.getFullYear(), date.getMonth())\n        );\n\n        if (startWeekNb > endWeekNb) {\n          startWeekNb = 0;\n          endWeekNb += 1;\n        }\n\n        return endWeekNb - startWeekNb + 1;\n      } else if (domain === 'year') {\n        return parent.getWeekNumber(new Date(date.getFullYear(), 11, 31));\n      }\n    };\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return this.getMinuteDomain(\n          date,\n          computeMinSubDomainSize(date, this.options.domain)\n        );\n      case 'x_hour':\n      case 'hour':\n        return this.getHourDomain(\n          date,\n          computeHourSubDomainSize(date, this.options.domain)\n        );\n      case 'x_day':\n      case 'day':\n        return this.getDayDomain(\n          date,\n          computeDaySubDomainSize(date, this.options.domain)\n        );\n      case 'x_week':\n      case 'week':\n        return this.getWeekDomain(\n          date,\n          computeWeekSubDomainSize(date, this.options.domain)\n        );\n      case 'x_month':\n      case 'month':\n        return this.getMonthDomain(date, 12);\n    }\n  },\n\n  /**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getNextDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().pop(), n, this.options.domain),\n      1\n    )[0];\n  },\n\n  /**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getPreviousDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().shift(), -n, this.options.domain),\n      1\n    )[0];\n  },\n\n  // =========================================================================//\n  // DATAS                                  //\n  // =========================================================================//\n\n  /**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */\n  getDatas: function (\n  source,\n  startDate,\n  endDate,\n  callback,\n  afterLoad,\n  updateMode)\n  {\n    'use strict';\n\n    var self = this;\n    if (arguments.length < 5) {\n      afterLoad = true;\n    }\n    if (arguments.length < 6) {\n      updateMode = this.APPEND_ON_UPDATE;\n    }\n    var _callback = function (error, data) {\n      if (afterLoad !== false) {\n        if (typeof afterLoad === 'function') {\n          data = afterLoad(data);\n        } else if (typeof self.options.afterLoadData === 'function') {\n          data = self.options.afterLoadData(data);\n        } else {\n          console.log('Provided callback for afterLoadData is not a function.');\n        }\n      } else if (\n      self.options.dataType === 'csv' ||\n      self.options.dataType === 'tsv')\n      {\n        data = this.interpretCSV(data);\n      }\n      self.parseDatas(data, updateMode, startDate, endDate);\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n\n    switch (typeof source) {\n      case 'string':\n        if (source === '') {\n          _callback(null, {});\n          return true;\n        } else {\n          var url = this.parseURI(source, startDate, endDate);\n          var requestType = 'GET';\n          if (self.options.dataPostPayload !== null) {\n            requestType = 'POST';\n          }\n          var payload = null;\n          if (self.options.dataPostPayload !== null) {\n            payload = this.parseURI(\n              self.options.dataPostPayload,\n              startDate,\n              endDate\n            );\n          }\n\n          var xhr = null;\n          switch (this.options.dataType) {\n            case 'json':\n              xhr = d3.json(url);\n              break;\n            case 'csv':\n              xhr = d3.csv(url);\n              break;\n            case 'tsv':\n              xhr = d3.tsv(url);\n              break;\n            case 'txt':\n              xhr = d3.text(url, 'text/plain');\n              break;\n          }\n\n          // jshint maxdepth:5\n          if (self.options.dataRequestHeaders !== null) {\n            for (var header in self.options.dataRequestHeaders) {\n              if (self.options.dataRequestHeaders.hasOwnProperty(header)) {\n                xhr.header(header, self.options.dataRequestHeaders[header]);\n              }\n            }\n          }\n\n          xhr.send(requestType, payload, _callback);\n        }\n        return false;\n      case 'object':\n        if (source === Object(source)) {\n          _callback(null, source);\n          return false;\n        }\n      /* falls through */\n      default:\n        _callback(null, {});\n        return true;\n    }\n  },\n\n  /**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */\n  parseDatas: function (data, updateMode, startDate, endDate) {\n    'use strict';\n\n    if (updateMode === this.RESET_ALL_ON_UPDATE) {\n      this._domains.forEach(function (key, value) {\n        value.forEach(function (element, index, array) {\n          array[index].v = null;\n        });\n      });\n    }\n\n    var temp = {};\n\n    var extractTime = function (d) {\n      return d.t;\n    };\n\n    /*jshint forin:false */\n    for (var d in data) {\n      var date = new Date(d * 1000);\n      var domainUnit = this.getDomain(date)[0].getTime();\n      // The current data belongs to a domain that was compressed\n      // Compress the data for the two duplicate hours into the same hour\n      if (this.DSTDomain.indexOf(domainUnit) >= 0) {\n        // Re-assign all data to the first or the second duplicate hours\n        // depending on which is visible\n        if (this._domains.has(domainUnit - 3600 * 1000)) {\n          domainUnit -= 3600 * 1000;\n        }\n      }\n\n      // Skip if data is not relevant to current domain\n      if (\n      isNaN(d) ||\n      !data.hasOwnProperty(d) ||\n      !this._domains.has(domainUnit) ||\n      !(domainUnit >= +startDate && domainUnit < +endDate))\n      {\n        continue;\n      }\n\n      var subDomainsData = this._domains.get(domainUnit);\n\n      if (!temp.hasOwnProperty(domainUnit)) {\n        temp[domainUnit] = subDomainsData.map(extractTime);\n      }\n\n      var index = temp[domainUnit].indexOf(\n        this._domainType[this.options.subDomain].extractUnit(date)\n      );\n\n      if (updateMode === this.RESET_SINGLE_ON_UPDATE) {\n        subDomainsData[index].v = data[d];\n      } else {\n        if (!isNaN(subDomainsData[index].v)) {\n          subDomainsData[index].v += data[d];\n        } else {\n          subDomainsData[index].v = data[d];\n        }\n      }\n    }\n  },\n\n  parseURI: function (str, startDate, endDate) {\n    'use strict';\n\n    // Use a timestamp in seconds\n    str = str.replace(/\\{\\{t:start\\}\\}/g, startDate.getTime() / 1000);\n    str = str.replace(/\\{\\{t:end\\}\\}/g, endDate.getTime() / 1000);\n\n    // Use a string date, following the ISO-8601\n    str = str.replace(/\\{\\{d:start\\}\\}/g, startDate.toISOString());\n    str = str.replace(/\\{\\{d:end\\}\\}/g, endDate.toISOString());\n\n    return str;\n  },\n\n  interpretCSV: function (data) {\n    'use strict';\n\n    var d = {};\n    var keys = Object.keys(data[0]);\n    var i, total;\n    for (i = 0, total = data.length; i < total; i += 1) {\n      d[data[i][keys[0]]] = +data[i][keys[1]];\n    }\n    return d;\n  },\n\n  /**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */\n  resize: function () {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n    var legendWidth = options.displayLegend ?\n    parent.Legend.getDim('width') +\n    options.legendMargin[1] +\n    options.legendMargin[3] :\n    0;\n    var legendHeight = options.displayLegend ?\n    parent.Legend.getDim('height') +\n    options.legendMargin[0] +\n    options.legendMargin[2] :\n    0;\n\n    var graphWidth =\n    parent.graphDim.width - options.domainGutter - options.cellPadding;\n    var graphHeight =\n    parent.graphDim.height - options.domainGutter - options.cellPadding;\n\n    this.root.\n    transition().\n    duration(options.animationDuration).\n    attr('width', function () {\n      if (\n      options.legendVerticalPosition === 'middle' ||\n      options.legendVerticalPosition === 'center')\n      {\n        return graphWidth + legendWidth;\n      }\n      return Math.max(graphWidth, legendWidth);\n    }).\n    attr('height', function () {\n      if (\n      options.legendVerticalPosition === 'middle' ||\n      options.legendVerticalPosition === 'center')\n      {\n        return Math.max(graphHeight, legendHeight);\n      }\n      return graphHeight + legendHeight;\n    });\n\n    this.root.\n    select('.graph').\n    transition().\n    duration(options.animationDuration).\n    attr('y', function () {\n      if (options.legendVerticalPosition === 'top') {\n        return legendHeight;\n      }\n      return 0;\n    }).\n    attr('x', function () {\n      if (\n      (options.legendVerticalPosition === 'middle' ||\n      options.legendVerticalPosition === 'center') &&\n      options.legendHorizontalPosition === 'left')\n      {\n        return legendWidth;\n      }\n      return 0;\n    });\n  },\n\n  // =========================================================================//\n  // PUBLIC API                                //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar forward\n   */\n  next: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadNextDomain(n);\n  },\n\n  /**\n   * Shift the calendar backward\n   */\n  previous: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadPreviousDomain(n);\n  },\n\n  /**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */\n  jumpTo: function (date, reset) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      reset = false;\n    }\n    var domains = this.getDomainKeys();\n    var firstDomain = domains[0];\n    var lastDomain = domains[domains.length - 1];\n\n    if (date < firstDomain) {\n      return this.loadPreviousDomain(this.getDomain(firstDomain, date).length);\n    } else {\n      if (reset) {\n        return this.loadNextDomain(this.getDomain(firstDomain, date).length);\n      }\n\n      if (date > lastDomain) {\n        return this.loadNextDomain(this.getDomain(lastDomain, date).length);\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */\n  rewind: function () {\n    'use strict';\n\n    this.jumpTo(this.options.start, true);\n  },\n\n  /**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar's datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don't want to use the afterLoad() callback\n   */\n  update: function (dataSource, afterLoad, updateMode) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      dataSource = this.options.data;\n    }\n    if (arguments.length < 2) {\n      afterLoad = true;\n    }\n    if (arguments.length < 3) {\n      updateMode = this.RESET_ALL_ON_UPDATE;\n    }\n\n    var domains = this.getDomainKeys();\n    var self = this;\n    this.getDatas(\n      dataSource,\n      new Date(domains[0]),\n      this.getSubDomain(domains[domains.length - 1]).pop(),\n      function () {\n        self.fill();\n        self.afterUpdate();\n      },\n      afterLoad,\n      updateMode\n    );\n  },\n\n  /**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */\n  setLegend: function () {\n    'use strict';\n\n    var oldLegend = this.options.legend.slice(0);\n    if (arguments.length >= 1 && Array.isArray(arguments[0])) {\n      this.options.legend = arguments[0];\n    }\n    if (arguments.length >= 2) {\n      if (Array.isArray(arguments[1]) && arguments[1].length >= 2) {\n        this.options.legendColors = [arguments[1][0], arguments[1][1]];\n      } else {\n        this.options.legendColors = arguments[1];\n      }\n    }\n\n    if (\n    arguments.length > 0 && !arrayEquals(oldLegend, this.options.legend) ||\n    arguments.length >= 2)\n    {\n      this.Legend.buildColors();\n      this.fill();\n    }\n\n    this.Legend.redraw(\n      this.graphDim.width -\n      this.options.domainGutter -\n      this.options.cellPadding\n    );\n  },\n\n  /**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */\n  removeLegend: function () {\n    'use strict';\n\n    if (!this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = false;\n    this.Legend.remove();\n    return true;\n  },\n\n  /**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */\n  showLegend: function () {\n    'use strict';\n\n    if (this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = true;\n    this.Legend.redraw(\n      this.graphDim.width -\n      this.options.domainGutter -\n      this.options.cellPadding\n    );\n    return true;\n  },\n\n  /**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */\n  highlight: function (args) {\n    'use strict';\n\n    if ((this.options.highlight = this.expandDateSetting(args)).length > 0) {\n      this.fill();\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */\n  destroy: function (callback) {\n    'use strict';\n\n    this.root.\n    transition().\n    duration(this.options.animationDuration).\n    attr('width', 0).\n    attr('height', 0).\n    remove().\n    each('end', function () {\n      if (typeof callback === 'function') {\n        callback();\n      } else if (typeof callback !== 'undefined') {\n        console.log('Provided callback for destroy() is not a function.');\n      }\n    });\n\n    return null;\n  },\n\n  getSVG: function () {\n    'use strict';\n\n    var styles = {\n      '.cal-heatmap-container': {},\n      '.graph': {},\n      '.graph-rect': {},\n      'rect.highlight': {},\n      'rect.now': {},\n      'rect.highlight-now': {},\n      'text.highlight': {},\n      'text.now': {},\n      'text.highlight-now': {},\n      '.domain-background': {},\n      '.graph-label': {},\n      '.subdomain-text': {},\n      '.q0': {},\n      '.qi': {}\n    };\n\n    for (\n    var j = 1, total = this.options.legend.length + 1;\n    j <= total;\n    j += 1)\n    {\n      styles['.q' + j] = {};\n    }\n\n    var root = this.root;\n\n    var whitelistStyles = [\n    // SVG specific properties\n    'stroke',\n    'stroke-width',\n    'stroke-opacity',\n    'stroke-dasharray',\n    'stroke-dashoffset',\n    'stroke-linecap',\n    'stroke-miterlimit',\n    'fill',\n    'fill-opacity',\n    'fill-rule',\n    'marker',\n    'marker-start',\n    'marker-mid',\n    'marker-end',\n    'alignement-baseline',\n    'baseline-shift',\n    'dominant-baseline',\n    'glyph-orientation-horizontal',\n    'glyph-orientation-vertical',\n    'kerning',\n    'text-anchor',\n    'shape-rendering',\n\n    // Text Specific properties\n    'text-transform',\n    'font-family',\n    'font',\n    'font-size',\n    'font-weight'];\n\n\n    var filterStyles = function (attribute, property, value) {\n      if (whitelistStyles.indexOf(property) !== -1) {\n        styles[attribute][property] = value;\n      }\n    };\n\n    var getElement = function (e) {\n      return root.select(e)[0][0];\n    };\n\n    /* jshint forin:false */\n    for (var element in styles) {\n      if (!styles.hasOwnProperty(element)) {\n        continue;\n      }\n\n      var dom = getElement(element);\n\n      if (dom === null) {\n        continue;\n      }\n\n      // The DOM Level 2 CSS way\n      /* jshint maxdepth: false */\n      if ('getComputedStyle' in window) {\n        var cs = getComputedStyle(dom, null);\n        if (cs.length !== 0) {\n          for (var i = 0; i < cs.length; i += 1) {\n            filterStyles(element, cs.item(i), cs.getPropertyValue(cs.item(i)));\n          }\n\n          // Opera workaround. Opera doesn\"t support `item`/`length`\n          // on CSSStyleDeclaration.\n        } else {\n          for (var k in cs) {\n            if (cs.hasOwnProperty(k)) {\n              filterStyles(element, k, cs[k]);\n            }\n          }\n        }\n\n        // The IE way\n      } else if ('currentStyle' in dom) {\n        var css = dom.currentStyle;\n        for (var p in css) {\n          filterStyles(element, p, css[p]);\n        }\n      }\n    }\n\n    var string =\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" ' +\n    'xmlns:xlink=\"http://www.w3.org/1999/xlink\"><style type=\"text/css\"><![CDATA[ ';\n\n    for (var style in styles) {\n      string += style + ' {\\n';\n      for (var l in styles[style]) {\n        string += '\\t' + l + ':' + styles[style][l] + ';\\n';\n      }\n      string += '}\\n';\n    }\n\n    string += ']]></style>';\n    string += new XMLSerializer().serializeToString(this.root[0][0]);\n    string += '</svg>';\n\n    return string;\n  }\n};\n\n// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n\n/**\n * Compute the position of a domain, relative to the calendar\n */\nvar DomainPosition = function () {\n  'use strict';\n\n  this.positions = d3.map();\n};\n\nDomainPosition.prototype.getPosition = function (d) {\n  'use strict';\n\n  return this.positions.get(d);\n};\n\nDomainPosition.prototype.getPositionFromIndex = function (i) {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[i]);\n};\n\nDomainPosition.prototype.getLast = function () {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.setPosition = function (d, dim) {\n  'use strict';\n\n  this.positions.set(d, dim);\n};\n\nDomainPosition.prototype.shiftRightBy = function (exitingDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value - exitingDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[0]);\n};\n\nDomainPosition.prototype.shiftLeftBy = function (enteringDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value + enteringDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.getKeys = function () {\n  'use strict';\n\n  return this.positions.keys().sort(function (a, b) {\n    return parseInt(a, 10) - parseInt(b, 10);\n  });\n};\n\n// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\n\nvar Legend = function (calendar) {\n  'use strict';\n\n  this.calendar = calendar;\n  this.computeDim();\n\n  if (calendar.options.legendColors !== null) {\n    this.buildColors();\n  }\n};\n\nLegend.prototype.computeDim = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n  this.dim = {\n    width:\n    options.legendCellSize * (options.legend.length + 1) +\n    options.legendCellPadding * options.legend.length,\n    height: options.legendCellSize\n  };\n};\n\nLegend.prototype.remove = function () {\n  'use strict';\n\n  this.calendar.root.select('.graph-legend').remove();\n  this.calendar.resize();\n};\n\nLegend.prototype.redraw = function (width) {\n  'use strict';\n\n  if (!this.calendar.options.displayLegend) {\n    return false;\n  }\n\n  var parent = this;\n  var calendar = this.calendar;\n  var legend = calendar.root;\n  var legendItem;\n  var options = calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  this.computeDim();\n\n  var _legend = options.legend.slice(0);\n  _legend.push(_legend[_legend.length - 1] + 1);\n\n  var legendElement = calendar.root.select('.graph-legend');\n  if (legendElement[0][0] !== null) {\n    legend = legendElement;\n    legendItem = legend.select('g').selectAll('rect').data(_legend);\n  } else {\n    // Creating the new legend DOM if it doesn't already exist\n    legend =\n    options.legendVerticalPosition === 'top' ?\n    legend.insert('svg', '.graph') :\n    legend.append('svg');\n\n    legend.attr('x', getLegendXPosition()).attr('y', getLegendYPosition());\n\n    legendItem = legend.\n    attr('class', 'graph-legend').\n    attr('height', parent.getDim('height')).\n    attr('width', parent.getDim('width')).\n    append('g').\n    selectAll().\n    data(_legend);\n  }\n\n  legendItem.\n  enter().\n  append('rect').\n  call(legendCellLayout).\n  attr('class', function (d) {\n    return calendar.Legend.getClass(d, calendar.legendScale === null);\n  }).\n  attr('fill-opacity', 0).\n  call(function (selection) {\n    if (\n    calendar.legendScale !== null &&\n    options.legendColors !== null &&\n    options.legendColors.hasOwnProperty('base'))\n    {\n      selection.attr('fill', options.legendColors.base);\n    }\n  }).\n  append('title');\n\n  legendItem.\n  exit().\n  transition().\n  duration(options.animationDuration).\n  attr('fill-opacity', 0).\n  remove();\n\n  legendItem.\n  transition().\n  delay(function (d, i) {\n    return options.animationDuration * i / 10;\n  }).\n  call(legendCellLayout).\n  attr('fill-opacity', 1).\n  call(function (element) {\n    element.attr('fill', function (d, i) {\n      if (calendar.legendScale === null) {\n        return '';\n      }\n\n      if (i === 0) {\n        return calendar.legendScale(d - 1);\n      }\n      return calendar.legendScale(options.legend[i - 1]);\n    });\n\n    element.attr('class', function (d) {\n      return calendar.Legend.getClass(d, calendar.legendScale === null);\n    });\n  });\n\n  function legendCellLayout(selection) {\n    selection.\n    attr('width', options.legendCellSize).\n    attr('height', options.legendCellSize).\n    attr('rx', options.legendCellRadius).\n    attr('ry', options.legendCellRadius).\n    attr('x', function (d, i) {\n      return i * (options.legendCellSize + options.legendCellPadding);\n    });\n  }\n\n  legendItem.select('title').text(function (d, i) {\n    if (i === 0) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.lower, {\n        min: options.legend[i],\n        name: options.itemName[1]\n      });\n    } else if (i === _legend.length - 1) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.upper, {\n        max: options.legend[i - 1],\n        name: options.itemName[1]\n      });\n    } else {\n      return calendar.formatStringWithObject(options.legendTitleFormat.inner, {\n        down: options.legend[i - 1],\n        up: options.legend[i],\n        name: options.itemName[1]\n      });\n    }\n  });\n  legendItem.\n  on('mouseover', function (d) {\n    calendar.legendTip.show(d, this);\n  }).\n  on('mouseout', function () {\n    calendar.legendTip.hide();\n  });\n\n  legend.\n  transition().\n  duration(options.animationDuration).\n  attr('x', getLegendXPosition()).\n  attr('y', getLegendYPosition()).\n  attr('width', parent.getDim('width')).\n  attr('height', parent.getDim('height'));\n\n  legend.\n  select('g').\n  transition().\n  duration(options.animationDuration).\n  attr('transform', function () {\n    if (options.legendOrientation === 'vertical') {\n      return (\n        'rotate(90 ' +\n        options.legendCellSize / 2 +\n        ' ' +\n        options.legendCellSize / 2 +\n        ')');\n\n    }\n    return '';\n  });\n\n  function getLegendXPosition() {\n    switch (options.legendHorizontalPosition) {\n      case 'right':\n        if (\n        options.legendVerticalPosition === 'center' ||\n        options.legendVerticalPosition === 'middle')\n        {\n          return width + options.legendMargin[3];\n        }\n        return width - parent.getDim('width') - options.legendMargin[1];\n      case 'middle':\n      case 'center':\n        return Math.round(width / 2 - parent.getDim('width') / 2);\n      default:\n        return options.legendMargin[3];\n    }\n  }\n\n  function getLegendYPosition() {\n    if (options.legendVerticalPosition === 'bottom') {\n      return (\n        calendar.graphDim.height +\n        options.legendMargin[0] -\n        options.domainGutter -\n        options.cellPadding);\n\n    }\n    return options.legendMargin[0];\n  }\n\n  calendar.resize();\n};\n\n/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */\nLegend.prototype.getDim = function (axis) {\n  'use strict';\n\n  var isHorizontal = this.calendar.options.legendOrientation === 'horizontal';\n\n  switch (axis) {\n    case 'width':\n      return this.dim[isHorizontal ? 'width' : 'height'];\n    case 'height':\n      return this.dim[isHorizontal ? 'height' : 'width'];\n  }\n};\n\nLegend.prototype.buildColors = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  if (options.legendColors === null) {\n    this.calendar.legendScale = null;\n    return false;\n  }\n\n  var _colorRange = [];\n\n  if (Array.isArray(options.legendColors)) {\n    _colorRange = options.legendColors;\n  } else if (\n  options.legendColors.hasOwnProperty('min') &&\n  options.legendColors.hasOwnProperty('max'))\n  {\n    _colorRange = [options.legendColors.min, options.legendColors.max];\n  } else {\n    options.legendColors = null;\n    return false;\n  }\n\n  var _legend = options.legend.slice(0);\n\n  if (_legend[0] > 0) {\n    _legend.unshift(0);\n  } else if (_legend[0] <= 0) {\n    // Let's guess the leftmost value, it we have to add one\n    _legend.unshift(\n      _legend[0] - (_legend[_legend.length - 1] - _legend[0]) / _legend.length\n    );\n  }\n  var colorScale;\n  if (options.legendColors.hasOwnProperty('colorScale')) {\n    colorScale = options.legendColors.colorScale;\n  } else {\n    colorScale = d3.scale.\n    linear().\n    range(_colorRange).\n    interpolate(d3.interpolateHcl).\n    domain([d3.min(_legend), d3.max(_legend)]);\n  }\n\n  var legendColors = _legend.map(function (element) {\n    return colorScale(element);\n  });\n  this.calendar.legendScale = d3.scale.\n  threshold().\n  domain(options.legend).\n  range(legendColors);\n\n  return true;\n};\n\n/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */\nLegend.prototype.getClass = function (n, withCssClass) {\n  'use strict';\n\n  if (n === null || isNaN(n)) {\n    return '';\n  }\n\n  var index = [this.calendar.options.legend.length + 1];\n\n  for (\n  var i = 0, total = this.calendar.options.legend.length - 1;\n  i <= total;\n  i += 1)\n  {\n    if (this.calendar.options.legend[0] > 0 && n < 0) {\n      index = ['1', 'i'];\n      break;\n    }\n\n    if (n <= this.calendar.options.legend[i]) {\n      index = [i + 1];\n      break;\n    }\n  }\n\n  if (n === 0) {\n    index.push(0);\n  }\n\n  index.unshift('');\n  return (index.join(' r') + (withCssClass ? index.join(' q') : '')).trim();\n};\n\n/**\n * #source http://stackoverflow.com/a/383245/805649\n */\nfunction mergeRecursive(obj1, obj2) {\n  'use strict';\n\n  /*jshint forin:false */\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if (obj2[p].constructor === Object) {\n        obj1[p] = mergeRecursive(obj1[p], obj2[p]);\n      } else {\n        obj1[p] = obj2[p];\n      }\n    } catch (e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n    }\n  }\n\n  return obj1;\n}\n\n/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */\nfunction arrayEquals(arrayA, arrayB) {\n  'use strict';\n\n  // if the other array is a falsy value, return\n  if (!arrayB || !arrayA) {\n    return false;\n  }\n\n  // compare lengths - can save a lot of time\n  if (arrayA.length !== arrayB.length) {\n    return false;\n  }\n\n  for (var i = 0; i < arrayA.length; i += 1) {\n    // Check if we have nested arrays\n    if (arrayA[i] instanceof Array && arrayB[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!arrayEquals(arrayA[i], arrayB[i])) {\n        return false;\n      }\n    } else if (arrayA[i] !== arrayB[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n  return true;\n}const _default =\n\nCalHeatMap;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(d3, \"d3\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(CalHeatMap, \"CalHeatMap\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(DomainPosition, \"DomainPosition\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(Legend, \"Legend\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(mergeRecursive, \"mergeRecursive\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(arrayEquals, \"arrayEquals\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["d3tip","getContrastingColor","t","d3","require","window","CalHeatMap","self","tip","attr","direction","offset","html","d","options","timeFormatter","valueFormatter","v","legendTip","allowedDataType","itemSelector","paintOnLoad","range","cellSize","cellPadding","cellRadius","domainGutter","domainMargin","domain","subDomain","colLimit","rowLimit","weekStartOnMonday","start","Date","minDate","maxDate","data","dataType","dataPostPayload","dataRequestHeaders","considerMissingDataAsZero","loadOnInit","verticalOrientation","domainDynamicDimension","label","position","align","x","y","rotate","width","height","legend","displayLegend","legendCellSize","legendCellPadding","legendMargin","legendVerticalPosition","legendHorizontalPosition","legendOrientation","legendColors","highlight","itemName","domainLabelFormat","subDomainTitleFormat","empty","filled","subDomainDateFormat","subDomainTextFormat","legendTitleFormat","lower","inner","upper","animationDuration","nextSelector","previousSelector","itemNamespace","tooltip","onClick","afterLoad","afterLoadNextDomain","afterLoadPreviousDomain","onComplete","afterLoadData","timestamps","stdTimezoneOffset","date","jan","getFullYear","jul","Math","max","getTimezoneOffset","results","timestamp","value","parseInt","afterUpdate","onMaxDomainReached","onMinDomainReached","_domainType","min","name","level","maxItemNumber","defaultRowNumber","defaultColumnNumber","row","getSubDomainRowNumber","column","getSubDomainColumnNumber","floor","getMinutes","format","connector","extractUnit","getMonth","getDate","getHours","getTime","hour","getDayCountInMonth","getWeekDay","p","day","getDayCountInYear","getWeekNumber","getDayOfYear","week","getMonthWeekNumber","dt","weekDay","getDay","setDate","month","year","type","hasOwnProperty","lastInsertedSvg","_completed","_domains","map","graphDim","legendDim","NAVIGATE_LEFT","NAVIGATE_RIGHT","RESET_ALL_ON_UPDATE","RESET_SINGLE_ON_UPDATE","APPEND_ON_UPDATE","DEFAULT_LEGEND_MARGIN","root","_maxDomainReached","_minDomainReached","domainPosition","DomainPosition","Legend","legendScale","DSTDomain","_init","getDomain","set","getSubDomain","select","append","_initCalendar","call","verticalDomainLabel","domainVerticalLabelHeight","domainHorizontalLabelWidth","paint","on","event","preventDefault","loadNextDomain","loadPreviousDomain","redraw","domains","getDomainKeys","getDatas","length","pop","fill","checkIfMinDomainIsReached","checkIfMaxDomainIsReached","getNextDomain","w","outer","arguments","h","navigationDir","domainSvg","selectAll","reverse","enteringDomainDim","exitingDomainDim","svg","enter","getDomainPosition","classname","domainIndex","axis","domainDim","tmp","setPosition","getPositionFromIndex","shiftRightBy","getLast","shiftLeftBy","subDomainSvgGroup","rect","get","getHighlightClassName","positionSubDomainX","positionSubDomainY","selection","base","show","hide","text","formatDate","domainRotate","s","transition","duration","getPosition","tempWidth","tempHeight","exit","remove","resize","prototype","init","settings","parent","mergeRecursive","validateDomainType","validateSelector","indexOf","Error","error","console","log","message","getOptimalSubDomain","k","expandMarginSetting","expandDateSetting","expandItemName","parseColLimit","parseRowLimit","autoAddLegendMargin","autoAlignLabel","selector","canBeFalse","Element","substring","Array","isArray","slice","filter","addStyle","element","overflow","htmlClass","trim","split","pastDate","dateIsLessThan","sameDate","dateIsEqual","push","getClass","join","getSubDomainTitle","formatSubDomainText","rgb","formatStringWithObject","formatted","args","prop","regexp","RegExp","replace","triggerEvent","eventName","successArgs","skip","apply","itemNb","response","shift","reached","upperBound","minDomainIsReached","maxDomainIsReached","lowerBound","formatNumber","f","time","count","n","bound","loadNewDomains","end","newDomains","backward","i","total","buildSubDomain","datetimestamp","keys","sort","a","b","index","ceil","j","isNow","dateA","dateB","normalizedMillis","subdomain","monthFirstWeekNumber","getWeekNumberInYear","getEndOfMonth","jumpDate","step","setHours","setMonth","setFullYear","getMinuteDomain","stop","minutes","getHourDomain","hours","splice","abs","getDayDomain","days","getWeekDomain","weekStart","endDate","mondays","sundays","getMonthDomain","months","getYearDomain","years","computeDaySubDomainSize","computeMinSubDomainSize","computeHourSubDomainSize","computeWeekSubDomainSize","endOfMonth","endWeekNb","startWeekNb","getPreviousDomain","source","startDate","callback","updateMode","_callback","interpretCSV","parseDatas","url","parseURI","requestType","payload","xhr","json","csv","tsv","header","send","Object","forEach","key","array","temp","extractTime","domainUnit","has","isNaN","subDomainsData","str","toISOString","legendWidth","getDim","legendHeight","graphWidth","graphHeight","next","previous","jumpTo","reset","firstDomain","lastDomain","rewind","update","dataSource","setLegend","oldLegend","arrayEquals","buildColors","removeLegend","showLegend","destroy","each","getSVG","styles","whitelistStyles","filterStyles","attribute","property","getElement","e","dom","cs","getComputedStyle","item","getPropertyValue","css","currentStyle","string","style","l","XMLSerializer","serializeToString","positions","getKeys","dim","calendar","computeDim","legendItem","_legend","legendElement","insert","getLegendXPosition","getLegendYPosition","legendCellLayout","delay","legendCellRadius","down","up","round","isHorizontal","_colorRange","unshift","colorScale","scale","linear","interpolate","interpolateHcl","threshold","withCssClass","obj1","obj2","constructor","arrayA","arrayB","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"],"sourcesContent":["// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */\n\n/* eslint-disable */\n\nimport d3tip from 'd3-tip';\nimport { getContrastingColor, t } from '@superset-ui/core';\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar CalHeatMap = function () {\n  'use strict';\n\n  var self = this;\n  self.tip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(\n      d => `\n      ${self.options.timeFormatter(d.t)}: <strong>${self.options.valueFormatter(\n        d.v,\n      )}</strong>\n    `,\n    );\n  self.legendTip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(d => self.options.valueFormatter(d));\n\n  this.allowedDataType = ['json', 'csv', 'tsv', 'txt'];\n\n  // Default settings\n  this.options = {\n    // selector string of the container to append the graph to\n    // Accept any string value accepted by document.querySelector or CSS3\n    // or an Element object\n    itemSelector: '#cal-heatmap',\n\n    // Whether to paint the calendar on init()\n    // Used by testsuite to reduce testing time\n    paintOnLoad: true,\n\n    // ================================================\n    // DOMAIN\n    // ================================================\n\n    // Number of domain to display on the graph\n    range: 12,\n\n    // Size of each cell, in pixel\n    cellSize: 10,\n\n    // Padding between each cell, in pixel\n    cellPadding: 2,\n\n    // For rounded subdomain rectangles, in pixels\n    cellRadius: 0,\n\n    domainGutter: 2,\n\n    domainMargin: [0, 0, 0, 0],\n\n    valueFormatter: d => d,\n\n    timeFormatter: d => d,\n\n    domain: 'hour',\n\n    subDomain: 'min',\n\n    // Number of columns to split the subDomains to\n    // If not null, will takes precedence over rowLimit\n    colLimit: null,\n\n    // Number of rows to split the subDomains to\n    // Will be ignored if colLimit is not null\n    rowLimit: null,\n\n    // First day of the week is Monday\n    // 0 to start the week on Sunday\n    weekStartOnMonday: true,\n\n    // Start date of the graph\n    // @default now\n    start: new Date(),\n\n    minDate: null,\n\n    maxDate: null,\n\n    // ================================================\n    // DATA\n    // ================================================\n\n    // Data source\n    // URL, where to fetch the original datas\n    data: '',\n\n    // Data type\n    // Default: json\n    dataType: this.allowedDataType[0],\n\n    // Payload sent when using POST http method\n    // Leave to null (default) for GET request\n    // Expect a string, formatted like \"a=b;c=d\"\n    dataPostPayload: null,\n\n    // Additional headers sent when requesting data\n    // Expect an object formatted like:\n    // { 'X-CSRF-TOKEN': 'token' }\n    dataRequestHeaders: null,\n\n    // Whether to consider missing date:value from the datasource\n    // as equal to 0, or just leave them as missing\n    considerMissingDataAsZero: false,\n\n    // Load remote data on calendar creation\n    // When false, the calendar will be left empty\n    loadOnInit: true,\n\n    // Calendar orientation\n    // false: display domains side by side\n    // true : display domains one under the other\n    verticalOrientation: false,\n\n    // Domain dynamic width/height\n    // The width on a domain depends on the number of\n    domainDynamicDimension: true,\n\n    // Domain Label properties\n    label: {\n      // valid: top, right, bottom, left\n      position: 'bottom',\n\n      // Valid: left, center, right\n      // Also valid are the direct svg values: start, middle, end\n      align: 'center',\n\n      // By default, there is no margin/padding around the label\n      offset: {\n        x: 0,\n        y: 0,\n      },\n\n      rotate: null,\n\n      // Used only on vertical orientation\n      width: 100,\n\n      // Used only on horizontal orientation\n      height: null,\n    },\n\n    // ================================================\n    // LEGEND\n    // ================================================\n\n    // Threshold for the legend\n    legend: [10, 20, 30, 40],\n\n    // Whether to display the legend\n    displayLegend: true,\n\n    legendCellSize: 10,\n\n    legendCellPadding: 2,\n\n    legendMargin: [0, 0, 0, 0],\n\n    // Legend vertical position\n    // top: place legend above calendar\n    // bottom: place legend below the calendar\n    legendVerticalPosition: 'bottom',\n\n    // Legend horizontal position\n    // accepted values: left, center, right\n    legendHorizontalPosition: 'left',\n\n    // Legend rotation\n    // accepted values: horizontal, vertical\n    legendOrientation: 'horizontal',\n\n    // Objects holding all the heatmap different colors\n    // null to disable, and use the default css styles\n    //\n    // Examples:\n    // legendColors: {\n    //    min: \"green\",\n    //    max: \"red\",\n    //    empty: \"#ffffff\",\n    //    base: \"grey\",\n    //    overflow: \"red\",\n    //    colorScaler: null,\n    // }\n    legendColors: null,\n\n    // ================================================\n    // HIGHLIGHT\n    // ================================================\n\n    // List of dates to highlight\n    // Valid values:\n    // - []: don't highlight anything\n    // - \"now\": highlight the current date\n    // - an array of Date objects: highlight the specified dates\n    highlight: [],\n\n    // ================================================\n    // TEXT FORMATTING / i18n\n    // ================================================\n\n    // Name of the items to represent in the calendar\n    itemName: ['item', 'items'],\n\n    // Formatting of the domain label\n    // @default: null, will use the formatting according to domain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    domainLabelFormat: null,\n\n    // Formatting of the title displayed when hovering a subDomain cell\n    subDomainTitleFormat: {\n      empty: '{date}',\n      filled: '{count} {name} {connector} {date}',\n    },\n\n    // Formatting of the {date} used in subDomainTitleFormat\n    // @default: null, will use the formatting according to subDomain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainDateFormat: null,\n\n    // Formatting of the text inside each subDomain cell\n    // @default: null, no text\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainTextFormat: null,\n\n    // Formatting of the title displayed when hovering a legend cell\n    legendTitleFormat: {\n      lower: t('less than {min} {name}'),\n      inner: t('between {down} and {up} {name}'),\n      upper: t('more than {max} {name}'),\n    },\n\n    // Animation duration, in ms\n    animationDuration: 500,\n\n    nextSelector: false,\n\n    previousSelector: false,\n\n    itemNamespace: 'cal-heatmap',\n\n    tooltip: false,\n\n    // ================================================\n    // EVENTS CALLBACK\n    // ================================================\n\n    // Callback when clicking on a time block\n    onClick: null,\n\n    // Callback after painting the empty calendar\n    // Can be used to trigger an API call, once the calendar is ready to be filled\n    afterLoad: null,\n\n    // Callback after loading the next domain in the calendar\n    afterLoadNextDomain: null,\n\n    // Callback after loading the previous domain in the calendar\n    afterLoadPreviousDomain: null,\n\n    // Callback after finishing all actions on the calendar\n    onComplete: null,\n\n    // Callback after fetching the datas, but before applying them to the calendar\n    // Used mainly to convert the datas if they're not formatted like expected\n    // Takes the fetched \"data\" object as argument, must return a json object\n    // formatted like {timestamp:count, timestamp2:count2},\n    afterLoadData: function (timestamps) {\n      // See https://github.com/wa0x6e/cal-heatmap/issues/126#issuecomment-373301803\n      const stdTimezoneOffset = date => {\n        const jan = new Date(date.getFullYear(), 0, 1);\n        const jul = new Date(date.getFullYear(), 6, 1);\n        return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());\n      };\n      const offset = stdTimezoneOffset(new Date()) * 60;\n      let results = {};\n      for (let timestamp in timestamps) {\n        const value = timestamps[timestamp];\n        timestamp = parseInt(timestamp, 10);\n        results[timestamp + offset] = value;\n      }\n      return results;\n    },\n\n    // Callback triggered after calling and completing update().\n    afterUpdate: null,\n\n    // Callback triggered after calling next().\n    // The `status` argument is equal to true if there is no\n    // more next domain to load\n    //\n    // This callback is also executed once, after calling previous(),\n    // only when the max domain is reached\n    onMaxDomainReached: null,\n\n    // Callback triggered after calling previous().\n    // The `status` argument is equal to true if there is no\n    // more previous domain to load\n    //\n    // This callback is also executed once, after calling next(),\n    // only when the min domain is reached\n    onMinDomainReached: null,\n  };\n\n  this._domainType = {\n    min: {\n      name: 'minute',\n      level: 10,\n      maxItemNumber: 60,\n      defaultRowNumber: 10,\n      defaultColumnNumber: 6,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMinutes() / self._domainType.min.row(d));\n        },\n        y: function (d) {\n          return d.getMinutes() % self._domainType.min.row(d);\n        },\n      },\n      format: {\n        date: '%H:%M, %A %B %-e, %Y',\n        legend: '',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n          d.getMinutes(),\n        ).getTime();\n      },\n    },\n    hour: {\n      name: 'hour',\n      level: 20,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 24;\n          case 'week':\n            return 24 * 7;\n          case 'month':\n            return (\n              24 *\n              (self.options.domainDynamicDimension\n                ? self.getDayCountInMonth(d)\n                : 31)\n            );\n        }\n      },\n      defaultRowNumber: 6,\n      defaultColumnNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 4;\n          case 'week':\n            return 28;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n        }\n      },\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          if (self.options.domain === 'month') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + (d.getDate() - 1) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              (d.getDate() - 1) * 4\n            );\n          } else if (self.options.domain === 'week') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + self.getWeekDay(d) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              self.getWeekDay(d) * 4\n            );\n          }\n          return Math.floor(d.getHours() / self._domainType.hour.row(d));\n        },\n        y: function (d) {\n          var p = d.getHours();\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'month':\n                p += (d.getDate() - 1) * 24;\n                break;\n              case 'week':\n                p += self.getWeekDay(d) * 24;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.hour.row(d));\n        },\n      },\n      format: {\n        date: '%Hh, %A %B %-e, %Y',\n        legend: '%H:00',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n        ).getTime();\n      },\n    },\n    day: {\n      name: 'day',\n      level: 30,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'week':\n            return 7;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInYear(d)\n              : 366;\n        }\n      },\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'week':\n            return 1;\n          case 'month':\n            return self.options.domainDynamicDimension &&\n              !self.options.verticalOrientation\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) -\n                  self.getWeekNumber(d) +\n                  1\n              : 6;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(new Date(d.getFullYear(), 11, 31)) -\n                  self.getWeekNumber(new Date(d.getFullYear(), 0)) +\n                  1\n              : 54;\n        }\n      },\n      defaultRowNumber: 7,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'week':\n              return Math.floor(\n                self.getWeekDay(d) / self._domainType.day.row(d),\n              );\n            case 'month':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (d.getDate() - 1) / self._domainType.day.row(d),\n                );\n              }\n              return (\n                self.getWeekNumber(d) -\n                self.getWeekNumber(new Date(d.getFullYear(), d.getMonth()))\n              );\n            case 'year':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (self.getDayOfYear(d) - 1) / self._domainType.day.row(d),\n                );\n              }\n              return self.getWeekNumber(d);\n          }\n        },\n        y: function (d) {\n          var p = self.getWeekDay(d);\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'year':\n                p = self.getDayOfYear(d) - 1;\n                break;\n              case 'week':\n                p = self.getWeekDay(d);\n                break;\n              case 'month':\n                p = d.getDate() - 1;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.day.row(d));\n        },\n      },\n      format: {\n        date: '%A %B %-e, %Y',\n        legend: '%e %b',\n        connector: 'on',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();\n      },\n    },\n    week: {\n      name: 'week',\n      level: 40,\n      maxItemNumber: 54,\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'year':\n            return self._domainType.week.maxItemNumber;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) - self.getWeekNumber(d)\n              : 5;\n        }\n      },\n      defaultRowNumber: 1,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'year':\n              return Math.floor(\n                self.getWeekNumber(d) / self._domainType.week.row(d),\n              );\n            case 'month':\n              return Math.floor(\n                self.getMonthWeekNumber(d) / self._domainType.week.row(d),\n              );\n          }\n        },\n        y: function (d) {\n          return self.getWeekNumber(d) % self._domainType.week.row(d);\n        },\n      },\n      format: {\n        date: '%B Week #%W',\n        legend: '%B Week #%W',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        var dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        // According to ISO-8601, week number computation are based on week starting on Monday\n        var weekDay = dt.getDay() - (self.options.weekStartOnMonday ? 1 : 0);\n        if (weekDay < 0) {\n          weekDay = 6;\n        }\n        dt.setDate(dt.getDate() - weekDay);\n        return dt.getTime();\n      },\n    },\n    month: {\n      name: 'month',\n      level: 50,\n      maxItemNumber: 12,\n      defaultColumnNumber: 12,\n      defaultRowNumber: 1,\n      row: function () {\n        return self.getSubDomainRowNumber();\n      },\n      column: function () {\n        return self.getSubDomainColumnNumber();\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMonth() / self._domainType.month.row(d));\n        },\n        y: function (d) {\n          return d.getMonth() % self._domainType.month.row(d);\n        },\n      },\n      format: {\n        date: '%B %Y',\n        legend: '%B',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth()).getTime();\n      },\n    },\n    year: {\n      name: 'year',\n      level: 60,\n      row: function () {\n        return self.options.rowLimit || 1;\n      },\n      column: function () {\n        return self.options.colLimit || 1;\n      },\n      position: {\n        x: function () {\n          return 1;\n        },\n        y: function () {\n          return 1;\n        },\n      },\n      format: {\n        date: '%Y',\n        legend: '%Y',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear()).getTime();\n      },\n    },\n  };\n\n  for (var type in this._domainType) {\n    if (this._domainType.hasOwnProperty(type)) {\n      var d = this._domainType[type];\n      this._domainType['x_' + type] = {\n        name: 'x_' + type,\n        level: d.type,\n        maxItemNumber: d.maxItemNumber,\n        defaultRowNumber: d.defaultRowNumber,\n        defaultColumnNumber: d.defaultColumnNumber,\n        row: d.column,\n        column: d.row,\n        position: {\n          x: d.position.y,\n          y: d.position.x,\n        },\n        format: d.format,\n        extractUnit: d.extractUnit,\n      };\n    }\n  }\n\n  // Record the address of the last inserted domain when browsing\n  this.lastInsertedSvg = null;\n\n  this._completed = false;\n\n  // Record all the valid domains\n  // Each domain value is a timestamp in milliseconds\n  this._domains = d3.map();\n\n  this.graphDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.legendDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.NAVIGATE_LEFT = 1;\n  this.NAVIGATE_RIGHT = 2;\n\n  // Various update mode when using the update() API\n  this.RESET_ALL_ON_UPDATE = 0;\n  this.RESET_SINGLE_ON_UPDATE = 1;\n  this.APPEND_ON_UPDATE = 2;\n\n  this.DEFAULT_LEGEND_MARGIN = 10;\n\n  this.root = null;\n  this.tooltip = null;\n\n  this._maxDomainReached = false;\n  this._minDomainReached = false;\n\n  this.domainPosition = new DomainPosition();\n  this.Legend = null;\n  this.legendScale = null;\n\n  // List of domains that are skipped because of DST\n  // All times belonging to these domains should be re-assigned to the previous domain\n  this.DSTDomain = [];\n\n  /**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */\n  this._init = function () {\n    self\n      .getDomain(self.options.start)\n      .map(function (d) {\n        return d.getTime();\n      })\n      .map(function (d) {\n        self._domains.set(\n          d,\n          self.getSubDomain(d).map(function (d) {\n            return {\n              t: self._domainType[self.options.subDomain].extractUnit(d),\n              v: null,\n            };\n          }),\n        );\n      });\n\n    self.root = d3\n      .select(self.options.itemSelector)\n      .append('svg')\n      .attr('class', 'cal-heatmap-container');\n\n    self.root.attr('x', 0).attr('y', 0).append('svg').attr('class', 'graph');\n\n    self.Legend = new Legend(self);\n\n    if (self.options.paintOnLoad) {\n      _initCalendar();\n    }\n    self.root.call(self.tip);\n    self.root.call(self.legendTip);\n\n    return true;\n  };\n\n  function _initCalendar() {\n    self.verticalDomainLabel =\n      self.options.label.position === 'top' ||\n      self.options.label.position === 'bottom';\n\n    self.domainVerticalLabelHeight =\n      self.options.label.height === null\n        ? Math.max(25, self.options.cellSize * 2)\n        : self.options.label.height;\n    self.domainHorizontalLabelWidth = 0;\n\n    if (\n      self.options.domainLabelFormat === '' &&\n      self.options.label.height === null\n    ) {\n      self.domainVerticalLabelHeight = 0;\n    }\n\n    if (!self.verticalDomainLabel) {\n      self.domainVerticalLabelHeight = 0;\n      self.domainHorizontalLabelWidth = self.options.label.width;\n    }\n\n    self.paint();\n\n    // =========================================================================//\n    // ATTACHING DOMAIN NAVIGATION EVENT                    //\n    // =========================================================================//\n    if (self.options.nextSelector !== false) {\n      d3.select(self.options.nextSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadNextDomain(1);\n        },\n      );\n    }\n\n    if (self.options.previousSelector !== false) {\n      d3.select(self.options.previousSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadPreviousDomain(1);\n        },\n      );\n    }\n\n    self.Legend.redraw(\n      self.graphDim.width -\n        self.options.domainGutter -\n        self.options.cellPadding,\n    );\n    self.afterLoad();\n\n    var domains = self.getDomainKeys();\n\n    // Fill the graph with some datas\n    if (self.options.loadOnInit) {\n      self.getDatas(\n        self.options.data,\n        new Date(domains[0]),\n        self.getSubDomain(domains[domains.length - 1]).pop(),\n        function () {\n          self.fill();\n          self.onComplete();\n        },\n      );\n    } else {\n      self.onComplete();\n    }\n\n    self.checkIfMinDomainIsReached(domains[0]);\n    self.checkIfMaxDomainIsReached(self.getNextDomain().getTime());\n  }\n\n  // Return the width of the domain block, without the domain gutter\n  // @param int d Domain start timestamp\n  function w(d, outer) {\n    var width =\n      self.options.cellSize *\n        self._domainType[self.options.subDomain].column(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].column(d);\n    if (arguments.length === 2 && outer === true) {\n      return (width +=\n        self.domainHorizontalLabelWidth +\n        self.options.domainGutter +\n        self.options.domainMargin[1] +\n        self.options.domainMargin[3]);\n    }\n    return width;\n  }\n\n  // Return the height of the domain block, without the domain gutter\n  function h(d, outer) {\n    var height =\n      self.options.cellSize * self._domainType[self.options.subDomain].row(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].row(d);\n    if (arguments.length === 2 && outer === true) {\n      height +=\n        self.options.domainGutter +\n        self.domainVerticalLabelHeight +\n        self.options.domainMargin[0] +\n        self.options.domainMargin[2];\n    }\n    return height;\n  }\n\n  /**\n   *\n   *\n   * @param int navigationDir\n   */\n  this.paint = function (navigationDir) {\n    var options = self.options;\n\n    if (arguments.length === 0) {\n      navigationDir = false;\n    }\n\n    // Painting all the domains\n    var domainSvg = self.root\n      .select('.graph')\n      .selectAll('.graph-domain')\n      .data(\n        function () {\n          var data = self.getDomainKeys();\n          return navigationDir === self.NAVIGATE_LEFT ? data.reverse() : data;\n        },\n        function (d) {\n          return d;\n        },\n      );\n    var enteringDomainDim = 0;\n    var exitingDomainDim = 0;\n\n    // =========================================================================//\n    // PAINTING DOMAIN                              //\n    // =========================================================================//\n\n    var svg = domainSvg\n      .enter()\n      .append('svg')\n      .attr('width', function (d) {\n        return w(d, true);\n      })\n      .attr('height', function (d) {\n        return h(d, true);\n      })\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          self.graphDim.width = Math.max(self.graphDim.width, w(d, true));\n          return 0;\n        } else {\n          return getDomainPosition(d, self.graphDim, 'width', w(d, true));\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          return getDomainPosition(d, self.graphDim, 'height', h(d, true));\n        } else {\n          self.graphDim.height = Math.max(self.graphDim.height, h(d, true));\n          return 0;\n        }\n      })\n      .attr('class', function (d) {\n        var classname = 'graph-domain';\n        var date = new Date(d);\n        switch (options.domain) {\n          case 'hour':\n            classname += ' h_' + date.getHours();\n          /* falls through */\n          case 'day':\n            classname += ' d_' + date.getDate() + ' dy_' + date.getDay();\n          /* falls through */\n          case 'week':\n            classname += ' w_' + self.getWeekNumber(date);\n          /* falls through */\n          case 'month':\n            classname += ' m_' + (date.getMonth() + 1);\n          /* falls through */\n          case 'year':\n            classname += ' y_' + date.getFullYear();\n        }\n        return classname;\n      });\n    self.lastInsertedSvg = svg;\n\n    function getDomainPosition(domainIndex, graphDim, axis, domainDim) {\n      var tmp = 0;\n      switch (navigationDir) {\n        case false:\n          tmp = graphDim[axis];\n\n          graphDim[axis] += domainDim;\n          self.domainPosition.setPosition(domainIndex, tmp);\n          return tmp;\n\n        case self.NAVIGATE_RIGHT:\n          self.domainPosition.setPosition(domainIndex, graphDim[axis]);\n\n          enteringDomainDim = domainDim;\n          exitingDomainDim = self.domainPosition.getPositionFromIndex(1);\n\n          self.domainPosition.shiftRightBy(exitingDomainDim);\n          return graphDim[axis];\n\n        case self.NAVIGATE_LEFT:\n          tmp = -domainDim;\n\n          enteringDomainDim = -tmp;\n          exitingDomainDim = graphDim[axis] - self.domainPosition.getLast();\n\n          self.domainPosition.setPosition(domainIndex, tmp);\n          self.domainPosition.shiftLeftBy(enteringDomainDim);\n          return tmp;\n      }\n    }\n\n    svg\n      .append('rect')\n      .attr('width', function (d) {\n        return w(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('height', function (d) {\n        return h(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('class', 'domain-background');\n\n    // =========================================================================//\n    // PAINTING SUBDOMAINS                            //\n    // =========================================================================//\n    var subDomainSvgGroup = svg\n      .append('svg')\n      .attr('x', function () {\n        if (options.label.position === 'left') {\n          return self.domainHorizontalLabelWidth + options.domainMargin[3];\n        } else {\n          return options.domainMargin[3];\n        }\n      })\n      .attr('y', function () {\n        if (options.label.position === 'top') {\n          return self.domainVerticalLabelHeight + options.domainMargin[0];\n        } else {\n          return options.domainMargin[0];\n        }\n      })\n      .attr('class', 'graph-subdomain-group');\n    var rect = subDomainSvgGroup\n      .selectAll('g')\n      .data(function (d) {\n        return self._domains.get(d);\n      })\n      .enter()\n      .append('g');\n    rect\n      .append('rect')\n      .attr('class', function (d) {\n        return (\n          'graph-rect' +\n          self.getHighlightClassName(d.t) +\n          (options.onClick !== null ? ' hover_cursor' : '')\n        );\n      })\n      .attr('width', options.cellSize)\n      .attr('height', options.cellSize)\n      .attr('x', function (d) {\n        return self.positionSubDomainX(d.t);\n      })\n      .attr('y', function (d) {\n        return self.positionSubDomainY(d.t);\n      })\n      .on('click', function (d) {\n        if (options.onClick !== null) {\n          return self.onClick(new Date(d.t), d.v);\n        }\n      })\n      .call(function (selection) {\n        if (options.cellRadius > 0) {\n          selection\n            .attr('rx', options.cellRadius)\n            .attr('ry', options.cellRadius);\n        }\n\n        if (\n          self.legendScale !== null &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('base')\n        ) {\n          selection.attr('fill', options.legendColors.base);\n        }\n\n        if (options.tooltip) {\n          selection\n            .on('mouseover', function (d) {\n              self.tip.show(d, this);\n            })\n            .on('mouseout', function () {\n              self.tip.hide(d);\n            });\n        }\n      });\n\n    // Appending a title to each subdomain\n    if (!options.tooltip) {\n      rect.append('title').text(function (d) {\n        return self.formatDate(new Date(d.t), options.subDomainDateFormat);\n      });\n    }\n\n    // =========================================================================//\n    // PAINTING LABEL                              //\n    // =========================================================================//\n    if (options.domainLabelFormat !== '') {\n      svg\n        .append('text')\n        .attr('class', 'graph-label')\n        .attr('y', function (d) {\n          var y = options.domainMargin[0];\n          switch (options.label.position) {\n            case 'top':\n              y += self.domainVerticalLabelHeight / 2;\n              break;\n            case 'bottom':\n              y += h(d) + self.domainVerticalLabelHeight / 2;\n          }\n\n          return (\n            y +\n            options.label.offset.y *\n              ((options.label.rotate === 'right' &&\n                options.label.position === 'right') ||\n              (options.label.rotate === 'left' &&\n                options.label.position === 'left')\n                ? -1\n                : 1)\n          );\n        })\n        .attr('x', function (d) {\n          var x = options.domainMargin[3];\n          switch (options.label.position) {\n            case 'right':\n              x += w(d);\n              break;\n            case 'bottom':\n            case 'top':\n              x += w(d) / 2;\n          }\n\n          if (options.label.align === 'right') {\n            return (\n              x +\n              self.domainHorizontalLabelWidth -\n              options.label.offset.x *\n                (options.label.rotate === 'right' ? -1 : 1)\n            );\n          }\n          return x + options.label.offset.x;\n        })\n        .attr('text-anchor', function () {\n          switch (options.label.align) {\n            case 'start':\n            case 'left':\n              return 'start';\n            case 'end':\n            case 'right':\n              return 'end';\n            default:\n              return 'middle';\n          }\n        })\n        .attr('dominant-baseline', function () {\n          return self.verticalDomainLabel ? 'middle' : 'top';\n        })\n        .text(function (d) {\n          return self.formatDate(new Date(d), options.domainLabelFormat);\n        })\n        .call(domainRotate);\n    }\n\n    function domainRotate(selection) {\n      switch (options.label.rotate) {\n        case 'right':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(90), ';\n            switch (options.label.position) {\n              case 'right':\n                s += 'translate(-' + w(d) + ' , -' + w(d) + ')';\n                break;\n              case 'left':\n                s += 'translate(0, -' + self.domainHorizontalLabelWidth + ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n        case 'left':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(270), ';\n            switch (options.label.position) {\n              case 'right':\n                s +=\n                  'translate(-' +\n                  (w(d) + self.domainHorizontalLabelWidth) +\n                  ' , ' +\n                  w(d) +\n                  ')';\n                break;\n              case 'left':\n                s +=\n                  'translate(-' +\n                  self.domainHorizontalLabelWidth +\n                  ' , ' +\n                  self.domainHorizontalLabelWidth +\n                  ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n      }\n    }\n\n    // =========================================================================//\n    // PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n    // =========================================================================//\n    if (options.subDomainTextFormat !== null) {\n      rect\n        .append('text')\n        .attr('class', function (d) {\n          return 'subdomain-text' + self.getHighlightClassName(d.t);\n        })\n        .attr('x', function (d) {\n          return self.positionSubDomainX(d.t) + options.cellSize / 2;\n        })\n        .attr('y', function (d) {\n          return self.positionSubDomainY(d.t) + options.cellSize / 2;\n        })\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'central')\n        .text(function (d) {\n          return self.formatDate(new Date(d.t), options.subDomainTextFormat);\n        });\n    }\n\n    // =========================================================================//\n    // ANIMATION                                //\n    // =========================================================================//\n\n    if (navigationDir !== false) {\n      domainSvg\n        .transition()\n        .duration(options.animationDuration)\n        .attr('x', function (d) {\n          return options.verticalOrientation\n            ? 0\n            : self.domainPosition.getPosition(d);\n        })\n        .attr('y', function (d) {\n          return options.verticalOrientation\n            ? self.domainPosition.getPosition(d)\n            : 0;\n        });\n    }\n\n    var tempWidth = self.graphDim.width;\n    var tempHeight = self.graphDim.height;\n\n    if (options.verticalOrientation) {\n      self.graphDim.height += enteringDomainDim - exitingDomainDim;\n    } else {\n      self.graphDim.width += enteringDomainDim - exitingDomainDim;\n    }\n\n    // At the time of exit, domainsWidth and domainsHeight already automatically shifted\n    domainSvg\n      .exit()\n      .transition()\n      .duration(options.animationDuration)\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          return 0;\n        } else {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.width, tempWidth);\n            case self.NAVIGATE_RIGHT:\n              return -w(d, true);\n          }\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.height, tempHeight);\n            case self.NAVIGATE_RIGHT:\n              return -h(d, true);\n          }\n        } else {\n          return 0;\n        }\n      })\n      .remove();\n\n    // Resize the root container\n    self.resize();\n  };\n};\n\nCalHeatMap.prototype = {\n  /**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */\n  /* jshint maxstatements:false */\n  init: function (settings) {\n    'use strict';\n\n    var parent = this;\n\n    var options = (parent.options = mergeRecursive(parent.options, settings));\n\n    // Fatal errors\n    // Stop script execution on error\n    validateDomainType();\n    validateSelector(options.itemSelector, false, 'itemSelector');\n\n    if (parent.allowedDataType.indexOf(options.dataType) === -1) {\n      throw new Error(\n        \"The data type '\" + options.dataType + \"' is not valid data type\",\n      );\n    }\n\n    if (d3.select(options.itemSelector)[0][0] === null) {\n      throw new Error(\n        \"The node '\" +\n          options.itemSelector +\n          \"' specified in itemSelector does not exists\",\n      );\n    }\n\n    try {\n      validateSelector(options.nextSelector, true, 'nextSelector');\n      validateSelector(options.previousSelector, true, 'previousSelector');\n    } catch (error) {\n      console.log(error.message);\n      return false;\n    }\n\n    // If other settings contains error, will fallback to default\n\n    if (!settings.hasOwnProperty('subDomain')) {\n      this.options.subDomain = getOptimalSubDomain(settings.domain);\n    }\n\n    if (\n      typeof options.itemNamespace !== 'string' ||\n      options.itemNamespace === ''\n    ) {\n      console.log(\n        'itemNamespace can not be empty, falling back to cal-heatmap',\n      );\n      options.itemNamespace = 'cal-heatmap';\n    }\n\n    // Don't touch these settings\n    var s = [\n      'data',\n      'onComplete',\n      'onClick',\n      'afterLoad',\n      'afterLoadData',\n      'afterLoadPreviousDomain',\n      'afterLoadNextDomain',\n      'afterUpdate',\n    ];\n\n    for (var k in s) {\n      if (settings.hasOwnProperty(s[k])) {\n        options[s[k]] = settings[s[k]];\n      }\n    }\n\n    options.subDomainDateFormat =\n      typeof options.subDomainDateFormat === 'string' ||\n      typeof options.subDomainDateFormat === 'function'\n        ? options.subDomainDateFormat\n        : this._domainType[options.subDomain].format.date;\n    options.domainLabelFormat =\n      typeof options.domainLabelFormat === 'string' ||\n      typeof options.domainLabelFormat === 'function'\n        ? options.domainLabelFormat\n        : this._domainType[options.domain].format.legend;\n    options.subDomainTextFormat =\n      (typeof options.subDomainTextFormat === 'string' &&\n        options.subDomainTextFormat !== '') ||\n      typeof options.subDomainTextFormat === 'function'\n        ? options.subDomainTextFormat\n        : null;\n    options.domainMargin = expandMarginSetting(options.domainMargin);\n    options.legendMargin = expandMarginSetting(options.legendMargin);\n    options.highlight = parent.expandDateSetting(options.highlight);\n    options.itemName = expandItemName(options.itemName);\n    options.colLimit = parseColLimit(options.colLimit);\n    options.rowLimit = parseRowLimit(options.rowLimit);\n    if (!settings.hasOwnProperty('legendMargin')) {\n      autoAddLegendMargin();\n    }\n    autoAlignLabel();\n\n    /**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */\n    function validateSelector(selector, canBeFalse, name) {\n      if (\n        ((canBeFalse && selector === false) ||\n          selector instanceof Element ||\n          typeof selector === 'string') &&\n        selector !== ''\n      ) {\n        return true;\n      }\n      throw new Error('The ' + name + ' is not valid');\n    }\n\n    /**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */\n    function getOptimalSubDomain(domain) {\n      switch (domain) {\n        case 'year':\n          return 'month';\n        case 'month':\n          return 'day';\n        case 'week':\n          return 'day';\n        case 'day':\n          return 'hour';\n        default:\n          return 'min';\n      }\n    }\n\n    /**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */\n    function validateDomainType() {\n      if (\n        !parent._domainType.hasOwnProperty(options.domain) ||\n        options.domain === 'min' ||\n        options.domain.substring(0, 2) === 'x_'\n      ) {\n        throw new Error(\"The domain '\" + options.domain + \"' is not valid\");\n      }\n\n      if (\n        !parent._domainType.hasOwnProperty(options.subDomain) ||\n        options.subDomain === 'year'\n      ) {\n        throw new Error(\n          \"The subDomain '\" + options.subDomain + \"' is not valid\",\n        );\n      }\n\n      if (\n        parent._domainType[options.domain].level <=\n        parent._domainType[options.subDomain].level\n      ) {\n        throw new Error(\n          \"'\" +\n            options.subDomain +\n            \"' is not a valid subDomain to '\" +\n            options.domain +\n            \"'\",\n        );\n      }\n\n      return true;\n    }\n\n    /**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */\n    function autoAlignLabel() {\n      // Auto-align label, depending on it's position\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('align'))\n      ) {\n        switch (options.label.position) {\n          case 'left':\n            options.label.align = 'right';\n            break;\n          case 'right':\n            options.label.align = 'left';\n            break;\n          default:\n            options.label.align = 'center';\n        }\n\n        if (options.label.rotate === 'left') {\n          options.label.align = 'right';\n        } else if (options.label.rotate === 'right') {\n          options.label.align = 'left';\n        }\n      }\n\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('offset'))\n      ) {\n        if (\n          options.label.position === 'left' ||\n          options.label.position === 'right'\n        ) {\n          options.label.offset = {\n            x: 10,\n            y: 15,\n          };\n        }\n      }\n    }\n\n    /**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */\n    function autoAddLegendMargin() {\n      switch (options.legendVerticalPosition) {\n        case 'top':\n          options.legendMargin[2] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'bottom':\n          options.legendMargin[0] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'middle':\n        case 'center':\n          options.legendMargin[\n            options.legendHorizontalPosition === 'right' ? 3 : 1\n          ] = parent.DEFAULT_LEGEND_MARGIN;\n      }\n    }\n\n    /**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */\n    function expandMarginSetting(value) {\n      if (typeof value === 'number') {\n        value = [value];\n      }\n\n      if (!Array.isArray(value)) {\n        console.log('Margin only takes an integer or an array of integers');\n        value = [0];\n      }\n\n      switch (value.length) {\n        case 1:\n          return [value[0], value[0], value[0], value[0]];\n        case 2:\n          return [value[0], value[1], value[0], value[1]];\n        case 3:\n          return [value[0], value[1], value[2], value[1]];\n        case 4:\n          return value;\n        default:\n          return value.slice(0, 4);\n      }\n    }\n\n    /**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */\n    function expandItemName(value) {\n      if (typeof value === 'string') {\n        return [value, value + (value !== '' ? 's' : '')];\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 1) {\n          return [value[0], value[0] + 's'];\n        } else if (value.length > 2) {\n          return value.slice(0, 2);\n        }\n\n        return value;\n      }\n\n      return ['item', 'items'];\n    }\n\n    function parseColLimit(value) {\n      return value > 0 ? value : null;\n    }\n\n    function parseRowLimit(value) {\n      if (value > 0 && options.colLimit > 0) {\n        console.log(\n          'colLimit and rowLimit are mutually exclusive, rowLimit will be ignored',\n        );\n        return null;\n      }\n      return value > 0 ? value : null;\n    }\n\n    return this._init();\n  },\n\n  /**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */\n  expandDateSetting: function (value) {\n    'use strict';\n\n    if (!Array.isArray(value)) {\n      value = [value];\n    }\n\n    return value\n      .map(function (data) {\n        if (data === 'now') {\n          return new Date();\n        }\n        if (data instanceof Date) {\n          return data;\n        }\n        return false;\n      })\n      .filter(function (d) {\n        return d !== false;\n      });\n  },\n\n  /**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It's used to limit the painting to only a subset of the calendar\n   * @return void\n   */\n  fill: function (svg) {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n\n    if (arguments.length === 0) {\n      svg = parent.root.selectAll('.graph-domain');\n    }\n\n    var rect = svg\n      .selectAll('svg')\n      .selectAll('g')\n      .data(function (d) {\n        return parent._domains.get(d);\n      });\n    /**\n     * Colorize the cell via a style attribute if enabled\n     */\n    function addStyle(element) {\n      if (parent.legendScale === null) {\n        return false;\n      }\n\n      element.attr('fill', function (d) {\n        if (\n          d.v === null &&\n          options.hasOwnProperty('considerMissingDataAsZero') &&\n          !options.considerMissingDataAsZero\n        ) {\n          if (options.legendColors.hasOwnProperty('base')) {\n            return options.legendColors.base;\n          }\n        }\n\n        if (\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('empty') &&\n          (d.v === 0 ||\n            (d.v === null &&\n              options.hasOwnProperty('considerMissingDataAsZero') &&\n              options.considerMissingDataAsZero))\n        ) {\n          return options.legendColors.empty;\n        }\n\n        if (\n          d.v < 0 &&\n          options.legend[0] > 0 &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('overflow')\n        ) {\n          return options.legendColors.overflow;\n        }\n\n        return parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n      });\n    }\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('rect')\n      .attr('class', function (d) {\n        var htmlClass = parent.getHighlightClassName(d.t).trim().split(' ');\n        var pastDate = parent.dateIsLessThan(d.t, new Date());\n        var sameDate = parent.dateIsEqual(d.t, new Date());\n\n        if (\n          parent.legendScale === null ||\n          (d.v === null &&\n            options.hasOwnProperty('considerMissingDataAsZero') &&\n            !options.considerMissingDataAsZero &&\n            !options.legendColors.hasOwnProperty('base'))\n        ) {\n          htmlClass.push('graph-rect');\n        }\n\n        if (sameDate) {\n          htmlClass.push('now');\n        } else if (!pastDate) {\n          htmlClass.push('future');\n        }\n\n        if (d.v !== null) {\n          htmlClass.push(\n            parent.Legend.getClass(d.v, parent.legendScale === null),\n          );\n        } else if (options.considerMissingDataAsZero && pastDate) {\n          htmlClass.push(\n            parent.Legend.getClass(0, parent.legendScale === null),\n          );\n        }\n\n        if (options.onClick !== null) {\n          htmlClass.push('hover_cursor');\n        }\n\n        return htmlClass.join(' ');\n      })\n      .call(addStyle);\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('title')\n      .text(function (d) {\n        return parent.getSubDomainTitle(d);\n      });\n\n    function formatSubDomainText(element) {\n      if (typeof options.subDomainTextFormat === 'function') {\n        element.text(function (d) {\n          return options.subDomainTextFormat(d.t, d.v);\n        });\n      }\n    }\n\n    /**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('text')\n      .attr('class', function (d) {\n        return 'subdomain-text' + parent.getHighlightClassName(d.t);\n      })\n      .call(formatSubDomainText)\n      .attr('fill', d => {\n        if (!d.v) return '#000';\n        const rgb = parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n        return getContrastingColor(rgb, 135);\n      });\n  },\n\n  /**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */\n  formatStringWithObject: function (formatted, args) {\n    'use strict';\n    for (var prop in args) {\n      if (args.hasOwnProperty(prop)) {\n        var regexp = new RegExp('\\\\{' + prop + '\\\\}', 'gi');\n        formatted = formatted.replace(regexp, args[prop]);\n      }\n    }\n    return formatted;\n  },\n\n  // =========================================================================//\n  // EVENTS CALLBACK                              //\n  // =========================================================================//\n\n  /**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */\n  triggerEvent: function (eventName, successArgs, skip) {\n    'use strict';\n\n    if ((arguments.length === 3 && skip) || this.options[eventName] === null) {\n      return true;\n    }\n\n    if (typeof this.options[eventName] === 'function') {\n      if (typeof successArgs === 'function') {\n        successArgs = successArgs();\n      }\n      return this.options[eventName].apply(this, successArgs);\n    } else {\n      console.log('Provided callback for ' + eventName + ' is not a function.');\n      return false;\n    }\n  },\n\n  /**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */\n  onClick: function (d, itemNb) {\n    'use strict';\n\n    return this.triggerEvent('onClick', [d, itemNb]);\n  },\n\n  /**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */\n  afterLoad: function () {\n    'use strict';\n\n    return this.triggerEvent('afterLoad');\n  },\n\n  /**\n   * Event triggered after completing drawing and filling the calendar\n   */\n  onComplete: function () {\n    'use strict';\n\n    var response = this.triggerEvent('onComplete', [], this._completed);\n    this._completed = true;\n    return response;\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadPreviousDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadPreviousDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadNextDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadNextDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */\n  onMinDomainReached: function (reached) {\n    'use strict';\n\n    this._minDomainReached = reached;\n    return this.triggerEvent('onMinDomainReached', [reached]);\n  },\n\n  /**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */\n  onMaxDomainReached: function (reached) {\n    'use strict';\n\n    this._maxDomainReached = reached;\n    return this.triggerEvent('onMaxDomainReached', [reached]);\n  },\n\n  checkIfMinDomainIsReached: function (date, upperBound) {\n    'use strict';\n\n    if (this.minDomainIsReached(date)) {\n      this.onMinDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._maxDomainReached && !this.maxDomainIsReached(upperBound)) {\n        this.onMaxDomainReached(false);\n      }\n    }\n  },\n\n  checkIfMaxDomainIsReached: function (date, lowerBound) {\n    'use strict';\n\n    if (this.maxDomainIsReached(date)) {\n      this.onMaxDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._minDomainReached && !this.minDomainIsReached(lowerBound)) {\n        this.onMinDomainReached(false);\n      }\n    }\n  },\n\n  afterUpdate: function () {\n    'use strict';\n\n    return this.triggerEvent('afterUpdate');\n  },\n\n  // =========================================================================//\n  // FORMATTER                                //\n  // =========================================================================//\n\n  formatNumber: d3.format(',g'),\n\n  formatDate: function (d, format) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      format = 'title';\n    }\n\n    if (typeof format === 'function') {\n      return format(d);\n    } else {\n      var f = d3.time.format(format);\n      return f(d);\n    }\n  },\n\n  getSubDomainTitle: function (d) {\n    'use strict';\n\n    if (d.v === null && !this.options.considerMissingDataAsZero) {\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.empty,\n        {\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    } else {\n      var value = d.v;\n      // Consider null as 0\n      if (value === null && this.options.considerMissingDataAsZero) {\n        value = 0;\n      }\n\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.filled,\n        {\n          count: this.formatNumber(value),\n          name: this.options.itemName[value !== 1 ? 1 : 0],\n          connector: this._domainType[this.options.subDomain].format.connector,\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    }\n  },\n\n  // =========================================================================//\n  // DOMAIN NAVIGATION                            //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it's not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */\n  loadNextDomain: function (n) {\n    'use strict';\n\n    if (this._maxDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_RIGHT,\n      this.getDomain(this.getNextDomain(), n),\n    );\n\n    this.afterLoadNextDomain(bound.end);\n    this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(), bound.start);\n\n    return true;\n  },\n\n  /**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it's not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */\n  loadPreviousDomain: function (n) {\n    'use strict';\n\n    if (this._minDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_LEFT,\n      this.getDomain(this.getDomainKeys()[0], -n).reverse(),\n    );\n\n    this.afterLoadPreviousDomain(bound.start);\n    this.checkIfMinDomainIsReached(bound.start, bound.end);\n\n    return true;\n  },\n\n  loadNewDomains: function (direction, newDomains) {\n    'use strict';\n\n    var parent = this;\n    var backward = direction === this.NAVIGATE_LEFT;\n    var i = -1;\n    var total = newDomains.length;\n    var domains = this.getDomainKeys();\n\n    function buildSubDomain(d) {\n      return {\n        t: parent._domainType[parent.options.subDomain].extractUnit(d),\n        v: null,\n      };\n    }\n\n    // Remove out of bound domains from list of new domains to prepend\n    while (++i < total) {\n      if (backward && this.minDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i + 1);\n        break;\n      }\n      if (!backward && this.maxDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i);\n        break;\n      }\n    }\n\n    newDomains = newDomains.slice(-this.options.range);\n\n    for (i = 0, total = newDomains.length; i < total; i += 1) {\n      this._domains.set(\n        newDomains[i].getTime(),\n        this.getSubDomain(newDomains[i]).map(buildSubDomain),\n      );\n\n      this._domains.remove(backward ? domains.pop() : domains.shift());\n    }\n\n    domains = this.getDomainKeys();\n\n    if (backward) {\n      newDomains = newDomains.reverse();\n    }\n\n    this.paint(direction);\n\n    this.getDatas(\n      this.options.data,\n      newDomains[0],\n      this.getSubDomain(newDomains[newDomains.length - 1]).pop(),\n      function () {\n        parent.fill(parent.lastInsertedSvg);\n      },\n    );\n\n    return {\n      start: newDomains[backward ? 0 : 1],\n      end: domains[domains.length - 1],\n    };\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */\n  maxDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.maxDate !== null &&\n      this.options.maxDate.getTime() < datetimestamp\n    );\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */\n  minDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.minDate !== null &&\n      this.options.minDate.getTime() >= datetimestamp\n    );\n  },\n\n  /**\n   * Return the list of the calendar's domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */\n  getDomainKeys: function () {\n    'use strict';\n\n    return this._domains\n      .keys()\n      .map(function (d) {\n        return parseInt(d, 10);\n      })\n      .sort(function (a, b) {\n        return a - b;\n      });\n  },\n\n  // =========================================================================//\n  // POSITIONNING                                //\n  // =========================================================================//\n\n  positionSubDomainX: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.x(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  positionSubDomainY: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.y(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  getSubDomainColumnNumber: function (d) {\n    'use strict';\n\n    if (this.options.rowLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.rowLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultColumnNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.colLimit || j;\n  },\n\n  getSubDomainRowNumber: function (d) {\n    'use strict';\n\n    if (this.options.colLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.colLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultRowNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.rowLimit || j;\n  },\n\n  /**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */\n  getHighlightClassName: function (d) {\n    'use strict';\n\n    d = new Date(d);\n\n    if (this.options.highlight.length > 0) {\n      for (var i in this.options.highlight) {\n        if (this.dateIsEqual(this.options.highlight[i], d)) {\n          return this.isNow(this.options.highlight[i])\n            ? ' highlight-now'\n            : ' highlight';\n        }\n      }\n    }\n    return '';\n  },\n\n  /**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */\n  isNow: function (d) {\n    'use strict';\n\n    return this.dateIsEqual(d, new Date());\n  },\n\n  /**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */\n  /* jshint maxcomplexity: false */\n  dateIsEqual: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours() &&\n          dateA.getMinutes() === dateB.getMinutes()\n        );\n      case 'x_hour':\n      case 'hour':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours()\n        );\n      case 'x_day':\n      case 'day':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate()\n        );\n      case 'x_week':\n      case 'week':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          this.getWeekNumber(dateA) === this.getWeekNumber(dateB)\n        );\n      case 'x_month':\n      case 'month':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth()\n        );\n      default:\n        return false;\n    }\n  },\n\n  /**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */\n  dateIsLessThan: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    function normalizedMillis(date, subdomain) {\n      switch (subdomain) {\n        case 'x_min':\n        case 'min':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n            date.getMinutes(),\n          ).getTime();\n        case 'x_hour':\n        case 'hour':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n          ).getTime();\n        case 'x_day':\n        case 'day':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n          ).getTime();\n        case 'x_week':\n        case 'week':\n        case 'x_month':\n        case 'month':\n          return new Date(date.getFullYear(), date.getMonth()).getTime();\n        default:\n          return date.getTime();\n      }\n    }\n\n    return (\n      normalizedMillis(dateA, this.options.subDomain) <\n      normalizedMillis(dateB, this.options.subDomain)\n    );\n  },\n\n  // =========================================================================//\n  // DATE COMPUTATION                              //\n  // =========================================================================//\n\n  /**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */\n  getDayOfYear: d3.time.format('%j'),\n\n  /**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */\n  getWeekNumber: function (d) {\n    'use strict';\n\n    var f =\n      this.options.weekStartOnMonday === true\n        ? d3.time.format('%W')\n        : d3.time.format('%U');\n    return f(d);\n  },\n\n  /**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */\n  getMonthWeekNumber: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n\n    var monthFirstWeekNumber = this.getWeekNumber(\n      new Date(d.getFullYear(), d.getMonth()),\n    );\n    return this.getWeekNumber(d) - monthFirstWeekNumber - 1;\n  },\n\n  /**\n   * Return the number of weeks in the dates' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date's year\n   */\n  getWeekNumberInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n  },\n\n  /**\n   * Return the number of days in the date's month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's month\n   */\n  getDayCountInMonth: function (d) {\n    'use strict';\n\n    return this.getEndOfMonth(d).getDate();\n  },\n\n  /**\n   * Return the number of days in the date's year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's year\n   */\n  getDayCountInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), 1, 29).getMonth() === 1 ? 366 : 365;\n  },\n\n  /**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */\n  getWeekDay: function (d) {\n    'use strict';\n\n    if (this.options.weekStartOnMonday === false) {\n      return d.getDay();\n    }\n    return d.getDay() === 0 ? 6 : d.getDay() - 1;\n  },\n\n  /**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */\n  getEndOfMonth: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), d.getMonth() + 1, 0);\n  },\n\n  /**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */\n  jumpDate: function (date, count, step) {\n    'use strict';\n\n    var d = new Date(date);\n    switch (step) {\n      case 'hour':\n        d.setHours(d.getHours() + count);\n        break;\n      case 'day':\n        d.setHours(d.getHours() + count * 24);\n        break;\n      case 'week':\n        d.setHours(d.getHours() + count * 24 * 7);\n        break;\n      case 'month':\n        d.setMonth(d.getMonth() + count);\n        break;\n      case 'year':\n        d.setFullYear(d.getFullYear() + count);\n    }\n\n    return new Date(d);\n  },\n\n  // =========================================================================//\n  // DOMAIN COMPUTATION                            //\n  // =========================================================================//\n\n  /**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */\n  getMinuteDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(+start + range * 1000 * 60);\n    }\n    return d3.time.minutes(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getHourDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(start);\n      stop.setHours(stop.getHours() + range);\n    }\n\n    var domains = d3.time.hours(Math.min(start, stop), Math.max(start, stop));\n\n    // Passing from DST to standard time\n    // If there are 25 hours, let's compress the duplicate hours\n    var i = 0;\n    var total = domains.length;\n    for (i = 0; i < total; i += 1) {\n      if (i > 0 && domains[i].getHours() === domains[i - 1].getHours()) {\n        this.DSTDomain.push(domains[i].getTime());\n        domains.splice(i, 1);\n        break;\n      }\n    }\n\n    // d3.time.hours is returning more hours than needed when changing\n    // from DST to standard time, because there is really 2 hours between\n    // 1am and 2am!\n    if (typeof range === 'number' && domains.length > Math.abs(range)) {\n      domains.splice(domains.length - 1, 1);\n    }\n\n    return domains;\n  },\n\n  /**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getDayDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth(), range.getDate());\n    } else {\n      stop = new Date(start);\n      stop = new Date(stop.setDate(stop.getDate() + parseInt(range, 10)));\n    }\n\n    return d3.time.days(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getWeekDomain: function (d, range) {\n    'use strict';\n\n    var weekStart;\n\n    if (this.options.weekStartOnMonday === false) {\n      weekStart = new Date(\n        d.getFullYear(),\n        d.getMonth(),\n        d.getDate() - d.getDay(),\n      );\n    } else {\n      if (d.getDay() === 1) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n      } else if (d.getDay() === 0) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        weekStart.setDate(weekStart.getDate() - 6);\n      } else {\n        weekStart = new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate() - d.getDay() + 1,\n        );\n      }\n    }\n\n    var endDate = new Date(weekStart);\n\n    var stop = range;\n    if (typeof range !== 'object') {\n      stop = new Date(endDate.setDate(endDate.getDate() + range * 7));\n    }\n\n    return this.options.weekStartOnMonday === true\n      ? d3.time.mondays(Math.min(weekStart, stop), Math.max(weekStart, stop))\n      : d3.time.sundays(Math.min(weekStart, stop), Math.max(weekStart, stop));\n  },\n\n  /**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */\n  getMonthDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth());\n    } else {\n      stop = new Date(start);\n      stop = stop.setMonth(stop.getMonth() + range);\n    }\n\n    return d3.time.months(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getYearDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), 0);\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), 0);\n    } else {\n      stop = new Date(d.getFullYear() + range, 0);\n    }\n\n    return d3.time.years(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */\n  getDomain: function (date, range) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    if (arguments.length < 2) {\n      range = this.options.range;\n    }\n\n    switch (this.options.domain) {\n      case 'hour':\n        var domains = this.getHourDomain(date, range);\n\n        // Case where an hour is missing, when passing from standard time to DST\n        // Missing hour is perfectly acceptabl in subDomain, but not in domains\n        if (typeof range === 'number' && domains.length < range) {\n          if (range > 0) {\n            domains.push(this.getHourDomain(domains[domains.length - 1], 2)[1]);\n          } else {\n            domains.shift(this.getHourDomain(domains[0], -2)[0]);\n          }\n        }\n        return domains;\n      case 'day':\n        return this.getDayDomain(date, range);\n      case 'week':\n        return this.getWeekDomain(date, range);\n      case 'month':\n        return this.getMonthDomain(date, range);\n      case 'year':\n        return this.getYearDomain(date, range);\n    }\n  },\n\n  /* jshint maxcomplexity: false */\n  getSubDomain: function (date) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    var parent = this;\n\n    /**\n     * @return int\n     */\n    var computeDaySubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'year':\n          return parent.getDayCountInYear(date);\n        case 'month':\n          return parent.getDayCountInMonth(date);\n        case 'week':\n          return 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeMinSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'hour':\n          return 60;\n        case 'day':\n          return 60 * 24;\n        case 'week':\n          return 60 * 24 * 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeHourSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'day':\n          return 24;\n        case 'week':\n          return 168;\n        case 'month':\n          return parent.getDayCountInMonth(date) * 24;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeWeekSubDomainSize = function (date, domain) {\n      if (domain === 'month') {\n        var endOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        var endWeekNb = parent.getWeekNumber(endOfMonth);\n        var startWeekNb = parent.getWeekNumber(\n          new Date(date.getFullYear(), date.getMonth()),\n        );\n\n        if (startWeekNb > endWeekNb) {\n          startWeekNb = 0;\n          endWeekNb += 1;\n        }\n\n        return endWeekNb - startWeekNb + 1;\n      } else if (domain === 'year') {\n        return parent.getWeekNumber(new Date(date.getFullYear(), 11, 31));\n      }\n    };\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return this.getMinuteDomain(\n          date,\n          computeMinSubDomainSize(date, this.options.domain),\n        );\n      case 'x_hour':\n      case 'hour':\n        return this.getHourDomain(\n          date,\n          computeHourSubDomainSize(date, this.options.domain),\n        );\n      case 'x_day':\n      case 'day':\n        return this.getDayDomain(\n          date,\n          computeDaySubDomainSize(date, this.options.domain),\n        );\n      case 'x_week':\n      case 'week':\n        return this.getWeekDomain(\n          date,\n          computeWeekSubDomainSize(date, this.options.domain),\n        );\n      case 'x_month':\n      case 'month':\n        return this.getMonthDomain(date, 12);\n    }\n  },\n\n  /**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getNextDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().pop(), n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  /**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getPreviousDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().shift(), -n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  // =========================================================================//\n  // DATAS                                  //\n  // =========================================================================//\n\n  /**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */\n  getDatas: function (\n    source,\n    startDate,\n    endDate,\n    callback,\n    afterLoad,\n    updateMode,\n  ) {\n    'use strict';\n\n    var self = this;\n    if (arguments.length < 5) {\n      afterLoad = true;\n    }\n    if (arguments.length < 6) {\n      updateMode = this.APPEND_ON_UPDATE;\n    }\n    var _callback = function (error, data) {\n      if (afterLoad !== false) {\n        if (typeof afterLoad === 'function') {\n          data = afterLoad(data);\n        } else if (typeof self.options.afterLoadData === 'function') {\n          data = self.options.afterLoadData(data);\n        } else {\n          console.log('Provided callback for afterLoadData is not a function.');\n        }\n      } else if (\n        self.options.dataType === 'csv' ||\n        self.options.dataType === 'tsv'\n      ) {\n        data = this.interpretCSV(data);\n      }\n      self.parseDatas(data, updateMode, startDate, endDate);\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n\n    switch (typeof source) {\n      case 'string':\n        if (source === '') {\n          _callback(null, {});\n          return true;\n        } else {\n          var url = this.parseURI(source, startDate, endDate);\n          var requestType = 'GET';\n          if (self.options.dataPostPayload !== null) {\n            requestType = 'POST';\n          }\n          var payload = null;\n          if (self.options.dataPostPayload !== null) {\n            payload = this.parseURI(\n              self.options.dataPostPayload,\n              startDate,\n              endDate,\n            );\n          }\n\n          var xhr = null;\n          switch (this.options.dataType) {\n            case 'json':\n              xhr = d3.json(url);\n              break;\n            case 'csv':\n              xhr = d3.csv(url);\n              break;\n            case 'tsv':\n              xhr = d3.tsv(url);\n              break;\n            case 'txt':\n              xhr = d3.text(url, 'text/plain');\n              break;\n          }\n\n          // jshint maxdepth:5\n          if (self.options.dataRequestHeaders !== null) {\n            for (var header in self.options.dataRequestHeaders) {\n              if (self.options.dataRequestHeaders.hasOwnProperty(header)) {\n                xhr.header(header, self.options.dataRequestHeaders[header]);\n              }\n            }\n          }\n\n          xhr.send(requestType, payload, _callback);\n        }\n        return false;\n      case 'object':\n        if (source === Object(source)) {\n          _callback(null, source);\n          return false;\n        }\n      /* falls through */\n      default:\n        _callback(null, {});\n        return true;\n    }\n  },\n\n  /**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */\n  parseDatas: function (data, updateMode, startDate, endDate) {\n    'use strict';\n\n    if (updateMode === this.RESET_ALL_ON_UPDATE) {\n      this._domains.forEach(function (key, value) {\n        value.forEach(function (element, index, array) {\n          array[index].v = null;\n        });\n      });\n    }\n\n    var temp = {};\n\n    var extractTime = function (d) {\n      return d.t;\n    };\n\n    /*jshint forin:false */\n    for (var d in data) {\n      var date = new Date(d * 1000);\n      var domainUnit = this.getDomain(date)[0].getTime();\n      // The current data belongs to a domain that was compressed\n      // Compress the data for the two duplicate hours into the same hour\n      if (this.DSTDomain.indexOf(domainUnit) >= 0) {\n        // Re-assign all data to the first or the second duplicate hours\n        // depending on which is visible\n        if (this._domains.has(domainUnit - 3600 * 1000)) {\n          domainUnit -= 3600 * 1000;\n        }\n      }\n\n      // Skip if data is not relevant to current domain\n      if (\n        isNaN(d) ||\n        !data.hasOwnProperty(d) ||\n        !this._domains.has(domainUnit) ||\n        !(domainUnit >= +startDate && domainUnit < +endDate)\n      ) {\n        continue;\n      }\n\n      var subDomainsData = this._domains.get(domainUnit);\n\n      if (!temp.hasOwnProperty(domainUnit)) {\n        temp[domainUnit] = subDomainsData.map(extractTime);\n      }\n\n      var index = temp[domainUnit].indexOf(\n        this._domainType[this.options.subDomain].extractUnit(date),\n      );\n\n      if (updateMode === this.RESET_SINGLE_ON_UPDATE) {\n        subDomainsData[index].v = data[d];\n      } else {\n        if (!isNaN(subDomainsData[index].v)) {\n          subDomainsData[index].v += data[d];\n        } else {\n          subDomainsData[index].v = data[d];\n        }\n      }\n    }\n  },\n\n  parseURI: function (str, startDate, endDate) {\n    'use strict';\n\n    // Use a timestamp in seconds\n    str = str.replace(/\\{\\{t:start\\}\\}/g, startDate.getTime() / 1000);\n    str = str.replace(/\\{\\{t:end\\}\\}/g, endDate.getTime() / 1000);\n\n    // Use a string date, following the ISO-8601\n    str = str.replace(/\\{\\{d:start\\}\\}/g, startDate.toISOString());\n    str = str.replace(/\\{\\{d:end\\}\\}/g, endDate.toISOString());\n\n    return str;\n  },\n\n  interpretCSV: function (data) {\n    'use strict';\n\n    var d = {};\n    var keys = Object.keys(data[0]);\n    var i, total;\n    for (i = 0, total = data.length; i < total; i += 1) {\n      d[data[i][keys[0]]] = +data[i][keys[1]];\n    }\n    return d;\n  },\n\n  /**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */\n  resize: function () {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n    var legendWidth = options.displayLegend\n      ? parent.Legend.getDim('width') +\n        options.legendMargin[1] +\n        options.legendMargin[3]\n      : 0;\n    var legendHeight = options.displayLegend\n      ? parent.Legend.getDim('height') +\n        options.legendMargin[0] +\n        options.legendMargin[2]\n      : 0;\n\n    var graphWidth =\n      parent.graphDim.width - options.domainGutter - options.cellPadding;\n    var graphHeight =\n      parent.graphDim.height - options.domainGutter - options.cellPadding;\n\n    this.root\n      .transition()\n      .duration(options.animationDuration)\n      .attr('width', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return graphWidth + legendWidth;\n        }\n        return Math.max(graphWidth, legendWidth);\n      })\n      .attr('height', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return Math.max(graphHeight, legendHeight);\n        }\n        return graphHeight + legendHeight;\n      });\n\n    this.root\n      .select('.graph')\n      .transition()\n      .duration(options.animationDuration)\n      .attr('y', function () {\n        if (options.legendVerticalPosition === 'top') {\n          return legendHeight;\n        }\n        return 0;\n      })\n      .attr('x', function () {\n        if (\n          (options.legendVerticalPosition === 'middle' ||\n            options.legendVerticalPosition === 'center') &&\n          options.legendHorizontalPosition === 'left'\n        ) {\n          return legendWidth;\n        }\n        return 0;\n      });\n  },\n\n  // =========================================================================//\n  // PUBLIC API                                //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar forward\n   */\n  next: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadNextDomain(n);\n  },\n\n  /**\n   * Shift the calendar backward\n   */\n  previous: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadPreviousDomain(n);\n  },\n\n  /**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */\n  jumpTo: function (date, reset) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      reset = false;\n    }\n    var domains = this.getDomainKeys();\n    var firstDomain = domains[0];\n    var lastDomain = domains[domains.length - 1];\n\n    if (date < firstDomain) {\n      return this.loadPreviousDomain(this.getDomain(firstDomain, date).length);\n    } else {\n      if (reset) {\n        return this.loadNextDomain(this.getDomain(firstDomain, date).length);\n      }\n\n      if (date > lastDomain) {\n        return this.loadNextDomain(this.getDomain(lastDomain, date).length);\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */\n  rewind: function () {\n    'use strict';\n\n    this.jumpTo(this.options.start, true);\n  },\n\n  /**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar's datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don't want to use the afterLoad() callback\n   */\n  update: function (dataSource, afterLoad, updateMode) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      dataSource = this.options.data;\n    }\n    if (arguments.length < 2) {\n      afterLoad = true;\n    }\n    if (arguments.length < 3) {\n      updateMode = this.RESET_ALL_ON_UPDATE;\n    }\n\n    var domains = this.getDomainKeys();\n    var self = this;\n    this.getDatas(\n      dataSource,\n      new Date(domains[0]),\n      this.getSubDomain(domains[domains.length - 1]).pop(),\n      function () {\n        self.fill();\n        self.afterUpdate();\n      },\n      afterLoad,\n      updateMode,\n    );\n  },\n\n  /**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */\n  setLegend: function () {\n    'use strict';\n\n    var oldLegend = this.options.legend.slice(0);\n    if (arguments.length >= 1 && Array.isArray(arguments[0])) {\n      this.options.legend = arguments[0];\n    }\n    if (arguments.length >= 2) {\n      if (Array.isArray(arguments[1]) && arguments[1].length >= 2) {\n        this.options.legendColors = [arguments[1][0], arguments[1][1]];\n      } else {\n        this.options.legendColors = arguments[1];\n      }\n    }\n\n    if (\n      (arguments.length > 0 && !arrayEquals(oldLegend, this.options.legend)) ||\n      arguments.length >= 2\n    ) {\n      this.Legend.buildColors();\n      this.fill();\n    }\n\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n  },\n\n  /**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */\n  removeLegend: function () {\n    'use strict';\n\n    if (!this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = false;\n    this.Legend.remove();\n    return true;\n  },\n\n  /**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */\n  showLegend: function () {\n    'use strict';\n\n    if (this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = true;\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n    return true;\n  },\n\n  /**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */\n  highlight: function (args) {\n    'use strict';\n\n    if ((this.options.highlight = this.expandDateSetting(args)).length > 0) {\n      this.fill();\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */\n  destroy: function (callback) {\n    'use strict';\n\n    this.root\n      .transition()\n      .duration(this.options.animationDuration)\n      .attr('width', 0)\n      .attr('height', 0)\n      .remove()\n      .each('end', function () {\n        if (typeof callback === 'function') {\n          callback();\n        } else if (typeof callback !== 'undefined') {\n          console.log('Provided callback for destroy() is not a function.');\n        }\n      });\n\n    return null;\n  },\n\n  getSVG: function () {\n    'use strict';\n\n    var styles = {\n      '.cal-heatmap-container': {},\n      '.graph': {},\n      '.graph-rect': {},\n      'rect.highlight': {},\n      'rect.now': {},\n      'rect.highlight-now': {},\n      'text.highlight': {},\n      'text.now': {},\n      'text.highlight-now': {},\n      '.domain-background': {},\n      '.graph-label': {},\n      '.subdomain-text': {},\n      '.q0': {},\n      '.qi': {},\n    };\n\n    for (\n      var j = 1, total = this.options.legend.length + 1;\n      j <= total;\n      j += 1\n    ) {\n      styles['.q' + j] = {};\n    }\n\n    var root = this.root;\n\n    var whitelistStyles = [\n      // SVG specific properties\n      'stroke',\n      'stroke-width',\n      'stroke-opacity',\n      'stroke-dasharray',\n      'stroke-dashoffset',\n      'stroke-linecap',\n      'stroke-miterlimit',\n      'fill',\n      'fill-opacity',\n      'fill-rule',\n      'marker',\n      'marker-start',\n      'marker-mid',\n      'marker-end',\n      'alignement-baseline',\n      'baseline-shift',\n      'dominant-baseline',\n      'glyph-orientation-horizontal',\n      'glyph-orientation-vertical',\n      'kerning',\n      'text-anchor',\n      'shape-rendering',\n\n      // Text Specific properties\n      'text-transform',\n      'font-family',\n      'font',\n      'font-size',\n      'font-weight',\n    ];\n\n    var filterStyles = function (attribute, property, value) {\n      if (whitelistStyles.indexOf(property) !== -1) {\n        styles[attribute][property] = value;\n      }\n    };\n\n    var getElement = function (e) {\n      return root.select(e)[0][0];\n    };\n\n    /* jshint forin:false */\n    for (var element in styles) {\n      if (!styles.hasOwnProperty(element)) {\n        continue;\n      }\n\n      var dom = getElement(element);\n\n      if (dom === null) {\n        continue;\n      }\n\n      // The DOM Level 2 CSS way\n      /* jshint maxdepth: false */\n      if ('getComputedStyle' in window) {\n        var cs = getComputedStyle(dom, null);\n        if (cs.length !== 0) {\n          for (var i = 0; i < cs.length; i += 1) {\n            filterStyles(element, cs.item(i), cs.getPropertyValue(cs.item(i)));\n          }\n\n          // Opera workaround. Opera doesn\"t support `item`/`length`\n          // on CSSStyleDeclaration.\n        } else {\n          for (var k in cs) {\n            if (cs.hasOwnProperty(k)) {\n              filterStyles(element, k, cs[k]);\n            }\n          }\n        }\n\n        // The IE way\n      } else if ('currentStyle' in dom) {\n        var css = dom.currentStyle;\n        for (var p in css) {\n          filterStyles(element, p, css[p]);\n        }\n      }\n    }\n\n    var string =\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" ' +\n      'xmlns:xlink=\"http://www.w3.org/1999/xlink\"><style type=\"text/css\"><![CDATA[ ';\n\n    for (var style in styles) {\n      string += style + ' {\\n';\n      for (var l in styles[style]) {\n        string += '\\t' + l + ':' + styles[style][l] + ';\\n';\n      }\n      string += '}\\n';\n    }\n\n    string += ']]></style>';\n    string += new XMLSerializer().serializeToString(this.root[0][0]);\n    string += '</svg>';\n\n    return string;\n  },\n};\n\n// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n\n/**\n * Compute the position of a domain, relative to the calendar\n */\nvar DomainPosition = function () {\n  'use strict';\n\n  this.positions = d3.map();\n};\n\nDomainPosition.prototype.getPosition = function (d) {\n  'use strict';\n\n  return this.positions.get(d);\n};\n\nDomainPosition.prototype.getPositionFromIndex = function (i) {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[i]);\n};\n\nDomainPosition.prototype.getLast = function () {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.setPosition = function (d, dim) {\n  'use strict';\n\n  this.positions.set(d, dim);\n};\n\nDomainPosition.prototype.shiftRightBy = function (exitingDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value - exitingDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[0]);\n};\n\nDomainPosition.prototype.shiftLeftBy = function (enteringDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value + enteringDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.getKeys = function () {\n  'use strict';\n\n  return this.positions.keys().sort(function (a, b) {\n    return parseInt(a, 10) - parseInt(b, 10);\n  });\n};\n\n// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\n\nvar Legend = function (calendar) {\n  'use strict';\n\n  this.calendar = calendar;\n  this.computeDim();\n\n  if (calendar.options.legendColors !== null) {\n    this.buildColors();\n  }\n};\n\nLegend.prototype.computeDim = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n  this.dim = {\n    width:\n      options.legendCellSize * (options.legend.length + 1) +\n      options.legendCellPadding * options.legend.length,\n    height: options.legendCellSize,\n  };\n};\n\nLegend.prototype.remove = function () {\n  'use strict';\n\n  this.calendar.root.select('.graph-legend').remove();\n  this.calendar.resize();\n};\n\nLegend.prototype.redraw = function (width) {\n  'use strict';\n\n  if (!this.calendar.options.displayLegend) {\n    return false;\n  }\n\n  var parent = this;\n  var calendar = this.calendar;\n  var legend = calendar.root;\n  var legendItem;\n  var options = calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  this.computeDim();\n\n  var _legend = options.legend.slice(0);\n  _legend.push(_legend[_legend.length - 1] + 1);\n\n  var legendElement = calendar.root.select('.graph-legend');\n  if (legendElement[0][0] !== null) {\n    legend = legendElement;\n    legendItem = legend.select('g').selectAll('rect').data(_legend);\n  } else {\n    // Creating the new legend DOM if it doesn't already exist\n    legend =\n      options.legendVerticalPosition === 'top'\n        ? legend.insert('svg', '.graph')\n        : legend.append('svg');\n\n    legend.attr('x', getLegendXPosition()).attr('y', getLegendYPosition());\n\n    legendItem = legend\n      .attr('class', 'graph-legend')\n      .attr('height', parent.getDim('height'))\n      .attr('width', parent.getDim('width'))\n      .append('g')\n      .selectAll()\n      .data(_legend);\n  }\n\n  legendItem\n    .enter()\n    .append('rect')\n    .call(legendCellLayout)\n    .attr('class', function (d) {\n      return calendar.Legend.getClass(d, calendar.legendScale === null);\n    })\n    .attr('fill-opacity', 0)\n    .call(function (selection) {\n      if (\n        calendar.legendScale !== null &&\n        options.legendColors !== null &&\n        options.legendColors.hasOwnProperty('base')\n      ) {\n        selection.attr('fill', options.legendColors.base);\n      }\n    })\n    .append('title');\n\n  legendItem\n    .exit()\n    .transition()\n    .duration(options.animationDuration)\n    .attr('fill-opacity', 0)\n    .remove();\n\n  legendItem\n    .transition()\n    .delay(function (d, i) {\n      return (options.animationDuration * i) / 10;\n    })\n    .call(legendCellLayout)\n    .attr('fill-opacity', 1)\n    .call(function (element) {\n      element.attr('fill', function (d, i) {\n        if (calendar.legendScale === null) {\n          return '';\n        }\n\n        if (i === 0) {\n          return calendar.legendScale(d - 1);\n        }\n        return calendar.legendScale(options.legend[i - 1]);\n      });\n\n      element.attr('class', function (d) {\n        return calendar.Legend.getClass(d, calendar.legendScale === null);\n      });\n    });\n\n  function legendCellLayout(selection) {\n    selection\n      .attr('width', options.legendCellSize)\n      .attr('height', options.legendCellSize)\n      .attr('rx', options.legendCellRadius)\n      .attr('ry', options.legendCellRadius)\n      .attr('x', function (d, i) {\n        return i * (options.legendCellSize + options.legendCellPadding);\n      });\n  }\n\n  legendItem.select('title').text(function (d, i) {\n    if (i === 0) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.lower, {\n        min: options.legend[i],\n        name: options.itemName[1],\n      });\n    } else if (i === _legend.length - 1) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.upper, {\n        max: options.legend[i - 1],\n        name: options.itemName[1],\n      });\n    } else {\n      return calendar.formatStringWithObject(options.legendTitleFormat.inner, {\n        down: options.legend[i - 1],\n        up: options.legend[i],\n        name: options.itemName[1],\n      });\n    }\n  });\n  legendItem\n    .on('mouseover', function (d) {\n      calendar.legendTip.show(d, this);\n    })\n    .on('mouseout', function () {\n      calendar.legendTip.hide();\n    });\n\n  legend\n    .transition()\n    .duration(options.animationDuration)\n    .attr('x', getLegendXPosition())\n    .attr('y', getLegendYPosition())\n    .attr('width', parent.getDim('width'))\n    .attr('height', parent.getDim('height'));\n\n  legend\n    .select('g')\n    .transition()\n    .duration(options.animationDuration)\n    .attr('transform', function () {\n      if (options.legendOrientation === 'vertical') {\n        return (\n          'rotate(90 ' +\n          options.legendCellSize / 2 +\n          ' ' +\n          options.legendCellSize / 2 +\n          ')'\n        );\n      }\n      return '';\n    });\n\n  function getLegendXPosition() {\n    switch (options.legendHorizontalPosition) {\n      case 'right':\n        if (\n          options.legendVerticalPosition === 'center' ||\n          options.legendVerticalPosition === 'middle'\n        ) {\n          return width + options.legendMargin[3];\n        }\n        return width - parent.getDim('width') - options.legendMargin[1];\n      case 'middle':\n      case 'center':\n        return Math.round(width / 2 - parent.getDim('width') / 2);\n      default:\n        return options.legendMargin[3];\n    }\n  }\n\n  function getLegendYPosition() {\n    if (options.legendVerticalPosition === 'bottom') {\n      return (\n        calendar.graphDim.height +\n        options.legendMargin[0] -\n        options.domainGutter -\n        options.cellPadding\n      );\n    }\n    return options.legendMargin[0];\n  }\n\n  calendar.resize();\n};\n\n/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */\nLegend.prototype.getDim = function (axis) {\n  'use strict';\n\n  var isHorizontal = this.calendar.options.legendOrientation === 'horizontal';\n\n  switch (axis) {\n    case 'width':\n      return this.dim[isHorizontal ? 'width' : 'height'];\n    case 'height':\n      return this.dim[isHorizontal ? 'height' : 'width'];\n  }\n};\n\nLegend.prototype.buildColors = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  if (options.legendColors === null) {\n    this.calendar.legendScale = null;\n    return false;\n  }\n\n  var _colorRange = [];\n\n  if (Array.isArray(options.legendColors)) {\n    _colorRange = options.legendColors;\n  } else if (\n    options.legendColors.hasOwnProperty('min') &&\n    options.legendColors.hasOwnProperty('max')\n  ) {\n    _colorRange = [options.legendColors.min, options.legendColors.max];\n  } else {\n    options.legendColors = null;\n    return false;\n  }\n\n  var _legend = options.legend.slice(0);\n\n  if (_legend[0] > 0) {\n    _legend.unshift(0);\n  } else if (_legend[0] <= 0) {\n    // Let's guess the leftmost value, it we have to add one\n    _legend.unshift(\n      _legend[0] - (_legend[_legend.length - 1] - _legend[0]) / _legend.length,\n    );\n  }\n  var colorScale;\n  if (options.legendColors.hasOwnProperty('colorScale')) {\n    colorScale = options.legendColors.colorScale;\n  } else {\n    colorScale = d3.scale\n      .linear()\n      .range(_colorRange)\n      .interpolate(d3.interpolateHcl)\n      .domain([d3.min(_legend), d3.max(_legend)]);\n  }\n\n  var legendColors = _legend.map(function (element) {\n    return colorScale(element);\n  });\n  this.calendar.legendScale = d3.scale\n    .threshold()\n    .domain(options.legend)\n    .range(legendColors);\n\n  return true;\n};\n\n/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */\nLegend.prototype.getClass = function (n, withCssClass) {\n  'use strict';\n\n  if (n === null || isNaN(n)) {\n    return '';\n  }\n\n  var index = [this.calendar.options.legend.length + 1];\n\n  for (\n    var i = 0, total = this.calendar.options.legend.length - 1;\n    i <= total;\n    i += 1\n  ) {\n    if (this.calendar.options.legend[0] > 0 && n < 0) {\n      index = ['1', 'i'];\n      break;\n    }\n\n    if (n <= this.calendar.options.legend[i]) {\n      index = [i + 1];\n      break;\n    }\n  }\n\n  if (n === 0) {\n    index.push(0);\n  }\n\n  index.unshift('');\n  return (index.join(' r') + (withCssClass ? index.join(' q') : '')).trim();\n};\n\n/**\n * #source http://stackoverflow.com/a/383245/805649\n */\nfunction mergeRecursive(obj1, obj2) {\n  'use strict';\n\n  /*jshint forin:false */\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if (obj2[p].constructor === Object) {\n        obj1[p] = mergeRecursive(obj1[p], obj2[p]);\n      } else {\n        obj1[p] = obj2[p];\n      }\n    } catch (e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n    }\n  }\n\n  return obj1;\n}\n\n/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */\nfunction arrayEquals(arrayA, arrayB) {\n  'use strict';\n\n  // if the other array is a falsy value, return\n  if (!arrayB || !arrayA) {\n    return false;\n  }\n\n  // compare lengths - can save a lot of time\n  if (arrayA.length !== arrayB.length) {\n    return false;\n  }\n\n  for (var i = 0; i < arrayA.length; i += 1) {\n    // Check if we have nested arrays\n    if (arrayA[i] instanceof Array && arrayB[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!arrayEquals(arrayA[i], arrayB[i])) {\n        return false;\n      }\n    } else if (arrayA[i] !== arrayB[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n  return true;\n}\n\nexport default CalHeatMap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}