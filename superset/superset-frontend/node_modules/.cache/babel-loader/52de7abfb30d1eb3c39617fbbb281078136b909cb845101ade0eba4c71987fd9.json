{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};import * as d3array from 'd3-array';\nimport sandboxedEval from '../utils/sandbox';\nexport function commonLayerProps(formData, setTooltip, setTooltipContent, onSelect) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y\n        });\n      } else\n      {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else\n  if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover)\n  };\n}\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99\n};\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(type = 'sum', accessor = null) {\n  if (type === 'count') {\n    return (arr) => arr.length;\n  }\n  let d3func;\n  if (type in percentiles) {\n    d3func = (arr, acc) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1, o2) => d3array.ascending(accessor(o1), accessor(o2)));\n      } else\n      {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else\n  {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr) => d3func(arr);\n  }\n  return (arr) => d3func(arr.map((x) => accessor(x)));\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(commonLayerProps, \"commonLayerProps\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");reactHotLoader.register(percentiles, \"percentiles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");reactHotLoader.register(getAggFunc, \"getAggFunc\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["d3array","sandboxedEval","commonLayerProps","formData","setTooltip","setTooltipContent","onSelect","fd","onHover","tooltipContentGenerator","js_tooltip","o","picked","content","x","y","onClick","js_onclick_href","href","window","open","table_filter","undefined","object","line_column","pickable","Boolean","percentiles","p1","p5","p95","p99","getAggFunc","type","accessor","arr","length","d3func","acc","sortedArr","sort","o1","o2","ascending","quantile","map","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport * as d3array from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr: JsonObject[]) => d3func(arr);\n  }\n\n  return (arr: JsonObject[]) => d3func(arr.map(x => accessor(x)));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}