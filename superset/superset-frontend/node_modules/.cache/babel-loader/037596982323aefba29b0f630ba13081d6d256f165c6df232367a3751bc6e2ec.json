{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Clauses, ExpressionTypes } from '../types';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType]\n    )\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n    this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column')\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql\n      })\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql\n      })\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange\n    };\n    const keywords = sqlKeywords.concat(\n      options.\n      map((option) => {\n        if (option.column_name) {\n          return {\n            name: option.column_name,\n            value: option.column_name,\n            score: 50,\n            meta: 'option'\n          };\n        }\n        return null;\n      }).\n      filter(Boolean)\n    );\n    const selectOptions = Object.keys(Clauses).map((clause) => ({\n      label: clause,\n      value: clause\n    }));\n\n    return (\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(\"div\", { className: \"filter-edit-clause-section\" },\n      ___EmotionJSX(StyledSelect, _extends({\n        options: selectOptions },\n      this.selectProps,\n      clauseSelectProps)\n      ),\n      ___EmotionJSX(\"span\", { className: \"filter-edit-clause-info\" },\n      ___EmotionJSX(\"strong\", null, \"WHERE\"), \" \", t('Filters by columns'),\n      ___EmotionJSX(\"br\", null),\n      ___EmotionJSX(\"strong\", null, \"HAVING\"), \" \", t('Filters by metrics')\n      )\n      ),\n      ___EmotionJSX(\"div\", { css: (theme) => ({ marginTop: theme.gridUnit * 4 }) },\n      ___EmotionJSX(SQLEditor, {\n        ref: this.handleAceEditorRef,\n        keywords: keywords,\n        height: `${height - 130}px`,\n        onChange: this.onSqlExpressionChange,\n        width: \"100%\",\n        showGutter: false,\n        value: adhocFilter.sqlExpression || adhocFilter.translateToSql(),\n        editorProps: { $blockScrolling: true },\n        enableLiveAutocompletion: true,\n        className: \"filter-sql-editor\",\n        wrapEnabled: true }\n      )\n      )\n      ));\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}AdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(StyledSelect, \"StyledSelect\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(AdhocFilterEditPopoverSqlTabContent, \"AdhocFilterEditPopoverSqlTabContent\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","PropTypes","Select","styled","t","SQLEditor","sqlKeywords","adhocMetricType","columnType","AdhocFilter","Clauses","ExpressionTypes","jsx","___EmotionJSX","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","options","arrayOf","oneOfType","shape","saved_metric_name","string","height","number","activeKey","StyledSelect","theme","gridUnit","AdhocFilterEditPopoverSqlTabContent","Component","constructor","props","onSqlExpressionChange","bind","onSqlExpressionClauseChange","handleAceEditorRef","selectProps","ariaLabel","componentDidUpdate","aceEditorRef","editor","resize","clause","duplicateWith","expressionType","Sql","sqlExpression","ref","render","clauseSelectProps","placeholder","value","keywords","concat","map","option","column_name","name","score","meta","filter","Boolean","selectOptions","Object","keys","label","className","_extends","css","marginTop","width","showGutter","translateToSql","editorProps","$blockScrolling","enableLiveAutocompletion","wrapEnabled","__reactstandin__regenerateByEval","key","code","eval","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column'),\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange,\n    };\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.keys(Clauses).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <StyledSelect\n            options={selectOptions}\n            {...this.selectProps}\n            {...clauseSelectProps}\n          />\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}