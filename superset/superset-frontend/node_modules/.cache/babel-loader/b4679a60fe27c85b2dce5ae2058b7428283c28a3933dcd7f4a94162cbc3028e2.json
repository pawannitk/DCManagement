{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _isEqual from \"lodash/isEqual\";import _kebabCase from \"lodash/kebabCase\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { ensureIsArray, t, styled, getChartControlPanelRegistry, DatasourceType, css, useTheme, isDefined, NO_TIME_RANGE, usePrevious } from '@superset-ui/core';\nimport { isTemporalColumn, sections } from '@superset-ui/chart-controls';\nimport { useSelector } from 'react-redux';\nimport { rgba } from 'emotion-rgba';\n\nimport Collapse from 'src/components/Collapse';\nimport Tabs from 'src/components/Tabs';\nimport { PluginContext } from 'src/components/DynamicPlugins';\nimport Loading from 'src/components/Loading';\nimport Modal from 'src/components/Modal';\nimport { getSectionsToRender } from 'src/explore/controlUtils';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport ControlRow from './ControlRow';\nimport Control from './Control';\nimport { ExploreAlert } from './ExploreAlert';\nimport { RunQueryButton } from './RunQueryButton';\nimport { Operators } from '../constants';\nimport { Clauses } from './controls/FilterControl/types';\nimport StashFormDataContainer from './StashFormDataContainer';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst { confirm } = Modal;\nconst iconStyles = css`\n  &.anticon {\n    font-size: unset;\n    .anticon {\n      line-height: unset;\n      vertical-align: unset;\n    }\n  }\n`;\nconst actionButtonsContainerStyles = (theme) => css`\n  display: flex;\n  position: sticky;\n  bottom: 0;\n  flex-direction: column;\n  align-items: center;\n  padding: ${theme.gridUnit * 4}px;\n  z-index: 999;\n  background: linear-gradient(\n    ${rgba(theme.colors.grayscale.light5, 0)},\n    ${theme.colors.grayscale.light5} ${theme.opacity.mediumLight}\n  );\n\n  & > button {\n    min-width: 156px;\n  }\n`;\nconst Styles = styled.div`\n  position: relative;\n  height: 100%;\n  width: 100%;\n\n  // Resizable add overflow-y: auto as a style to this div\n  // To override it, we need to use !important\n  overflow: visible !important;\n  #controlSections {\n    height: 100%;\n    overflow: visible;\n  }\n  .nav-tabs {\n    flex: 0 0 1;\n  }\n  .tab-content {\n    overflow: auto;\n    flex: 1 1 100%;\n  }\n  .Select__menu {\n    max-width: 100%;\n  }\n  .type-label {\n    margin-right: ${({ theme }) => theme.gridUnit * 3}px;\n    width: ${({ theme }) => theme.gridUnit * 7}px;\n    display: inline-block;\n    text-align: center;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n`;\nconst ControlPanelsTabs = styled(Tabs)`\n  ${({ theme, fullWidth }) => css`\n    height: 100%;\n    overflow: visible;\n    .ant-tabs-nav {\n      margin-bottom: 0;\n    }\n    .ant-tabs-nav-list {\n      width: ${fullWidth ? '100%' : '50%'};\n    }\n    .ant-tabs-tabpane {\n      height: 100%;\n    }\n    .ant-tabs-content-holder {\n      padding-top: ${theme.gridUnit * 4}px;\n    }\n\n    .ant-collapse-ghost > .ant-collapse-item {\n      &:not(:last-child) {\n        border-bottom: 1px solid ${theme.colors.grayscale.light3};\n      }\n\n      & > .ant-collapse-header {\n        font-size: ${theme.typography.sizes.s}px;\n      }\n\n      & > .ant-collapse-content > .ant-collapse-content-box {\n        padding-bottom: 0;\n        font-size: ${theme.typography.sizes.s}px;\n      }\n    }\n  `}\n`;\nconst isTimeSection = (section) => !!section.label && sections.legacyTimeseriesTime.label === section.label;\nconst hasTimeColumn = (datasource) => {var _datasource$columns;return datasource == null ? void 0 : (_datasource$columns = datasource.columns) == null ? void 0 : _datasource$columns.some((c) => c.is_dttm);};\nconst sectionsToExpand = (sections, datasource) =>\n// avoid expanding time section if datasource doesn't include time column\nsections.reduce((acc, section) => (section.expanded || !section.label) && (\n!isTimeSection(section) || hasTimeColumn(datasource)) ?\n[...acc, String(section.label)] :\nacc, []);\nfunction getState(vizType, datasource, datasourceType) {\n  const querySections = [];\n  const customizeSections = [];\n  getSectionsToRender(vizType, datasourceType).forEach((section) => {\n    // if at least one control in the section is not `renderTrigger`\n    // or asks to be displayed at the Data tab\n    if (section.tabOverride === 'data' ||\n    section.controlSetRows.some((rows) => rows.some((control) => control &&\n    typeof control === 'object' &&\n    'config' in control &&\n    control.config && (\n    !control.config.renderTrigger ||\n    control.config.tabOverride === 'data')))) {\n      querySections.push(section);\n    } else\n    if (section.controlSetRows.length > 0) {\n      customizeSections.push(section);\n    }\n  });\n  const expandedQuerySections = sectionsToExpand(querySections, datasource);\n  const expandedCustomizeSections = sectionsToExpand(customizeSections, datasource);\n  return {\n    expandedQuerySections,\n    expandedCustomizeSections,\n    querySections,\n    customizeSections\n  };\n}\nfunction useResetOnChangeRef(initialValue, resetOnChangeValue) {\n  const value = useRef(initialValue());\n  const prevResetOnChangeValue = useRef(resetOnChangeValue);\n  if (prevResetOnChangeValue.current !== resetOnChangeValue) {\n    value.current = initialValue();\n    prevResetOnChangeValue.current = resetOnChangeValue;\n  }\n  return value;\n}__signature__(useResetOnChangeRef, \"useRef{value}\\nuseRef{prevResetOnChangeValue}\");\nexport const ControlPanelsContainer = (props) => {var _props$exploreState$d3, _props$exploreState$d4;\n  const { colors } = useTheme();\n  const pluginContext = useContext(PluginContext);\n  const prevState = usePrevious(props.exploreState);\n  const prevDatasource = usePrevious(props.exploreState.datasource);\n  const prevChartStatus = usePrevious(props.chart.chartStatus);\n  const [showDatasourceAlert, setShowDatasourceAlert] = useState(false);\n  const containerRef = useRef(null);\n  const controlsTransferred = useSelector((state) => state.explore.controlsTransferred);\n  const defaultTimeFilter = useSelector((state) => {var _state$common, _state$common$conf;return ((_state$common = state.common) == null ? void 0 : (_state$common$conf = _state$common.conf) == null ? void 0 : _state$common$conf.DEFAULT_TIME_FILTER) || NO_TIME_RANGE;});\n  const { form_data, actions } = props;\n  const { setControlValue } = actions;\n  const { x_axis, adhoc_filters } = form_data;\n  const previousXAxis = usePrevious(x_axis);\n  useEffect(() => {\n    if (x_axis &&\n    x_axis !== previousXAxis &&\n    isTemporalColumn(x_axis, props.exploreState.datasource)) {\n      const noFilter = !(adhoc_filters != null && adhoc_filters.find((filter) => filter.expressionType === 'SIMPLE' &&\n      filter.operator === Operators.TemporalRange &&\n      filter.subject === x_axis));\n      if (noFilter) {\n        confirm({\n          title: t('The X-axis is not on the filters list'),\n          content: t(`The X-axis is not on the filters list which will prevent it from being used in\n            time range filters in dashboards. Would you like to add it to the filters list?`),\n          onOk: () => {\n            setControlValue('adhoc_filters', [\n            ...(adhoc_filters || []),\n            {\n              clause: Clauses.Where,\n              subject: x_axis,\n              operator: Operators.TemporalRange,\n              comparator: defaultTimeFilter,\n              expressionType: 'SIMPLE'\n            }]\n            );\n          }\n        });\n      }\n    }\n  }, [\n  x_axis,\n  adhoc_filters,\n  setControlValue,\n  defaultTimeFilter,\n  previousXAxis,\n  props.exploreState.datasource]\n  );\n  useEffect(() => {\n    let shouldUpdateControls = false;\n    const removeDatasourceWarningFromControl = (value) => {\n      if (typeof value === 'object' &&\n      isDefined(value) &&\n      'datasourceWarning' in value &&\n      value.datasourceWarning === true) {\n        shouldUpdateControls = true;\n        return { ...value, datasourceWarning: false };\n      }\n      return value;\n    };\n    if (props.chart.chartStatus === 'success' &&\n    prevChartStatus !== 'success') {\n      controlsTransferred == null ? void 0 : controlsTransferred.forEach((controlName) => {var _ensureIsArray;\n        shouldUpdateControls = false;\n        if (!isDefined(props.controls[controlName])) {\n          return;\n        }\n        const alteredControls = Array.isArray(props.controls[controlName].value) ? (_ensureIsArray =\n        ensureIsArray(props.controls[controlName].value)) == null ? void 0 : _ensureIsArray.map(removeDatasourceWarningFromControl) :\n        removeDatasourceWarningFromControl(props.controls[controlName].value);\n        if (shouldUpdateControls) {\n          props.actions.setControlValue(controlName, alteredControls);\n        }\n      });\n    }\n  }, [\n  controlsTransferred,\n  prevChartStatus,\n  props.actions,\n  props.chart.chartStatus,\n  props.controls]\n  );\n  useEffect(() => {var _props$exploreState$d, _props$exploreState$d2;\n    if (prevDatasource &&\n    prevDatasource.type !== DatasourceType.Query && (\n    ((_props$exploreState$d = props.exploreState.datasource) == null ? void 0 : _props$exploreState$d.id) !== prevDatasource.id ||\n    ((_props$exploreState$d2 = props.exploreState.datasource) == null ? void 0 : _props$exploreState$d2.type) !== prevDatasource.type)) {var _containerRef$current;\n      setShowDatasourceAlert(true);\n      (_containerRef$current = containerRef.current) == null ? void 0 : _containerRef$current.scrollTo(0, 0);\n    }\n  }, [(_props$exploreState$d3 =\n  props.exploreState.datasource) == null ? void 0 : _props$exploreState$d3.id, (_props$exploreState$d4 =\n  props.exploreState.datasource) == null ? void 0 : _props$exploreState$d4.type,\n  prevDatasource]\n  );\n  const { expandedQuerySections, expandedCustomizeSections, querySections, customizeSections } = useMemo(() => getState(form_data.viz_type, props.exploreState.datasource, props.datasource_type), [props.exploreState.datasource, form_data.viz_type, props.datasource_type]);\n  const resetTransferredControls = useCallback(() => {\n    ensureIsArray(props.exploreState.controlsTransferred).forEach((controlName) => props.actions.setControlValue(controlName, props.controls[controlName].default));\n  }, [props.actions, props.exploreState.controlsTransferred, props.controls]);\n  const handleClearFormClick = useCallback(() => {\n    resetTransferredControls();\n    setShowDatasourceAlert(false);\n  }, [resetTransferredControls]);\n  const handleContinueClick = useCallback(() => {\n    setShowDatasourceAlert(false);\n  }, []);\n  const shouldRecalculateControlState = ({ name, config }) => {\n    const { controls, chart, exploreState } = props;\n    return Boolean(config.shouldMapStateToProps == null ? void 0 : config.shouldMapStateToProps(prevState || exploreState, exploreState, controls[name], chart));\n  };\n  const renderControl = ({ name, config }) => {\n    const { controls, chart, exploreState } = props;\n    const { visibility } = config;\n    // If the control item is not an object, we have to look up the control data from\n    // the centralized controls file.\n    // When it is an object we read control data straight from `config` instead\n    const controlData = {\n      ...config,\n      ...controls[name],\n      ...(shouldRecalculateControlState({ name, config }) ?\n      config == null ? void 0 : config.mapStateToProps == null ? void 0 : config.mapStateToProps(exploreState, controls[name], chart) :\n      // for other controls, `mapStateToProps` is already run in\n      // controlUtils/getControlState.ts\n      undefined),\n      name\n    };\n    const { validationErrors, label: baseLabel, description: baseDescription, ...restProps } = controlData;\n    const isVisible = visibility ?\n    visibility.call(config, props, controlData) :\n    undefined;\n    const label = typeof baseLabel === 'function' ?\n    baseLabel(exploreState, controls[name], chart) :\n    baseLabel;\n    const description = typeof baseDescription === 'function' ?\n    baseDescription(exploreState, controls[name], chart) :\n    baseDescription;\n    if (name === 'adhoc_filters') {\n      restProps.canDelete = (valueToBeDeleted, values) => {var _controls$time_range;\n        const isTemporalRange = (filter) => filter.operator === Operators.TemporalRange;\n        if (!(controls != null && (_controls$time_range = controls.time_range) != null && _controls$time_range.value) && isTemporalRange(valueToBeDeleted)) {\n          const count = values.filter(isTemporalRange).length;\n          if (count === 1) {\n            // if temporal filter's value is \"No filter\", prevent deletion\n            // otherwise reset the value to \"No filter\"\n            if (valueToBeDeleted.comparator === defaultTimeFilter) {\n              return t(`You cannot delete the last temporal filter as it's used for time range filters in dashboards.`);\n            }\n            props.actions.setControlValue(name, values.map((val) => {\n              if (_isEqual(val, valueToBeDeleted)) {\n                return {\n                  ...val,\n                  comparator: defaultTimeFilter\n                };\n              }\n              return val;\n            }));\n            return false;\n          }\n        }\n        return true;\n      };\n    }\n    return ___EmotionJSX(StashFormDataContainer, { shouldStash: isVisible === false, fieldNames: [name], key: `control-container-${name}` },\n    ___EmotionJSX(Control, _extends({ key: `control-${name}`, name: name, label: label, description: description, validationErrors: validationErrors, actions: props.actions, isVisible: isVisible }, restProps))\n    );\n  };\n  const sectionHasHadNoErrors = useResetOnChangeRef(() => ({}), form_data.viz_type);\n  const renderControlPanelSection = (section) => {\n    const { controls } = props;\n    const { label, description, visibility } = section;\n    // Section label can be a ReactNode but in some places we want to\n    // have a string ID. Using forced type conversion for now,\n    // should probably add a `id` field to sections in the future.\n    const sectionId = String(label);\n    const isVisible = (visibility == null ? void 0 : visibility.call(this, props, controls)) !== false;\n    const hasErrors = section.controlSetRows.some((rows) => rows.some((item) => {\n      const controlName = typeof item === 'string' ?\n      item :\n      item && 'name' in item ?\n      item.name :\n      null;\n      return controlName &&\n      controlName in controls &&\n      controls[controlName].validationErrors &&\n      controls[controlName].validationErrors.length > 0;\n    }));\n    if (!hasErrors) {\n      sectionHasHadNoErrors.current[sectionId] = true;\n    }\n    const errorColor = sectionHasHadNoErrors.current[sectionId] ?\n    colors.error.base :\n    colors.alert.base;\n    const PanelHeader = () => ___EmotionJSX(\"span\", { \"data-test\": \"collapsible-control-panel-header\" },\n    ___EmotionJSX(\"span\", { css: (theme) => css`\n            font-size: ${theme.typography.sizes.m}px;\n            line-height: 1.3;\n          ` },\n    label\n    ), ' ',\n    description && ___EmotionJSX(Tooltip, { id: sectionId, title: description },\n    ___EmotionJSX(Icons.InfoCircleOutlined, { css: iconStyles })\n    ),\n    hasErrors && ___EmotionJSX(Tooltip, { id: `${_kebabCase('validation-errors')}-tooltip`, title: t('This section contains validation errors') },\n    ___EmotionJSX(Icons.InfoCircleOutlined, { css: css`\n                ${iconStyles};\n                color: ${errorColor};\n              ` })\n    )\n    );\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(StashFormDataContainer, { key: `sectionId-${sectionId}`, shouldStash: !isVisible, fieldNames: section.controlSetRows.\n      flat().\n      map((item) => item && typeof item === 'object' ?\n      'name' in item ?\n      item.name :\n      '' :\n      String(item || '')).\n      filter(Boolean) }),\n    isVisible && ___EmotionJSX(Collapse.Panel, { css: (theme) => css`\n              margin-bottom: 0;\n              box-shadow: none;\n\n              &:last-child {\n                padding-bottom: ${theme.gridUnit * 16}px;\n                border-bottom: 0;\n              }\n\n              .panel-body {\n                margin-left: ${theme.gridUnit * 4}px;\n                padding-bottom: 0;\n              }\n\n              span.label {\n                display: inline-block;\n              }\n              ${!section.label &&\n      `\n            .ant-collapse-header {\n              display: none;\n            }\n          `}\n            `, header: ___EmotionJSX(PanelHeader, null), key: sectionId },\n    section.controlSetRows.map((controlSets, i) => {\n      const renderedControls = controlSets.\n      map((controlItem) => {\n        if (!controlItem) {\n          // When the item is invalid\n          return null;\n        }\n        if ( /*#__PURE__*/React.isValidElement(controlItem)) {\n          // When the item is a React element\n          return controlItem;\n        }\n        if (controlItem.name &&\n        controlItem.config &&\n        controlItem.name !== 'datasource') {\n          return renderControl(controlItem);\n        }\n        return null;\n      }).\n      filter((x) => x !== null);\n      // don't show the row if it is empty\n      if (renderedControls.length === 0) {\n        return null;\n      }\n      return ___EmotionJSX(ControlRow, { key: `controlsetrow-${i}`, controls: renderedControls });\n    })\n    )\n    );\n  };\n  const hasControlsTransferred = ensureIsArray(props.exploreState.controlsTransferred).length > 0;\n  const DatasourceAlert = useCallback(() => hasControlsTransferred ? ___EmotionJSX(ExploreAlert, { title: t('Keep control settings?'), bodyText: t(\"You've changed datasets. Any controls with data (columns, metrics) that match this new dataset have been retained.\"), primaryButtonAction: handleContinueClick, secondaryButtonAction: handleClearFormClick, primaryButtonText: t('Continue'), secondaryButtonText: t('Clear form'), type: \"info\" }) : ___EmotionJSX(ExploreAlert, { title: t('No form settings were maintained'), bodyText: t('We were unable to carry over any controls when switching to this new dataset.'), primaryButtonAction: handleContinueClick, primaryButtonText: t('Continue'), type: \"warning\" }), [handleClearFormClick, handleContinueClick, hasControlsTransferred]);\n  const dataTabHasHadNoErrors = useResetOnChangeRef(() => false, form_data.viz_type);\n  const dataTabTitle = useMemo(() => {\n    if (!props.errorMessage) {\n      dataTabHasHadNoErrors.current = true;\n    }\n    const errorColor = dataTabHasHadNoErrors.current ?\n    colors.error.base :\n    colors.alert.base;\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(\"span\", null, t('Data')),\n    props.errorMessage && ___EmotionJSX(\"span\", { css: (theme) => css`\n              margin-left: ${theme.gridUnit * 2}px;\n            ` },\n    ' ',\n    ___EmotionJSX(Tooltip, { id: \"query-error-tooltip\", placement: \"right\", title: props.errorMessage },\n    ___EmotionJSX(Icons.ExclamationCircleOutlined, { css: css`\n                  ${iconStyles};\n                  color: ${errorColor};\n                ` })\n    )\n    )\n    );\n  }, [\n  colors.error.base,\n  colors.alert.base,\n  dataTabHasHadNoErrors,\n  props.errorMessage]\n  );\n  const controlPanelRegistry = getChartControlPanelRegistry();\n  if (!controlPanelRegistry.has(form_data.viz_type) && pluginContext.loading) {\n    return ___EmotionJSX(Loading, null);\n  }\n  const showCustomizeTab = customizeSections.length > 0;\n  return ___EmotionJSX(Styles, { ref: containerRef },\n  ___EmotionJSX(ControlPanelsTabs, { id: \"controlSections\", \"data-test\": \"control-tabs\", fullWidth: showCustomizeTab, allowOverflow: false },\n  ___EmotionJSX(Tabs.TabPane, { key: \"query\", tab: dataTabTitle },\n  ___EmotionJSX(Collapse, { defaultActiveKey: expandedQuerySections, expandIconPosition: \"right\", ghost: true },\n  showDatasourceAlert && ___EmotionJSX(DatasourceAlert, null),\n  querySections.map(renderControlPanelSection)\n  )\n  ),\n  showCustomizeTab && ___EmotionJSX(Tabs.TabPane, { key: \"display\", tab: t('Customize') },\n  ___EmotionJSX(Collapse, { defaultActiveKey: expandedCustomizeSections, expandIconPosition: \"right\", ghost: true },\n  customizeSections.map(renderControlPanelSection)\n  )\n  )\n  ),\n  ___EmotionJSX(\"div\", { css: actionButtonsContainerStyles },\n  ___EmotionJSX(RunQueryButton, { onQuery: props.onQuery, onStop: props.onStop, errorMessage: props.errorMessage, loading: props.chart.chartStatus === 'loading', isNewChart: !props.chart.queriesResponse, canStopQuery: props.canStopQuery, chartIsStale: props.chartIsStale })\n  )\n  );\n};__signature__(ControlPanelsContainer, \"useTheme{{ colors }}\\nuseContext{pluginContext}\\nusePrevious{prevState}\\nusePrevious{prevDatasource}\\nusePrevious{prevChartStatus}\\nuseState{[showDatasourceAlert, setShowDatasourceAlert](false)}\\nuseRef{containerRef}\\nuseSelector{controlsTransferred}\\nuseSelector{defaultTimeFilter}\\nusePrevious{previousXAxis}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{{ expandedQuerySections, expandedCustomizeSections, querySections, customizeSections, }}\\nuseCallback{resetTransferredControls}\\nuseCallback{handleClearFormClick}\\nuseCallback{handleContinueClick}\\nuseResetOnChangeRef{sectionHasHadNoErrors}\\nuseCallback{DatasourceAlert}\\nuseResetOnChangeRef{dataTabHasHadNoErrors}\\nuseMemo{dataTabTitle}\", () => [useTheme, usePrevious, usePrevious, usePrevious, useSelector, useSelector, usePrevious, useResetOnChangeRef, useResetOnChangeRef]);const _default =\nControlPanelsContainer;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(confirm, \"confirm\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(iconStyles, \"iconStyles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(actionButtonsContainerStyles, \"actionButtonsContainerStyles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(Styles, \"Styles\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(ControlPanelsTabs, \"ControlPanelsTabs\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(isTimeSection, \"isTimeSection\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(hasTimeColumn, \"hasTimeColumn\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(sectionsToExpand, \"sectionsToExpand\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(getState, \"getState\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(useResetOnChangeRef, \"useResetOnChangeRef\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(ControlPanelsContainer, \"ControlPanelsContainer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useMemo","useRef","useState","ensureIsArray","t","styled","getChartControlPanelRegistry","DatasourceType","css","useTheme","isDefined","NO_TIME_RANGE","usePrevious","isTemporalColumn","sections","useSelector","rgba","Collapse","Tabs","PluginContext","Loading","Modal","getSectionsToRender","Tooltip","Icons","ControlRow","Control","ExploreAlert","RunQueryButton","Operators","Clauses","StashFormDataContainer","jsx","___EmotionJSX","confirm","iconStyles","actionButtonsContainerStyles","theme","gridUnit","colors","grayscale","light5","opacity","mediumLight","Styles","div","typography","weights","bold","ControlPanelsTabs","fullWidth","light3","sizes","s","isTimeSection","section","label","legacyTimeseriesTime","hasTimeColumn","datasource","_datasource$columns","columns","some","c","is_dttm","sectionsToExpand","reduce","acc","expanded","String","getState","vizType","datasourceType","querySections","customizeSections","forEach","tabOverride","controlSetRows","rows","control","config","renderTrigger","push","length","expandedQuerySections","expandedCustomizeSections","useResetOnChangeRef","initialValue","resetOnChangeValue","value","prevResetOnChangeValue","current","__signature__","ControlPanelsContainer","props","_props$exploreState$d3","_props$exploreState$d4","pluginContext","prevState","exploreState","prevDatasource","prevChartStatus","chart","chartStatus","showDatasourceAlert","setShowDatasourceAlert","containerRef","controlsTransferred","state","explore","defaultTimeFilter","_state$common","_state$common$conf","common","conf","DEFAULT_TIME_FILTER","form_data","actions","setControlValue","x_axis","adhoc_filters","previousXAxis","noFilter","find","filter","expressionType","operator","TemporalRange","subject","title","content","onOk","clause","Where","comparator","shouldUpdateControls","removeDatasourceWarningFromControl","datasourceWarning","controlName","_ensureIsArray","controls","alteredControls","Array","isArray","map","_props$exploreState$d","_props$exploreState$d2","type","Query","id","_containerRef$current","scrollTo","viz_type","datasource_type","resetTransferredControls","default","handleClearFormClick","handleContinueClick","shouldRecalculateControlState","name","Boolean","shouldMapStateToProps","renderControl","visibility","controlData","mapStateToProps","undefined","validationErrors","baseLabel","description","baseDescription","restProps","isVisible","call","canDelete","valueToBeDeleted","values","_controls$time_range","isTemporalRange","time_range","count","val","_isEqual","shouldStash","fieldNames","key","_extends","sectionHasHadNoErrors","renderControlPanelSection","sectionId","hasErrors","item","errorColor","error","base","alert","PanelHeader","m","InfoCircleOutlined","_kebabCase","Fragment","flat","Panel","header","controlSets","i","renderedControls","controlItem","isValidElement","x","hasControlsTransferred","DatasourceAlert","bodyText","primaryButtonAction","secondaryButtonAction","primaryButtonText","secondaryButtonText","dataTabHasHadNoErrors","dataTabTitle","errorMessage","placement","ExclamationCircleOutlined","controlPanelRegistry","has","loading","showCustomizeTab","ref","allowOverflow","TabPane","tab","defaultActiveKey","expandIconPosition","ghost","onQuery","onStop","isNewChart","queriesResponse","canStopQuery","chartIsStale","_default","reactHotLoader","reactHotLoaderGlobal","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/explore/components/ControlPanelsContainer.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, {\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  ensureIsArray,\n  t,\n  styled,\n  getChartControlPanelRegistry,\n  QueryFormData,\n  DatasourceType,\n  css,\n  SupersetTheme,\n  useTheme,\n  isDefined,\n  JsonValue,\n  NO_TIME_RANGE,\n  usePrevious,\n} from '@superset-ui/core';\nimport {\n  ControlPanelSectionConfig,\n  ControlState,\n  CustomControlItem,\n  Dataset,\n  ExpandedControlItem,\n  isTemporalColumn,\n  sections,\n} from '@superset-ui/chart-controls';\nimport { useSelector } from 'react-redux';\nimport { rgba } from 'emotion-rgba';\nimport { kebabCase, isEqual } from 'lodash';\n\nimport Collapse from 'src/components/Collapse';\nimport Tabs from 'src/components/Tabs';\nimport { PluginContext } from 'src/components/DynamicPlugins';\nimport Loading from 'src/components/Loading';\nimport Modal from 'src/components/Modal';\n\nimport { getSectionsToRender } from 'src/explore/controlUtils';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport { ChartState, ExplorePageState } from 'src/explore/types';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport ControlRow from './ControlRow';\nimport Control from './Control';\nimport { ExploreAlert } from './ExploreAlert';\nimport { RunQueryButton } from './RunQueryButton';\nimport { Operators } from '../constants';\nimport { Clauses } from './controls/FilterControl/types';\nimport StashFormDataContainer from './StashFormDataContainer';\n\nconst { confirm } = Modal;\n\nexport type ControlPanelsContainerProps = {\n  exploreState: ExplorePageState['explore'];\n  actions: ExploreActions;\n  datasource_type: DatasourceType;\n  chart: ChartState;\n  controls: Record<string, ControlState>;\n  form_data: QueryFormData;\n  isDatasourceMetaLoading: boolean;\n  errorMessage: ReactNode;\n  onQuery: () => void;\n  onStop: () => void;\n  canStopQuery: boolean;\n  chartIsStale: boolean;\n};\n\nexport type ExpandedControlPanelSectionConfig = Omit<\n  ControlPanelSectionConfig,\n  'controlSetRows'\n> & {\n  controlSetRows: ExpandedControlItem[][];\n};\n\nconst iconStyles = css`\n  &.anticon {\n    font-size: unset;\n    .anticon {\n      line-height: unset;\n      vertical-align: unset;\n    }\n  }\n`;\n\nconst actionButtonsContainerStyles = (theme: SupersetTheme) => css`\n  display: flex;\n  position: sticky;\n  bottom: 0;\n  flex-direction: column;\n  align-items: center;\n  padding: ${theme.gridUnit * 4}px;\n  z-index: 999;\n  background: linear-gradient(\n    ${rgba(theme.colors.grayscale.light5, 0)},\n    ${theme.colors.grayscale.light5} ${theme.opacity.mediumLight}\n  );\n\n  & > button {\n    min-width: 156px;\n  }\n`;\n\nconst Styles = styled.div`\n  position: relative;\n  height: 100%;\n  width: 100%;\n\n  // Resizable add overflow-y: auto as a style to this div\n  // To override it, we need to use !important\n  overflow: visible !important;\n  #controlSections {\n    height: 100%;\n    overflow: visible;\n  }\n  .nav-tabs {\n    flex: 0 0 1;\n  }\n  .tab-content {\n    overflow: auto;\n    flex: 1 1 100%;\n  }\n  .Select__menu {\n    max-width: 100%;\n  }\n  .type-label {\n    margin-right: ${({ theme }) => theme.gridUnit * 3}px;\n    width: ${({ theme }) => theme.gridUnit * 7}px;\n    display: inline-block;\n    text-align: center;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n`;\n\nconst ControlPanelsTabs = styled(Tabs)`\n  ${({ theme, fullWidth }) => css`\n    height: 100%;\n    overflow: visible;\n    .ant-tabs-nav {\n      margin-bottom: 0;\n    }\n    .ant-tabs-nav-list {\n      width: ${fullWidth ? '100%' : '50%'};\n    }\n    .ant-tabs-tabpane {\n      height: 100%;\n    }\n    .ant-tabs-content-holder {\n      padding-top: ${theme.gridUnit * 4}px;\n    }\n\n    .ant-collapse-ghost > .ant-collapse-item {\n      &:not(:last-child) {\n        border-bottom: 1px solid ${theme.colors.grayscale.light3};\n      }\n\n      & > .ant-collapse-header {\n        font-size: ${theme.typography.sizes.s}px;\n      }\n\n      & > .ant-collapse-content > .ant-collapse-content-box {\n        padding-bottom: 0;\n        font-size: ${theme.typography.sizes.s}px;\n      }\n    }\n  `}\n`;\n\nconst isTimeSection = (section: ControlPanelSectionConfig): boolean =>\n  !!section.label && sections.legacyTimeseriesTime.label === section.label;\n\nconst hasTimeColumn = (datasource: Dataset): boolean =>\n  datasource?.columns?.some(c => c.is_dttm);\nconst sectionsToExpand = (\n  sections: ControlPanelSectionConfig[],\n  datasource: Dataset,\n): string[] =>\n  // avoid expanding time section if datasource doesn't include time column\n  sections.reduce(\n    (acc, section) =>\n      (section.expanded || !section.label) &&\n      (!isTimeSection(section) || hasTimeColumn(datasource))\n        ? [...acc, String(section.label)]\n        : acc,\n    [] as string[],\n  );\n\nfunction getState(\n  vizType: string,\n  datasource: Dataset,\n  datasourceType: DatasourceType,\n) {\n  const querySections: ControlPanelSectionConfig[] = [];\n  const customizeSections: ControlPanelSectionConfig[] = [];\n\n  getSectionsToRender(vizType, datasourceType).forEach(section => {\n    // if at least one control in the section is not `renderTrigger`\n    // or asks to be displayed at the Data tab\n    if (\n      section.tabOverride === 'data' ||\n      section.controlSetRows.some(rows =>\n        rows.some(\n          control =>\n            control &&\n            typeof control === 'object' &&\n            'config' in control &&\n            control.config &&\n            (!control.config.renderTrigger ||\n              control.config.tabOverride === 'data'),\n        ),\n      )\n    ) {\n      querySections.push(section);\n    } else if (section.controlSetRows.length > 0) {\n      customizeSections.push(section);\n    }\n  });\n  const expandedQuerySections: string[] = sectionsToExpand(\n    querySections,\n    datasource,\n  );\n  const expandedCustomizeSections: string[] = sectionsToExpand(\n    customizeSections,\n    datasource,\n  );\n  return {\n    expandedQuerySections,\n    expandedCustomizeSections,\n    querySections,\n    customizeSections,\n  };\n}\n\nfunction useResetOnChangeRef(initialValue: () => any, resetOnChangeValue: any) {\n  const value = useRef(initialValue());\n  const prevResetOnChangeValue = useRef(resetOnChangeValue);\n  if (prevResetOnChangeValue.current !== resetOnChangeValue) {\n    value.current = initialValue();\n    prevResetOnChangeValue.current = resetOnChangeValue;\n  }\n\n  return value;\n}\n\nexport const ControlPanelsContainer = (props: ControlPanelsContainerProps) => {\n  const { colors } = useTheme();\n  const pluginContext = useContext(PluginContext);\n\n  const prevState = usePrevious(props.exploreState);\n  const prevDatasource = usePrevious(props.exploreState.datasource);\n  const prevChartStatus = usePrevious(props.chart.chartStatus);\n\n  const [showDatasourceAlert, setShowDatasourceAlert] = useState(false);\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const controlsTransferred = useSelector<\n    ExplorePageState,\n    string[] | undefined\n  >(state => state.explore.controlsTransferred);\n\n  const defaultTimeFilter = useSelector<ExplorePageState>(\n    state => state.common?.conf?.DEFAULT_TIME_FILTER || NO_TIME_RANGE,\n  );\n\n  const { form_data, actions } = props;\n  const { setControlValue } = actions;\n  const { x_axis, adhoc_filters } = form_data;\n\n  const previousXAxis = usePrevious(x_axis);\n\n  useEffect(() => {\n    if (\n      x_axis &&\n      x_axis !== previousXAxis &&\n      isTemporalColumn(x_axis, props.exploreState.datasource)\n    ) {\n      const noFilter = !adhoc_filters?.find(\n        filter =>\n          filter.expressionType === 'SIMPLE' &&\n          filter.operator === Operators.TemporalRange &&\n          filter.subject === x_axis,\n      );\n      if (noFilter) {\n        confirm({\n          title: t('The X-axis is not on the filters list'),\n          content:\n            t(`The X-axis is not on the filters list which will prevent it from being used in\n            time range filters in dashboards. Would you like to add it to the filters list?`),\n          onOk: () => {\n            setControlValue('adhoc_filters', [\n              ...(adhoc_filters || []),\n              {\n                clause: Clauses.Where,\n                subject: x_axis,\n                operator: Operators.TemporalRange,\n                comparator: defaultTimeFilter,\n                expressionType: 'SIMPLE',\n              },\n            ]);\n          },\n        });\n      }\n    }\n  }, [\n    x_axis,\n    adhoc_filters,\n    setControlValue,\n    defaultTimeFilter,\n    previousXAxis,\n    props.exploreState.datasource,\n  ]);\n\n  useEffect(() => {\n    let shouldUpdateControls = false;\n    const removeDatasourceWarningFromControl = (\n      value: JsonValue | undefined,\n    ) => {\n      if (\n        typeof value === 'object' &&\n        isDefined(value) &&\n        'datasourceWarning' in value &&\n        value.datasourceWarning === true\n      ) {\n        shouldUpdateControls = true;\n        return { ...value, datasourceWarning: false };\n      }\n      return value;\n    };\n    if (\n      props.chart.chartStatus === 'success' &&\n      prevChartStatus !== 'success'\n    ) {\n      controlsTransferred?.forEach(controlName => {\n        shouldUpdateControls = false;\n        if (!isDefined(props.controls[controlName])) {\n          return;\n        }\n        const alteredControls = Array.isArray(props.controls[controlName].value)\n          ? ensureIsArray(props.controls[controlName].value)?.map(\n              removeDatasourceWarningFromControl,\n            )\n          : removeDatasourceWarningFromControl(\n              props.controls[controlName].value,\n            );\n        if (shouldUpdateControls) {\n          props.actions.setControlValue(controlName, alteredControls);\n        }\n      });\n    }\n  }, [\n    controlsTransferred,\n    prevChartStatus,\n    props.actions,\n    props.chart.chartStatus,\n    props.controls,\n  ]);\n\n  useEffect(() => {\n    if (\n      prevDatasource &&\n      prevDatasource.type !== DatasourceType.Query &&\n      (props.exploreState.datasource?.id !== prevDatasource.id ||\n        props.exploreState.datasource?.type !== prevDatasource.type)\n    ) {\n      setShowDatasourceAlert(true);\n      containerRef.current?.scrollTo(0, 0);\n    }\n  }, [\n    props.exploreState.datasource?.id,\n    props.exploreState.datasource?.type,\n    prevDatasource,\n  ]);\n\n  const {\n    expandedQuerySections,\n    expandedCustomizeSections,\n    querySections,\n    customizeSections,\n  } = useMemo(\n    () =>\n      getState(\n        form_data.viz_type,\n        props.exploreState.datasource,\n        props.datasource_type,\n      ),\n    [props.exploreState.datasource, form_data.viz_type, props.datasource_type],\n  );\n\n  const resetTransferredControls = useCallback(() => {\n    ensureIsArray(props.exploreState.controlsTransferred).forEach(controlName =>\n      props.actions.setControlValue(\n        controlName,\n        props.controls[controlName].default,\n      ),\n    );\n  }, [props.actions, props.exploreState.controlsTransferred, props.controls]);\n\n  const handleClearFormClick = useCallback(() => {\n    resetTransferredControls();\n    setShowDatasourceAlert(false);\n  }, [resetTransferredControls]);\n\n  const handleContinueClick = useCallback(() => {\n    setShowDatasourceAlert(false);\n  }, []);\n\n  const shouldRecalculateControlState = ({\n    name,\n    config,\n  }: CustomControlItem): boolean => {\n    const { controls, chart, exploreState } = props;\n\n    return Boolean(\n      config.shouldMapStateToProps?.(\n        prevState || exploreState,\n        exploreState,\n        controls[name],\n        chart,\n      ),\n    );\n  };\n\n  const renderControl = ({ name, config }: CustomControlItem) => {\n    const { controls, chart, exploreState } = props;\n    const { visibility } = config;\n\n    // If the control item is not an object, we have to look up the control data from\n    // the centralized controls file.\n    // When it is an object we read control data straight from `config` instead\n    const controlData = {\n      ...config,\n      ...controls[name],\n      ...(shouldRecalculateControlState({ name, config })\n        ? config?.mapStateToProps?.(exploreState, controls[name], chart)\n        : // for other controls, `mapStateToProps` is already run in\n          // controlUtils/getControlState.ts\n          undefined),\n      name,\n    };\n    const {\n      validationErrors,\n      label: baseLabel,\n      description: baseDescription,\n      ...restProps\n    } = controlData as ControlState & {\n      validationErrors?: any[];\n    };\n\n    const isVisible = visibility\n      ? visibility.call(config, props, controlData)\n      : undefined;\n\n    const label =\n      typeof baseLabel === 'function'\n        ? baseLabel(exploreState, controls[name], chart)\n        : baseLabel;\n\n    const description =\n      typeof baseDescription === 'function'\n        ? baseDescription(exploreState, controls[name], chart)\n        : baseDescription;\n\n    if (name === 'adhoc_filters') {\n      restProps.canDelete = (\n        valueToBeDeleted: Record<string, any>,\n        values: Record<string, any>[],\n      ) => {\n        const isTemporalRange = (filter: Record<string, any>) =>\n          filter.operator === Operators.TemporalRange;\n        if (!controls?.time_range?.value && isTemporalRange(valueToBeDeleted)) {\n          const count = values.filter(isTemporalRange).length;\n          if (count === 1) {\n            // if temporal filter's value is \"No filter\", prevent deletion\n            // otherwise reset the value to \"No filter\"\n            if (valueToBeDeleted.comparator === defaultTimeFilter) {\n              return t(\n                `You cannot delete the last temporal filter as it's used for time range filters in dashboards.`,\n              );\n            }\n            props.actions.setControlValue(\n              name,\n              values.map(val => {\n                if (isEqual(val, valueToBeDeleted)) {\n                  return {\n                    ...val,\n                    comparator: defaultTimeFilter,\n                  };\n                }\n                return val;\n              }),\n            );\n            return false;\n          }\n        }\n        return true;\n      };\n    }\n\n    return (\n      <StashFormDataContainer\n        shouldStash={isVisible === false}\n        fieldNames={[name]}\n        key={`control-container-${name}`}\n      >\n        <Control\n          key={`control-${name}`}\n          name={name}\n          label={label}\n          description={description}\n          validationErrors={validationErrors}\n          actions={props.actions}\n          isVisible={isVisible}\n          {...restProps}\n        />\n      </StashFormDataContainer>\n    );\n  };\n\n  const sectionHasHadNoErrors = useResetOnChangeRef(\n    () => ({}),\n    form_data.viz_type,\n  );\n\n  const renderControlPanelSection = (\n    section: ExpandedControlPanelSectionConfig,\n  ) => {\n    const { controls } = props;\n    const { label, description, visibility } = section;\n\n    // Section label can be a ReactNode but in some places we want to\n    // have a string ID. Using forced type conversion for now,\n    // should probably add a `id` field to sections in the future.\n    const sectionId = String(label);\n    const isVisible = visibility?.call(this, props, controls) !== false;\n    const hasErrors = section.controlSetRows.some(rows =>\n      rows.some(item => {\n        const controlName =\n          typeof item === 'string'\n            ? item\n            : item && 'name' in item\n              ? item.name\n              : null;\n        return (\n          controlName &&\n          controlName in controls &&\n          controls[controlName].validationErrors &&\n          controls[controlName].validationErrors.length > 0\n        );\n      }),\n    );\n\n    if (!hasErrors) {\n      sectionHasHadNoErrors.current[sectionId] = true;\n    }\n\n    const errorColor = sectionHasHadNoErrors.current[sectionId]\n      ? colors.error.base\n      : colors.alert.base;\n\n    const PanelHeader = () => (\n      <span data-test=\"collapsible-control-panel-header\">\n        <span\n          css={(theme: SupersetTheme) => css`\n            font-size: ${theme.typography.sizes.m}px;\n            line-height: 1.3;\n          `}\n        >\n          {label}\n        </span>{' '}\n        {description && (\n          <Tooltip id={sectionId} title={description}>\n            <Icons.InfoCircleOutlined css={iconStyles} />\n          </Tooltip>\n        )}\n        {hasErrors && (\n          <Tooltip\n            id={`${kebabCase('validation-errors')}-tooltip`}\n            title={t('This section contains validation errors')}\n          >\n            <Icons.InfoCircleOutlined\n              css={css`\n                ${iconStyles};\n                color: ${errorColor};\n              `}\n            />\n          </Tooltip>\n        )}\n      </span>\n    );\n\n    return (\n      <>\n        <StashFormDataContainer\n          key={`sectionId-${sectionId}`}\n          shouldStash={!isVisible}\n          fieldNames={section.controlSetRows\n            .flat()\n            .map(item =>\n              item && typeof item === 'object'\n                ? 'name' in item\n                  ? item.name\n                  : ''\n                : String(item || ''),\n            )\n            .filter(Boolean)}\n        />\n        {isVisible && (\n          <Collapse.Panel\n            css={theme => css`\n              margin-bottom: 0;\n              box-shadow: none;\n\n              &:last-child {\n                padding-bottom: ${theme.gridUnit * 16}px;\n                border-bottom: 0;\n              }\n\n              .panel-body {\n                margin-left: ${theme.gridUnit * 4}px;\n                padding-bottom: 0;\n              }\n\n              span.label {\n                display: inline-block;\n              }\n              ${!section.label &&\n              `\n            .ant-collapse-header {\n              display: none;\n            }\n          `}\n            `}\n            header={<PanelHeader />}\n            key={sectionId}\n          >\n            {section.controlSetRows.map((controlSets, i) => {\n              const renderedControls = controlSets\n                .map(controlItem => {\n                  if (!controlItem) {\n                    // When the item is invalid\n                    return null;\n                  }\n                  if (React.isValidElement(controlItem)) {\n                    // When the item is a React element\n                    return controlItem;\n                  }\n                  if (\n                    controlItem.name &&\n                    controlItem.config &&\n                    controlItem.name !== 'datasource'\n                  ) {\n                    return renderControl(controlItem);\n                  }\n                  return null;\n                })\n                .filter(x => x !== null);\n              // don't show the row if it is empty\n              if (renderedControls.length === 0) {\n                return null;\n              }\n              return (\n                <ControlRow\n                  key={`controlsetrow-${i}`}\n                  controls={renderedControls}\n                />\n              );\n            })}\n          </Collapse.Panel>\n        )}\n      </>\n    );\n  };\n\n  const hasControlsTransferred =\n    ensureIsArray(props.exploreState.controlsTransferred).length > 0;\n\n  const DatasourceAlert = useCallback(\n    () =>\n      hasControlsTransferred ? (\n        <ExploreAlert\n          title={t('Keep control settings?')}\n          bodyText={t(\n            \"You've changed datasets. Any controls with data (columns, metrics) that match this new dataset have been retained.\",\n          )}\n          primaryButtonAction={handleContinueClick}\n          secondaryButtonAction={handleClearFormClick}\n          primaryButtonText={t('Continue')}\n          secondaryButtonText={t('Clear form')}\n          type=\"info\"\n        />\n      ) : (\n        <ExploreAlert\n          title={t('No form settings were maintained')}\n          bodyText={t(\n            'We were unable to carry over any controls when switching to this new dataset.',\n          )}\n          primaryButtonAction={handleContinueClick}\n          primaryButtonText={t('Continue')}\n          type=\"warning\"\n        />\n      ),\n    [handleClearFormClick, handleContinueClick, hasControlsTransferred],\n  );\n\n  const dataTabHasHadNoErrors = useResetOnChangeRef(\n    () => false,\n    form_data.viz_type,\n  );\n\n  const dataTabTitle = useMemo(() => {\n    if (!props.errorMessage) {\n      dataTabHasHadNoErrors.current = true;\n    }\n\n    const errorColor = dataTabHasHadNoErrors.current\n      ? colors.error.base\n      : colors.alert.base;\n\n    return (\n      <>\n        <span>{t('Data')}</span>\n        {props.errorMessage && (\n          <span\n            css={(theme: SupersetTheme) => css`\n              margin-left: ${theme.gridUnit * 2}px;\n            `}\n          >\n            {' '}\n            <Tooltip\n              id=\"query-error-tooltip\"\n              placement=\"right\"\n              title={props.errorMessage}\n            >\n              <Icons.ExclamationCircleOutlined\n                css={css`\n                  ${iconStyles};\n                  color: ${errorColor};\n                `}\n              />\n            </Tooltip>\n          </span>\n        )}\n      </>\n    );\n  }, [\n    colors.error.base,\n    colors.alert.base,\n    dataTabHasHadNoErrors,\n    props.errorMessage,\n  ]);\n\n  const controlPanelRegistry = getChartControlPanelRegistry();\n  if (!controlPanelRegistry.has(form_data.viz_type) && pluginContext.loading) {\n    return <Loading />;\n  }\n\n  const showCustomizeTab = customizeSections.length > 0;\n\n  return (\n    <Styles ref={containerRef}>\n      <ControlPanelsTabs\n        id=\"controlSections\"\n        data-test=\"control-tabs\"\n        fullWidth={showCustomizeTab}\n        allowOverflow={false}\n      >\n        <Tabs.TabPane key=\"query\" tab={dataTabTitle}>\n          <Collapse\n            defaultActiveKey={expandedQuerySections}\n            expandIconPosition=\"right\"\n            ghost\n          >\n            {showDatasourceAlert && <DatasourceAlert />}\n            {querySections.map(renderControlPanelSection)}\n          </Collapse>\n        </Tabs.TabPane>\n        {showCustomizeTab && (\n          <Tabs.TabPane key=\"display\" tab={t('Customize')}>\n            <Collapse\n              defaultActiveKey={expandedCustomizeSections}\n              expandIconPosition=\"right\"\n              ghost\n            >\n              {customizeSections.map(renderControlPanelSection)}\n            </Collapse>\n          </Tabs.TabPane>\n        )}\n      </ControlPanelsTabs>\n      <div css={actionButtonsContainerStyles}>\n        <RunQueryButton\n          onQuery={props.onQuery}\n          onStop={props.onStop}\n          errorMessage={props.errorMessage}\n          loading={props.chart.chartStatus === 'loading'}\n          isNewChart={!props.chart.queriesResponse}\n          canStopQuery={props.canStopQuery}\n          chartIsStale={props.chartIsStale}\n        />\n      </div>\n    </Styles>\n  );\n};\n\nexport default ControlPanelsContainer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}