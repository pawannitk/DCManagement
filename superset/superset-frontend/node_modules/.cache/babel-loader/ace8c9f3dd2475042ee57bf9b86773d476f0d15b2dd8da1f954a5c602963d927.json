{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { Framebuffer, Renderbuffer, Texture2D, cssToDeviceRatio } from '@luma.gl/core';\nimport { equals } from '@math.gl/core';\nimport { _deepEqual as deepEqual } from '@deck.gl/core';\nimport CollisionFilterPass from './collision-filter-pass';\nimport MaskEffect from '../mask/mask-effect';\nconst DOWNSCALE = 2;\nexport default class CollisionFilterEffect {\n  constructor() {\n    _defineProperty(this, \"id\", 'collision-filter-effect');\n\n    _defineProperty(this, \"props\", null);\n\n    _defineProperty(this, \"useInPicking\", true);\n\n    _defineProperty(this, \"order\", 1);\n\n    _defineProperty(this, \"channels\", {});\n\n    _defineProperty(this, \"collisionFilterPass\", void 0);\n\n    _defineProperty(this, \"collisionFBOs\", {});\n\n    _defineProperty(this, \"dummyCollisionMap\", void 0);\n\n    _defineProperty(this, \"lastViewport\", void 0);\n  }\n\n  preRender(gl, {\n    effects: allEffects,\n    layers,\n    layerFilter,\n    viewports,\n    onViewportActive,\n    views,\n    isPicking,\n    preRenderStats = {}\n  }) {\n    var _preRenderStats$mask;\n\n    if (!this.dummyCollisionMap) {\n      this.dummyCollisionMap = new Texture2D(gl, {\n        width: 1,\n        height: 1\n      });\n    }\n\n    if (isPicking) {\n      return;\n    }\n\n    const collisionLayers = layers.filter(({\n      props: {\n        visible,\n        collisionEnabled\n      }\n    }) => visible && collisionEnabled);\n\n    if (collisionLayers.length === 0) {\n      this.channels = {};\n      return;\n    }\n\n    if (!this.collisionFilterPass) {\n      this.collisionFilterPass = new CollisionFilterPass(gl, {\n        id: 'default-collision-filter'\n      });\n    }\n\n    const effects = allEffects === null || allEffects === void 0 ? void 0 : allEffects.filter((e) => e.constructor === MaskEffect);\n    const maskEffectRendered = (_preRenderStats$mask = preRenderStats['mask-effect']) === null || _preRenderStats$mask === void 0 ? void 0 : _preRenderStats$mask.didRender;\n\n    const channels = this._groupByCollisionGroup(gl, collisionLayers);\n\n    const viewport = viewports[0];\n    const viewportChanged = !this.lastViewport || !this.lastViewport.equals(viewport) || maskEffectRendered;\n\n    for (const collisionGroup in channels) {\n      const collisionFBO = this.collisionFBOs[collisionGroup];\n      const renderInfo = channels[collisionGroup];\n      collisionFBO.resize({\n        width: gl.canvas.width / DOWNSCALE,\n        height: gl.canvas.height / DOWNSCALE\n      });\n\n      this._render(renderInfo, {\n        effects,\n        layerFilter,\n        onViewportActive,\n        views,\n        viewport,\n        viewportChanged\n      });\n    }\n  }\n\n  _render(renderInfo, {\n    effects,\n    layerFilter,\n    onViewportActive,\n    views,\n    viewport,\n    viewportChanged\n  }) {\n    const {\n      collisionGroup\n    } = renderInfo;\n    const oldRenderInfo = this.channels[collisionGroup];\n\n    if (!oldRenderInfo) {\n      return;\n    }\n\n    const needsRender = viewportChanged || renderInfo === oldRenderInfo || !deepEqual(oldRenderInfo.layers, renderInfo.layers, 1) || renderInfo.layerBounds.some((b, i) => !equals(b, oldRenderInfo.layerBounds[i])) || renderInfo.allLayersLoaded !== oldRenderInfo.allLayersLoaded || renderInfo.layers.some((layer) => layer.props.transitions);\n    this.channels[collisionGroup] = renderInfo;\n\n    if (needsRender) {\n      this.lastViewport = viewport;\n      const collisionFBO = this.collisionFBOs[collisionGroup];\n      this.collisionFilterPass.renderCollisionMap(collisionFBO, {\n        pass: 'collision-filter',\n        isPicking: true,\n        layers: renderInfo.layers,\n        effects,\n        layerFilter,\n        viewports: viewport ? [viewport] : [],\n        onViewportActive,\n        views,\n        moduleParameters: {\n          dummyCollisionMap: this.dummyCollisionMap,\n          devicePixelRatio: cssToDeviceRatio(collisionFBO.gl) / DOWNSCALE\n        }\n      });\n    }\n  }\n\n  _groupByCollisionGroup(gl, collisionLayers) {\n    const channelMap = {};\n\n    for (const layer of collisionLayers) {\n      const {\n        collisionGroup\n      } = layer.props;\n      let channelInfo = channelMap[collisionGroup];\n\n      if (!channelInfo) {\n        channelInfo = {\n          collisionGroup,\n          layers: [],\n          layerBounds: [],\n          allLayersLoaded: true\n        };\n        channelMap[collisionGroup] = channelInfo;\n      }\n\n      channelInfo.layers.push(layer);\n      channelInfo.layerBounds.push(layer.getBounds());\n\n      if (!layer.isLoaded) {\n        channelInfo.allLayersLoaded = false;\n      }\n    }\n\n    for (const collisionGroup of Object.keys(channelMap)) {\n      if (!this.collisionFBOs[collisionGroup]) {\n        this.createFBO(gl, collisionGroup);\n      }\n\n      if (!this.channels[collisionGroup]) {\n        this.channels[collisionGroup] = channelMap[collisionGroup];\n      }\n    }\n\n    for (const collisionGroup of Object.keys(this.collisionFBOs)) {\n      if (!channelMap[collisionGroup]) {\n        this.destroyFBO(collisionGroup);\n      }\n    }\n\n    return channelMap;\n  }\n\n  getModuleParameters(layer) {\n    const {\n      collisionGroup\n    } = layer.props;\n    const {\n      collisionFBOs,\n      dummyCollisionMap\n    } = this;\n    return {\n      collisionFBO: collisionFBOs[collisionGroup],\n      dummyCollisionMap\n    };\n  }\n\n  cleanup() {\n    if (this.dummyCollisionMap) {\n      this.dummyCollisionMap.delete();\n      this.dummyCollisionMap = undefined;\n    }\n\n    this.channels = {};\n\n    for (const collisionGroup of Object.keys(this.collisionFBOs)) {\n      this.destroyFBO(collisionGroup);\n    }\n\n    this.collisionFBOs = {};\n    this.lastViewport = undefined;\n  }\n\n  createFBO(gl, collisionGroup) {\n    const {\n      width,\n      height\n    } = gl.canvas;\n    const collisionMap = new Texture2D(gl, {\n      width,\n      height,\n      parameters: {\n        [10241]: 9728,\n        [10240]: 9728,\n        [10242]: 33071,\n        [10243]: 33071\n      }\n    });\n    const depthBuffer = new Renderbuffer(gl, {\n      format: 33189,\n      width,\n      height\n    });\n    this.collisionFBOs[collisionGroup] = new Framebuffer(gl, {\n      id: \"Collision-\".concat(collisionGroup),\n      width,\n      height,\n      attachments: {\n        [36064]: collisionMap,\n        [36096]: depthBuffer\n      }\n    });\n  }\n\n  destroyFBO(collisionGroup) {\n    const fbo = this.collisionFBOs[collisionGroup];\n\n    for (const attachment of Object.values(fbo.attachments)) {\n      attachment.delete();\n    }\n\n    fbo.delete();\n    delete this.collisionFBOs[collisionGroup];\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DOWNSCALE, \"DOWNSCALE\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/node_modules/@deck.gl/extensions/dist/esm/collision-filter/collision-filter-effect.js\");reactHotLoader.register(CollisionFilterEffect, \"CollisionFilterEffect\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/node_modules/@deck.gl/extensions/dist/esm/collision-filter/collision-filter-effect.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["Framebuffer","Renderbuffer","Texture2D","cssToDeviceRatio","equals","_deepEqual","deepEqual","CollisionFilterPass","MaskEffect","DOWNSCALE","CollisionFilterEffect","constructor","_defineProperty","preRender","gl","effects","allEffects","layers","layerFilter","viewports","onViewportActive","views","isPicking","preRenderStats","_preRenderStats$mask","dummyCollisionMap","width","height","collisionLayers","filter","props","visible","collisionEnabled","length","channels","collisionFilterPass","id","e","maskEffectRendered","didRender","_groupByCollisionGroup","viewport","viewportChanged","lastViewport","collisionGroup","collisionFBO","collisionFBOs","renderInfo","resize","canvas","_render","oldRenderInfo","needsRender","layerBounds","some","b","i","allLayersLoaded","layer","transitions","renderCollisionMap","pass","moduleParameters","devicePixelRatio","channelMap","channelInfo","push","getBounds","isLoaded","Object","keys","createFBO","destroyFBO","getModuleParameters","cleanup","delete","undefined","collisionMap","parameters","depthBuffer","format","concat","attachments","fbo","attachment","values","__reactstandin__regenerateByEval","key","code","eval","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["../../../src/collision-filter/collision-filter-effect.ts"],"sourcesContent":["import {Framebuffer, Renderbuffer, Texture2D, cssToDeviceRatio} from '@luma.gl/core';\nimport {equals} from '@math.gl/core';\nimport {_deepEqual as deepEqual} from '@deck.gl/core';\nimport type {Effect, Layer, PreRenderOptions, Viewport} from '@deck.gl/core';\nimport CollisionFilterPass from './collision-filter-pass';\nimport MaskEffect, {MaskPreRenderStats} from '../mask/mask-effect';\n// import {debugFBO} from '../utils/debug';\n\ntype CollisionFilterExtensionProps = {\n  collisionTestProps?: {};\n  collisionGroup: string;\n};\n\n// Factor by which to downscale Collision FBO relative to canvas\nconst DOWNSCALE = 2;\n\ntype RenderInfo = {\n  collisionGroup: string;\n  layers: Layer<CollisionFilterExtensionProps>[];\n  layerBounds: ([number[], number[]] | null)[];\n  allLayersLoaded: boolean;\n};\n\nexport default class CollisionFilterEffect implements Effect {\n  id = 'collision-filter-effect';\n  props = null;\n  useInPicking = true;\n  order = 1;\n\n  private channels: Record<string, RenderInfo> = {};\n  private collisionFilterPass?: CollisionFilterPass;\n  private collisionFBOs: Record<string, Framebuffer> = {};\n  private dummyCollisionMap?: Texture2D;\n  private lastViewport?: Viewport;\n\n  preRender(\n    gl: WebGLRenderingContext,\n    {\n      effects: allEffects,\n      layers,\n      layerFilter,\n      viewports,\n      onViewportActive,\n      views,\n      isPicking,\n      preRenderStats = {}\n    }: PreRenderOptions\n  ): void {\n    if (!this.dummyCollisionMap) {\n      this.dummyCollisionMap = new Texture2D(gl, {width: 1, height: 1});\n    }\n\n    if (isPicking) {\n      // Do not update on picking pass\n      return;\n    }\n\n    const collisionLayers = layers.filter(\n      // @ts-ignore\n      ({props: {visible, collisionEnabled}}) => visible && collisionEnabled\n    ) as Layer<CollisionFilterExtensionProps>[];\n    if (collisionLayers.length === 0) {\n      this.channels = {};\n      return;\n    }\n\n    if (!this.collisionFilterPass) {\n      this.collisionFilterPass = new CollisionFilterPass(gl, {id: 'default-collision-filter'});\n    }\n\n    // Detect if mask has rendered. TODO: better dependency system for Effects\n    const effects = allEffects?.filter(e => e.constructor === MaskEffect);\n    const maskEffectRendered = (preRenderStats['mask-effect'] as MaskPreRenderStats)?.didRender;\n\n    // Collect layers to render\n    const channels = this._groupByCollisionGroup(gl, collisionLayers);\n\n    const viewport = viewports[0];\n    const viewportChanged =\n      !this.lastViewport || !this.lastViewport.equals(viewport) || maskEffectRendered;\n\n    // Resize framebuffers to match canvas\n    for (const collisionGroup in channels) {\n      const collisionFBO = this.collisionFBOs[collisionGroup];\n      const renderInfo = channels[collisionGroup];\n      collisionFBO.resize({\n        width: gl.canvas.width / DOWNSCALE,\n        height: gl.canvas.height / DOWNSCALE\n      });\n      this._render(renderInfo, {\n        effects,\n        layerFilter,\n        onViewportActive,\n        views,\n        viewport,\n        viewportChanged\n      });\n    }\n\n    // debugFBO(this.collisionFBOs[Object.keys(channels)[0]], {minimap: true});\n  }\n\n  private _render(\n    renderInfo: RenderInfo,\n    {\n      effects,\n      layerFilter,\n      onViewportActive,\n      views,\n      viewport,\n      viewportChanged\n    }: {\n      effects: PreRenderOptions['effects'];\n      layerFilter: PreRenderOptions['layerFilter'];\n      onViewportActive: PreRenderOptions['onViewportActive'];\n      views: PreRenderOptions['views'];\n      viewport: Viewport;\n      viewportChanged: boolean;\n    }\n  ) {\n    const {collisionGroup} = renderInfo;\n    const oldRenderInfo = this.channels[collisionGroup];\n    if (!oldRenderInfo) {\n      return;\n    }\n\n    const needsRender =\n      viewportChanged ||\n      // If render info is new\n      renderInfo === oldRenderInfo ||\n      // If sublayers have changed\n      !deepEqual(oldRenderInfo.layers, renderInfo.layers, 1) ||\n      // If a sublayer's bounds have been updated\n      renderInfo.layerBounds.some((b, i) => !equals(b, oldRenderInfo.layerBounds[i])) ||\n      // If a sublayer's isLoaded state has been updated\n      renderInfo.allLayersLoaded !== oldRenderInfo.allLayersLoaded ||\n      // Some prop is in transition\n      renderInfo.layers.some(layer => layer.props.transitions);\n\n    this.channels[collisionGroup] = renderInfo;\n\n    if (needsRender) {\n      this.lastViewport = viewport;\n      const collisionFBO = this.collisionFBOs[collisionGroup];\n\n      // Rerender collision FBO\n      this.collisionFilterPass!.renderCollisionMap(collisionFBO, {\n        pass: 'collision-filter',\n        isPicking: true,\n        layers: renderInfo.layers,\n        effects,\n        layerFilter,\n        viewports: viewport ? [viewport] : [],\n        onViewportActive,\n        views,\n        moduleParameters: {\n          // To avoid feedback loop forming between Framebuffer and active Texture.\n          dummyCollisionMap: this.dummyCollisionMap,\n          devicePixelRatio: cssToDeviceRatio(collisionFBO.gl) / DOWNSCALE\n        }\n      });\n    }\n  }\n\n  /**\n   * Group layers by collisionGroup\n   * Returns a map from collisionGroup to render info\n   */\n  private _groupByCollisionGroup(\n    gl: WebGLRenderingContext,\n    collisionLayers: Layer<CollisionFilterExtensionProps>[]\n  ): Record<string, RenderInfo> {\n    const channelMap = {};\n    for (const layer of collisionLayers) {\n      const {collisionGroup} = layer.props;\n      let channelInfo = channelMap[collisionGroup];\n      if (!channelInfo) {\n        channelInfo = {collisionGroup, layers: [], layerBounds: [], allLayersLoaded: true};\n        channelMap[collisionGroup] = channelInfo;\n      }\n      channelInfo.layers.push(layer);\n      channelInfo.layerBounds.push(layer.getBounds());\n      if (!layer.isLoaded) {\n        channelInfo.allLayersLoaded = false;\n      }\n    }\n\n    // Create any new passes and remove any old ones\n    for (const collisionGroup of Object.keys(channelMap)) {\n      if (!this.collisionFBOs[collisionGroup]) {\n        this.createFBO(gl, collisionGroup);\n      }\n      if (!this.channels[collisionGroup]) {\n        this.channels[collisionGroup] = channelMap[collisionGroup];\n      }\n    }\n    for (const collisionGroup of Object.keys(this.collisionFBOs)) {\n      if (!channelMap[collisionGroup]) {\n        this.destroyFBO(collisionGroup);\n      }\n    }\n\n    return channelMap;\n  }\n\n  getModuleParameters(layer: Layer): {\n    collisionFBO: Framebuffer;\n    dummyCollisionMap: Texture2D;\n  } {\n    const {collisionGroup} = (layer as Layer<CollisionFilterExtensionProps>).props;\n    const {collisionFBOs, dummyCollisionMap} = this;\n    return {collisionFBO: collisionFBOs[collisionGroup], dummyCollisionMap};\n  }\n\n  cleanup(): void {\n    if (this.dummyCollisionMap) {\n      this.dummyCollisionMap.delete();\n      this.dummyCollisionMap = undefined;\n    }\n    this.channels = {};\n    for (const collisionGroup of Object.keys(this.collisionFBOs)) {\n      this.destroyFBO(collisionGroup);\n    }\n    this.collisionFBOs = {};\n    this.lastViewport = undefined;\n  }\n\n  createFBO(gl: WebGLRenderingContext, collisionGroup: string) {\n    const {width, height} = gl.canvas;\n    const collisionMap = new Texture2D(gl, {\n      width,\n      height,\n      parameters: {\n        [gl.TEXTURE_MIN_FILTER]: gl.NEAREST,\n        [gl.TEXTURE_MAG_FILTER]: gl.NEAREST,\n        [gl.TEXTURE_WRAP_S]: gl.CLAMP_TO_EDGE,\n        [gl.TEXTURE_WRAP_T]: gl.CLAMP_TO_EDGE\n      }\n    });\n\n    const depthBuffer = new Renderbuffer(gl, {format: gl.DEPTH_COMPONENT16, width, height});\n    this.collisionFBOs[collisionGroup] = new Framebuffer(gl, {\n      id: `Collision-${collisionGroup}`,\n      width,\n      height,\n      attachments: {\n        [gl.COLOR_ATTACHMENT0]: collisionMap,\n        [gl.DEPTH_ATTACHMENT]: depthBuffer\n      }\n    });\n  }\n\n  destroyFBO(collisionGroup: string) {\n    const fbo = this.collisionFBOs[collisionGroup];\n    for (const attachment of Object.values(fbo.attachments as Texture2D[])) {\n      attachment.delete();\n    }\n    fbo.delete();\n    delete this.collisionFBOs[collisionGroup];\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}