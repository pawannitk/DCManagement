{"ast":null,"code":"import _debounce from \"lodash/debounce\";import _isEqual from \"lodash/isEqual\";import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\nimport React, { useEffect, useState, useCallback, createContext, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { SLOW_DEBOUNCE, isNativeFilter, usePrevious, styled } from '@superset-ui/core';\nimport { useHistory } from 'react-router-dom';\nimport { updateDataMask, clearDataMask } from 'src/dataMask/actions';\nimport { useImmer } from 'use-immer';\n\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { useTabId } from 'src/hooks/useTabId';\nimport { logEvent } from 'src/logger/actions';\nimport { LOG_ACTIONS_CHANGE_DASHBOARD_FILTER } from 'src/logger/LogUtils';\nimport { FilterBarOrientation } from 'src/dashboard/types';\nimport { checkIsApplyDisabled } from './utils';\nimport { useNativeFiltersDataMask, useFilters, useFilterUpdates, useInitialization } from './state';\nimport { createFilterKey, updateFilterKey } from './keyValue';\nimport ActionButtons from './ActionButtons';\nimport Horizontal from './Horizontal';\nimport Vertical from './Vertical';\nimport { useSelectFiltersInScope } from '../state';\n// FilterBar is just being hidden as it must still\n// render fully due to encapsulated logics\nimport { jsx as ___EmotionJSX } from \"@emotion/react\";const HiddenFilterBar = styled.div`\n  display: none;\n`;\nconst EXCLUDED_URL_PARAMS = [\nURL_PARAMS.nativeFilters.name,\nURL_PARAMS.permalinkKey.name];\n\nconst publishDataMask = _debounce(async (history, dashboardId, updateKey, dataMaskSelected, tabId) => {\n  const { location } = history;\n  const { search } = location;\n  const previousParams = new URLSearchParams(search);\n  const newParams = new URLSearchParams();\n  let dataMaskKey;\n  previousParams.forEach((value, key) => {\n    if (!EXCLUDED_URL_PARAMS.includes(key)) {\n      newParams.append(key, value);\n    }\n  });\n  const nativeFiltersCacheKey = getUrlParam(URL_PARAMS.nativeFiltersKey);\n  const dataMask = JSON.stringify(dataMaskSelected);\n  if (updateKey &&\n  nativeFiltersCacheKey && (\n  await updateFilterKey(dashboardId, dataMask, nativeFiltersCacheKey, tabId))) {\n    dataMaskKey = nativeFiltersCacheKey;\n  } else\n  {\n    dataMaskKey = await createFilterKey(dashboardId, dataMask, tabId);\n  }\n  if (dataMaskKey) {\n    newParams.set(URL_PARAMS.nativeFiltersKey.name, dataMaskKey);\n  }\n  // pathname could be updated somewhere else through window.history\n  // keep react router history in sync with window history\n  // replace params only when current page is /superset/dashboard\n  // this prevents a race condition between updating filters and navigating to Explore\n  if (window.location.pathname.includes('/superset/dashboard')) {\n    history.location.pathname = window.location.pathname;\n    history.replace({\n      search: newParams.toString()\n    });\n  }\n}, SLOW_DEBOUNCE);\nexport const FilterBarScrollContext = /*#__PURE__*/createContext(false);\nconst FilterBar = ({ orientation = FilterBarOrientation.Vertical, verticalConfig, hidden = false }) => {\n  const history = useHistory();\n  const dataMaskApplied = useNativeFiltersDataMask();\n  const [dataMaskSelected, setDataMaskSelected] = useImmer(dataMaskApplied);\n  const dispatch = useDispatch();\n  const [updateKey, setUpdateKey] = useState(0);\n  const tabId = useTabId();\n  const filters = useFilters();\n  const previousFilters = usePrevious(filters);\n  const filterValues = Object.values(filters);\n  const nativeFilterValues = filterValues.filter(isNativeFilter);\n  const dashboardId = useSelector(({ dashboardInfo }) => dashboardInfo == null ? void 0 : dashboardInfo.id);\n  const previousDashboardId = usePrevious(dashboardId);\n  const canEdit = useSelector(({ dashboardInfo }) => dashboardInfo.dash_edit_perm);\n  const user = useSelector((state) => state.user);\n  const [filtersInScope] = useSelectFiltersInScope(nativeFilterValues);\n  const dataMaskSelectedRef = useRef(dataMaskSelected);\n  dataMaskSelectedRef.current = dataMaskSelected;\n  const handleFilterSelectionChange = useCallback((filter, dataMask) => {\n    setDataMaskSelected((draft) => {var _dataMask$filterState, _dataMaskSelectedRef$, _dataMaskSelectedRef$2;\n      // force instant updating on initialization for filters with `requiredFirst` is true or instant filters\n      if (\n      // filterState.value === undefined - means that value not initialized\n      ((_dataMask$filterState = dataMask.filterState) == null ? void 0 : _dataMask$filterState.value) !== undefined &&\n      ((_dataMaskSelectedRef$ = dataMaskSelectedRef.current[filter.id]) == null ? void 0 : (_dataMaskSelectedRef$2 = _dataMaskSelectedRef$.filterState) == null ? void 0 : _dataMaskSelectedRef$2.value) ===\n      undefined &&\n      filter.requiredFirst) {\n        dispatch(updateDataMask(filter.id, dataMask));\n      }\n      draft[filter.id] = {\n        ...getInitialDataMask(filter.id),\n        ...dataMask\n      };\n    });\n  }, [dispatch, setDataMaskSelected]);\n  useEffect(() => {\n    if (previousFilters && dashboardId === previousDashboardId) {\n      const updates = {};\n      Object.values(filters).forEach((currentFilter) => {\n        const previousFilter = previousFilters == null ? void 0 : previousFilters[currentFilter.id];\n        if (!previousFilter) {\n          return;\n        }\n        const currentType = currentFilter.filterType;\n        const currentTargets = currentFilter.targets;\n        const currentDataMask = currentFilter.defaultDataMask;\n        const previousType = previousFilter == null ? void 0 : previousFilter.filterType;\n        const previousTargets = previousFilter == null ? void 0 : previousFilter.targets;\n        const previousDataMask = previousFilter == null ? void 0 : previousFilter.defaultDataMask;\n        const typeChanged = currentType !== previousType;\n        const targetsChanged = !_isEqual(currentTargets, previousTargets);\n        const dataMaskChanged = !_isEqual(currentDataMask, previousDataMask);\n        if (typeChanged || targetsChanged || dataMaskChanged) {\n          updates[currentFilter.id] = getInitialDataMask(currentFilter.id);\n        }\n      });\n      if (!_isEmpty(updates)) {\n        setDataMaskSelected((draft) => ({ ...draft, ...updates }));\n        Object.keys(updates).forEach((key) => dispatch(clearDataMask(key)));\n      }\n    }\n  }, [\n  JSON.stringify(filters),\n  JSON.stringify(previousFilters),\n  previousDashboardId]\n  );\n  const dataMaskAppliedText = JSON.stringify(dataMaskApplied);\n  useEffect(() => {\n    setDataMaskSelected(() => dataMaskApplied);\n  }, [dataMaskAppliedText, setDataMaskSelected]);\n  useEffect(() => {\n    // embedded users can't persist filter combinations\n    if (user != null && user.userId) {\n      publishDataMask(history, dashboardId, updateKey, dataMaskApplied, tabId);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dashboardId, dataMaskAppliedText, history, updateKey, tabId]);\n  const handleApply = useCallback(() => {\n    dispatch(logEvent(LOG_ACTIONS_CHANGE_DASHBOARD_FILTER, {}));\n    const filterIds = Object.keys(dataMaskSelected);\n    setUpdateKey(1);\n    filterIds.forEach((filterId) => {\n      if (dataMaskSelected[filterId]) {\n        dispatch(updateDataMask(filterId, dataMaskSelected[filterId]));\n      }\n    });\n  }, [dataMaskSelected, dispatch]);\n  const handleClearAll = useCallback(() => {\n    const clearDataMaskIds = [];\n    let dispatchAllowed = false;\n    filtersInScope.filter(isNativeFilter).forEach((filter) => {\n      const { id } = filter;\n      if (dataMaskSelected[id]) {var _filter$controlValues;\n        if ((_filter$controlValues = filter.controlValues) != null && _filter$controlValues.enableEmptyFilter) {\n          dispatchAllowed = false;\n        }\n        clearDataMaskIds.push(id);\n        setDataMaskSelected((draft) => {var _draft$id$filterState;\n          if (((_draft$id$filterState = draft[id].filterState) == null ? void 0 : _draft$id$filterState.value) !== undefined) {\n            draft[id].filterState.value = undefined;\n          }\n        });\n      }\n    });\n    if (dispatchAllowed) {\n      clearDataMaskIds.forEach((id) => dispatch(clearDataMask(id)));\n    }\n  }, [dataMaskSelected, dispatch, filtersInScope, setDataMaskSelected]);\n  useFilterUpdates(dataMaskSelected, setDataMaskSelected);\n  const isApplyDisabled = checkIsApplyDisabled(dataMaskSelected, dataMaskApplied, filtersInScope.filter(isNativeFilter));\n  const isInitialized = useInitialization();\n  const actions = ___EmotionJSX(ActionButtons, { filterBarOrientation: orientation, width: verticalConfig == null ? void 0 : verticalConfig.width, onApply: handleApply, onClearAll: handleClearAll, dataMaskSelected: dataMaskSelected, dataMaskApplied: dataMaskApplied, isApplyDisabled: isApplyDisabled });\n  const filterBarComponent = orientation === FilterBarOrientation.Horizontal ? ___EmotionJSX(Horizontal, { actions: actions, canEdit: canEdit, dashboardId: dashboardId, dataMaskSelected: dataMaskSelected, filterValues: filterValues, isInitialized: isInitialized, onSelectionChange: handleFilterSelectionChange }) : verticalConfig ? ___EmotionJSX(Vertical, { actions: actions, canEdit: canEdit, dataMaskSelected: dataMaskSelected, filtersOpen: verticalConfig.filtersOpen, filterValues: filterValues, isInitialized: isInitialized, height: verticalConfig.height, offset: verticalConfig.offset, onSelectionChange: handleFilterSelectionChange, toggleFiltersBar: verticalConfig.toggleFiltersBar, width: verticalConfig.width }) : null;\n  return hidden ? ___EmotionJSX(HiddenFilterBar, null, filterBarComponent) : filterBarComponent;\n};__signature__(FilterBar, \"useHistory{history}\\nuseNativeFiltersDataMask{dataMaskApplied}\\nuseImmer{[dataMaskSelected, setDataMaskSelected]}\\nuseDispatch{dispatch}\\nuseState{[updateKey, setUpdateKey](0)}\\nuseTabId{tabId}\\nuseFilters{filters}\\nusePrevious{previousFilters}\\nuseSelector{dashboardId}\\nusePrevious{previousDashboardId}\\nuseSelector{canEdit}\\nuseSelector{user}\\nuseSelectFiltersInScope{[filtersInScope]}\\nuseRef{dataMaskSelectedRef}\\nuseCallback{handleFilterSelectionChange}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{handleApply}\\nuseCallback{handleClearAll}\\nuseFilterUpdates{}\\nuseInitialization{isInitialized}\", () => [useHistory, useNativeFiltersDataMask, useImmer, useDispatch, useTabId, useFilters, usePrevious, useSelector, usePrevious, useSelector, useSelector, useSelectFiltersInScope, useFilterUpdates, useInitialization]);const _default = /*#__PURE__*/\nReact.memo(FilterBar);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(HiddenFilterBar, \"HiddenFilterBar\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(EXCLUDED_URL_PARAMS, \"EXCLUDED_URL_PARAMS\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(publishDataMask, \"publishDataMask\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(FilterBarScrollContext, \"FilterBarScrollContext\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(FilterBar, \"FilterBar\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","useEffect","useState","useCallback","createContext","useRef","useDispatch","useSelector","SLOW_DEBOUNCE","isNativeFilter","usePrevious","styled","useHistory","updateDataMask","clearDataMask","useImmer","getInitialDataMask","URL_PARAMS","getUrlParam","useTabId","logEvent","LOG_ACTIONS_CHANGE_DASHBOARD_FILTER","FilterBarOrientation","checkIsApplyDisabled","useNativeFiltersDataMask","useFilters","useFilterUpdates","useInitialization","createFilterKey","updateFilterKey","ActionButtons","Horizontal","Vertical","useSelectFiltersInScope","jsx","___EmotionJSX","HiddenFilterBar","div","EXCLUDED_URL_PARAMS","nativeFilters","name","permalinkKey","publishDataMask","_debounce","history","dashboardId","updateKey","dataMaskSelected","tabId","location","search","previousParams","URLSearchParams","newParams","dataMaskKey","forEach","value","key","includes","append","nativeFiltersCacheKey","nativeFiltersKey","dataMask","JSON","stringify","set","window","pathname","replace","toString","FilterBarScrollContext","FilterBar","orientation","verticalConfig","hidden","dataMaskApplied","setDataMaskSelected","dispatch","setUpdateKey","filters","previousFilters","filterValues","Object","values","nativeFilterValues","filter","dashboardInfo","id","previousDashboardId","canEdit","dash_edit_perm","user","state","filtersInScope","dataMaskSelectedRef","current","handleFilterSelectionChange","draft","_dataMask$filterState","_dataMaskSelectedRef$","_dataMaskSelectedRef$2","filterState","undefined","requiredFirst","updates","currentFilter","previousFilter","currentType","filterType","currentTargets","targets","currentDataMask","defaultDataMask","previousType","previousTargets","previousDataMask","typeChanged","targetsChanged","_isEqual","dataMaskChanged","_isEmpty","keys","dataMaskAppliedText","userId","handleApply","filterIds","filterId","handleClearAll","clearDataMaskIds","dispatchAllowed","_filter$controlValues","controlValues","enableEmptyFilter","push","_draft$id$filterState","isApplyDisabled","isInitialized","actions","filterBarOrientation","width","onApply","onClearAll","filterBarComponent","onSelectionChange","filtersOpen","height","offset","toggleFiltersBar","__signature__","_default","memo","reactHotLoader","reactHotLoaderGlobal","default","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\nimport React, {\n  useEffect,\n  useState,\n  useCallback,\n  createContext,\n  useRef,\n} from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  DataMaskStateWithId,\n  DataMaskWithId,\n  Filter,\n  DataMask,\n  SLOW_DEBOUNCE,\n  isNativeFilter,\n  usePrevious,\n  styled,\n} from '@superset-ui/core';\nimport { useHistory } from 'react-router-dom';\nimport { updateDataMask, clearDataMask } from 'src/dataMask/actions';\nimport { useImmer } from 'use-immer';\nimport { isEmpty, isEqual, debounce } from 'lodash';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { useTabId } from 'src/hooks/useTabId';\nimport { logEvent } from 'src/logger/actions';\nimport { LOG_ACTIONS_CHANGE_DASHBOARD_FILTER } from 'src/logger/LogUtils';\nimport { FilterBarOrientation, RootState } from 'src/dashboard/types';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { checkIsApplyDisabled } from './utils';\nimport { FiltersBarProps } from './types';\nimport {\n  useNativeFiltersDataMask,\n  useFilters,\n  useFilterUpdates,\n  useInitialization,\n} from './state';\nimport { createFilterKey, updateFilterKey } from './keyValue';\nimport ActionButtons from './ActionButtons';\nimport Horizontal from './Horizontal';\nimport Vertical from './Vertical';\nimport { useSelectFiltersInScope } from '../state';\n\n// FilterBar is just being hidden as it must still\n// render fully due to encapsulated logics\nconst HiddenFilterBar = styled.div`\n  display: none;\n`;\n\nconst EXCLUDED_URL_PARAMS: string[] = [\n  URL_PARAMS.nativeFilters.name,\n  URL_PARAMS.permalinkKey.name,\n];\n\nconst publishDataMask = debounce(\n  async (\n    history,\n    dashboardId,\n    updateKey,\n    dataMaskSelected: DataMaskStateWithId,\n    tabId,\n  ) => {\n    const { location } = history;\n    const { search } = location;\n    const previousParams = new URLSearchParams(search);\n    const newParams = new URLSearchParams();\n    let dataMaskKey: string | null;\n    previousParams.forEach((value, key) => {\n      if (!EXCLUDED_URL_PARAMS.includes(key)) {\n        newParams.append(key, value);\n      }\n    });\n\n    const nativeFiltersCacheKey = getUrlParam(URL_PARAMS.nativeFiltersKey);\n    const dataMask = JSON.stringify(dataMaskSelected);\n    if (\n      updateKey &&\n      nativeFiltersCacheKey &&\n      (await updateFilterKey(\n        dashboardId,\n        dataMask,\n        nativeFiltersCacheKey,\n        tabId,\n      ))\n    ) {\n      dataMaskKey = nativeFiltersCacheKey;\n    } else {\n      dataMaskKey = await createFilterKey(dashboardId, dataMask, tabId);\n    }\n    if (dataMaskKey) {\n      newParams.set(URL_PARAMS.nativeFiltersKey.name, dataMaskKey);\n    }\n\n    // pathname could be updated somewhere else through window.history\n    // keep react router history in sync with window history\n    // replace params only when current page is /superset/dashboard\n    // this prevents a race condition between updating filters and navigating to Explore\n    if (window.location.pathname.includes('/superset/dashboard')) {\n      history.location.pathname = window.location.pathname;\n      history.replace({\n        search: newParams.toString(),\n      });\n    }\n  },\n  SLOW_DEBOUNCE,\n);\n\nexport const FilterBarScrollContext = createContext(false);\nconst FilterBar: React.FC<FiltersBarProps> = ({\n  orientation = FilterBarOrientation.Vertical,\n  verticalConfig,\n  hidden = false,\n}) => {\n  const history = useHistory();\n  const dataMaskApplied: DataMaskStateWithId = useNativeFiltersDataMask();\n  const [dataMaskSelected, setDataMaskSelected] =\n    useImmer<DataMaskStateWithId>(dataMaskApplied);\n  const dispatch = useDispatch();\n  const [updateKey, setUpdateKey] = useState(0);\n  const tabId = useTabId();\n  const filters = useFilters();\n  const previousFilters = usePrevious(filters);\n  const filterValues = Object.values(filters);\n  const nativeFilterValues = filterValues.filter(isNativeFilter);\n  const dashboardId = useSelector<any, number>(\n    ({ dashboardInfo }) => dashboardInfo?.id,\n  );\n  const previousDashboardId = usePrevious(dashboardId);\n  const canEdit = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.dash_edit_perm,\n  );\n  const user: UserWithPermissionsAndRoles = useSelector<\n    RootState,\n    UserWithPermissionsAndRoles\n  >(state => state.user);\n\n  const [filtersInScope] = useSelectFiltersInScope(nativeFilterValues);\n\n  const dataMaskSelectedRef = useRef(dataMaskSelected);\n  dataMaskSelectedRef.current = dataMaskSelected;\n  const handleFilterSelectionChange = useCallback(\n    (\n      filter: Pick<Filter, 'id'> & Partial<Filter>,\n      dataMask: Partial<DataMask>,\n    ) => {\n      setDataMaskSelected(draft => {\n        // force instant updating on initialization for filters with `requiredFirst` is true or instant filters\n        if (\n          // filterState.value === undefined - means that value not initialized\n          dataMask.filterState?.value !== undefined &&\n          dataMaskSelectedRef.current[filter.id]?.filterState?.value ===\n            undefined &&\n          filter.requiredFirst\n        ) {\n          dispatch(updateDataMask(filter.id, dataMask));\n        }\n        draft[filter.id] = {\n          ...(getInitialDataMask(filter.id) as DataMaskWithId),\n          ...dataMask,\n        };\n      });\n    },\n    [dispatch, setDataMaskSelected],\n  );\n\n  useEffect(() => {\n    if (previousFilters && dashboardId === previousDashboardId) {\n      const updates = {};\n      Object.values(filters).forEach(currentFilter => {\n        const previousFilter = previousFilters?.[currentFilter.id];\n        if (!previousFilter) {\n          return;\n        }\n        const currentType = currentFilter.filterType;\n        const currentTargets = currentFilter.targets;\n        const currentDataMask = currentFilter.defaultDataMask;\n        const previousType = previousFilter?.filterType;\n        const previousTargets = previousFilter?.targets;\n        const previousDataMask = previousFilter?.defaultDataMask;\n        const typeChanged = currentType !== previousType;\n        const targetsChanged = !isEqual(currentTargets, previousTargets);\n        const dataMaskChanged = !isEqual(currentDataMask, previousDataMask);\n\n        if (typeChanged || targetsChanged || dataMaskChanged) {\n          updates[currentFilter.id] = getInitialDataMask(currentFilter.id);\n        }\n      });\n\n      if (!isEmpty(updates)) {\n        setDataMaskSelected(draft => ({ ...draft, ...updates }));\n        Object.keys(updates).forEach(key => dispatch(clearDataMask(key)));\n      }\n    }\n  }, [\n    JSON.stringify(filters),\n    JSON.stringify(previousFilters),\n    previousDashboardId,\n  ]);\n\n  const dataMaskAppliedText = JSON.stringify(dataMaskApplied);\n\n  useEffect(() => {\n    setDataMaskSelected(() => dataMaskApplied);\n  }, [dataMaskAppliedText, setDataMaskSelected]);\n\n  useEffect(() => {\n    // embedded users can't persist filter combinations\n    if (user?.userId) {\n      publishDataMask(history, dashboardId, updateKey, dataMaskApplied, tabId);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dashboardId, dataMaskAppliedText, history, updateKey, tabId]);\n\n  const handleApply = useCallback(() => {\n    dispatch(logEvent(LOG_ACTIONS_CHANGE_DASHBOARD_FILTER, {}));\n    const filterIds = Object.keys(dataMaskSelected);\n    setUpdateKey(1);\n    filterIds.forEach(filterId => {\n      if (dataMaskSelected[filterId]) {\n        dispatch(updateDataMask(filterId, dataMaskSelected[filterId]));\n      }\n    });\n  }, [dataMaskSelected, dispatch]);\n\n  const handleClearAll = useCallback(() => {\n    const clearDataMaskIds: string[] = [];\n    let dispatchAllowed = false;\n    filtersInScope.filter(isNativeFilter).forEach(filter => {\n      const { id } = filter;\n      if (dataMaskSelected[id]) {\n        if (filter.controlValues?.enableEmptyFilter) {\n          dispatchAllowed = false;\n        }\n        clearDataMaskIds.push(id);\n        setDataMaskSelected(draft => {\n          if (draft[id].filterState?.value !== undefined) {\n            draft[id].filterState!.value = undefined;\n          }\n        });\n      }\n    });\n    if (dispatchAllowed) {\n      clearDataMaskIds.forEach(id => dispatch(clearDataMask(id)));\n    }\n  }, [dataMaskSelected, dispatch, filtersInScope, setDataMaskSelected]);\n\n  useFilterUpdates(dataMaskSelected, setDataMaskSelected);\n  const isApplyDisabled = checkIsApplyDisabled(\n    dataMaskSelected,\n    dataMaskApplied,\n    filtersInScope.filter(isNativeFilter),\n  );\n  const isInitialized = useInitialization();\n\n  const actions = (\n    <ActionButtons\n      filterBarOrientation={orientation}\n      width={verticalConfig?.width}\n      onApply={handleApply}\n      onClearAll={handleClearAll}\n      dataMaskSelected={dataMaskSelected}\n      dataMaskApplied={dataMaskApplied}\n      isApplyDisabled={isApplyDisabled}\n    />\n  );\n\n  const filterBarComponent =\n    orientation === FilterBarOrientation.Horizontal ? (\n      <Horizontal\n        actions={actions}\n        canEdit={canEdit}\n        dashboardId={dashboardId}\n        dataMaskSelected={dataMaskSelected}\n        filterValues={filterValues}\n        isInitialized={isInitialized}\n        onSelectionChange={handleFilterSelectionChange}\n      />\n    ) : verticalConfig ? (\n      <Vertical\n        actions={actions}\n        canEdit={canEdit}\n        dataMaskSelected={dataMaskSelected}\n        filtersOpen={verticalConfig.filtersOpen}\n        filterValues={filterValues}\n        isInitialized={isInitialized}\n        height={verticalConfig.height}\n        offset={verticalConfig.offset}\n        onSelectionChange={handleFilterSelectionChange}\n        toggleFiltersBar={verticalConfig.toggleFiltersBar}\n        width={verticalConfig.width}\n      />\n    ) : null;\n\n  return hidden ? (\n    <HiddenFilterBar>{filterBarComponent}</HiddenFilterBar>\n  ) : (\n    filterBarComponent\n  );\n};\nexport default React.memo(FilterBar);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}