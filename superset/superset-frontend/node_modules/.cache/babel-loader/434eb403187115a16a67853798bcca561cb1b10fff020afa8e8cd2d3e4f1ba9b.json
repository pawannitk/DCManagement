{"ast":null,"code":"import _kebabCase from \"lodash/kebabCase\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};import domToImage from 'dom-to-image-more';\n\nimport { t, supersetTheme } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\n/**\n * generate a consistent file stem from a description and date\n *\n * @param description title or description of content of file\n * @param date date when file was generated\n */\nconst generateFileStem = (description, date = new Date()) => `${_kebabCase(description)}-${date.toISOString().replace(/[: ]/g, '-')}`;\n/**\n * Create an event handler for turning an element into an image\n *\n * @param selector css selector of the parent element which should be turned into image\n * @param description name or a short description of what is being printed.\n *   Value will be normalized, and a date as well as a file extension will be added.\n * @param isExactSelector if false, searches for the closest ancestor that matches selector.\n * @returns event handler\n */\nexport default function downloadAsImage(selector, description, isExactSelector = false) {\n  return (event) => {\n    const elementToPrint = isExactSelector ?\n    document.querySelector(selector) :\n    event.currentTarget.closest(selector);\n    if (!elementToPrint) {\n      return addWarningToast(t('Image download failed, please refresh and try again.'));\n    }\n    // Mapbox controls are loaded from different origin, causing CORS error\n    // See https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL#exceptions\n    const filter = (node) => {\n      if (typeof node.className === 'string') {\n        return node.className !== 'mapboxgl-control-container' &&\n        !node.className.includes('header-controls');\n      }\n      return true;\n    };\n    return domToImage.\n    toJpeg(elementToPrint, {\n      bgcolor: supersetTheme.colors.grayscale.light4,\n      filter\n    }).\n    then((dataUrl) => {\n      const link = document.createElement('a');\n      link.download = `${generateFileStem(description)}.jpg`;\n      link.href = dataUrl;\n      link.click();\n    }).\n    catch((e) => {\n      console.error('Creating image failed', e);\n    });\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(generateFileStem, \"generateFileStem\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/utils/downloadAsImage.ts\");reactHotLoader.register(downloadAsImage, \"downloadAsImage\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/utils/downloadAsImage.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["domToImage","t","supersetTheme","addWarningToast","generateFileStem","description","date","Date","_kebabCase","toISOString","replace","downloadAsImage","selector","isExactSelector","event","elementToPrint","document","querySelector","currentTarget","closest","filter","node","className","includes","toJpeg","bgcolor","colors","grayscale","light4","then","dataUrl","link","createElement","download","href","click","catch","e","console","error","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/utils/downloadAsImage.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SyntheticEvent } from 'react';\nimport domToImage from 'dom-to-image-more';\nimport { kebabCase } from 'lodash';\nimport { t, supersetTheme } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\n\n/**\n * generate a consistent file stem from a description and date\n *\n * @param description title or description of content of file\n * @param date date when file was generated\n */\nconst generateFileStem = (description: string, date = new Date()) =>\n  `${kebabCase(description)}-${date.toISOString().replace(/[: ]/g, '-')}`;\n\n/**\n * Create an event handler for turning an element into an image\n *\n * @param selector css selector of the parent element which should be turned into image\n * @param description name or a short description of what is being printed.\n *   Value will be normalized, and a date as well as a file extension will be added.\n * @param isExactSelector if false, searches for the closest ancestor that matches selector.\n * @returns event handler\n */\nexport default function downloadAsImage(\n  selector: string,\n  description: string,\n  isExactSelector = false,\n) {\n  return (event: SyntheticEvent) => {\n    const elementToPrint = isExactSelector\n      ? document.querySelector(selector)\n      : event.currentTarget.closest(selector);\n\n    if (!elementToPrint) {\n      return addWarningToast(\n        t('Image download failed, please refresh and try again.'),\n      );\n    }\n\n    // Mapbox controls are loaded from different origin, causing CORS error\n    // See https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL#exceptions\n    const filter = (node: Element) => {\n      if (typeof node.className === 'string') {\n        return (\n          node.className !== 'mapboxgl-control-container' &&\n          !node.className.includes('header-controls')\n        );\n      }\n      return true;\n    };\n\n    return domToImage\n      .toJpeg(elementToPrint, {\n        bgcolor: supersetTheme.colors.grayscale.light4,\n        filter,\n      })\n      .then((dataUrl: string) => {\n        const link = document.createElement('a');\n        link.download = `${generateFileStem(description)}.jpg`;\n        link.href = dataUrl;\n        link.click();\n      })\n      .catch((e: Error) => {\n        console.error('Creating image failed', e);\n      });\n  };\n}\n"],"mappings":"iVAmBA,OAAOA,UAAU,MAAM,mBAAmB;;AAE1C,SAASC,CAAC,EAAEC,aAAa,QAAQ,mBAAmB;AACpD,SAASC,eAAe,QAAQ,sCAAsC;AAEtE;;;;;;AAMA,MAAMC,gBAAgB,GAAGA,CAACC,WAAmB,EAAEC,IAAI,GAAG,IAAIC,IAAI,EAAE,KAC9D,GAAGC,UAAA,CAAUH,WAAW,CAAC,IAAIC,IAAI,CAACG,WAAW,EAAE,CAACC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,EAAE;AAEzE;;;;;;;;;AASA,eAAc,SAAUC,eAAeA,CACrCC,QAAgB,EAChBP,WAAmB,EACnBQ,eAAe,GAAG,KAAK;EAEvB,OAAO,CAACC,KAAqB,KAAI;IAC/B,MAAMC,cAAc,GAAGF,eAAe;IAClCG,QAAQ,CAACC,aAAa,CAACL,QAAQ,CAAC;IAChCE,KAAK,CAACI,aAAa,CAACC,OAAO,CAACP,QAAQ,CAAC;IAEzC,IAAI,CAACG,cAAc,EAAE;MACnB,OAAOZ,eAAe,CACpBF,CAAC,CAAC,sDAAsD,CAAC,CAC1D;;IAGH;IACA;IACA,MAAMmB,MAAM,GAAGA,CAACC,IAAa,KAAI;MAC/B,IAAI,OAAOA,IAAI,CAACC,SAAS,KAAK,QAAQ,EAAE;QACtC,OACED,IAAI,CAACC,SAAS,KAAK,4BAA4B;QAC/C,CAACD,IAAI,CAACC,SAAS,CAACC,QAAQ,CAAC,iBAAiB,CAAC;;MAG/C,OAAO,IAAI;IACb,CAAC;IAED,OAAOvB,UAAU;IACdwB,MAAM,CAACT,cAAc,EAAE;MACtBU,OAAO,EAAEvB,aAAa,CAACwB,MAAM,CAACC,SAAS,CAACC,MAAM;MAC9CR;KACD,CAAC;IACDS,IAAI,CAAC,CAACC,OAAe,KAAI;MACxB,MAAMC,IAAI,GAAGf,QAAQ,CAACgB,aAAa,CAAC,GAAG,CAAC;MACxCD,IAAI,CAACE,QAAQ,GAAG,GAAG7B,gBAAgB,CAACC,WAAW,CAAC,MAAM;MACtD0B,IAAI,CAACG,IAAI,GAAGJ,OAAO;MACnBC,IAAI,CAACI,KAAK,EAAE;IACd,CAAC,CAAC;IACDC,KAAK,CAAC,CAACC,CAAQ,KAAI;MAClBC,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEF,CAAC,CAAC;IAC3C,CAAC,CAAC;EACN,CAAC;AACH,CAAC,mBAAAG,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAC,SAAA,MAAAH,cAAA,WAAAA,cAAA,CAAAI,QAAA,CAvDKxC,gBAAgB,6GAAAoC,cAAA,CAAAI,QAAA,CAYEjC,eAAe,oIAAAkC,WAAA,UAAAJ,oBAAA,mBAAAA,oBAAA,CAAAI,WAAA,GAAAF,SAAA,CAAAE,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}