{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { useMemo } from 'react';\nimport { isFilterDivider } from '@superset-ui/core';\nimport { TAB_TYPE } from '../../util/componentTypes';\nconst defaultFilterConfiguration = [];\nexport function useFilterConfiguration() {\n  return useSelector((state) => {var _state$dashboardInfo, _state$dashboardInfo$;return ((_state$dashboardInfo = state.dashboardInfo) == null ? void 0 : (_state$dashboardInfo$ = _state$dashboardInfo.metadata) == null ? void 0 : _state$dashboardInfo$.native_filter_configuration) ||\n    defaultFilterConfiguration;});\n}\n/**\n * returns the dashboard's filter configuration,\n * converted into a map of id -> filter\n */__signature__(useFilterConfiguration, \"useSelector{}\", () => [useSelector]);\nexport function useFilterConfigMap() {\n  const filterConfig = useFilterConfiguration();\n  return useMemo(() => filterConfig.reduce((acc, filter) => {\n    acc[filter.id] = filter;\n    return acc;\n  }, {}), [filterConfig]);\n}__signature__(useFilterConfigMap, \"useFilterConfiguration{filterConfig}\\nuseMemo{}\", () => [useFilterConfiguration]);\nexport function useDashboardLayout() {\n  return useSelector((state) => {var _state$dashboardLayou;return (_state$dashboardLayou = state.dashboardLayout) == null ? void 0 : _state$dashboardLayou.present;});\n}__signature__(useDashboardLayout, \"useSelector{}\", () => [useSelector]);\nexport function useDashboardHasTabs() {\n  const dashboardLayout = useDashboardLayout();\n  return useMemo(() => Object.values(dashboardLayout).some((element) => element.type === TAB_TYPE), [dashboardLayout]);\n}__signature__(useDashboardHasTabs, \"useDashboardLayout{dashboardLayout}\\nuseMemo{}\", () => [useDashboardLayout]);\nfunction useActiveDashboardTabs() {\n  return useSelector((state) => {var _state$dashboardState;return (_state$dashboardState = state.dashboardState) == null ? void 0 : _state$dashboardState.activeTabs;});\n}__signature__(useActiveDashboardTabs, \"useSelector{}\", () => [useSelector]);\nfunction useSelectChartTabParents() {\n  const dashboardLayout = useDashboardLayout();\n  return (chartId) => {\n    const chartLayoutItem = Object.values(dashboardLayout).find((layoutItem) => {var _layoutItem$meta;return ((_layoutItem$meta = layoutItem.meta) == null ? void 0 : _layoutItem$meta.chartId) === chartId;});\n    return chartLayoutItem == null ? void 0 : chartLayoutItem.parents.filter((parent) => dashboardLayout[parent].type === TAB_TYPE);\n  };\n}__signature__(useSelectChartTabParents, \"useDashboardLayout{dashboardLayout}\", () => [useDashboardLayout]);\nexport function useIsFilterInScope() {\n  const activeTabs = useActiveDashboardTabs();\n  const selectChartTabParents = useSelectChartTabParents();\n  // Filter is in scope if any of it's charts is visible.\n  // Chart is visible if it's placed in an active tab tree or if it's not attached to any tab.\n  // Chart is in an active tab tree if all of it's ancestors of type TAB are active\n  // Dividers are always in scope\n  return (filter) => {var _filter$chartsInScope;return isFilterDivider(filter) ||\n    'chartsInScope' in filter && ((_filter$chartsInScope =\n    filter.chartsInScope) == null ? void 0 : _filter$chartsInScope.some((chartId) => {\n      const tabParents = selectChartTabParents(chartId);\n      return (tabParents == null ? void 0 : tabParents.length) === 0 || (\n      tabParents == null ? void 0 : tabParents.every((tab) => activeTabs.includes(tab)));\n    }));};\n}__signature__(useIsFilterInScope, \"useActiveDashboardTabs{activeTabs}\\nuseSelectChartTabParents{selectChartTabParents}\", () => [useActiveDashboardTabs, useSelectChartTabParents]);\nexport function useSelectFiltersInScope(filters) {\n  const dashboardHasTabs = useDashboardHasTabs();\n  const isFilterInScope = useIsFilterInScope();\n  return useMemo(() => {\n    let filtersInScope = [];\n    const filtersOutOfScope = [];\n    // we check native filters scopes only on dashboards with tabs\n    if (!dashboardHasTabs) {\n      filtersInScope = filters;\n    } else\n    {\n      filters.forEach((filter) => {\n        const filterInScope = isFilterInScope(filter);\n        if (filterInScope) {\n          filtersInScope.push(filter);\n        } else\n        {\n          filtersOutOfScope.push(filter);\n        }\n      });\n    }\n    return [filtersInScope, filtersOutOfScope];\n  }, [filters, dashboardHasTabs, isFilterInScope]);\n}__signature__(useSelectFiltersInScope, \"useDashboardHasTabs{dashboardHasTabs}\\nuseIsFilterInScope{isFilterInScope}\\nuseMemo{}\", () => [useDashboardHasTabs, useIsFilterInScope]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(defaultFilterConfiguration, \"defaultFilterConfiguration\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useFilterConfiguration, \"useFilterConfiguration\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useFilterConfigMap, \"useFilterConfigMap\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useDashboardLayout, \"useDashboardLayout\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useDashboardHasTabs, \"useDashboardHasTabs\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useActiveDashboardTabs, \"useActiveDashboardTabs\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useSelectChartTabParents, \"useSelectChartTabParents\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useIsFilterInScope, \"useIsFilterInScope\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");reactHotLoader.register(useSelectFiltersInScope, \"useSelectFiltersInScope\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["useSelector","useMemo","isFilterDivider","TAB_TYPE","defaultFilterConfiguration","useFilterConfiguration","state","_state$dashboardInfo","_state$dashboardInfo$","dashboardInfo","metadata","native_filter_configuration","__signature__","useFilterConfigMap","filterConfig","reduce","acc","filter","id","useDashboardLayout","_state$dashboardLayou","dashboardLayout","present","useDashboardHasTabs","Object","values","some","element","type","useActiveDashboardTabs","_state$dashboardState","dashboardState","activeTabs","useSelectChartTabParents","chartId","chartLayoutItem","find","layoutItem","_layoutItem$meta","meta","parents","parent","useIsFilterInScope","selectChartTabParents","_filter$chartsInScope","chartsInScope","tabParents","length","every","tab","includes","useSelectFiltersInScope","filters","dashboardHasTabs","isFilterInScope","filtersInScope","filtersOutOfScope","forEach","filterInScope","push","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/dashboard/components/nativeFilters/state.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { useMemo } from 'react';\nimport {\n  Filter,\n  FilterConfiguration,\n  Divider,\n  isFilterDivider,\n} from '@superset-ui/core';\nimport { ActiveTabs, DashboardLayout, RootState } from '../../types';\nimport { TAB_TYPE } from '../../util/componentTypes';\n\nconst defaultFilterConfiguration: Filter[] = [];\n\nexport function useFilterConfiguration() {\n  return useSelector<any, FilterConfiguration>(\n    state =>\n      state.dashboardInfo?.metadata?.native_filter_configuration ||\n      defaultFilterConfiguration,\n  );\n}\n\n/**\n * returns the dashboard's filter configuration,\n * converted into a map of id -> filter\n */\nexport function useFilterConfigMap() {\n  const filterConfig = useFilterConfiguration();\n  return useMemo(\n    () =>\n      filterConfig.reduce(\n        (acc: Record<string, Filter | Divider>, filter: Filter) => {\n          acc[filter.id] = filter;\n          return acc;\n        },\n        {} as Record<string, Filter | Divider>,\n      ),\n    [filterConfig],\n  );\n}\n\nexport function useDashboardLayout() {\n  return useSelector<any, DashboardLayout>(\n    state => state.dashboardLayout?.present,\n  );\n}\n\nexport function useDashboardHasTabs() {\n  const dashboardLayout = useDashboardLayout();\n  return useMemo(\n    () =>\n      Object.values(dashboardLayout).some(element => element.type === TAB_TYPE),\n    [dashboardLayout],\n  );\n}\n\nfunction useActiveDashboardTabs() {\n  return useSelector<RootState, ActiveTabs>(\n    state => state.dashboardState?.activeTabs,\n  );\n}\n\nfunction useSelectChartTabParents() {\n  const dashboardLayout = useDashboardLayout();\n  return (chartId: number) => {\n    const chartLayoutItem = Object.values(dashboardLayout).find(\n      layoutItem => layoutItem.meta?.chartId === chartId,\n    );\n    return chartLayoutItem?.parents.filter(\n      (parent: string) => dashboardLayout[parent].type === TAB_TYPE,\n    );\n  };\n}\n\nexport function useIsFilterInScope() {\n  const activeTabs = useActiveDashboardTabs();\n  const selectChartTabParents = useSelectChartTabParents();\n\n  // Filter is in scope if any of it's charts is visible.\n  // Chart is visible if it's placed in an active tab tree or if it's not attached to any tab.\n  // Chart is in an active tab tree if all of it's ancestors of type TAB are active\n  // Dividers are always in scope\n  return (filter: Filter | Divider) =>\n    isFilterDivider(filter) ||\n    ('chartsInScope' in filter &&\n      filter.chartsInScope?.some((chartId: number) => {\n        const tabParents = selectChartTabParents(chartId);\n        return (\n          tabParents?.length === 0 ||\n          tabParents?.every(tab => activeTabs.includes(tab))\n        );\n      }));\n}\n\nexport function useSelectFiltersInScope(filters: (Filter | Divider)[]) {\n  const dashboardHasTabs = useDashboardHasTabs();\n  const isFilterInScope = useIsFilterInScope();\n\n  return useMemo(() => {\n    let filtersInScope: (Filter | Divider)[] = [];\n    const filtersOutOfScope: (Filter | Divider)[] = [];\n\n    // we check native filters scopes only on dashboards with tabs\n    if (!dashboardHasTabs) {\n      filtersInScope = filters;\n    } else {\n      filters.forEach(filter => {\n        const filterInScope = isFilterInScope(filter);\n\n        if (filterInScope) {\n          filtersInScope.push(filter);\n        } else {\n          filtersOutOfScope.push(filter);\n        }\n      });\n    }\n    return [filtersInScope, filtersOutOfScope];\n  }, [filters, dashboardHasTabs, isFilterInScope]);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}