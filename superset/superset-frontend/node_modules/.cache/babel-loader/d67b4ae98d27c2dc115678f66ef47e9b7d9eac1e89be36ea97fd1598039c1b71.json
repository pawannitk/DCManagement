{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\n// <- When we work with Immer, we need reassign, so disabling lint\nimport produce from 'immer';\nimport { isFeatureEnabled, FeatureFlag } from '@superset-ui/core';\nimport { NATIVE_FILTER_PREFIX } from 'src/dashboard/components/nativeFilters/FiltersConfigModal/utils';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { CLEAR_DATA_MASK_STATE, SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE, UPDATE_DATA_MASK } from './actions';\nimport { areObjectsEqual } from '../reduxUtils';\nexport function getInitialDataMask(id, moreProps = {}) {\n  let otherProps = {};\n  if (id) {\n    otherProps = {\n      id\n    };\n  }\n  return {\n    ...otherProps,\n    extraFormData: {},\n    filterState: {},\n    ownState: {},\n    ...moreProps\n  };\n}\nfunction fillNativeFilters(filterConfig, mergedDataMask, draftDataMask, initialDataMask, currentFilters) {\n  filterConfig.forEach((filter) => {var _currentFilters$filte;\n    const dataMask = initialDataMask || {};\n    mergedDataMask[filter.id] = {\n      ...getInitialDataMask(filter.id),\n      ...filter.defaultDataMask,\n      ...dataMask[filter.id]\n    };\n    if (currentFilters &&\n    !areObjectsEqual(filter.defaultDataMask, (_currentFilters$filte = currentFilters[filter.id]) == null ? void 0 : _currentFilters$filte.defaultDataMask, { ignoreUndefined: true })) {\n      mergedDataMask[filter.id] = {\n        ...mergedDataMask[filter.id],\n        ...filter.defaultDataMask\n      };\n    }\n  });\n  // Get back all other non-native filters\n  Object.values(draftDataMask).forEach((filter) => {\n    if (!String(filter == null ? void 0 : filter.id).startsWith(NATIVE_FILTER_PREFIX)) {\n      mergedDataMask[filter == null ? void 0 : filter.id] = filter;\n    }\n  });\n}\nconst dataMaskReducer = produce((draft, action) => {var _action$data$dashboar3, _action$data$dashboar4, _action$data$dashboar5, _action$filterConfig;\n  const cleanState = {};\n  switch (action.type) {\n    case CLEAR_DATA_MASK_STATE:\n      return cleanState;\n    case UPDATE_DATA_MASK:\n      draft[action.filterId] = {\n        ...getInitialDataMask(action.filterId),\n        ...draft[action.filterId],\n        ...action.dataMask\n      };\n      return draft;\n    // TODO: update hydrate to .ts\n    // @ts-ignore\n    case HYDRATE_DASHBOARD:\n      if (isFeatureEnabled(FeatureFlag.DashboardCrossFilters)) {var _action$data$dashboar, _action$data$dashboar2;\n        Object.keys(\n        // @ts-ignore\n        (_action$data$dashboar = action.data.dashboardInfo) == null ? void 0 : (_action$data$dashboar2 = _action$data$dashboar.metadata) == null ? void 0 : _action$data$dashboar2.chart_configuration).forEach((id) => {\n          cleanState[id] = {\n            ...getInitialDataMask(id) // take initial data\n          };\n        });\n      }\n      fillNativeFilters(\n      // @ts-ignore\n      (_action$data$dashboar3 = (_action$data$dashboar4 = action.data.dashboardInfo) == null ? void 0 : (_action$data$dashboar5 = _action$data$dashboar4.metadata) == null ? void 0 : _action$data$dashboar5.native_filter_configuration) != null ? _action$data$dashboar3 :\n      [], cleanState, draft,\n      // @ts-ignore\n      action.data.dataMask);\n      return cleanState;\n    case SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:\n      fillNativeFilters((_action$filterConfig = action.filterConfig) != null ? _action$filterConfig : [], cleanState, draft, action.filters);\n      return cleanState;\n    default:\n      return draft;\n  }\n}, {});const _default =\ndataMaskReducer;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getInitialDataMask, \"getInitialDataMask\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dataMask/reducer.ts\");reactHotLoader.register(fillNativeFilters, \"fillNativeFilters\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dataMask/reducer.ts\");reactHotLoader.register(dataMaskReducer, \"dataMaskReducer\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dataMask/reducer.ts\");reactHotLoader.register(_default, \"default\", \"/home/pawank/Documents/dcim/superset/superset-frontend/src/dataMask/reducer.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["produce","isFeatureEnabled","FeatureFlag","NATIVE_FILTER_PREFIX","HYDRATE_DASHBOARD","CLEAR_DATA_MASK_STATE","SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE","UPDATE_DATA_MASK","areObjectsEqual","getInitialDataMask","id","moreProps","otherProps","extraFormData","filterState","ownState","fillNativeFilters","filterConfig","mergedDataMask","draftDataMask","initialDataMask","currentFilters","forEach","filter","_currentFilters$filte","dataMask","defaultDataMask","ignoreUndefined","Object","values","String","startsWith","dataMaskReducer","draft","action","_action$data$dashboar3","_action$data$dashboar4","_action$data$dashboar5","_action$filterConfig","cleanState","type","filterId","DashboardCrossFilters","_action$data$dashboar","_action$data$dashboar2","keys","data","dashboardInfo","metadata","chart_configuration","native_filter_configuration","filters","_default","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/src/dataMask/reducer.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\n// <- When we work with Immer, we need reassign, so disabling lint\nimport produce from 'immer';\nimport {\n  DataMask,\n  DataMaskStateWithId,\n  DataMaskWithId,\n  isFeatureEnabled,\n  FeatureFlag,\n  Filter,\n  FilterConfiguration,\n  Filters,\n} from '@superset-ui/core';\nimport { NATIVE_FILTER_PREFIX } from 'src/dashboard/components/nativeFilters/FiltersConfigModal/utils';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport {\n  AnyDataMaskAction,\n  CLEAR_DATA_MASK_STATE,\n  SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n  UPDATE_DATA_MASK,\n} from './actions';\nimport { areObjectsEqual } from '../reduxUtils';\n\nexport function getInitialDataMask(\n  id?: string | number,\n  moreProps?: DataMask,\n): DataMask;\nexport function getInitialDataMask(\n  id: string | number,\n  moreProps: DataMask = {},\n): DataMaskWithId {\n  let otherProps = {};\n  if (id) {\n    otherProps = {\n      id,\n    };\n  }\n  return {\n    ...otherProps,\n    extraFormData: {},\n    filterState: {},\n    ownState: {},\n    ...moreProps,\n  } as DataMaskWithId;\n}\n\nfunction fillNativeFilters(\n  filterConfig: FilterConfiguration,\n  mergedDataMask: DataMaskStateWithId,\n  draftDataMask: DataMaskStateWithId,\n  initialDataMask?: DataMaskStateWithId,\n  currentFilters?: Filters,\n) {\n  filterConfig.forEach((filter: Filter) => {\n    const dataMask = initialDataMask || {};\n    mergedDataMask[filter.id] = {\n      ...getInitialDataMask(filter.id), // take initial data\n      ...filter.defaultDataMask, // if something new came from BE - take it\n      ...dataMask[filter.id],\n    };\n    if (\n      currentFilters &&\n      !areObjectsEqual(\n        filter.defaultDataMask,\n        currentFilters[filter.id]?.defaultDataMask,\n        { ignoreUndefined: true },\n      )\n    ) {\n      mergedDataMask[filter.id] = {\n        ...mergedDataMask[filter.id],\n        ...filter.defaultDataMask,\n      };\n    }\n  });\n\n  // Get back all other non-native filters\n  Object.values(draftDataMask).forEach(filter => {\n    if (!String(filter?.id).startsWith(NATIVE_FILTER_PREFIX)) {\n      mergedDataMask[filter?.id] = filter;\n    }\n  });\n}\n\nconst dataMaskReducer = produce(\n  (draft: DataMaskStateWithId, action: AnyDataMaskAction) => {\n    const cleanState = {};\n    switch (action.type) {\n      case CLEAR_DATA_MASK_STATE:\n        return cleanState;\n      case UPDATE_DATA_MASK:\n        draft[action.filterId] = {\n          ...getInitialDataMask(action.filterId),\n          ...draft[action.filterId],\n          ...action.dataMask,\n        };\n        return draft;\n      // TODO: update hydrate to .ts\n      // @ts-ignore\n      case HYDRATE_DASHBOARD:\n        if (isFeatureEnabled(FeatureFlag.DashboardCrossFilters)) {\n          Object.keys(\n            // @ts-ignore\n            action.data.dashboardInfo?.metadata?.chart_configuration,\n          ).forEach(id => {\n            cleanState[id] = {\n              ...getInitialDataMask(id), // take initial data\n            };\n          });\n        }\n        fillNativeFilters(\n          // @ts-ignore\n          action.data.dashboardInfo?.metadata?.native_filter_configuration ??\n            [],\n          cleanState,\n          draft,\n          // @ts-ignore\n          action.data.dataMask,\n        );\n        return cleanState;\n      case SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:\n        fillNativeFilters(\n          action.filterConfig ?? [],\n          cleanState,\n          draft,\n          action.filters,\n        );\n        return cleanState;\n\n      default:\n        return draft;\n    }\n  },\n  {},\n);\n\nexport default dataMaskReducer;\n"],"mappings":"wSAAA;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA,OAAOA,OAAO,MAAM,OAAO;AAC3B,SAIEC,gBAAgB,EAChBC,WAAW,QAIN,mBAAmB;AAC1B,SAASC,oBAAoB,QAAQ,iEAAiE;AACtG,SAASC,iBAAiB,QAAQ,+BAA+B;AACjE,SAEEC,qBAAqB,EACrBC,wCAAwC,EACxCC,gBAAgB,QACX,WAAW;AAClB,SAASC,eAAe,QAAQ,eAAe;AAM/C,OAAM,SAAUC,kBAAkBA,CAChCC,EAAmB,EACnBC,SAAA,GAAsB,EAAE;EAExB,IAAIC,UAAU,GAAG,EAAE;EACnB,IAAIF,EAAE,EAAE;IACNE,UAAU,GAAG;MACXF;KACD;;EAEH,OAAO;IACL,GAAGE,UAAU;IACbC,aAAa,EAAE,EAAE;IACjBC,WAAW,EAAE,EAAE;IACfC,QAAQ,EAAE,EAAE;IACZ,GAAGJ;GACc;AACrB;AAEA,SAASK,iBAAiBA,CACxBC,YAAiC,EACjCC,cAAmC,EACnCC,aAAkC,EAClCC,eAAqC,EACrCC,cAAwB;EAExBJ,YAAY,CAACK,OAAO,CAAC,CAACC,MAAc,KAAI,KAAAC,qBAAA;IACtC,MAAMC,QAAQ,GAAGL,eAAe,IAAI,EAAE;IACtCF,cAAc,CAACK,MAAM,CAACb,EAAE,CAAC,GAAG;MAC1B,GAAGD,kBAAkB,CAACc,MAAM,CAACb,EAAE,CAAC;MAChC,GAAGa,MAAM,CAACG,eAAe;MACzB,GAAGD,QAAQ,CAACF,MAAM,CAACb,EAAE;KACtB;IACD,IACEW,cAAc;IACd,CAACb,eAAe,CACde,MAAM,CAACG,eAAe,GAAAF,qBAAA,GACtBH,cAAc,CAACE,MAAM,CAACb,EAAE,CAAC,qBAAzBc,qBAAA,CAA2BE,eAAe,EAC1C,EAAEC,eAAe,EAAE,IAAI,EAAE,CAC1B,EACD;MACAT,cAAc,CAACK,MAAM,CAACb,EAAE,CAAC,GAAG;QAC1B,GAAGQ,cAAc,CAACK,MAAM,CAACb,EAAE,CAAC;QAC5B,GAAGa,MAAM,CAACG;OACX;;EAEL,CAAC,CAAC;EAEF;EACAE,MAAM,CAACC,MAAM,CAACV,aAAa,CAAC,CAACG,OAAO,CAAC,CAAAC,MAAM,KAAG;IAC5C,IAAI,CAACO,MAAM,CAACP,MAAM,oBAANA,MAAM,CAAEb,EAAE,CAAC,CAACqB,UAAU,CAAC5B,oBAAoB,CAAC,EAAE;MACxDe,cAAc,CAACK,MAAM,oBAANA,MAAM,CAAEb,EAAE,CAAC,GAAGa,MAAM;;EAEvC,CAAC,CAAC;AACJ;AAEA,MAAMS,eAAe,GAAGhC,OAAO,CAC7B,CAACiC,KAA0B,EAAEC,MAAyB,KAAI,KAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,oBAAA;EACxD,MAAMC,UAAU,GAAG,EAAE;EACrB,QAAQL,MAAM,CAACM,IAAI;IACjB,KAAKnC,qBAAqB;MACxB,OAAOkC,UAAU;IACnB,KAAKhC,gBAAgB;MACnB0B,KAAK,CAACC,MAAM,CAACO,QAAQ,CAAC,GAAG;QACvB,GAAGhC,kBAAkB,CAACyB,MAAM,CAACO,QAAQ,CAAC;QACtC,GAAGR,KAAK,CAACC,MAAM,CAACO,QAAQ,CAAC;QACzB,GAAGP,MAAM,CAACT;OACX;MACD,OAAOQ,KAAK;IACd;IACA;IACA,KAAK7B,iBAAiB;MACpB,IAAIH,gBAAgB,CAACC,WAAW,CAACwC,qBAAqB,CAAC,EAAE,KAAAC,qBAAA,EAAAC,sBAAA;QACvDhB,MAAM,CAACiB,IAAI;QACT;QAAA,CAAAF,qBAAA,GACAT,MAAM,CAACY,IAAI,CAACC,aAAa,sBAAAH,sBAAA,GAAzBD,qBAAA,CAA2BK,QAAQ,qBAAnCJ,sBAAA,CAAqCK,mBAAmB,CACzD,CAAC3B,OAAO,CAAC,CAAAZ,EAAE,KAAG;UACb6B,UAAU,CAAC7B,EAAE,CAAC,GAAG;YACf,GAAGD,kBAAkB,CAACC,EAAE,CAAC,CAAE;WAC5B;QACH,CAAC,CAAC;;MAEJM,iBAAiB;MACf;MAAA,CAAAmB,sBAAA,IAAAC,sBAAA,GACAF,MAAM,CAACY,IAAI,CAACC,aAAa,sBAAAV,sBAAA,GAAzBD,sBAAA,CAA2BY,QAAQ,qBAAnCX,sBAAA,CAAqCa,2BAA2B,YAAAf,sBAAA;MAC9D,EAAE,EACJI,UAAU,EACVN,KAAK;MACL;MACAC,MAAM,CAACY,IAAI,CAACrB,QAAQ,CACrB;MACD,OAAOc,UAAU;IACnB,KAAKjC,wCAAwC;MAC3CU,iBAAiB,EAAAsB,oBAAA,GACfJ,MAAM,CAACjB,YAAY,YAAAqB,oBAAA,GAAI,EAAE,EACzBC,UAAU,EACVN,KAAK,EACLC,MAAM,CAACiB,OAAO,CACf;MACD,OAAOZ,UAAU;IAEnB;MACE,OAAON,KAAK;;AAElB,CAAC,EACD,EAAE,CACH,CAAC,MAAAmB,QAAA;AAEapB,eAAe,CAA9B,eAAAoB,QAAA,CAA+B,mBAAAC,cAAA,UAAAC,oBAAA,mBAAAA,oBAAA,CAAAC,OAAA,GAAAC,SAAA,MAAAH,cAAA,WAAAA,cAAA,CAAAI,QAAA,CA5GfhD,kBAAkB,0GAAA4C,cAAA,CAAAI,QAAA,CAmBzBzC,iBAAiB,yGAAAqC,cAAA,CAAAI,QAAA,CAqCpBzB,eAAe,uGAAAqB,cAAA,CAAAI,QAAA,CAAAL,QAAA,uHAAAM,WAAA,UAAAJ,oBAAA,mBAAAA,oBAAA,CAAAI,WAAA,GAAAF,SAAA,CAAAE,WAAA,IAAAA,WAAA,CAAAC,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}