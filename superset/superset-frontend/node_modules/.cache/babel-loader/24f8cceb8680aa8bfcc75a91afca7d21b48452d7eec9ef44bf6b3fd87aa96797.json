{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport { getMetricLabel, getValueFormatter, getNumberFormatter, ensureIsArray, getTimeOffset } from '@superset-ui/core';\nimport { getComparisonFontSize, getHeaderFontSize } from './utils';\nexport const parseMetricValue = (metricValue) => {\n  if (typeof metricValue === 'string') {\n    const dateObject = moment.utc(metricValue, moment.ISO_8601, true);\n    if (dateObject.isValid()) {\n      return dateObject.valueOf();\n    }\n    return 0;\n  }\n  return metricValue != null ? metricValue : 0;\n};\nexport default function transformProps(chartProps) {var _chartProps$rawFormDa, _chartProps$rawFormDa2, _chartProps$rawFormDa3, _chartProps$rawFormDa4, _chartProps$rawFormDa5;\n  /**\n   * This function is called after a successful response has been\n   * received from the chart data endpoint, and is used to transform\n   * the incoming data prior to being sent to the Visualization.\n   *\n   * The transformProps function is also quite useful to return\n   * additional/modified props to your data viz component. The formData\n   * can also be accessed from your CustomViz.tsx file, but\n   * doing supplying custom props here is often handy for integrating third\n   * party libraries that rely on specific props.\n   *\n   * A description of properties in `chartProps`:\n   * - `height`, `width`: the height/width of the DOM element in which\n   *   the chart is located\n   * - `formData`: the chart data request payload that was sent to the\n   *   backend.\n   * - `queriesData`: the chart data response payload that was received\n   *   from the backend. Some notable properties of `queriesData`:\n   *   - `data`: an array with data, each row with an object mapping\n   *     the column/alias to its value. Example:\n   *     `[{ col1: 'abc', metric1: 10 }, { col1: 'xyz', metric1: 20 }]`\n   *   - `rowcount`: the number of rows in `data`\n   *   - `query`: the query that was issued.\n   *\n   * Please note: the transformProps function gets cached when the\n   * application loads. When making changes to the `transformProps`\n   * function during development with hot reloading, changes won't\n   * be seen until restarting the development server.\n   */\n  const { width, height, formData, queriesData, datasource: { currencyFormats = {}, columnFormats = {} } } = chartProps;\n  const { boldText, headerFontSize, headerText, metric, yAxisFormat, currencyFormat, subheaderFontSize, comparisonColorScheme, comparisonColorEnabled, percentDifferenceFormat } = formData;\n  const { data: dataA = [] } = queriesData[0];\n  const data = dataA;\n  const metricName = getMetricLabel(metric);\n  const timeComparison = ensureIsArray((_chartProps$rawFormDa = chartProps.rawFormData) == null ? void 0 : _chartProps$rawFormDa.time_compare)[0];\n  const startDateOffset = (_chartProps$rawFormDa2 = chartProps.rawFormData) == null ? void 0 : _chartProps$rawFormDa2.start_date_offset;\n  const currentTimeRangeFilter = (_chartProps$rawFormDa3 = chartProps.rawFormData) == null ? void 0 : (_chartProps$rawFormDa4 = _chartProps$rawFormDa3.adhoc_filters) == null ? void 0 : (_chartProps$rawFormDa5 = _chartProps$rawFormDa4.filter((adhoc_filter) => adhoc_filter.operator === 'TEMPORAL_RANGE')) == null ? void 0 : _chartProps$rawFormDa5[0];\n  const isCustomOrInherit = timeComparison === 'custom' || timeComparison === 'inherit';\n  let dataOffset = [];\n  if (isCustomOrInherit) {\n    dataOffset = getTimeOffset(currentTimeRangeFilter, ensureIsArray(timeComparison), startDateOffset || '');\n  }\n  const { value1, value2 } = data.reduce((acc, curr) => {\n    Object.keys(curr).forEach((key) => {\n      if (key.includes(`${metricName}__${!isCustomOrInherit ? timeComparison : dataOffset[0]}`)) {\n        acc.value2 += curr[key];\n      } else\n      if (key.includes(metricName)) {\n        acc.value1 += curr[key];\n      }\n    });\n    return acc;\n  }, { value1: 0, value2: 0 });\n  let bigNumber = data.length === 0 ? 0 : parseMetricValue(value1);\n  let prevNumber = data.length === 0 ? 0 : parseMetricValue(value2);\n  const numberFormatter = getValueFormatter(metric, currencyFormats, columnFormats, yAxisFormat, currencyFormat);\n  const compTitles = {\n    r: 'Range',\n    y: 'Year',\n    m: 'Month',\n    w: 'Week'\n  };\n  const formatPercentChange = getNumberFormatter(percentDifferenceFormat);\n  let valueDifference = bigNumber - prevNumber;\n  let percentDifferenceNum;\n  if (!bigNumber && !prevNumber) {\n    percentDifferenceNum = 0;\n  } else\n  if (!bigNumber || !prevNumber) {\n    percentDifferenceNum = bigNumber ? 1 : -1;\n  } else\n  {\n    percentDifferenceNum = (bigNumber - prevNumber) / Math.abs(prevNumber);\n  }\n  const compType = compTitles[formData.timeComparison];\n  bigNumber = numberFormatter(bigNumber);\n  prevNumber = numberFormatter(prevNumber);\n  valueDifference = numberFormatter(valueDifference);\n  const percentDifference = formatPercentChange(percentDifferenceNum);\n  return {\n    width,\n    height,\n    data,\n    metricName,\n    bigNumber,\n    prevNumber,\n    valueDifference,\n    percentDifferenceFormattedString: percentDifference,\n    boldText,\n    headerFontSize: getHeaderFontSize(headerFontSize),\n    subheaderFontSize: getComparisonFontSize(subheaderFontSize),\n    headerText,\n    compType,\n    comparisonColorEnabled,\n    comparisonColorScheme,\n    percentDifferenceNumber: percentDifferenceNum,\n    currentTimeRangeFilter,\n    startDateOffset,\n    shift: timeComparison\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(parseMetricValue, \"parseMetricValue\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberPeriodOverPeriod/transformProps.ts\");reactHotLoader.register(transformProps, \"transformProps\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberPeriodOverPeriod/transformProps.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["moment","getMetricLabel","getValueFormatter","getNumberFormatter","ensureIsArray","getTimeOffset","getComparisonFontSize","getHeaderFontSize","parseMetricValue","metricValue","dateObject","utc","ISO_8601","isValid","valueOf","transformProps","chartProps","_chartProps$rawFormDa","_chartProps$rawFormDa2","_chartProps$rawFormDa3","_chartProps$rawFormDa4","_chartProps$rawFormDa5","width","height","formData","queriesData","datasource","currencyFormats","columnFormats","boldText","headerFontSize","headerText","metric","yAxisFormat","currencyFormat","subheaderFontSize","comparisonColorScheme","comparisonColorEnabled","percentDifferenceFormat","data","dataA","metricName","timeComparison","rawFormData","time_compare","startDateOffset","start_date_offset","currentTimeRangeFilter","adhoc_filters","filter","adhoc_filter","operator","isCustomOrInherit","dataOffset","value1","value2","reduce","acc","curr","Object","keys","forEach","key","includes","bigNumber","length","prevNumber","numberFormatter","compTitles","r","y","m","w","formatPercentChange","valueDifference","percentDifferenceNum","Math","abs","compType","percentDifference","percentDifferenceFormattedString","percentDifferenceNumber","shift","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["/home/pawank/Documents/dcim/superset/superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberPeriodOverPeriod/transformProps.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport {\n  ChartProps,\n  getMetricLabel,\n  getValueFormatter,\n  getNumberFormatter,\n  SimpleAdhocFilter,\n  ensureIsArray,\n  getTimeOffset,\n} from '@superset-ui/core';\nimport { getComparisonFontSize, getHeaderFontSize } from './utils';\n\nexport const parseMetricValue = (metricValue: number | string | null) => {\n  if (typeof metricValue === 'string') {\n    const dateObject = moment.utc(metricValue, moment.ISO_8601, true);\n    if (dateObject.isValid()) {\n      return dateObject.valueOf();\n    }\n    return 0;\n  }\n  return metricValue ?? 0;\n};\n\nexport default function transformProps(chartProps: ChartProps) {\n  /**\n   * This function is called after a successful response has been\n   * received from the chart data endpoint, and is used to transform\n   * the incoming data prior to being sent to the Visualization.\n   *\n   * The transformProps function is also quite useful to return\n   * additional/modified props to your data viz component. The formData\n   * can also be accessed from your CustomViz.tsx file, but\n   * doing supplying custom props here is often handy for integrating third\n   * party libraries that rely on specific props.\n   *\n   * A description of properties in `chartProps`:\n   * - `height`, `width`: the height/width of the DOM element in which\n   *   the chart is located\n   * - `formData`: the chart data request payload that was sent to the\n   *   backend.\n   * - `queriesData`: the chart data response payload that was received\n   *   from the backend. Some notable properties of `queriesData`:\n   *   - `data`: an array with data, each row with an object mapping\n   *     the column/alias to its value. Example:\n   *     `[{ col1: 'abc', metric1: 10 }, { col1: 'xyz', metric1: 20 }]`\n   *   - `rowcount`: the number of rows in `data`\n   *   - `query`: the query that was issued.\n   *\n   * Please note: the transformProps function gets cached when the\n   * application loads. When making changes to the `transformProps`\n   * function during development with hot reloading, changes won't\n   * be seen until restarting the development server.\n   */\n  const {\n    width,\n    height,\n    formData,\n    queriesData,\n    datasource: { currencyFormats = {}, columnFormats = {} },\n  } = chartProps;\n  const {\n    boldText,\n    headerFontSize,\n    headerText,\n    metric,\n    yAxisFormat,\n    currencyFormat,\n    subheaderFontSize,\n    comparisonColorScheme,\n    comparisonColorEnabled,\n    percentDifferenceFormat,\n  } = formData;\n  const { data: dataA = [] } = queriesData[0];\n  const data = dataA;\n  const metricName = getMetricLabel(metric);\n  const timeComparison = ensureIsArray(chartProps.rawFormData?.time_compare)[0];\n  const startDateOffset = chartProps.rawFormData?.start_date_offset;\n  const currentTimeRangeFilter = chartProps.rawFormData?.adhoc_filters?.filter(\n    (adhoc_filter: SimpleAdhocFilter) =>\n      adhoc_filter.operator === 'TEMPORAL_RANGE',\n  )?.[0];\n  const isCustomOrInherit =\n    timeComparison === 'custom' || timeComparison === 'inherit';\n  let dataOffset: string[] = [];\n  if (isCustomOrInherit) {\n    dataOffset = getTimeOffset(\n      currentTimeRangeFilter,\n      ensureIsArray(timeComparison),\n      startDateOffset || '',\n    );\n  }\n\n  const { value1, value2 } = data.reduce(\n    (acc: { value1: number; value2: number }, curr: { [x: string]: any }) => {\n      Object.keys(curr).forEach(key => {\n        if (\n          key.includes(\n            `${metricName}__${\n              !isCustomOrInherit ? timeComparison : dataOffset[0]\n            }`,\n          )\n        ) {\n          acc.value2 += curr[key];\n        } else if (key.includes(metricName)) {\n          acc.value1 += curr[key];\n        }\n      });\n      return acc;\n    },\n    { value1: 0, value2: 0 },\n  );\n\n  let bigNumber: number | string =\n    data.length === 0 ? 0 : parseMetricValue(value1);\n  let prevNumber: number | string =\n    data.length === 0 ? 0 : parseMetricValue(value2);\n\n  const numberFormatter = getValueFormatter(\n    metric,\n    currencyFormats,\n    columnFormats,\n    yAxisFormat,\n    currencyFormat,\n  );\n\n  const compTitles = {\n    r: 'Range' as string,\n    y: 'Year' as string,\n    m: 'Month' as string,\n    w: 'Week' as string,\n  };\n\n  const formatPercentChange = getNumberFormatter(percentDifferenceFormat);\n\n  let valueDifference: number | string = bigNumber - prevNumber;\n\n  let percentDifferenceNum;\n\n  if (!bigNumber && !prevNumber) {\n    percentDifferenceNum = 0;\n  } else if (!bigNumber || !prevNumber) {\n    percentDifferenceNum = bigNumber ? 1 : -1;\n  } else {\n    percentDifferenceNum = (bigNumber - prevNumber) / Math.abs(prevNumber);\n  }\n\n  const compType = compTitles[formData.timeComparison];\n  bigNumber = numberFormatter(bigNumber);\n  prevNumber = numberFormatter(prevNumber);\n  valueDifference = numberFormatter(valueDifference);\n  const percentDifference: string = formatPercentChange(percentDifferenceNum);\n\n  return {\n    width,\n    height,\n    data,\n    metricName,\n    bigNumber,\n    prevNumber,\n    valueDifference,\n    percentDifferenceFormattedString: percentDifference,\n    boldText,\n    headerFontSize: getHeaderFontSize(headerFontSize),\n    subheaderFontSize: getComparisonFontSize(subheaderFontSize),\n    headerText,\n    compType,\n    comparisonColorEnabled,\n    comparisonColorScheme,\n    percentDifferenceNumber: percentDifferenceNum,\n    currentTimeRangeFilter,\n    startDateOffset,\n    shift: timeComparison,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}