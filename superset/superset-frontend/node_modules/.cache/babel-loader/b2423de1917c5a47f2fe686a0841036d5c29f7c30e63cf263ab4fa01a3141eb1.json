{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { deepEqual } from '../utils/deep-equal';\nimport LightingEffect from '../effects/lighting/lighting-effect';\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\n\nfunction compareEffects(e1, e2) {\n  var _e1$order, _e2$order;\n\n  const o1 = (_e1$order = e1.order) !== null && _e1$order !== void 0 ? _e1$order : Infinity;\n  const o2 = (_e2$order = e2.order) !== null && _e2$order !== void 0 ? _e2$order : Infinity;\n  return o1 - o2;\n}\n\nexport default class EffectManager {\n  constructor() {\n    _defineProperty(this, \"effects\", void 0);\n\n    _defineProperty(this, \"_resolvedEffects\", []);\n\n    _defineProperty(this, \"_defaultEffects\", []);\n\n    _defineProperty(this, \"_needsRedraw\", void 0);\n\n    this.effects = [];\n    this._needsRedraw = 'Initial render';\n\n    this._setEffects([]);\n  }\n\n  addDefaultEffect(effect) {\n    const defaultEffects = this._defaultEffects;\n\n    if (!defaultEffects.find((e) => e.id === effect.id)) {\n      const index = defaultEffects.findIndex((e) => compareEffects(e, effect) > 0);\n\n      if (index < 0) {\n        defaultEffects.push(effect);\n      } else {\n        defaultEffects.splice(index, 0, effect);\n      }\n\n      this._setEffects(this.effects);\n    }\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      if (!deepEqual(props.effects, this.effects, 1)) {\n        this._setEffects(props.effects);\n      }\n    }\n  }\n\n  needsRedraw(opts = {\n    clearRedrawFlags: false\n  }) {\n    const redraw = this._needsRedraw;\n\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n\n    return redraw;\n  }\n\n  getEffects() {\n    return this._resolvedEffects;\n  }\n\n  _setEffects(effects) {\n    const oldEffectsMap = {};\n\n    for (const effect of this.effects) {\n      oldEffectsMap[effect.id] = effect;\n    }\n\n    const nextEffects = [];\n\n    for (const effect of effects) {\n      const oldEffect = oldEffectsMap[effect.id];\n\n      if (oldEffect && oldEffect !== effect) {\n        if (oldEffect.setProps) {\n          oldEffect.setProps(effect.props);\n          nextEffects.push(oldEffect);\n        } else {\n          oldEffect.cleanup();\n          nextEffects.push(effect);\n        }\n      } else {\n        nextEffects.push(effect);\n      }\n\n      delete oldEffectsMap[effect.id];\n    }\n\n    for (const removedEffectId in oldEffectsMap) {\n      oldEffectsMap[removedEffectId].cleanup();\n    }\n\n    this.effects = nextEffects;\n    this._resolvedEffects = nextEffects.concat(this._defaultEffects);\n\n    if (!effects.some((effect) => effect instanceof LightingEffect)) {\n      this._resolvedEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n\n    this._needsRedraw = 'effects changed';\n  }\n\n  finalize() {\n    for (const effect of this._resolvedEffects) {\n      effect.cleanup();\n    }\n\n    this.effects.length = 0;\n    this._resolvedEffects.length = 0;\n    this._defaultEffects.length = 0;\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DEFAULT_LIGHTING_EFFECT, \"DEFAULT_LIGHTING_EFFECT\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js\");reactHotLoader.register(compareEffects, \"compareEffects\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js\");reactHotLoader.register(EffectManager, \"EffectManager\", \"/home/pawank/Documents/dcim/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/node_modules/@deck.gl/core/dist/esm/lib/effect-manager.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["deepEqual","LightingEffect","DEFAULT_LIGHTING_EFFECT","compareEffects","e1","e2","_e1$order","_e2$order","o1","order","Infinity","o2","EffectManager","constructor","_defineProperty","effects","_needsRedraw","_setEffects","addDefaultEffect","effect","defaultEffects","_defaultEffects","find","e","id","index","findIndex","push","splice","setProps","props","needsRedraw","opts","clearRedrawFlags","redraw","getEffects","_resolvedEffects","oldEffectsMap","nextEffects","oldEffect","cleanup","removedEffectId","concat","some","finalize","length","__reactstandin__regenerateByEval","key","code","eval","reactHotLoader","reactHotLoaderGlobal","default","undefined","register","leaveModule","module"],"sources":["../../../src/lib/effect-manager.ts"],"sourcesContent":["import {deepEqual} from '../utils/deep-equal';\nimport LightingEffect from '../effects/lighting/lighting-effect';\nimport type {Effect} from './effect';\n\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\n\n/** Sort two effects. Returns 0 if equal, negative if e1 < e2, positive if e1 > e2 */\nfunction compareEffects(e1: Effect, e2: Effect): number {\n  const o1 = e1.order ?? Infinity;\n  const o2 = e2.order ?? Infinity;\n  return o1 - o2;\n}\n\nexport default class EffectManager {\n  effects: Effect[];\n  private _resolvedEffects: Effect[] = [];\n  /** Effect instances and order preference pairs, sorted by order */\n  private _defaultEffects: Effect[] = [];\n  private _needsRedraw: false | string;\n\n  constructor() {\n    this.effects = [];\n    this._needsRedraw = 'Initial render';\n    this._setEffects([]);\n  }\n\n  /**\n   * Register a new default effect, i.e. an effect presents regardless of user supplied props.effects\n   */\n  addDefaultEffect(effect: Effect) {\n    const defaultEffects = this._defaultEffects;\n    if (!defaultEffects.find(e => e.id === effect.id)) {\n      const index = defaultEffects.findIndex(e => compareEffects(e, effect) > 0);\n      if (index < 0) {\n        defaultEffects.push(effect);\n      } else {\n        defaultEffects.splice(index, 0, effect);\n      }\n      this._setEffects(this.effects);\n    }\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      // Compare effects against each other shallowly\n      if (!deepEqual(props.effects, this.effects, 1)) {\n        this._setEffects(props.effects);\n      }\n    }\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}): false | string {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  getEffects() {\n    return this._resolvedEffects;\n  }\n\n  private _setEffects(effects: Effect[]) {\n    const oldEffectsMap: Record<string, Effect> = {};\n    for (const effect of this.effects) {\n      oldEffectsMap[effect.id] = effect;\n    }\n\n    const nextEffects: Effect[] = [];\n    for (const effect of effects) {\n      const oldEffect = oldEffectsMap[effect.id];\n      if (oldEffect && oldEffect !== effect) {\n        if (oldEffect.setProps) {\n          oldEffect.setProps(effect.props);\n          nextEffects.push(oldEffect);\n        } else {\n          oldEffect.cleanup();\n          nextEffects.push(effect);\n        }\n      } else {\n        nextEffects.push(effect);\n      }\n      delete oldEffectsMap[effect.id];\n    }\n    for (const removedEffectId in oldEffectsMap) {\n      oldEffectsMap[removedEffectId].cleanup();\n    }\n    this.effects = nextEffects;\n\n    this._resolvedEffects = nextEffects.concat(this._defaultEffects);\n    // Special case for lighting: only add default instance if no LightingEffect is specified\n    if (!effects.some(effect => effect instanceof LightingEffect)) {\n      this._resolvedEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n    this._needsRedraw = 'effects changed';\n  }\n\n  finalize() {\n    for (const effect of this._resolvedEffects) {\n      effect.cleanup();\n    }\n\n    this.effects.length = 0;\n    this._resolvedEffects.length = 0;\n    this._defaultEffects.length = 0;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}